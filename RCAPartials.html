<!--
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
RCA MANAGER v3 - ENHANCED CLIENT-SIDE JAVASCRIPT
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
Includes: Theme toggle, keyboard shortcuts, search history, admin panel,
session heartbeat, and all existing functionality preserved.
-->

<script>
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  // CONFIGURATION & STATE
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

  let appConfig = null;
  let searchHistory = JSON.parse(localStorage.getItem('rcam_searchHistory') || '[]');
  let adminPanelOpen = false;

  // Initialize app on load
  document.addEventListener('DOMContentLoaded', initializeApp);

  async function initializeApp() {
    // Load config from server
    google.script.run.withSuccessHandler(config => {
      appConfig = config;

      // Apply saved theme
      const savedTheme = localStorage.getItem('rcam_theme') || config.ui.DEFAULT_THEME;
      setTheme(savedTheme);

      // Show admin button if admin
      if (config.isAdmin && config.features.ENABLE_ADMIN_PANEL) {
        document.getElementById('adminBtn')?.classList.remove('hidden');
      }

      // Show user email
      const userInfo = document.querySelector('.user-info');
      if (userInfo) {
        userInfo.textContent = config.userEmail.split('@')[0];
      }

      // Initialize features
      if (config.features.ENABLE_KEYBOARD_SHORTCUTS) initKeyboardShortcuts();
      if (config.features.ENABLE_SEARCH_HISTORY) renderSearchHistory();
      if (config.features.ENABLE_CASE_DISTRIBUTION) startHeartbeat();

      // Apply condensed layout if enabled
      if (config.features.ENABLE_CONDENSED_LAYOUT) {
        document.documentElement.setAttribute('data-layout', 'condensed');
      }

    }).getClientConfig();

    // Expand first sections by default
    document.querySelectorAll('.section-content').forEach((el, i) => {
      if (i < 2) el.classList.remove('hidden');
    });
  }

  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  // THEME SYSTEM
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

  function setTheme(theme) {
    document.documentElement.setAttribute('data-theme', theme);
    localStorage.setItem('rcam_theme', theme);

    const toggle = document.getElementById('themeToggle');
    if (toggle) {
      toggle.innerHTML = theme === 'dark' ? 'â˜€ï¸ Light' : 'ğŸŒ™ Dark';
    }
  }

  function toggleTheme() {
    const current = document.documentElement.getAttribute('data-theme') || 'dark';
    setTheme(current === 'dark' ? 'light' : 'dark');
  }

  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  // STATUS BAR MESSAGES
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

  function statusUpdate(msg, type = 'default') {
    const status = document.getElementById('status');
    if (!status) return;

    status.textContent = msg;
    status.className = ''; // Reset classes

    if (type === 'success' || msg.includes('claimed') || msg.includes('Updated') || msg.includes('Uploaded')) {
      status.classList.add('success');
    } else if (type === 'error' || msg.includes('error') || msg.includes('Error')) {
      status.classList.add('error');
    } else if (type === 'loading' || msg.includes('Fetching') || msg.includes('Uploading')) {
      status.classList.add('loading');
    }

    // Auto-clear after duration
    if (type !== 'loading') {
      setTimeout(() => {
        status.textContent = '';
        status.className = '';
      }, appConfig?.ui?.TOAST_DURATION_MS || 3000);
    }
  }

  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  // SECTION TOGGLE (COLLAPSIBLE)
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

  function toggleSection(sectionId) {
    const section = document.getElementById(sectionId);
    const header = section?.previousElementSibling;

    if (section.classList.contains('hidden')) {
      section.classList.remove('hidden');
      header?.classList.remove('collapsed');
    } else {
      section.classList.add('hidden');
      header?.classList.add('collapsed');
    }
  }

  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  // COPY TO CLIPBOARD
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

  function copyToClipboard(labelId) {
    const label = document.getElementById(labelId);
    if (!label) return;

    const text = label.innerText || label.textContent;

    if (navigator.clipboard) {
      navigator.clipboard.writeText(text).then(() => {
        statusUpdate('Copied: ' + text.substring(0, 20) + (text.length > 20 ? '...' : ''), 'success');
      });
    } else {
      // Fallback
      const tempInput = document.createElement('textarea');
      tempInput.value = text;
      document.body.appendChild(tempInput);
      tempInput.select();
      document.execCommand('copy');
      document.body.removeChild(tempInput);
      statusUpdate('Copied', 'success');
    }
  }

  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  // CANNED RESPONSES
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

  function addCannedResponse(response) {
    const textarea = document.getElementById('rebuttal-response');
    if (!textarea) return;

    const cursorPosition = textarea.selectionStart;
    const textBeforeCursor = textarea.value.substring(0, cursorPosition);
    const textAfterCursor = textarea.value.substring(cursorPosition);

    textarea.value = textBeforeCursor + response + textAfterCursor;

    const newCursorPosition = cursorPosition + response.length;
    textarea.setSelectionRange(newCursorPosition, newCursorPosition);
    textarea.focus();
  }

  let cannedResponses = [];

  function showCannedModal() {
    document.getElementById('cannedModal').style.display = 'block';
    document.getElementById('modalOverlay')?.classList.add('active');
    fetchCannedResponses();
  }

  function closeCannedModal() {
    document.getElementById('cannedModal').style.display = 'none';
    document.getElementById('modalOverlay')?.classList.remove('active');
  }

  function fetchCannedResponses() {
    google.script.run.withSuccessHandler(data => {
      cannedResponses = data;
      const dropdown = document.getElementById('savedResList');
      if (!dropdown) return;

      dropdown.innerHTML = '<option value="">-- Select --</option>';
      cannedResponses.forEach(r => {
        const opt = document.createElement('option');
        opt.value = r.name;
        opt.textContent = r.name;
        dropdown.appendChild(opt);
      });
    }).getCannedResponses();
  }

  function loadCannedResponse() {
    const name = document.getElementById('responseList')?.value;
    const match = cannedResponses.find(r => r.name === name);
    if (match) {
      document.getElementById('responseBox').value = match.response;
      document.getElementById('responseName').value = match.name;
    }
  }

  function saveCanned() {
    const name = document.getElementById('responseName')?.value.trim();
    const response = document.getElementById('responseBox')?.value.trim();

    if (!name || !response) {
      alert('Please enter both name and response');
      return;
    }

    google.script.run.withSuccessHandler(msg => {
      statusUpdate('Response ' + msg, 'success');
      fetchCannedResponses();
    }).saveCannedResponse(name, response);
  }

  function clearCanned() {
    document.getElementById('responseList').value = '';
    document.getElementById('responseBox').value = '';
    document.getElementById('responseName').value = '';
  }

  function insertCanned() {
    const response = document.getElementById('responseBox')?.value;
    if (response) {
      addCannedResponse(response);
      closeCannedModal();
    }
  }

  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  // CASE MANAGEMENT (INPUT / DISPLAY)
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

  function inputCaseInfo(data) {
    // Check for case conflict (case already taken by another analyst)
    if (data[0] && data[0].includes('already taken')) {
      alert('âš ï¸ Case Conflict!\n\n' + data[0] + '\n\nPlease click "Get Case" to fetch a new case.');
      statusUpdate(data[0], 'error');
      return;
    }

    // Check for no cases available
    if (data[0] === 'No Cases') {
      statusUpdate('No cases available in queue', 'default');
      return;
    }

    statusUpdate(data[0], 'success');
    const values = data;

    const table = document.getElementById('caseinfo');
    if (!table) return;

    let valueCounter = 1;

    for (let i = 0; i < table.rows.length; i++) {
      const row = table.rows[i];
      for (let j = 0; j < row.cells.length; j++) {
        if ((i * row.cells.length + j) % 2 === 1 && valueCounter < values.length) {
          row.cells[j].innerHTML = values[valueCounter];
          valueCounter++;
        }
      }
    }

    document.getElementById('policy').innerHTML = data[14] || '';
    document.getElementById('internal-notes').innerHTML = data[15] || '';

    if (data[16]?.length > 2) {
      AffirmLink(data[16]);
    }

    if (data[7] === 'INQ') {
      document.getElementById('recovery-notes').value = 'This is an Inquiry.';
    }
  }

  function getCase() {
    statusUpdate('Fetching case...', 'loading');

    const itnInput = document.getElementById('confirmation-number');

    if (itnInput?.value !== '') {
      const itn = itnInput.value;

      // Add to search history
      addToSearchHistory(itn);

      google.script.run.withSuccessHandler(updatesearch).searchCase(itn);
      clearTableData();

      setTimeout(() => {
        statusUpdate('Fetching reservation info...', 'loading');
        google.script.run.withSuccessHandler(updateTtable).getReservationData(itn);
      }, 2000);

      setTimeout(() => {
        const row = document.getElementById('cId')?.innerText;
        if (row) {
          google.script.run.withSuccessHandler(claimstatus).checkClaim(row);
        }
      }, 10000);

    } else {
      clearTableData();
      // Get portal value if set, otherwise use empty string to get any available case
      const portal = document.getElementById('portal')?.value || '';

      // Call backend - it will fetch the next available case regardless of portal
      google.script.run.withSuccessHandler(inputCaseInfo).getCase(portal);

      setTimeout(() => {
        const itn = document.getElementById('itn')?.innerText;
        if (itn) {
          statusUpdate('Fetching reservation info...', 'loading');
          google.script.run.withSuccessHandler(updateTtable).getReservationData(itn);
        }
      }, 6000);

      setTimeout(() => {
        const row = document.getElementById('cId')?.innerText;
        if (row) {
          google.script.run.withSuccessHandler(claimstatus).checkClaim(row);
        }
      }, 10000);
    }
  }

  function claimstatus(response) {
    statusUpdate(response[0], response[1] === '#2ea44f' ? 'success' : 'error');
  }

  function updatesearch(data) {
    statusUpdate(data[0], 'success');
    const values = data;
    const table = document.getElementById('caseinfo');

    if (!table) return;

    let valueCounter = 1;

    for (let i = 0; i < table.rows.length; i++) {
      const row = table.rows[i];
      for (let j = 0; j < row.cells.length; j++) {
        if ((i * row.cells.length + j) % 2 === 1 && valueCounter < values.length) {
          row.cells[j].innerHTML = values[valueCounter];
          valueCounter++;
        }
      }
    }

    document.getElementById('policy').innerHTML = data[14] || '';
    if (data[18]?.length > 2) AffirmLink(data[18]);
    document.getElementById('issuer-notes').value = data[15] || '';
    document.getElementById('rebuttal-response').value = data[16] || '';
    document.getElementById('internal-notes').value = data[17] || '';
    document.getElementById('rca').value = data[19] || '';
  }

  function updateTtable(data) {
    statusUpdate(data[0], 'success');
    const values = data;
    const table = document.getElementById('transInfo');

    if (!table) return;

    let valueCounter = 1;

    for (let i = 0; i < table.rows.length; i++) {
      const row = table.rows[i];
      for (let j = 0; j < row.cells.length; j++) {
        if ((i * row.cells.length + j) % 2 === 1 && valueCounter < values.length) {
          row.cells[j].innerHTML = values[valueCounter];
          valueCounter++;
        }
      }
    }
  }

  function AffirmLink(link) {
    const portalCell = document.getElementById('alink');
    if (!portalCell) return;

    const hyperlink = document.createElement('a');
    hyperlink.href = 'https://' + link;
    hyperlink.textContent = 'Affirm';
    hyperlink.target = '_blank';
    hyperlink.style.color = 'var(--accent-green)';

    portalCell.textContent = '';
    portalCell.appendChild(hyperlink);
  }

  function clearTableData() {
    document.querySelectorAll('.data').forEach(el => el.textContent = '');

    ['rca', 'issuer-notes', 'rebuttal-response', 'internal-notes', 'recovery-notes',
      'confirmpage', 'confirmpages', 'checkoutpage', 'checkoutpages', 'wexandrefund', 'accproof'
    ].forEach(id => {
      const el = document.getElementById(id);
      if (el) el.value = '';
    });

    const icon = document.getElementById('icon');
    if (icon) icon.innerHTML = 'âŒ';

    const uploadStatus = document.getElementById('Uploadstatus');
    if (uploadStatus) uploadStatus.innerHTML = '';

    document.querySelectorAll('.output').forEach(el => el.textContent = '');
    document.querySelectorAll('.delete-btn').forEach(btn => btn.click());
  }

  function getInfo() {
    const itn = document.getElementById('itn')?.innerText;
    if (itn) {
      statusUpdate('Fetching reservation info...', 'loading');
      google.script.run.withSuccessHandler(updateTtable).getReservationData(itn);
    }
  }

  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  // RESOLVE CASE
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

  function Resolve() {
    const rca = document.getElementById('rca')?.value;
    const res = document.getElementById('rebuttal-response')?.value;

    if (!rca || !res) {
      alert('RCA or Rebuttal Response is missing.');
      return;
    }

    const refundAmount = document.querySelector('#caseinfo > tbody:nth-child(1) > tr:nth-child(8) > td:nth-child(2)')?.innerText?.trim();
    const uploadStatus = document.querySelectorAll('.output')[2]?.textContent;

    // Check if refund screenshot uploaded but amount is missing or zero
    if (uploadStatus === 'Uploaded' && (!refundAmount || refundAmount === '0' || refundAmount === '')) {
      if (!confirm('âš ï¸ Missing Refund Amount!\n\nRefund screenshot was uploaded but the Refund Amount is not set.\n\nDo you want to continue without updating the refund amount?')) return;
    }

    const row = document.getElementById('cId')?.innerText;
    const aff = document.getElementById('issuer-notes')?.value;
    const notes = document.getElementById('internal-notes')?.value;

    google.script.run.withSuccessHandler(msg => {
      statusUpdate(msg, 'success');
      clearTableData();

      // Check break mode - if enabled, don't auto-fetch next case
      const breakMode = document.getElementById('breakMode')?.checked;
      if (breakMode) {
        statusUpdate('â˜• Break mode active - ready when you are', 'default');
        return;
      }

      // Auto-get next case if not searching specific ITN
      if (!document.getElementById('confirmation-number')?.value) {
        setTimeout(getCase, 3000);
      }
    }).resolveRCA(row, rca, res, aff, notes);
  }

  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  // FILE UPLOADS
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

  async function saveFiles1() {
    const uploadBoxes = document.querySelectorAll('.upload-box');
    const itn = document.getElementById('itn')?.innerText;
    const row = document.getElementById('tId')?.innerText;

    if (!row) {
      alert('ERROR: Transaction Info Missing!');
      return;
    }

    for (let box of uploadBoxes) {
      const img = box.querySelector('img');
      const output = box.nextElementSibling;

      if (img?.src.startsWith('blob')) {
        statusUpdate('Uploading images...', 'loading');

        const base64Data = await getBase64FromImage(img.src);

        google.script.run.withSuccessHandler(response => {
          if (output) output.textContent = response.status;
        }).uploadImageToDrive(row, itn, box.id, base64Data);
      }
    }
  }

  async function getBase64FromImage(imageUrl) {
    const response = await fetch(imageUrl);
    const blob = await response.blob();
    return new Promise((resolve, reject) => {
      const reader = new FileReader();
      reader.onloadend = () => resolve(reader.result.split(',')[1]);
      reader.onerror = reject;
      reader.readAsDataURL(blob);
    });
  }

  async function uploadFiles() {
    const statusEl = document.getElementById('Uploadstatus');

    const getFileContent = file => {
      return new Promise((resolve, reject) => {
        if (statusEl) statusEl.innerHTML = 'Uploading... <span class="spinner"></span>';
        const reader = new FileReader();
        reader.onload = () => resolve(reader.result.split(',')[1]);
        reader.onerror = reject;
        reader.readAsDataURL(file);
      });
    };

    const prepareFile = async file => ({
      name: file.name,
      mimeType: file.type,
      content: await getFileContent(file)
    });

    const itn = document.getElementById('itn')?.innerText;
    const confirmpage = document.getElementById('confirmpage')?.files[0];
    const checkoutpage = document.getElementById('checkoutpage')?.files[0];

    if (!confirmpage || !checkoutpage) {
      alert('Confirmation and Checkout pages are required!');
      return;
    }

    const confirmpages = document.getElementById('confirmpages')?.files[0];
    const checkoutpages = document.getElementById('checkoutpages')?.files[0];
    const wexandrefund = document.getElementById('wexandrefund')?.files[0];
    const accproof = document.getElementById('accproof')?.files[0];

    const formData = {
      itn: itn,
      confirmpage: await prepareFile(confirmpage),
      checkoutpage: await prepareFile(checkoutpage),
      confirmpages: confirmpages ? await prepareFile(confirmpages) : null,
      checkoutpages: checkoutpages ? await prepareFile(checkoutpages) : null,
      wexandrefund: wexandrefund ? await prepareFile(wexandrefund) : null,
      accproof: accproof ? await prepareFile(accproof) : null
    };

    google.script.run.withSuccessHandler(res => {
      if (statusEl) {
        statusEl.innerHTML = `<strong>${res.message}</strong><br>Uploaded:<br>` + res.uploaded.join('<br>');
      }

      ['confirmpage', 'confirmpages', 'checkoutpage', 'checkoutpages', 'wexandrefund', 'accproof'].forEach(id => {
        const el = document.getElementById(id);
        if (el) el.value = '';
      });
    }).uploadAllFiles(formData);
  }

  // Setup paste handlers for upload boxes
  document.addEventListener('DOMContentLoaded', () => {
    document.querySelectorAll('.upload-box').forEach(box => {
      const previewImage = box.querySelector('img');
      const span = box.querySelector('span');
      const deleteButton = box.querySelector('.delete-btn');

      box.addEventListener('paste', event => {
        const items = event.clipboardData?.items;
        if (!items) return;

        for (let item of items) {
          if (item.type.startsWith('image/')) {
            const blob = item.getAsFile();
            const url = URL.createObjectURL(blob);

            if (previewImage) {
              previewImage.src = url;
              previewImage.style.display = 'block';
            }
            if (span) span.style.display = 'none';
            if (deleteButton) deleteButton.style.display = 'block';
            box.classList.add('has-image');
            break;
          }
        }
      });

      if (deleteButton) {
        deleteButton.addEventListener('click', () => {
          if (previewImage) {
            previewImage.src = '';
            previewImage.style.display = 'none';
          }
          if (span) span.style.display = 'block';
          deleteButton.style.display = 'none';
          box.classList.remove('has-image');
        });
      }
    });
  });

  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  // RECOVERY
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

  function RecoveryReq() {
    const row = document.getElementById('tId')?.innerText;
    const selectedOption = document.getElementById('recovery-details')?.value;

    if (!row) {
      alert('ERROR: Transaction Info Missing!');
      return;
    }

    if (!selectedOption) {
      alert('No option selected');
      return;
    }

    if (selectedOption === 'Recovery Needed') {
      const itn = document.getElementById('itn')?.innerText;
      const hotel = document.getElementById('hotel')?.innerText;
      const rnum = document.getElementById('rnum')?.innerText;
      const cin = document.querySelectorAll('.data')[19]?.innerText;
      const cout = document.querySelectorAll('.data')[20]?.innerText;
      const cbcode = document.querySelectorAll('.data')[4]?.innerText;
      const amt = document.querySelectorAll('.data')[8]?.innerText;
      const notes = document.getElementById('recovery-notes')?.value;

      google.script.run.withSuccessHandler(msg => {
        statusUpdate(msg, 'success');
        document.getElementById('recovery-notes').value = '';
        document.getElementById('icon').innerHTML = 'âœ…';
      }).sendForRecovery(itn, rnum, amt, cin, cout, hotel, cbcode, notes);

    } else {
      const itn = document.getElementById('itn')?.innerText;
      const rnum = document.getElementById('rnum')?.innerText;
      const amt = document.querySelectorAll('.data')[8]?.innerText;
      const notes = document.getElementById('recovery-notes')?.value;

      google.script.run.withSuccessHandler(msg => {
        statusUpdate(msg, 'success');
        document.getElementById('recovery-notes').value = '';
        document.getElementById('icon').innerHTML = 'âœ…';
      }).sendForVbException(itn, rnum, amt, selectedOption, notes);
    }
  }

  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  // PENDING CASES
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

  function getPendingCases() {
    statusUpdate('Fetching pending cases...', 'loading');
    google.script.run.withSuccessHandler(updatePending).getPendingCases();
  }

  function updatePending(data) {
    const container = document.querySelector('.working-rca');
    const table = document.getElementById('pendingcase');
    const message = document.getElementById('pendingmessage');
    const hideBtn = document.getElementById('hide');

    if (data?.length > 0) {
      if (container) container.style.display = 'block';
      if (hideBtn) hideBtn.style.display = 'inline';
      if (table) table.style.display = 'table';
      if (message) message.style.display = 'none';

      // Clear existing rows
      if (table) {
        while (table.rows.length > 1) {
          table.deleteRow(1);
        }

        // Add new rows
        data.forEach(rowData => {
          const row = table.insertRow();
          rowData.forEach(cellData => {
            const cell = row.insertCell();
            cell.textContent = cellData;
          });
        });

        // Hide row number column
        table.querySelectorAll('th:first-child, td:first-child').forEach(el => {
          el.style.display = 'none';
        });
      }

      DeadlineReaching();
    } else {
      if (container) container.style.display = 'block';
      if (message) message.style.display = 'block';
      if (table) table.style.display = 'none';
    }
  }

  function DeadlineReaching() {
    const tableRows = document.getElementById('pendingcase')?.getElementsByTagName('tr');
    if (!tableRows) return;

    for (let row = 1; row < tableRows.length; row++) {
      const cellToCheck = tableRows[row].getElementsByTagName('td')[5];
      if (cellToCheck && reviewDate(cellToCheck) < 5) {
        addCautionIconToCell(cellToCheck);
      }
    }
  }

  function addCautionIconToCell(cell) {
    const existing = cell.querySelector('.caution-icon');
    if (existing) return;

    const cautionIcon = document.createElement('span');
    cautionIcon.className = 'caution-icon';
    cautionIcon.innerText = 'âš ï¸';
    cell.appendChild(cautionIcon);
  }

  function reviewDate(cell) {
    const today = new Date();
    const dueDt = new Date(cell.textContent);
    const diffTime = Math.abs(today - dueDt);
    return Math.ceil(diffTime / (1000 * 60 * 60 * 24));
  }

  function hidePendingTable() {
    document.querySelector('.working-rca').style.display = 'none';
    document.getElementById('hide').style.display = 'none';
  }

  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  // QUEUE STATS
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

  function getCount() {
    statusUpdate('Fetching queue stats...', 'loading');
    google.script.run.withSuccessHandler(response => {
      const spans = document.querySelectorAll('.queue-status span');
      if (spans.length >= 7) {
        spans[0].textContent = response.myCount;
        spans[1].textContent = response.myFraud;
        spans[2].textContent = response.priority;
        spans[3].textContent = response.affirm;
        spans[4].textContent = response.amex;
        spans[5].textContent = response.braintree;
        spans[6].textContent = response.chase;
      }
      statusUpdate('Stats loaded', 'success');
    }).agentCount();
  }

  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  // EDIT CELL (REFUND / ROOM TYPE)
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

  function editCell(editIcon) {
    const currTd = editIcon.closest('td');
    const td = editIcon.closest('td').nextElementSibling;
    const currentValue = td.textContent.trim();

    const input = document.createElement('input');
    input.type = 'text';
    input.value = currentValue;
    input.style.width = '100%';

    td.innerHTML = '';
    td.appendChild(input);
    input.focus();

    const saveIcon = document.createElement('span');
    saveIcon.innerHTML = 'ğŸ’¾';
    saveIcon.classList.add('action-icons');
    saveIcon.onclick = () => saveCell(input, td, saveIcon, currTd);

    editIcon.replaceWith(saveIcon);
  }

  function saveCell(input, td, saveIcon, currTd) {
    const newValue = input.value.trim();
    td.textContent = newValue;

    const editIcon = document.createElement('span');
    editIcon.innerHTML = 'âœï¸';
    editIcon.classList.add('action-icons');
    editIcon.onclick = () => editCell(editIcon);

    saveIcon.replaceWith(editIcon);

    if (currTd.innerText.includes('Room Type')) {
      const row = document.getElementById('tId')?.innerText;
      if (row) google.script.run.updateRoomType(row, newValue);
    } else {
      const row = document.getElementById('cId')?.innerText;
      if (row) google.script.run.updateRefundAmount(row, newValue);
    }
  }

  // Textarea character limit
  document.addEventListener('DOMContentLoaded', () => {
    const textarea = document.getElementById('issuer-notes');
    const errorMsg = document.getElementById('errorMsg');
    const MAX_ROWS = 30;
    const MAX_CHARS = 2500;

    if (textarea) {
      textarea.addEventListener('input', function () {
        const lines = this.value.split('\n');
        const charCount = this.value.length;

        if (lines.length > MAX_ROWS) {
          if (errorMsg) errorMsg.textContent = `Error: Maximum of ${MAX_ROWS} rows allowed.`;
          this.value = lines.slice(0, MAX_ROWS).join('\n');
        } else if (charCount > MAX_CHARS) {
          if (errorMsg) errorMsg.textContent = `Error: Maximum of ${MAX_CHARS} characters allowed.`;
          this.value = this.value.slice(0, MAX_CHARS);
        } else {
          if (errorMsg) errorMsg.textContent = '';
        }
      });
    }
  });

  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  // BOOKING DATA / CANNED RES
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

  function getBookingData() {
    const row = document.getElementById('cId')?.innerText;
    if (!row) return;

    google.script.run.withSuccessHandler(response => {
      addCannedResponse(response);
    }).createCannedRes(row);
  }

  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  // KEYBOARD SHORTCUTS
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

  function initKeyboardShortcuts() {
    document.addEventListener('keydown', event => {
      // Don't trigger if typing in input/textarea
      if (['INPUT', 'TEXTAREA', 'SELECT'].includes(document.activeElement.tagName)) {
        // Only allow Escape
        if (event.key === 'Escape') {
          document.activeElement.blur();
        }
        return;
      }

      // Ctrl/Cmd shortcuts
      if (event.ctrlKey || event.metaKey) {
        switch (event.key.toLowerCase()) {
          case 'enter':
            event.preventDefault();
            Resolve();
            break;
          case 'g':
            event.preventDefault();
            getCase();
            break;
          case 'p':
            event.preventDefault();
            getPendingCases();
            break;
          case 's':
            event.preventDefault();
            saveFiles1();
            break;
        }
      }

      // Single key shortcuts (when not in input)
      switch (event.key) {
        case '?':
          showShortcutsHelp();
          break;
        case 'Escape':
          closeCannedModal();
          closeAdminPanel();
          break;
      }
    });
  }

  function showShortcutsHelp() {
    alert(`Keyboard Shortcuts:
  
Ctrl+Enter  â†’  Resolve case
Ctrl+G      â†’  Get new case
Ctrl+P      â†’  Show pending cases
Ctrl+S      â†’  Save uploads
Escape      â†’  Close modals
?           â†’  Show this help`);
  }

  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  // SEARCH HISTORY
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

  function addToSearchHistory(itn) {
    if (!itn || !appConfig?.features?.ENABLE_SEARCH_HISTORY) return;

    // Remove if already exists
    searchHistory = searchHistory.filter(i => i !== itn);

    // Add to front
    searchHistory.unshift(itn);

    // Limit size
    if (searchHistory.length > (appConfig?.ui?.SEARCH_HISTORY_LIMIT || 10)) {
      searchHistory.pop();
    }

    localStorage.setItem('rcam_searchHistory', JSON.stringify(searchHistory));
    renderSearchHistory();
  }

  function renderSearchHistory() {
    const container = document.getElementById('searchHistory');
    if (!container || !appConfig?.features?.ENABLE_SEARCH_HISTORY) return;

    container.innerHTML = '';

    searchHistory.slice(0, 5).forEach(itn => {
      const chip = document.createElement('span');
      chip.className = 'search-chip';
      chip.textContent = itn;
      chip.onclick = () => {
        document.getElementById('confirmation-number').value = itn;
        getCase();
      };
      container.appendChild(chip);
    });
  }

  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  // SESSION HEARTBEAT (for case distribution)
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

  function startHeartbeat() {
    // Initial heartbeat
    google.script.run.recordHeartbeat();

    // Periodic heartbeat
    setInterval(() => {
      google.script.run.recordHeartbeat();
    }, appConfig?.session?.HEARTBEAT_INTERVAL_MS || 60000);

    // Mark inactive on page unload
    window.addEventListener('beforeunload', () => {
      google.script.run.markInactive();
    });
  }

  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  // ADMIN PANEL
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

  function toggleAdminPanel() {
    const panel = document.getElementById('adminPanel');
    if (!panel) return;

    adminPanelOpen = !adminPanelOpen;
    panel.classList.toggle('open', adminPanelOpen);

    if (adminPanelOpen) {
      loadAdminData();
    }
  }

  function closeAdminPanel() {
    const panel = document.getElementById('adminPanel');
    if (panel) {
      panel.classList.remove('open');
      adminPanelOpen = false;
    }
  }

  function loadAdminData() {
    // Load analyst stats
    google.script.run.withSuccessHandler(stats => {
      renderAnalystStats(stats);
    }).getAnalystStats();

    // Load case distribution summary
    google.script.run.withSuccessHandler(summary => {
      renderDistributionSummary(summary);
    }).getCaseDistributionSummary();

    // Load active analysts
    google.script.run.withSuccessHandler(analysts => {
      renderActiveAnalysts(analysts);
    }).getActiveAnalysts();
  }

  function renderAnalystStats(stats) {
    const container = document.getElementById('analystStatsContainer');
    if (!container || !stats) return;

    container.innerHTML = stats.slice(0, 10).map(s => `
    <div class="analyst-list-item">
      <div>
        <span class="analyst-name">${s.name}</span>
        <span class="analyst-stats">Avg: ${s.avgTimeMinutes}min</span>
      </div>
      <div>
        <strong>${s.resolvedToday}</strong> today
      </div>
    </div>
  `).join('');
  }

  function renderDistributionSummary(summary) {
    if (!summary) return;

    const el = document.getElementById('distributionSummary');
    if (el) {
      el.innerHTML = `
      <div class="admin-stat-card">
        <h4>URGENCY</h4>
        <div>Critical (0-2d): <strong style="color:var(--accent-red)">${summary.byUrgency?.critical || 0}</strong></div>
        <div>Warning (3-5d): <strong style="color:var(--accent-yellow)">${summary.byUrgency?.warning || 0}</strong></div>
        <div>Normal (6+d): <strong style="color:var(--accent-green)">${summary.byUrgency?.normal || 0}</strong></div>
      </div>
    `;
    }
  }

  function renderActiveAnalysts(analysts) {
    const container = document.getElementById('activeAnalystsContainer');
    if (!container) return;

    if (!analysts || analysts.length === 0) {
      container.innerHTML = '<p style="color:var(--text-muted)">No active analysts</p>';
      return;
    }

    container.innerHTML = analysts.map(a => `
    <div style="display:flex;align-items:center;gap:8px;padding:6px 0;">
      <span class="analyst-active"></span>
      <span>${a.email.split('@')[0]}</span>
    </div>
  `).join('');
  }

  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  // ADMIN PANEL - CONFIG TAB (Sheet/Folder IDs)
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

  function showAdminTab(tab) {
    const statsTab = document.getElementById('adminTabStats');
    const configTab = document.getElementById('adminTabConfig');
    const btnStats = document.getElementById('tabStats');
    const btnConfig = document.getElementById('tabConfig');

    if (tab === 'stats') {
      statsTab.style.display = 'block';
      configTab.style.display = 'none';
      btnStats.classList.add('primary');
      btnConfig.classList.remove('primary');
      loadAdminData();
    } else {
      statsTab.style.display = 'none';
      configTab.style.display = 'block';
      btnStats.classList.remove('primary');
      btnConfig.classList.add('primary');
      loadSheetConfig();
    }
  }

  function loadSheetConfig() {
    google.script.run.withSuccessHandler(config => {
      if (config.error) {
        alert(config.error);
        return;
      }
      renderSheetConfig(config.sheets, 'sheetConfigContainer', 'sheet');
      renderSheetConfig(config.folders, 'folderConfigContainer', 'folder');
    }).withFailureHandler(err => {
      alert('Error loading config: ' + err);
    }).getSheetConfig();
  }

  function renderSheetConfig(items, containerId, type) {
    const container = document.getElementById(containerId);
    if (!container) return;

    const LABELS = {
      // Sheets
      RCA_DATA: 'RCA Data (Main)',
      CB_CONTROLLER: 'CB Controller',
      RECOVERY: 'Recovery',
      VB_EXCEPTION: 'VB Exception',
      EMAIL_CONFIRMATION: 'Email Confirmation',
      CANNED_RESPONSES: 'Canned Responses',
      // Folders
      IMAGES: 'Images',
      CONFIRM_PAGE: 'Confirmation PDFs',
      CHECKOUT_PAGE: 'Checkout PDFs',
      WEX_REFUND: 'WEX/Refund PDFs',
      ACCERTIFY: 'Accertify PDFs'
    };

    container.innerHTML = Object.entries(items).map(([key, val]) => `
            <div style="margin-bottom:12px;padding:8px;background:var(--bg-card);border-radius:4px;">
                <label style="font-size:10px;color:var(--text-muted);margin-bottom:4px;display:block;">
                    ${LABELS[key] || key}
                    ${val.isCustom ? '<span style="color:var(--accent-yellow);">âš¡ Custom</span>' : ''}
                </label>
                <div style="display:flex;gap:6px;">
                    <input type="text" 
                           id="${type}_${key}" 
                           value="${val.current}" 
                           style="flex:1;font-size:11px;font-family:monospace;">
                    <button onclick="save${type === 'sheet' ? 'Sheet' : 'Folder'}Id('${key}')" 
                            class="small">ğŸ’¾</button>
                    ${val.isCustom ? `<button onclick="reset${type === 'sheet' ? 'Sheet' : 'Folder'}Id('${key}')" 
                            class="small danger">â†º</button>` : ''}
                </div>
            </div>
        `).join('');
  }

  function saveSheetId(key) {
    const input = document.getElementById('sheet_' + key);
    if (!input) return;

    const newId = input.value.trim();
    google.script.run.withSuccessHandler(result => {
      if (result.success) {
        statusUpdate(result.message, 'success');
        loadSheetConfig();
      } else {
        alert('Error: ' + result.error);
      }
    }).updateSheetId(key, newId);
  }

  function saveFolderId(key) {
    const input = document.getElementById('folder_' + key);
    if (!input) return;

    const newId = input.value.trim();
    google.script.run.withSuccessHandler(result => {
      if (result.success) {
        statusUpdate(result.message, 'success');
        loadSheetConfig();
      } else {
        alert('Error: ' + result.error);
      }
    }).updateFolderId(key, newId);
  }

  function resetSheetId(key) {
    if (!confirm('Reset ' + key + ' to default value?')) return;

    google.script.run.withSuccessHandler(result => {
      if (result.success) {
        statusUpdate(result.message, 'success');
        loadSheetConfig();
      }
    }).resetSheetId(key);
  }

  function resetFolderId(key) {
    if (!confirm('Reset ' + key + ' to default value?')) return;

    google.script.run.withSuccessHandler(result => {
      if (result.success) {
        statusUpdate(result.message, 'success');
        loadSheetConfig();
      }
    }).resetFolderId(key);
  }

</script><!--
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
RCA MANAGER v3 - PREMIUM DESIGN SYSTEM STYLESHEET
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
Supports Dark (default) and Light mode via CSS variables.
Fonts: Space Grotesk (UI) + Space Mono (Data)
-->

<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link
  href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@400;500;600;700&family=Space+Mono:wght@400;700&display=swap"
  rel="stylesheet">

<style>
  /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   CSS CUSTOM PROPERTIES (THEME SYSTEM)
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */

  :root {
    /* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
     DARK THEME (DEFAULT)
     â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    --bg-primary: #000000;
    --bg-secondary: #0a0a0a;
    --bg-elevated: #111111;
    --bg-card: #151515;
    --bg-input: #1a1a1a;

    --border: #1f1f1f;
    --border-hover: #2a2a2a;
    --border-focus: #3a3a3a;

    --text-primary: #ffffff;
    --text-secondary: #888888;
    --text-muted: #555555;
    --text-inverse: #000000;

    --accent-green: #00ff88;
    --accent-green-dim: rgba(0, 255, 136, 0.15);
    --accent-red: #ff0055;
    --accent-red-dim: rgba(255, 0, 85, 0.15);
    --accent-yellow: #ffcc00;
    --accent-yellow-dim: rgba(255, 204, 0, 0.15);
    --accent-blue: #0088ff;
    --accent-blue-dim: rgba(0, 136, 255, 0.15);

    --shadow-sm: 0 1px 2px rgba(0, 0, 0, 0.5);
    --shadow-md: 0 4px 12px rgba(0, 0, 0, 0.4);
    --shadow-lg: 0 8px 24px rgba(0, 0, 0, 0.5);

    --glow-green: 0 0 20px rgba(0, 255, 136, 0.3);
    --glow-red: 0 0 20px rgba(255, 0, 85, 0.3);
  }

  [data-theme="light"] {
    /* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
     LIGHT THEME
     â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    --bg-primary: #f8f9fa;
    --bg-secondary: #ffffff;
    --bg-elevated: #ffffff;
    --bg-card: #f1f3f5;
    --bg-input: #e9ecef;

    --border: #dee2e6;
    --border-hover: #ced4da;
    --border-focus: #adb5bd;

    --text-primary: #1a1a1a;
    --text-secondary: #495057;
    --text-muted: #868e96;
    --text-inverse: #ffffff;

    --accent-green: #00cc6a;
    --accent-green-dim: rgba(0, 204, 106, 0.12);
    --accent-red: #e03131;
    --accent-red-dim: rgba(224, 49, 49, 0.12);
    --accent-yellow: #f59f00;
    --accent-yellow-dim: rgba(245, 159, 0, 0.12);
    --accent-blue: #1971c2;
    --accent-blue-dim: rgba(25, 113, 194, 0.12);

    --shadow-sm: 0 1px 3px rgba(0, 0, 0, 0.08);
    --shadow-md: 0 4px 12px rgba(0, 0, 0, 0.08);
    --shadow-lg: 0 8px 24px rgba(0, 0, 0, 0.12);

    --glow-green: 0 0 12px rgba(0, 204, 106, 0.25);
    --glow-red: 0 0 12px rgba(224, 49, 49, 0.25);
  }

  /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   TYPOGRAPHY
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */

  * {
    box-sizing: border-box;
    margin: 0;
    padding: 0;
  }

  body {
    font-family: 'Space Grotesk', -apple-system, BlinkMacSystemFont, sans-serif;
    font-size: 13px;
    line-height: 1.5;
    background-color: var(--bg-primary);
    color: var(--text-primary);
    margin: 0;
    padding: 0;
    min-height: 100vh;
    display: flex;
    flex-direction: column;
    transition: background-color 0.3s ease, color 0.3s ease;
  }

  .mono {
    font-family: 'Space Mono', 'Consolas', monospace;
    font-weight: 700;
  }

  /* Meta labels */
  .meta-label {
    font-size: 10px;
    text-transform: uppercase;
    letter-spacing: 1.5px;
    color: var(--text-muted);
    font-weight: 600;
  }

  /* Headings */
  h1,
  h2,
  h3,
  h4 {
    font-family: 'Space Grotesk', sans-serif;
    text-transform: uppercase;
    letter-spacing: 1px;
    font-weight: 700;
  }

  h1 {
    font-size: 18px;
  }

  h2 {
    font-size: 15px;
  }

  h3 {
    font-size: 13px;
  }

  /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   HEADER / NAV BAR
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */

  header {
    background: var(--bg-elevated);
    border-bottom: 1px solid var(--border);
    padding: 12px 20px;
    display: flex;
    align-items: center;
    justify-content: space-between;
    position: sticky;
    top: 0;
    z-index: 100;
  }

  header h1 {
    color: var(--text-primary);
    font-size: 16px;
    letter-spacing: 2px;
    display: flex;
    align-items: center;
    gap: 10px;
  }

  header h1::before {
    content: '';
    width: 8px;
    height: 8px;
    background: var(--accent-green);
    border-radius: 50%;
    box-shadow: var(--glow-green);
  }

  .header-controls {
    display: flex;
    align-items: center;
    gap: 16px;
  }

  #status {
    background: var(--bg-card);
    border: 1px solid var(--border);
    border-radius: 4px;
    padding: 6px 14px;
    font-size: 12px;
    color: var(--text-secondary);
    min-width: 200px;
    text-align: center;
    transition: all 0.3s ease;
  }

  #status.success {
    background: var(--accent-green-dim);
    border-color: var(--accent-green);
    color: var(--accent-green);
  }

  #status.error {
    background: var(--accent-red-dim);
    border-color: var(--accent-red);
    color: var(--accent-red);
  }

  #status.loading {
    background: var(--accent-blue-dim);
    border-color: var(--accent-blue);
    color: var(--accent-blue);
  }

  /* Theme Toggle */
  .theme-toggle {
    background: var(--bg-card);
    border: 1px solid var(--border);
    border-radius: 4px;
    padding: 6px 12px;
    cursor: pointer;
    display: flex;
    align-items: center;
    gap: 6px;
    font-size: 12px;
    color: var(--text-secondary);
    transition: all 0.2s ease;
  }

  .theme-toggle:hover {
    border-color: var(--border-hover);
    color: var(--text-primary);
  }

  /* User info */
  .user-info {
    font-size: 11px;
    color: var(--text-muted);
    text-transform: uppercase;
    letter-spacing: 1px;
  }

  /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   MAIN CONTAINER / LAYOUT
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */

  .container {
    display: flex;
    flex: 1;
    background: var(--bg-primary);
    padding: 12px;
    gap: 12px;
    height: calc(100vh - 60px);
    overflow: visible;
  }

  .left-section,
  .right-section {
    flex: 0 0 280px;
    background: var(--bg-secondary);
    border: 1px solid var(--border);
    border-radius: 4px;
    overflow-y: auto;
    max-height: calc(100vh - 84px);
    display: flex;
    flex-direction: column;
  }

  .middle-section {
    flex: 1;
    background: var(--bg-secondary);
    border: 1px solid var(--border);
    border-radius: 4px;
    display: flex;
    flex-direction: column;
    overflow-y: auto;
    min-height: 200px;
    padding: 16px;
    gap: 12px;
  }

  /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   SECTION HEADERS (COLLAPSIBLE)
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */

  .section-header {
    background: var(--bg-elevated);
    border-bottom: 1px solid var(--border);
    padding: 10px 14px;
    font-size: 11px;
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 1.5px;
    color: var(--text-secondary);
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: space-between;
    transition: all 0.2s ease;
    user-select: none;
  }

  .section-header:hover {
    background: var(--bg-card);
    color: var(--text-primary);
  }

  .section-header::after {
    content: 'â–¼';
    font-size: 8px;
    transition: transform 0.2s ease;
  }

  .section-header.collapsed::after {
    transform: rotate(-90deg);
  }

  .section-header.active {
    background: var(--accent-green-dim);
    color: var(--accent-green);
    border-left: 3px solid var(--accent-green);
  }

  .section-content {
    padding: 12px;
    display: block;
    background: var(--bg-secondary);
  }

  .section-content.hidden {
    display: none;
  }

  /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   TABLES (CASE INFO / TRANSACTION INFO)
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */

  table {
    width: 100%;
    border-collapse: collapse;
    font-size: 12px;
  }

  table th {
    background: var(--bg-elevated);
    color: var(--text-secondary);
    font-size: 10px;
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 1px;
    padding: 8px 10px;
    text-align: left;
    border-bottom: 1px solid var(--border);
  }

  table td {
    padding: 8px 10px;
    border-bottom: 1px solid var(--border);
    vertical-align: middle;
  }

  table tr:last-child td {
    border-bottom: none;
  }

  table tr:hover td {
    background: var(--bg-card);
  }

  .label {
    background: var(--bg-elevated);
    color: var(--text-secondary);
    font-weight: 500;
    width: 40%;
    font-size: 11px;
  }

  .data {
    font-family: 'Space Mono', monospace;
    font-weight: 700;
    color: var(--text-primary);
    cursor: pointer;
    transition: color 0.2s ease;
  }

  .data:hover {
    color: var(--accent-green);
  }

  /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   FORM ELEMENTS
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */

  input[type="text"],
  input[type="file"],
  select,
  textarea,
  datalist {
    background: var(--bg-input);
    border: 1px solid var(--border);
    border-radius: 3px;
    padding: 8px 12px;
    font-family: 'Space Grotesk', sans-serif;
    font-size: 13px;
    color: var(--text-primary);
    width: 100%;
    transition: all 0.2s ease;
  }

  input[type="text"]:focus,
  select:focus,
  textarea:focus {
    outline: none;
    border-color: var(--accent-green);
    box-shadow: 0 0 0 2px var(--accent-green-dim);
  }

  input::placeholder,
  textarea::placeholder {
    color: var(--text-muted);
  }

  textarea {
    resize: vertical !important;
    min-height: 40px;
    max-height: none !important;
    flex-shrink: 0 !important;
    font-size: 12px;
    line-height: 1.6;
    overflow: auto !important;
  }

  textarea#rebuttal-response {
    min-height: 250px;
    max-height: none !important;
    resize: vertical !important;
    flex-shrink: 0 !important;
    overflow: auto !important;
  }

  textarea#issuer-notes,
  textarea#internal-notes {
    min-height: 40px;
    max-height: none !important;
    resize: vertical !important;
    flex-shrink: 0 !important;
    overflow: auto !important;
  }

  label {
    display: block;
    font-size: 11px;
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 1px;
    color: var(--text-secondary);
    margin-bottom: 6px;
  }

  /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   BUTTONS
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */

  button {
    font-family: 'Space Grotesk', sans-serif;
    font-size: 12px;
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 1px;
    padding: 8px 16px;
    border-radius: 3px;
    cursor: pointer;
    transition: all 0.2s ease;
    display: inline-flex;
    align-items: center;
    gap: 6px;
  }

  /* Primary Button (Light background) */
  button.primary,
  button#upload,
  button#buttonPDF {
    background: var(--text-primary);
    color: var(--text-inverse);
    border: none;
  }

  button.primary:hover,
  button#upload:hover,
  button#buttonPDF:hover {
    background: var(--accent-green);
    color: var(--bg-primary);
    box-shadow: var(--glow-green);
  }

  /* Secondary Button (Dark, bordered) */
  button {
    background: var(--bg-card);
    color: var(--text-primary);
    border: 1px solid var(--border);
  }

  button:hover {
    border-color: var(--border-hover);
    background: var(--bg-elevated);
  }

  /* Danger Button */
  button.danger {
    background: var(--accent-red-dim);
    border-color: var(--accent-red);
    color: var(--accent-red);
  }

  button.danger:hover {
    background: var(--accent-red);
    color: var(--text-primary);
    box-shadow: var(--glow-red);
  }

  /* Small Button */
  button.small {
    padding: 4px 10px;
    font-size: 10px;
  }

  /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   RCA SECTION (MIDDLE)
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */

  .rca-section {
    display: flex;
    gap: 8px;
    align-items: center;
    margin-bottom: 12px;
  }

  .rca-section input,
  .rca-section select {
    flex: 1;
  }

  #rca {
    font-family: 'Space Grotesk', sans-serif;
    font-size: 13px;
  }

  /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   UPLOAD BOXES (PASTE AREAS)
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */

  .upload-box {
    width: 100%;
    height: 28px;
    border: 1px dashed var(--border);
    border-radius: 4px;
    display: flex;
    justify-content: center;
    align-items: center;
    background: var(--bg-input);
    transition: all 0.3s ease;
    cursor: pointer;
    position: relative;
    overflow: hidden;
    flex-direction: column;
    margin-bottom: 8px;
  }

  .upload-box:hover,
  .upload-box:focus {
    border-color: var(--accent-green);
    background: var(--accent-green-dim);
  }

  .upload-box span {
    font-size: 11px;
    color: var(--text-muted);
    text-transform: uppercase;
    letter-spacing: 1px;
  }

  .upload-box img {
    max-width: 100%;
    max-height: 100%;
    object-fit: contain;
    display: none;
  }

  .upload-box.has-image span {
    display: none;
  }

  .upload-box.has-image img {
    display: block;
  }

  .delete-btn {
    position: absolute;
    top: 4px;
    right: 4px;
    padding: 2px 6px;
    background: var(--accent-red);
    color: var(--text-primary);
    border: none;
    border-radius: 2px;
    cursor: pointer;
    display: none;
    font-size: 10px;
    text-transform: uppercase;
  }

  .upload-box.has-image .delete-btn {
    display: block;
  }

  .output {
    font-size: 11px;
    color: var(--accent-green);
    margin-bottom: 8px;
  }

  .error {
    color: var(--accent-red);
  }

  /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   QUEUE STATUS DASHBOARD
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */

  .queue-status {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: 8px;
    padding: 12px;
  }

  .queue-status>div {
    background: var(--bg-card);
    border: 1px solid var(--border);
    border-radius: 4px;
    padding: 10px;
    text-align: center;
  }

  .queue-status>div:first-child,
  .queue-status>div:nth-child(2) {
    background: var(--accent-green-dim);
    border-color: var(--accent-green);
  }

  .queue-status>div:nth-child(3) {
    grid-column: span 2;
    background: var(--accent-yellow-dim);
    border-color: var(--accent-yellow);
  }

  .queue-status strong {
    display: block;
    font-size: 10px;
    text-transform: uppercase;
    letter-spacing: 1px;
    color: var(--text-secondary);
    margin-bottom: 4px;
  }

  .queue-status span {
    font-family: 'Space Mono', monospace;
    font-size: 18px;
    font-weight: 700;
    color: var(--text-primary);
  }

  /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   PENDING CASES TABLE
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */

  .working-rca {
    background: var(--bg-card);
    border: 1px solid var(--border);
    border-radius: 4px;
    padding: 12px;
    margin-top: 12px;
    max-height: 300px;
    overflow-y: auto;
  }

  #pendingcase {
    width: 100%;
  }

  #pendingcase th,
  #pendingcase td {
    font-size: 11px;
    padding: 6px 8px;
  }

  .caution-icon {
    margin-left: 6px;
    animation: pulse 1s infinite;
  }

  @keyframes pulse {

    0%,
    100% {
      opacity: 1;
    }

    50% {
      opacity: 0.5;
    }
  }

  #pendingmessage {
    color: var(--accent-green);
    font-weight: 600;
    padding: 12px;
  }

  /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   BUTTONS SECTION
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */

  .buttons-section {
    display: flex;
    gap: 10px;
    margin-top: 12px;
    flex-wrap: wrap;
  }

  /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   CANNED RESPONSE MODAL
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */

  #cannedModal {
    position: fixed;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    background: var(--bg-elevated);
    border: 1px solid var(--border);
    border-radius: 6px;
    padding: 20px;
    z-index: 1000;
    width: 600px;
    min-height: 400px;
    max-width: 90vw;
    max-height: 80vh;
    overflow-y: auto;
    resize: both;
    box-shadow: var(--shadow-lg);
  }

  #cannedModal h3 {
    color: var(--text-primary);
    margin-bottom: 16px;
    font-size: 14px;
  }

  .modal-overlay {
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: rgba(0, 0, 0, 0.7);
    z-index: 999;
  }

  /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   ADMIN PANEL
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */

  .admin-panel {
    position: fixed;
    top: 0;
    right: -400px;
    width: 400px;
    height: 100vh;
    background: var(--bg-secondary);
    border-left: 1px solid var(--border);
    z-index: 200;
    transition: right 0.3s ease;
    display: flex;
    flex-direction: column;
  }

  .admin-panel.open {
    right: 0;
  }

  .admin-panel-header {
    background: var(--bg-elevated);
    border-bottom: 1px solid var(--border);
    padding: 16px;
    display: flex;
    align-items: center;
    justify-content: space-between;
  }

  .admin-panel-header h2 {
    color: var(--text-primary);
    font-size: 14px;
  }

  .admin-panel-content {
    flex: 1;
    overflow-y: auto;
    padding: 16px;
  }

  .admin-stat-card {
    background: var(--bg-card);
    border: 1px solid var(--border);
    border-radius: 4px;
    padding: 12px;
    margin-bottom: 12px;
  }

  .admin-stat-card h4 {
    font-size: 10px;
    color: var(--text-muted);
    margin-bottom: 8px;
  }

  .admin-stat-value {
    font-family: 'Space Mono', monospace;
    font-size: 24px;
    font-weight: 700;
    color: var(--accent-green);
  }

  .analyst-list {
    list-style: none;
  }

  .analyst-list li {
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 10px 12px;
    border-bottom: 1px solid var(--border);
  }

  .analyst-list li:hover {
    background: var(--bg-card);
  }

  .analyst-name {
    font-weight: 500;
  }

  .analyst-stats {
    font-size: 11px;
    color: var(--text-muted);
  }

  .analyst-active {
    width: 8px;
    height: 8px;
    border-radius: 50%;
    background: var(--accent-green);
    box-shadow: var(--glow-green);
  }

  .analyst-inactive {
    width: 8px;
    height: 8px;
    border-radius: 50%;
    background: var(--text-muted);
  }

  /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   KEYBOARD SHORTCUTS HINT
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */

  .shortcuts-hint {
    position: fixed;
    bottom: 16px;
    right: 16px;
    background: var(--bg-elevated);
    border: 1px solid var(--border);
    border-radius: 4px;
    padding: 12px 16px;
    font-size: 11px;
    color: var(--text-muted);
    z-index: 50;
    display: none;
    /* Hidden by default - show via ? key */
  }

  .shortcuts-hint kbd {
    background: var(--bg-card);
    border: 1px solid var(--border);
    border-radius: 2px;
    padding: 2px 6px;
    font-family: 'Space Mono', monospace;
    font-size: 10px;
    color: var(--text-secondary);
  }

  /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   SEARCH HISTORY CHIPS
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */

  .search-history {
    display: flex;
    flex-wrap: wrap;
    gap: 6px;
    margin-bottom: 10px;
  }

  .search-chip {
    background: var(--bg-card);
    border: 1px solid var(--border);
    border-radius: 3px;
    padding: 4px 10px;
    font-size: 11px;
    font-family: 'Space Mono', monospace;
    color: var(--text-secondary);
    cursor: pointer;
    transition: all 0.2s ease;
  }

  .search-chip:hover {
    border-color: var(--accent-green);
    color: var(--accent-green);
  }

  /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   ACTION ICONS
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */

  .action-icons {
    font-size: 14px;
    cursor: pointer;
    margin-left: 8px;
    opacity: 0.6;
    transition: opacity 0.2s ease;
  }

  .action-icons:hover {
    opacity: 1;
  }

  /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   SPINNER / LOADING
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */

  .spinner {
    border: 2px solid var(--border);
    border-top: 2px solid var(--accent-green);
    border-radius: 50%;
    width: 16px;
    height: 16px;
    animation: spin 0.8s linear infinite;
    display: inline-block;
    vertical-align: middle;
  }

  @keyframes spin {
    0% {
      transform: rotate(0deg);
    }

    100% {
      transform: rotate(360deg);
    }
  }

  /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   SUCCESS / ERROR MESSAGES
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */

  .success-msg {
    background: var(--accent-green-dim);
    border: 1px solid var(--accent-green);
    border-radius: 4px;
    padding: 8px 12px;
    color: var(--accent-green);
    font-size: 12px;
  }

  .error-msg {
    background: var(--accent-red-dim);
    border: 1px solid var(--accent-red);
    border-radius: 4px;
    padding: 8px 12px;
    color: var(--accent-red);
    font-size: 12px;
  }

  /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   SCROLLBAR STYLING
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */

  ::-webkit-scrollbar {
    width: 8px;
    height: 8px;
  }

  ::-webkit-scrollbar-track {
    background: var(--bg-primary);
  }

  ::-webkit-scrollbar-thumb {
    background: var(--border-hover);
    border-radius: 4px;
  }

  ::-webkit-scrollbar-thumb:hover {
    background: var(--text-muted);
  }

  /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   TOOLTIPS
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */

  [data-tooltip] {
    position: relative;
  }

  [data-tooltip]::after {
    content: attr(data-tooltip);
    position: absolute;
    bottom: 100%;
    left: 50%;
    transform: translateX(-50%);
    background: var(--bg-elevated);
    border: 1px solid var(--border);
    border-radius: 4px;
    padding: 8px 12px;
    font-size: 11px;
    color: var(--text-secondary);
    white-space: nowrap;
    opacity: 0;
    pointer-events: none;
    transition: opacity 0.2s ease;
    z-index: 100;
  }

  [data-tooltip]:hover::after {
    opacity: 1;
  }

  /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   RESPONSIVE ADJUSTMENTS
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */

  @media (max-width: 1200px) {

    .left-section,
    .right-section {
      flex: 0 0 240px;
    }
  }

  @media (max-width: 900px) {
    .container {
      flex-direction: column;
      height: auto;
    }

    .left-section,
    .middle-section,
    .right-section {
      flex: none;
      width: 100%;
    }
  }

  /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   HIGHLIGHT EFFECTS
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */

  .highlight {
    background-color: var(--accent-red-dim);
    animation: highlight-fade 2s ease-out;
  }

  @keyframes highlight-fade {
    0% {
      background-color: var(--accent-red);
    }

    100% {
      background-color: transparent;
    }
  }

  /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   PDF UPLOADS SECTION
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */

  .pdf-uploads label {
    display: block;
    font-size: 11px;
    font-weight: 500;
    color: var(--text-secondary);
    margin-top: 8px;
    margin-bottom: 4px;
  }

  .pdf-uploads input[type="file"] {
    font-size: 11px;
    padding: 6px;
  }

  /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   TOGGLE SWITCH (Fancy On/Off)
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */

  .toggle-switch {
    position: relative;
    display: inline-block;
    width: 44px;
    height: 22px;
    flex-shrink: 0;
  }

  .toggle-switch input {
    opacity: 0;
    width: 0;
    height: 0;
  }

  .toggle-slider {
    position: absolute;
    cursor: pointer;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background-color: var(--bg-input);
    border: 1px solid var(--border);
    border-radius: 22px;
    transition: all 0.3s ease;
  }

  .toggle-slider:before {
    content: "";
    position: absolute;
    height: 16px;
    width: 16px;
    left: 2px;
    bottom: 2px;
    background: var(--text-muted);
    border-radius: 50%;
    transition: all 0.3s ease;
  }

  input:checked+.toggle-slider {
    background-color: var(--accent-green-dim);
    border-color: var(--accent-green);
  }

  input:checked+.toggle-slider:before {
    transform: translateX(22px);
    background: var(--accent-green);
    box-shadow: var(--glow-green);
  }

  input:focus+.toggle-slider {
    box-shadow: 0 0 0 2px var(--accent-green-dim);
  }

  /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   CONDENSED LAYOUT MODE
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• 
   Enable via CONFIG.FEATURES.ENABLE_CONDENSED_LAYOUT = true
   Applies via data-layout="condensed" on html element */

  [data-layout="condensed"] .container {
    height: auto;
    max-height: calc(100vh - 60px);
  }

  [data-layout="condensed"] .left-section,
  [data-layout="condensed"] .right-section {
    max-height: calc(100vh - 84px);
    overflow-y: auto;
  }

  [data-layout="condensed"] .middle-section {
    overflow: visible;
  }

  [data-layout="condensed"] .section-content {
    max-height: 150px;
    overflow-y: auto;
  }

  [data-layout="condensed"] table {
    font-size: 11px;
  }

  [data-layout="condensed"] table td,
  [data-layout="condensed"] table th {
    padding: 4px 8px;
  }

  [data-layout="condensed"] textarea {
    min-height: 100px;
  }

  [data-layout="condensed"] textarea#rebuttal-response {
    min-height: 120px;
  }

  [data-layout="condensed"] .upload-box {
    height: 45px;
  }

  [data-layout="condensed"] .queue-status {
    padding: 8px;
  }

  [data-layout="condensed"] .working-rca {
    max-height: 150px;
  }
</style><!--
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
RCA MANAGER v3 - RCA RESPONSE AUTO-FILL
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
Maps RCA values to pre-defined rebuttal responses.
Triggered when user selects an RCA and has the checkbox enabled.
-->

<script>
  // Bind the change event for the RCA input
  document.addEventListener('DOMContentLoaded', function () {
    const rcaInput = document.getElementById('rca');
    if (rcaInput) {
      rcaInput.addEventListener('change', fetchResponse);
      // Removed 'input' listener - was causing duplicate paste when both events fired
    }
  });

  function fetchResponse() {
    const rca = document.getElementById('rca').value;
    const res = document.getElementById('rebuttal-response');
    const checkbox = document.getElementById('getRes?');

    if (!res || !checkbox?.checked) return;

    const cursorPosition = res.selectionStart;
    const textBeforeCursor = res.value.substring(0, cursorPosition);
    const textAfterCursor = res.value.substring(cursorPosition);

    // RCA to Response mapping
    const RESPONSES = {
      "Customer - Cancel policy dispute/Non Refundable":
        "Customer was made aware of and agreed to the cancellation policy prior to confirming the booking. At the time the booking was made, the reservation was non-refundable. Cardholder's chargeback is an erroneous attempt to circumvent the cancellation policy and breach the contract the customer entered when agreeing to the Terms and Conditions (T&C) before his card was charged. Cardholder owes Priceline Partner Solutions for the reservation. A reversal is due. Please see included documents supporting that cardholder is not due a credit.\n\n",

      "Risk - Fraudulent Transaction":
        "The following transaction is not fraudulent as stated. The attached documents indicate the cardholder participated in the transaction. Also, we are a Card Not Present (CNP) environment. All of our sales purchase are made by the customer either directly through our secure online platform or via our official call center, where all transactions are handled through verified procedures. Customer was made aware of and agreed to the cancellation policy prior to confirming the booking. The attached documents indicate the cardholder participated in the transaction; note the AVS and CVV attached. The payment for this reservation processed in the United States and appeared on statement as 'HTL*_______'. Based on this, we confirm that the transaction was initiated and authorized by the cardholder and request that the chargeback be reversed. Customer was made aware of and agreed to the cancellation policy prior to confirming the booking. The attached documents indicate the cardholder participated in the transaction. The cardholder has made no good faith effort in resolving any issues with this charge with Priceline Partner Solutions prior to filing the dispute.\n\n",

      "Customer - Cancel policy dispute":
        "Cardholder claiming credit is owed on a reservation. Customer tried contacting Priceline Partner Solutions for cancellation when the reservation was inside penalty or canceled the reservation inside of cancellation policy. See attached receipt/confirmation sent to the customer at the time of booking detailing the cancellation policy. Per cancellation policy and Priceline Partner Solutions Terms and Conditions, which the customer agreed to at the time of booking, no refund is due. If you do not cancel before the cancellation policy period applicable to the reservation, the customer will be subject to a charge equal to applicable nightly rates, tax recovery charges, and service fees. There are no refunds for no-shows or early checkouts. The hotel/ supplier has billed Priceline Partner Solutions, and we have paid the hotel/supplier. The customer owes Priceline Partner Solutions for the reservation.\n\n",

      "No Reservation (No Wex)":
        "Reservation was available at the time of check-in. No cancellation was received via the Priceline Partner Solutions customer service phone line or via the Travel Agent site, as required per the cancellation policy of the reservation. All policies agreed to and sent to guests after the completion of booking process. Guest failed to process cancellation based on agreed-upon policy. See attached confirmation of booking. The supplier billed Priceline for the stay, and Priceline billed the guest. Reversal is required.\n\n",

      "Customer - Taxes and Fees":
        "The customer agreed to and confirmed acceptance of the full transaction price before providing their card information to book the room. The customer is disputing the amount of taxes and service fees. Per Terms and Conditions (T&C), the tax recovery charge is a recovery of the estimated taxes that we pay to the hotel for our customers' reservations. We also collect a service fee for facilitating reservations. These facts are listed in the T&C which the customer agreed to before their card was charged. Customer was made aware of and agreed to the cancellation policy prior to confirming the booking. Please see included documents supporting that cardholder is not due a credit.\n\n",

      "Manual Response": "",

      "Customer - Cancel policy dispute (No Contact / Confirmed)":
        "NO cancellation was received via Priceline customer service via any means - call or email, as required per the attached cancellation policy (T&C Sec 36). The reservation is still active on our records. All policies are agreed to and sent to the guest during checkout. Guest failed to process a cancellation based on agreed-upon policy. Customer was made aware of and agreed to the cancellation policy prior to confirming the booking. See attached confirmation of booking supporting that cardholder is not due a credit.\n\n",

      "Chargeback Accepted":
        "Chargeback has been accepted.",

      "No Reservation (with WEX)":
        "Reservation was available at the hotel for check-in. No cancellation was received via the Priceline Partner Solutions customer service phone line or via the Travel Agent site, as required per the cancellation policy of the reservation. There should be no charges from the hotel directly for this reservation. Please see the attached document showing the hotel has billed Priceline Partner Solutions for the reservation, and we have paid the hotel / supplier. The customer agreed to the terms of the booking before their card was charged. Our terms state that Priceline Partner Solutions is not responsible for the services provided at the hotel; we are merely the facilitator of the hotel booking process. The Cardholder owes Priceline Partner Solutions for this reservation. Please see attached receipt/confirmation sent at the time of booking.\n\n",

      "Cancellation/Tax & Recovery (attempt to cancel)":
        "The customer reviewed and accepted both the cancellation policy and the full transaction amount prior to entering their payment information and completing the booking. They are now disputing the charge, claiming the cancellation was due to dissatisfaction with taxes and service fees. However, as clearly outlined in the Terms and Conditions (T&C) accepted at the time of purchase:\n\nTax Recovery Charge: This charge represents the estimated taxes that we collect and remit directly to the hotel or affiliated supplier on the customer's behalf. It ensures compliance with local tax requirements related to the reservation.\n\nService Fee: This is a nonrefundable fee that covers the administrative and operational costs of facilitating the reservation with our affiliate or supplier. It is clearly disclosed during the booking process.\n\nThese charges, along with the cancellation policy, were fully presented and accepted prior to the cardholder's payment authorization. As such, the transaction was processed in accordance with the agreed-upon terms.\n\n",

      "Duplicate bill w/ GAR ARN":
        "Please see the included purchase details showing that the Cardholder purchased the same item through different transactions. Cardholder booked these reservations and agreed to balance, cancellation policy, terms and condition. The Cardholder is provided with the confirmed booking details before completing the purchase. Please see attached receipt/confirmation sent at the time of booking.\n\n",

      "Hotel - Unsatisfactory":
        "The cardholder is claiming to be dissatisfied with the services provided at the hotel. This reservation is non-refundable once services are rendered. The customer agreed to the terms of the booking before their card was charged. Per the additional terms under Travel Agency Agreement, Section 17 states that because of the nature of Travel Agent's Services, we are not in control of the quality of rooms provided by any particular hotel at any time. Travel Agent has no control over, and makes no representations regarding, the quality, safety or legality of the products and services offered, food provided, accommodations provided, and/or the truth or accuracy of the listings or the ability of the vendors to offer services, nor do we make any guarantee that the lodging establishment is not undergoing any renovation. The terms state that Priceline Partner Solutions is not responsible for the services provided at the hotel; Priceline Partner Solutions is merely the facilitator of the hotel booking process. Per terms and conditions as well as the cancellation policy emailed to the customer at the time of booking, the customer is due no refund. The hotel/ supplier has billed Priceline Partner Solutions, and we have paid the hotel/supplier.\n\n",

      "No Reservation (Cancelled)":
        "The reservation was confirmed and scheduled for [check-in date]. The customer voluntarily cancelled the reservation on [cancellation date], prior to the check-in date. As per our stated cancellation policy, [cancellation policy â€” e.g., 'reservations cancelled within X days of check-in are non-refundable']. Since the customer chose to cancel the reservation, the service which was supposed to be available, couldn't/wouldn't be rendered and hence this chargeback is not valid under the reason code \\\"services not rendered\\\". Attached are the reservation confirmation, cancellation request from the customer, and our cancellation policy as presented at the time of booking. We respectfully request that this chargeback be reversed.\\n\\n",

      "Customer - Cancel Penalty Dispute/Early Checkout":
        "Cardholder is disputing unused nights. The cardholder checked out early, but this does not change the terms they agreed to at the time of booking. The reservation was non-refundable, and our policy clearly states that no refunds are given for unused nights. The full charge remains valid because the room was held for the entire duration of the original reservation, making it unavailable to other guests, and the rate was based on the full length of stay selected at the time of booking. Per terms and conditions as well as the cancellation policy emailed to the customer at the time of booking, Cardholder is not due a refund.\n\n",

      "Hotel - Hotel Billed Direct (Wex not charged/Direct Bill)":
        "Per the affidavit, the customer claims to have been direct billed by the hotel in error. Our establishment did not make this charge. This charge should be disputed with the establishment that made them. The customer agreed to the terms of the booking before their card was charged. Our terms state that Priceline Partner Solutions.com is not responsible for the services provided at the hotel. Priceline Partner Solutions.com is only the facilitator of the hotel booking process. The customer owes Priceline Partner Solutions for this reservation. Please see attached receipt/confirmation sent at the time of booking.\n\n",

      "Cancellation/Tax & Recovery (No attempt to cancel)":
        "The customer completed the booking after reviewing and accepting both the cancellation policy and the full transaction amount prior to entering their payment information. They are now disputing the charge, citing dissatisfaction with taxes and service fees, despite having neither canceled the reservation nor contacted us to request a cancellation. There is no record of any cancellation initiated by the customer.\n\nThe charges in question were fully disclosed at the time of booking and accepted under the Terms and Conditions (T&C):\n\nTax Recovery Charge: This charge represents the estimated taxes that we collect and remit directly to the hotel or affiliated supplier on the customer's behalf. It ensures compliance with local tax obligations related to the reservation.\n\nService Fee: This is a non-refundable fee that covers the administrative and operational costs of securing and managing the reservation with our affiliate or supplier. It was clearly itemized during the checkout process.\n\nThese fees, along with the total transaction amount, were acknowledged and approved by the customer prior to confirming the reservation. As there is no record of a cancellation, and the reservation was held as booked, the charge remains valid and consistent with the agreed-upon terms.\n\n",

      "Customer - Charge not recognized":
        "The following transaction is not fraudulent as stated. Customer was made aware of and agreed to the cancellation policy prior to confirming the booking. The attached documents indicate the cardholder participated in the transaction; note the AVS and CVV attached. The payment for this reservation processed in the United States and appeared on statement as 'cci*Hotel Res'.\n\n",

      "Hotel - Hotel revealed rate":
        "The hotel has revealed Priceline Partner Solutions's net rates to the customer in error. The hotel's receipt provided to the customer in error shows wholesale rates between Priceline Partner Solutions and the hotel. The customer agreed to the retail Priceline Partner Solutions rate during the booking process with us and agreed to and confirmed acceptance of the full transaction price including the Tax Recovery Charges & Service Fees before providing their card information to book the room. Per Terms and Conditions (T&C), the tax recovery charge is a recovery of the estimated taxes that we pay to the hotel for our customers' reservations. We also collect a service fee for facilitating reservations. These facts are listed in the T&C which the customer agreed to before their card was charged. Customer was made aware of and agreed to the cancellation policy prior to confirming the booking. Please see included documents supporting that cardholder is not due a credit.\n\n",

      "Hotel - Hotel Billed Direct":
        "Per the affidavit, the customer claims to have been direct billed by the hotel in error. Our establishment did not make this charge. This charge should be disputed with the establishment that made them. The customer agreed to the terms of the booking before their card was charged. Our terms state that Priceline Partner Solutions is not responsible for the services provided at the hotel. Priceline Partner Solutions is only the facilitator of the hotel booking process. Priceline Partner Solutions has paid for the reservation in advance and it was available at the time of check in. The customer owes Priceline Partner Solutions for this reservation. Please see attached receipt/confirmation sent at the time of booking.\n\n",

      "Duplicate bill w/ NON GAR ARN":
        "Please be advised the ARN# listed on the affidavit does not belong to Priceline Partner Solutions. The customer claims to have been direct billed by the hotel in error. Our establishment did not make this charge. These charges should be disputed with the establishment that made them. The customer agreed to Priceline Partner Solutions's terms of the booking before we charged their card. Our terms state that Priceline Partner Solutions is not responsible for the services provided at the hotel. Priceline Partner Solutions is merely the facilitator of the hotel booking process. Please see attached receipt/confirmation sent at the time of booking. There should be no charges from the hotel directly for this reservation as the hotel has billed Priceline Partner Solutions for the reservation, and we have paid the hotel.\n\n",

      "Resolved":
        "Auto-resolved / Reversal Received",

      "Reason code 53 without affidavit":
        "The customer booked the reservation having first agreed to the balance, cancellation policy, and terms and conditions (T&C). Priceline Partner Solutions has no record of Cardholder making a good faith effort to contact us regarding any cancellation, refund, or service issues. There were no affidavits attached to this dispute informing the reason of the dispute, to allow Priceline Partner Solutions adequate information to address the customer's concerns. Based on reason code 53-NOT AS DESCRIBED OR DEFECTIVE, no cancellation was received via the Priceline Partner Solutions customer service phone line or via the Travel Agent site within the cancellation period, as required per the attached cancellation policy and T&C. All policies are agreed to and sent to guests during checkout via email. Any COVID 19 cancellations inside of penalty must be supported with positive test results. The customer agreed to the terms of the booking before their card was charged. However, because of the nature of Travel Agent's Services, we are not in control of the quality of rooms provided by any particular hotel at any time. Travel Agent does not guarantee the accuracy of any information on the Site, nor do we make any guarantee that the lodging establishment is not undergoing any renovation. The terms state that Priceline Partner Solutions is not responsible for the services provided at the hotel; we are merely the facilitator of the hotel booking process. Per terms and conditions and the cancellation policy emailed to the customer at the time of booking, the customer is due no refund.\n\n",

      "Customer - Currency":
        "All payments are currently processed in one of the following currencies: U.S. dollars, Great Britain Pounds, Australian Dollar, Canadian Dollar, Euro and will reflect the exchange rate in effect on the date of the payment. A customer has the option to choose their preferred currency from the above mentioned currencies. If a customer doesn't change/choose the currency type, the US Dollar will automatically be chosen as the default currency under which the transaction would be processed. Currency rates are based on various publicly available sources and should be used as guidelines only. Rates are not verified as accurate, and actual rates may vary. Currency quotes are not updated in real-time. Check the date on the currency converter feature for the day that currency was last updated. Customer was made aware of and agreed to the cancellation policy prior to confirming the booking. Please see included documents supporting that cardholder is not due a credit.\n\n",

      "Customer - Cancel policy dispute/No Show":
        "The reservation is listed as a no-show. Due to this booking being a no-show, no folio is available. No cancellation was received via the Priceline customer service phone line or via the Travel Agent site, as required per the attached cancellation policy Terms and Conditions (T&C) Part IV (C). All policies are agreed to and sent to the guest at the time of booking. Guest failed to process cancellation based on agreed-upon policy. Please see included documents supporting that cardholder is not due a credit.\n\n",

      "Customer - Unable to check in/Customer Issue (Age, CC)":
        "Please be advised that the guest will be required to provide official State or authorized government issued ID upon check-in for any Travel Agent reservation. In addition, guest is required to provide a credit or debit card upon request from the hotel for incidentals, as referenced above. Failure to produce such ID may result in forfeiture of the booking of the Travel Agent Service without any right to refund. As per Part IV [C]. Additional hotel policies are given on the confirmation page of the reservation which is also sent to customer via email.\n\n",

      "Customer - Booking Error":
        "Customer was made aware of and agreed to the cancellation policy prior to confirming the booking. Please see included documents supporting that cardholder is not due a credit.\n\n",

      "Hotel - Room Type Not Available":
        "Customer was made aware of and agreed to the cancellation policy prior to confirming the booking. Please see included documents supporting that cardholder is not due a credit.\n\n",

      "Other - Chip liability shift (fraud)":
        "The following transaction is not fraudulent as stated. The attached documents indicate the cardholder participated in the transaction; note the AVS and CVV attached. Also, we are a Card Not Present (CNP) environment. All of our sales are made either online through websites or with a sales agent over-the-phone. Customer was made aware of and agreed to the cancellation policy prior to confirming the booking. For this reason, any CB claiming that a chip could not be read, is null and void. Please see included purchase details which show the billing data provided at the time of booking links to the cardholder. The cardholder has made no good faith effort in resolving any issues with this charge with Priceline Partner Solutions prior to filing the dispute.\n\n",

      "Service - Cancel Not Performed":
        "Customer was made aware of and agreed to the cancellation policy prior to confirming the booking. Please see included documents supporting that cardholder is not due a credit.\n\n",

      "Risk - Fraudulent Transaction (w/ Contact)":
        "Customer called Priceline Partner Solutions and cancelled this reservation on MM/DD/YYYY due to _________ which was selected by customer himself/herself at the time of booking. As per the cancellation policy this reservation was non-refundable/partially refundable at the time of cancellation and hence it was cancelled with full/partial cancellation charges/penalty. No refund due.\n\nIn direct communication with us, the cardholder acknowledges:\n1. Visiting our website and initiating a booking process.\n2. Seeing the final price before payment and interacting with the payment screen.\n3. Receiving a confirmation email that includes correct booking details and price.\n4. Noting specific dates, amounts, and cancellation policiesâ€”clear evidence of familiarity with the transaction.\nThese admissions directly contradict the basis of a \"card not present\", as they demonstrate that the cardholder was knowingly and actively involved in the transaction.\n\nThe following transaction is not fraudulent as stated. The attached documents indicate the cardholder participated in the transaction. Also, we are a Card Not Present (CNP) environment. All of our sales purchase are made by the customer either directly through our secure online platform or via our official call center, where all transactions are handled through verified procedures. Customer was made aware of and agreed to the cancellation policy prior to confirming the booking. The attached documents indicate the cardholder participated in the transaction; note the AVS and CVV attached. The payment for this reservation processed in the United States and appeared on statement as 'HTL*_______'. Based on this, we confirm that the transaction was initiated and authorized by the cardholder and request that the chargeback be reversed. Customer was made aware of and agreed to the cancellation policy prior to confirming the booking. The attached documents indicate the cardholder participated in the transaction. The cardholder has made no good faith effort in resolving any issues with this charge with Priceline Partner Solutions prior to filing the dispute.\n\n",

      "Sales - Data Entry Issue (Online Reservation Only)":
        "The reservation was made online through our website by the cardholder and all information was entered by the cardholder. The customer booked the reservation having first agreed to the full transaction amount, cancellation policy, and terms and conditions (T&C) and clicked the box agreeing to the terms and conditions at the time of booking before their card was charged and the card holder was sent confirmation mail in regards to the same. No refund is due.\n\n",

      "Pending":
        "Case is pending."
    };

    const response = RESPONSES[rca];
    if (response !== undefined) {
      res.value = textBeforeCursor + response + textAfterCursor;
      res.focus();
    }
  }
</script>