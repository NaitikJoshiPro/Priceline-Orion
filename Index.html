<!DOCTYPE html>
<html>
<head>
    <base target="_top">
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>ORION Platform</title>

    <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
         GLOBAL THEME (inlined from Theme.html)
         ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link
    href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@300;400;500;600;700&family=Space+Mono:wght@400;700&display=swap"
    rel="stylesheet">

<style>
    /* =============================================================================
   SECTION 1: COLOR SYSTEM
   ============================================================================= */

    :root,
    :root[data-theme="dark"] {
        /* Backgrounds - Pure black gradations */
        --bg-primary: #000000;
        --bg-secondary: #080808;
        --bg-elevated: #0f0f0f;
        --bg-card: #141414;
        --bg-input: #1a1a1a;

        /* Borders */
        --border: #1a1a1a;
        --border-hover: #2a2a2a;
        --border-focus: #3a3a3a;

        /* Text - White gradations */
        --text-primary: #f5f5f5;
        --text-secondary: #808080;
        --text-muted: #4d4d4d;
        --text-inverse: #000000;

        /* Accent - Monochrome only */
        --accent-primary: #e6e6e6;
        --accent-glow: rgba(230, 230, 230, 0.15);

        /* State Colors */
        --state-success: #22c55e;
        --state-warning: #f59e0b;
        --state-error: #ef4444;
        --state-info: #3b82f6;

        /* State Dim (for backgrounds) */
        --state-success-dim: rgba(34, 197, 94, 0.15);
        --state-warning-dim: rgba(245, 158, 11, 0.15);
        --state-error-dim: rgba(239, 68, 68, 0.15);
        --state-info-dim: rgba(59, 130, 246, 0.15);

        /* RT Report States (aliases for consistency) */
        --state-pending: #f59e0b;
        --state-accepted: #22c55e;
        --state-rejected: #ef4444;

        /* Accent Colors (when ENABLE_ACCENT_COLORS = true) */
        --accent-visa: #1a1f71;
        --accent-mastercard: #eb001b;
        --accent-discover: #ff6000;
        --accent-amex: #006fcf;
        --accent-challenge: #22c55e;
        --accent-accept: #3b82f6;
        --accent-reversal: #f59e0b;
        --accent-danger: #ef4444;

        /* Shadows */
        --shadow-sm: 0 1px 2px rgba(0, 0, 0, 0.5);
        --shadow-md: 0 4px 12px rgba(0, 0, 0, 0.4);
        --shadow-lg: 0 8px 24px rgba(0, 0, 0, 0.5);

        /* Glows */
        --glow-success: 0 0 20px rgba(34, 197, 94, 0.3);
        --glow-error: 0 0 20px rgba(239, 68, 68, 0.3);
    }

    :root[data-theme="light"] {
        /* Backgrounds - Warm off-white */
        --bg-primary: #e8e6e1;
        --bg-secondary: #f0eeea;
        --bg-elevated: #f5f3ef;
        --bg-card: #ffffff;
        --bg-input: #e0ddd7;

        /* Borders */
        --border: #c8c4be;
        --border-hover: #b0aca6;
        --border-focus: #989490;

        /* Text */
        --text-primary: #1a1a1a;
        --text-secondary: #4a4a4a;
        --text-muted: #7a7a7a;
        --text-inverse: #ffffff;

        /* Accent */
        --accent-primary: #2a2a2a;
        --accent-glow: rgba(42, 42, 42, 0.08);

        /* State Colors (slightly muted for light mode) */
        --state-success: #16a34a;
        --state-warning: #d97706;
        --state-error: #dc2626;
        --state-info: #2563eb;

        /* State Dim */
        --state-success-dim: rgba(22, 163, 74, 0.12);
        --state-warning-dim: rgba(217, 119, 6, 0.12);
        --state-error-dim: rgba(220, 38, 38, 0.12);
        --state-info-dim: rgba(37, 99, 235, 0.12);

        /* Accent Colors (when ENABLE_ACCENT_COLORS = true) */
        --accent-visa: #1a1f71;
        --accent-mastercard: #cc0000;
        --accent-discover: #cc4d00;
        --accent-amex: #0057a3;
        --accent-challenge: #16a34a;
        --accent-accept: #2563eb;
        --accent-reversal: #d97706;
        --accent-danger: #dc2626;

        /* Shadows */
        --shadow-sm: 0 1px 3px rgba(0, 0, 0, 0.08);
        --shadow-md: 0 4px 12px rgba(0, 0, 0, 0.08);
        --shadow-lg: 0 8px 24px rgba(0, 0, 0, 0.12);
    }

    /* =============================================================================
   SECTION 2: TYPOGRAPHY
   ============================================================================= */

    :root {
        --font-ui: 'Space Grotesk', -apple-system, BlinkMacSystemFont, sans-serif;
        --font-mono: 'Space Mono', 'SF Mono', Consolas, monospace;

        --font-xs: 10px;
        --font-sm: 12px;
        --font-base: 14px;
        --font-md: 16px;
        --font-lg: 18px;
        --font-xl: 24px;
        --font-2xl: 32px;
        --font-3xl: 48px;
    }

    /* =============================================================================
   SECTION 3: SPACING
   ============================================================================= */

    :root {
        --spacing-xs: 4px;
        --spacing-sm: 8px;
        --spacing-md: 16px;
        --spacing-lg: 24px;
        --spacing-xl: 32px;
        --spacing-2xl: 48px;
        --spacing-3xl: 64px;
    }

    /* =============================================================================
   SECTION 4: LAYOUT
   ============================================================================= */

    :root {
        --sidebar-width: 260px;
        --header-height: 56px;
        --border-radius-sm: 4px;
        --border-radius-md: 6px;
        --border-radius-lg: 8px;
        --border-radius-xl: 12px;
    }

    /* =============================================================================
   SECTION 5: TRANSITIONS
   ============================================================================= */

    :root {
        --transition-fast: 150ms cubic-bezier(0.4, 0, 0.2, 1);
        --transition-normal: 300ms cubic-bezier(0.4, 0, 0.2, 1);
        --transition-slow: 500ms cubic-bezier(0.4, 0, 0.2, 1);
    }

    /* =============================================================================
   SECTION 6: BASE RESET
   ============================================================================= */

    *,
    *::before,
    *::after {
        box-sizing: border-box;
        margin: 0;
        padding: 0;
    }

    /* Hide scrollbars globally */
    * {
        scrollbar-width: none;
        -ms-overflow-style: none;
    }

    *::-webkit-scrollbar {
        display: none;
    }

    html,
    body {
        height: 100%;
        overflow: hidden;
    }

    body {
        font-family: var(--font-ui);
        font-size: var(--font-base);
        color: var(--text-primary);
        background-color: var(--bg-primary);
        background-image: radial-gradient(circle, var(--border) 1px, transparent 1px);
        background-size: 24px 24px;
        line-height: 1.5;
        -webkit-font-smoothing: antialiased;
        transition: background-color var(--transition-normal), color var(--transition-normal);
    }

    a {
        color: var(--accent-primary);
        text-decoration: none;
    }

    a:hover {
        text-decoration: underline;
    }

    .hidden {
        display: none !important;
    }

    .mono {
        font-family: var(--font-mono);
    }

    /* =============================================================================
   SECTION 7: ANIMATIONS
   ============================================================================= */

    @keyframes fadeIn {
        from {
            opacity: 0;
        }

        to {
            opacity: 1;
        }
    }

    @keyframes slideUp {
        from {
            opacity: 0;
            transform: translateY(20px);
        }

        to {
            opacity: 1;
            transform: translateY(0);
        }
    }

    @keyframes slideIn {
        from {
            opacity: 0;
            transform: translateX(-20px);
        }

        to {
            opacity: 1;
            transform: translateX(0);
        }
    }

    @keyframes pulse {

        0%,
        100% {
            opacity: 1;
        }

        50% {
            opacity: 0.7;
        }
    }

    @keyframes spin {
        to {
            transform: rotate(360deg);
        }
    }

    @keyframes shimmer {
        0% {
            background-position: -200% 0;
        }

        100% {
            background-position: 200% 0;
        }
    }

    /* Animation classes */
    .animate-fade {
        animation: fadeIn 0.3s ease;
    }

    .animate-slide-up {
        animation: slideUp 0.4s ease;
    }

    .animate-slide-in {
        animation: slideIn 0.3s ease;
    }

    .animate-pulse {
        animation: pulse 2s infinite;
    }

    /* =============================================================================
   SECTION 8: LAYOUT COMPONENTS
   ============================================================================= */

    /* App Container */
    .app-container {
        display: flex;
        height: 100vh;
        width: 100vw;
    }

    /* Sidebar */
    .sidebar {
        width: var(--sidebar-width);
        height: 100vh;
        display: flex;
        flex-direction: column;
        background-color: var(--bg-secondary);
        border-right: 1px solid var(--border);
        flex-shrink: 0;
    }

    .sidebar-header {
        display: flex;
        align-items: center;
        gap: var(--spacing-md);
        padding: var(--spacing-lg);
        border-bottom: 1px solid var(--border);
    }

    .sidebar-nav {
        flex: 1;
        padding: var(--spacing-md);
        display: flex;
        flex-direction: column;
        gap: var(--spacing-xs);
    }

    .sidebar-footer {
        padding: var(--spacing-md);
        border-top: 1px solid var(--border);
    }

    /* Main Content */
    .main-content {
        flex: 1;
        display: flex;
        flex-direction: column;
        overflow: hidden;
    }

    /* Header */
    .header {
        height: var(--header-height);
        display: flex;
        align-items: center;
        justify-content: space-between;
        padding: 0 var(--spacing-lg);
        background-color: var(--bg-secondary);
        border-bottom: 1px solid var(--border);
        flex-shrink: 0;
    }

    /* Content */
    .content {
        flex: 1;
        padding: var(--spacing-lg);
        overflow-y: auto;
        animation: fadeIn 0.3s ease;
    }

    /* =============================================================================
   SECTION 9: COMPONENT - Logo
   ============================================================================= */

    .logo {
        font-size: var(--font-3xl);
        font-weight: 300;
        color: var(--accent-primary);
        letter-spacing: -2px;
        text-decoration: none;
    }

    .logo-sm {
        font-size: var(--font-2xl);
    }

    .logo-md {
        font-size: var(--font-3xl);
    }

    .logo-lg {
        font-size: 72px;
    }

    /* =============================================================================
   SECTION 10: COMPONENT - Navigation
   ============================================================================= */

    .nav-item {
        display: flex;
        align-items: center;
        gap: var(--spacing-sm);
        padding: var(--spacing-sm) var(--spacing-md);
        font-size: var(--font-sm);
        color: var(--text-secondary);
        text-decoration: none;
        border-radius: var(--border-radius-md);
        cursor: pointer;
        transition: all var(--transition-fast);
    }

    .nav-item:hover {
        color: var(--text-primary);
        background-color: var(--bg-elevated);
        text-decoration: none;
    }

    .nav-item.active {
        color: var(--text-primary);
        background-color: var(--bg-card);
        border: 1px solid var(--border);
    }

    /* =============================================================================
   SECTION 11: COMPONENT - Buttons
   ============================================================================= */

    .btn {
        display: inline-flex;
        align-items: center;
        justify-content: center;
        gap: var(--spacing-xs);
        padding: 8px 16px;
        font-family: var(--font-ui);
        font-size: var(--font-sm);
        font-weight: 500;
        border-radius: var(--border-radius-md);
        border: 1px solid var(--border);
        cursor: pointer;
        transition: all var(--transition-fast);
        background: transparent;
        color: var(--text-primary);
    }

    .btn:hover {
        border-color: var(--border-hover);
        background-color: var(--bg-elevated);
    }

    .btn-primary {
        background-color: var(--accent-primary);
        color: var(--bg-primary);
        border-color: var(--accent-primary);
    }

    .btn-primary:hover {
        opacity: 0.9;
    }

    .btn-success {
        border-color: var(--state-success);
        color: var(--state-success);
    }

    .btn-warning {
        border-color: var(--state-warning);
        color: var(--state-warning);
    }

    .btn-error {
        border-color: var(--state-error);
        color: var(--state-error);
    }

    .btn-sm {
        padding: 4px 10px;
        font-size: var(--font-xs);
    }

    .btn-lg {
        padding: 12px 24px;
        font-size: var(--font-base);
    }

    .btn-icon {
        width: 32px;
        height: 32px;
        padding: 0;
    }

    /* =============================================================================
   SECTION 12: COMPONENT - Cards
   ============================================================================= */

    .card {
        background-color: var(--bg-card);
        border: 1px solid var(--border);
        border-radius: var(--border-radius-lg);
        padding: var(--spacing-md);
        transition: all var(--transition-fast);
    }

    .card:hover {
        border-color: var(--border-hover);
    }

    .card-header {
        display: flex;
        align-items: center;
        justify-content: space-between;
        margin-bottom: var(--spacing-md);
    }

    .card-title {
        font-size: var(--font-base);
        font-weight: 500;
        color: var(--text-primary);
    }

    /* =============================================================================
   SECTION 13: COMPONENT - Forms
   ============================================================================= */

    .form-group {
        margin-bottom: var(--spacing-md);
    }

    .form-label {
        display: block;
        font-size: var(--font-sm);
        font-weight: 500;
        color: var(--text-secondary);
        margin-bottom: var(--spacing-xs);
    }

    .form-input,
    .form-select,
    .form-textarea {
        width: 100%;
        padding: 10px 12px;
        font-family: var(--font-ui);
        font-size: var(--font-base);
        color: var(--text-primary);
        background-color: var(--bg-input);
        border: 1px solid var(--border);
        border-radius: var(--border-radius-md);
        transition: all var(--transition-fast);
    }

    .form-input:focus,
    .form-select:focus,
    .form-textarea:focus {
        outline: none;
        border-color: var(--accent-primary);
    }

    .form-textarea {
        min-height: 100px;
        resize: vertical;
    }

    /* =============================================================================
   SECTION 14: COMPONENT - Badges
   ============================================================================= */

    .badge {
        display: inline-flex;
        align-items: center;
        padding: 4px 10px;
        font-size: var(--font-xs);
        font-weight: 500;
        text-transform: uppercase;
        letter-spacing: 0.5px;
        border-radius: var(--border-radius-sm);
        background-color: var(--bg-elevated);
        color: var(--text-muted);
        border: 1px solid var(--border);
    }

    .badge-success {
        background-color: var(--state-success-dim);
        color: var(--state-success);
        border: none;
    }

    .badge-warning {
        background-color: var(--state-warning-dim);
        color: var(--state-warning);
        border: none;
    }

    .badge-error {
        background-color: var(--state-error-dim);
        color: var(--state-error);
        border: none;
    }

    .badge-info {
        background-color: var(--state-info-dim);
        color: var(--state-info);
        border: none;
    }

    /* =============================================================================
   SECTION 15: COMPONENT - Modal
   ============================================================================= */

    .modal-overlay {
        position: fixed;
        inset: 0;
        background-color: rgba(0, 0, 0, 0.8);
        display: flex;
        align-items: center;
        justify-content: center;
        z-index: 1000;
        animation: fadeIn 0.2s ease;
    }

    .modal {
        width: 90%;
        max-width: 600px;
        max-height: 80vh;
        background-color: var(--bg-card);
        border: 1px solid var(--border);
        border-radius: var(--border-radius-xl);
        overflow: hidden;
        animation: slideUp 0.3s ease;
    }

    .modal-header {
        display: flex;
        align-items: center;
        justify-content: space-between;
        padding: var(--spacing-md) var(--spacing-lg);
        border-bottom: 1px solid var(--border);
    }

    .modal-title {
        font-size: var(--font-md);
        font-weight: 500;
    }

    .modal-body {
        padding: var(--spacing-lg);
        overflow-y: auto;
        max-height: 60vh;
    }

    .modal-footer {
        display: flex;
        justify-content: flex-end;
        gap: var(--spacing-sm);
        padding: var(--spacing-md) var(--spacing-lg);
        border-top: 1px solid var(--border);
    }

    /* =============================================================================
   SECTION 16: COMPONENT - Toast
   ============================================================================= */

    .toast {
        position: fixed;
        bottom: var(--spacing-lg);
        right: var(--spacing-lg);
        padding: var(--spacing-md) var(--spacing-lg);
        background-color: var(--bg-card);
        border: 1px solid var(--border);
        border-radius: var(--border-radius-lg);
        color: var(--text-primary);
        font-size: var(--font-sm);
        z-index: 2000;
        animation: slideUp 0.3s ease;
    }

    .toast-success {
        border-color: var(--state-success);
    }

    .toast-error {
        border-color: var(--state-error);
    }

    .toast-warning {
        border-color: var(--state-warning);
    }

    /* =============================================================================
   SECTION 17: COMPONENT - Loading/Spinner
   ============================================================================= */

    .loading {
        display: flex;
        align-items: center;
        justify-content: center;
        gap: var(--spacing-sm);
        padding: var(--spacing-xl);
        color: var(--text-muted);
    }

    .spinner {
        width: 20px;
        height: 20px;
        border: 2px solid var(--border);
        border-top-color: var(--accent-primary);
        border-radius: 50%;
        animation: spin 0.8s linear infinite;
    }

    /* =============================================================================
   SECTION 18: COMPONENT - Empty State
   ============================================================================= */

    .empty-state {
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        padding: var(--spacing-3xl);
        color: var(--text-muted);
        text-align: center;
    }

    .empty-state-icon {
        font-size: 48px;
        margin-bottom: var(--spacing-md);
        opacity: 0.5;
    }

    .empty-state-title {
        font-size: var(--font-md);
        font-weight: 500;
        color: var(--text-secondary);
        margin-bottom: var(--spacing-xs);
    }

    .empty-state-text {
        font-size: var(--font-sm);
    }

    /* =============================================================================
   SECTION 19: UTILITY CLASSES
   ============================================================================= */

    /* Flex */
    .flex {
        display: flex;
    }

    .flex-col {
        flex-direction: column;
    }

    .flex-center {
        align-items: center;
        justify-content: center;
    }

    .flex-between {
        justify-content: space-between;
    }

    .gap-xs {
        gap: var(--spacing-xs);
    }

    .gap-sm {
        gap: var(--spacing-sm);
    }

    .gap-md {
        gap: var(--spacing-md);
    }

    .gap-lg {
        gap: var(--spacing-lg);
    }

    /* Text */
    .text-primary {
        color: var(--text-primary);
    }

    .text-secondary {
        color: var(--text-secondary);
    }

    .text-muted {
        color: var(--text-muted);
    }

    .text-success {
        color: var(--state-success);
    }

    .text-warning {
        color: var(--state-warning);
    }

    .text-error {
        color: var(--state-error);
    }

    .text-center {
        text-align: center;
    }

    .text-sm {
        font-size: var(--font-sm);
    }

    .text-xs {
        font-size: var(--font-xs);
    }

    .font-bold {
        font-weight: 600;
    }

    .uppercase {
        text-transform: uppercase;
        letter-spacing: 0.5px;
    }

    /* Spacing */
    .p-sm {
        padding: var(--spacing-sm);
    }

    .p-md {
        padding: var(--spacing-md);
    }

    .p-lg {
        padding: var(--spacing-lg);
    }

    .m-sm {
        margin: var(--spacing-sm);
    }

    .m-md {
        margin: var(--spacing-md);
    }

    .m-lg {
        margin: var(--spacing-lg);
    }

    .mt-md {
        margin-top: var(--spacing-md);
    }

    .mb-md {
        margin-bottom: var(--spacing-md);
    }

    /* =============================================================================
   SECTION 20: THEME TOGGLE (Professional SVG-based)
   ============================================================================= */

    .theme-toggle {
        width: 32px;
        height: 32px;
        display: flex;
        align-items: center;
        justify-content: center;
        background: transparent;
        border: 1px solid var(--border);
        border-radius: var(--border-radius-md);
        color: var(--text-secondary);
        cursor: pointer;
        transition: all var(--transition-fast);
        padding: 0;
    }

    .theme-toggle:hover {
        border-color: var(--border-hover);
        color: var(--text-primary);
        background: var(--bg-elevated);
    }

    .theme-toggle svg {
        width: 16px;
        height: 16px;
        fill: currentColor;
        transition: transform var(--transition-fast);
    }

    .theme-toggle:hover svg {
        transform: rotate(15deg);
    }

    /* Icon visibility based on theme */
    .theme-toggle .icon-sun,
    .theme-toggle .icon-moon {
        display: none;
    }

    [data-theme="dark"] .theme-toggle .icon-sun {
        display: block;
    }

    [data-theme="light"] .theme-toggle .icon-moon {
        display: block;
    }

    /* Fallback for single icon mode */
    .theme-toggle .icon-contrast {
        display: block;
    }
</style>



    <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
         THEME STATE (inlined from ThemeState.html)
         ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<script>
    // Apply theme immediately to prevent flash (IIFE)
    (function () {
        const saved = localStorage.getItem('orion-theme') || 'dark';
        document.documentElement.setAttribute('data-theme', saved);
    })();

    // Theme management singleton
    const Theme = {
        current: 'dark',

        init() {
            const saved = localStorage.getItem('orion-theme') || 'dark';
            this.current = saved;
            document.documentElement.setAttribute('data-theme', saved);
            this.updateToggleIcon();
        },

        set(theme) {
            this.current = theme;
            document.documentElement.setAttribute('data-theme', theme);
            localStorage.setItem('orion-theme', theme);
            this.updateToggleIcon();
        },

        toggle() {
            this.set(this.current === 'dark' ? 'light' : 'dark');
        },

        updateToggleIcon() {
            // Update all toggle buttons on page
            document.querySelectorAll('.theme-toggle').forEach(btn => {
                const sunIcon = btn.querySelector('.icon-sun');
                const moonIcon = btn.querySelector('.icon-moon');
                if (sunIcon && moonIcon) {
                    sunIcon.style.display = this.current === 'dark' ? 'block' : 'none';
                    moonIcon.style.display = this.current === 'light' ? 'block' : 'none';
                }
            });
        },

        // Create toggle button HTML (professional SVG icons)
        createToggleButton() {
            return `
                <button class="theme-toggle" onclick="Theme.toggle()" title="Toggle theme" aria-label="Toggle dark/light mode">
                    <svg class="icon-sun" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <circle cx="12" cy="12" r="5"/>
                        <path d="M12 1v2M12 21v2M4.22 4.22l1.42 1.42M18.36 18.36l1.42 1.42M1 12h2M21 12h2M4.22 19.78l1.42-1.42M18.36 5.64l1.42-1.42"/>
                    </svg>
                    <svg class="icon-moon" viewBox="0 0 24 24" fill="currentColor">
                        <path d="M21.752 15.002A9.718 9.718 0 0118 15.75c-5.385 0-9.75-4.365-9.75-9.75 0-1.33.266-2.597.748-3.752A9.753 9.753 0 003 11.25C3 16.635 7.365 21 12.75 21a9.753 9.753 0 009.002-5.998z"/>
                    </svg>
                </button>
            `;
        }
    };

    // Auto-init on load
    document.addEventListener('DOMContentLoaded', () => Theme.init());
</script>

<? if (page === "rca") { ?>
    <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
         RCA PARTIALS (inlined from RCAPartials.html)
         ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<!--
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
RCA MANAGER v3 - ENHANCED CLIENT-SIDE JAVASCRIPT
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
Includes: Theme toggle, keyboard shortcuts, search history, admin panel,
session heartbeat, and all existing functionality preserved.
-->

<script>
  // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
  // CONFIGURATION & STATE
  // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

  let appConfig = null;
  let searchHistory = JSON.parse(localStorage.getItem('rcam_searchHistory') || '[]');
  let adminPanelOpen = false;

  // Initialize app on load
  document.addEventListener('DOMContentLoaded', initializeApp);

  async function initializeApp() {
    // Load config from server
    google.script.run.withSuccessHandler(config => {
      appConfig = config;

      // Apply saved theme
      const savedTheme = localStorage.getItem('rcam_theme') || config.ui.DEFAULT_THEME;
      setTheme(savedTheme);

      // Show admin button if admin
      if (config.isAdmin && config.features.ENABLE_ADMIN_PANEL) {
        document.getElementById('adminBtn')?.classList.remove('hidden');
      }

      // Show user email
      const userInfo = document.querySelector('.user-info');
      if (userInfo) {
        userInfo.textContent = config.userEmail.split('@')[0];
      }

      // Initialize features
      if (config.features.ENABLE_KEYBOARD_SHORTCUTS) initKeyboardShortcuts();
      if (config.features.ENABLE_SEARCH_HISTORY) renderSearchHistory();
      if (config.features.ENABLE_CASE_DISTRIBUTION) startHeartbeat();

      // Apply condensed layout if enabled
      if (config.features.ENABLE_CONDENSED_LAYOUT) {
        document.documentElement.setAttribute('data-layout', 'condensed');
      }

    }).getClientConfig();

    // Expand first sections by default
    document.querySelectorAll('.section-content').forEach((el, i) => {
      if (i < 2) el.classList.remove('hidden');
    });
  }

  // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
  // THEME SYSTEM
  // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

  function setTheme(theme) {
    document.documentElement.setAttribute('data-theme', theme);
    localStorage.setItem('rcam_theme', theme);

    const toggle = document.getElementById('themeToggle');
    if (toggle) {
      toggle.innerHTML = theme === 'dark' ? '‚òÄÔ∏è Light' : 'üåô Dark';
    }
  }

  function toggleTheme() {
    const current = document.documentElement.getAttribute('data-theme') || 'dark';
    setTheme(current === 'dark' ? 'light' : 'dark');
  }

  // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
  // STATUS BAR MESSAGES
  // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

  function statusUpdate(msg, type = 'default') {
    const status = document.getElementById('status');
    if (!status) return;

    status.textContent = msg;
    status.className = ''; // Reset classes

    if (type === 'success' || msg.includes('claimed') || msg.includes('Updated') || msg.includes('Uploaded')) {
      status.classList.add('success');
    } else if (type === 'error' || msg.includes('error') || msg.includes('Error')) {
      status.classList.add('error');
    } else if (type === 'loading' || msg.includes('Fetching') || msg.includes('Uploading')) {
      status.classList.add('loading');
    }

    // Auto-clear after duration
    if (type !== 'loading') {
      setTimeout(() => {
        status.textContent = '';
        status.className = '';
      }, appConfig?.ui?.TOAST_DURATION_MS || 3000);
    }
  }

  // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
  // SECTION TOGGLE (COLLAPSIBLE)
  // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

  function toggleSection(sectionId) {
    const section = document.getElementById(sectionId);
    const header = section?.previousElementSibling;

    if (section.classList.contains('hidden')) {
      section.classList.remove('hidden');
      header?.classList.remove('collapsed');
    } else {
      section.classList.add('hidden');
      header?.classList.add('collapsed');
    }
  }

  // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
  // COPY TO CLIPBOARD
  // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

  function copyToClipboard(labelId) {
    const label = document.getElementById(labelId);
    if (!label) return;

    const text = label.innerText || label.textContent;

    if (navigator.clipboard) {
      navigator.clipboard.writeText(text).then(() => {
        statusUpdate('Copied: ' + text.substring(0, 20) + (text.length > 20 ? '...' : ''), 'success');
      });
    } else {
      // Fallback
      const tempInput = document.createElement('textarea');
      tempInput.value = text;
      document.body.appendChild(tempInput);
      tempInput.select();
      document.execCommand('copy');
      document.body.removeChild(tempInput);
      statusUpdate('Copied', 'success');
    }
  }

  // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
  // CANNED RESPONSES
  // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

  function addCannedResponse(response) {
    const textarea = document.getElementById('rebuttal-response');
    if (!textarea) return;

    const cursorPosition = textarea.selectionStart;
    const textBeforeCursor = textarea.value.substring(0, cursorPosition);
    const textAfterCursor = textarea.value.substring(cursorPosition);

    textarea.value = textBeforeCursor + response + textAfterCursor;

    const newCursorPosition = cursorPosition + response.length;
    textarea.setSelectionRange(newCursorPosition, newCursorPosition);
    textarea.focus();
  }

  let cannedResponses = [];

  function showCannedModal() {
    document.getElementById('cannedModal').style.display = 'block';
    document.getElementById('modalOverlay')?.classList.add('active');
    fetchCannedResponses();
  }

  function closeCannedModal() {
    document.getElementById('cannedModal').style.display = 'none';
    document.getElementById('modalOverlay')?.classList.remove('active');
  }

  function fetchCannedResponses() {
    google.script.run.withSuccessHandler(data => {
      cannedResponses = data;
      const dropdown = document.getElementById('savedResList');
      if (!dropdown) return;

      dropdown.innerHTML = '<option value="">-- Select --</option>';
      cannedResponses.forEach(r => {
        const opt = document.createElement('option');
        opt.value = r.name;
        opt.textContent = r.name;
        dropdown.appendChild(opt);
      });
    }).getCannedResponses();
  }

  function loadCannedResponse() {
    const name = document.getElementById('responseList')?.value;
    const match = cannedResponses.find(r => r.name === name);
    if (match) {
      document.getElementById('responseBox').value = match.response;
      document.getElementById('responseName').value = match.name;
    }
  }

  function saveCanned() {
    const name = document.getElementById('responseName')?.value.trim();
    const response = document.getElementById('responseBox')?.value.trim();

    if (!name || !response) {
      alert('Please enter both name and response');
      return;
    }

    google.script.run.withSuccessHandler(msg => {
      statusUpdate('Response ' + msg, 'success');
      fetchCannedResponses();
    }).saveCannedResponse(name, response);
  }

  function clearCanned() {
    document.getElementById('responseList').value = '';
    document.getElementById('responseBox').value = '';
    document.getElementById('responseName').value = '';
  }

  function insertCanned() {
    const response = document.getElementById('responseBox')?.value;
    if (response) {
      addCannedResponse(response);
      closeCannedModal();
    }
  }

  // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
  // CASE MANAGEMENT (INPUT / DISPLAY)
  // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

  function inputCaseInfo(data) {
    // Check for case conflict (case already taken by another analyst)
    if (data[0] && data[0].includes('already taken')) {
      alert('‚ö†Ô∏è Case Conflict!\n\n' + data[0] + '\n\nPlease click "Get Case" to fetch a new case.');
      statusUpdate(data[0], 'error');
      return;
    }

    // Check for no cases available
    if (data[0] === 'No Cases') {
      statusUpdate('No cases available in queue', 'default');
      return;
    }

    statusUpdate(data[0], 'success');
    const values = data;

    const table = document.getElementById('caseinfo');
    if (!table) return;

    let valueCounter = 1;

    for (let i = 0; i < table.rows.length; i++) {
      const row = table.rows[i];
      for (let j = 0; j < row.cells.length; j++) {
        if ((i * row.cells.length + j) % 2 === 1 && valueCounter < values.length) {
          row.cells[j].innerHTML = values[valueCounter];
          valueCounter++;
        }
      }
    }

    document.getElementById('policy').innerHTML = data[14] || '';
    document.getElementById('internal-notes').innerHTML = data[15] || '';

    if (data[16]?.length > 2) {
      AffirmLink(data[16]);
    }

    if (data[7] === 'INQ') {
      document.getElementById('recovery-notes').value = 'This is an Inquiry.';
    }
  }

  function getCase() {
    statusUpdate('Fetching case...', 'loading');

    const itnInput = document.getElementById('confirmation-number');

    if (itnInput?.value !== '') {
      const itn = itnInput.value;

      // Add to search history
      addToSearchHistory(itn);

      google.script.run.withSuccessHandler(updatesearch).searchCase(itn);
      clearTableData();

      setTimeout(() => {
        statusUpdate('Fetching reservation info...', 'loading');
        google.script.run.withSuccessHandler(updateTtable).getReservationData(itn);
      }, 2000);

      setTimeout(() => {
        const row = document.getElementById('cId')?.innerText;
        if (row) {
          google.script.run.withSuccessHandler(claimstatus).checkClaim(row);
        }
      }, 10000);

    } else {
      clearTableData();
      // Get portal value if set, otherwise use empty string to get any available case
      const portal = document.getElementById('portal')?.value || '';

      // Call backend - it will fetch the next available case regardless of portal
      google.script.run.withSuccessHandler(inputCaseInfo).getCase(portal);

      setTimeout(() => {
        const itn = document.getElementById('itn')?.innerText;
        if (itn) {
          statusUpdate('Fetching reservation info...', 'loading');
          google.script.run.withSuccessHandler(updateTtable).getReservationData(itn);
        }
      }, 6000);

      setTimeout(() => {
        const row = document.getElementById('cId')?.innerText;
        if (row) {
          google.script.run.withSuccessHandler(claimstatus).checkClaim(row);
        }
      }, 10000);
    }
  }

  function claimstatus(response) {
    statusUpdate(response[0], response[1] === '#2ea44f' ? 'success' : 'error');
  }

  function updatesearch(data) {
    statusUpdate(data[0], 'success');
    const values = data;
    const table = document.getElementById('caseinfo');

    if (!table) return;

    let valueCounter = 1;

    for (let i = 0; i < table.rows.length; i++) {
      const row = table.rows[i];
      for (let j = 0; j < row.cells.length; j++) {
        if ((i * row.cells.length + j) % 2 === 1 && valueCounter < values.length) {
          row.cells[j].innerHTML = values[valueCounter];
          valueCounter++;
        }
      }
    }

    document.getElementById('policy').innerHTML = data[14] || '';
    if (data[18]?.length > 2) AffirmLink(data[18]);
    document.getElementById('issuer-notes').value = data[15] || '';
    document.getElementById('rebuttal-response').value = data[16] || '';
    document.getElementById('internal-notes').value = data[17] || '';
    document.getElementById('rca').value = data[19] || '';
  }

  function updateTtable(data) {
    statusUpdate(data[0], 'success');
    const values = data;
    const table = document.getElementById('transInfo');

    if (!table) return;

    let valueCounter = 1;

    for (let i = 0; i < table.rows.length; i++) {
      const row = table.rows[i];
      for (let j = 0; j < row.cells.length; j++) {
        if ((i * row.cells.length + j) % 2 === 1 && valueCounter < values.length) {
          row.cells[j].innerHTML = values[valueCounter];
          valueCounter++;
        }
      }
    }
  }

  function AffirmLink(link) {
    const portalCell = document.getElementById('alink');
    if (!portalCell) return;

    const hyperlink = document.createElement('a');
    hyperlink.href = 'https://' + link;
    hyperlink.textContent = 'Affirm';
    hyperlink.target = '_blank';
    hyperlink.style.color = 'var(--accent-green)';

    portalCell.textContent = '';
    portalCell.appendChild(hyperlink);
  }

  function clearTableData() {
    document.querySelectorAll('.data').forEach(el => el.textContent = '');

    ['rca', 'issuer-notes', 'rebuttal-response', 'internal-notes', 'recovery-notes',
      'confirmpage', 'confirmpages', 'checkoutpage', 'checkoutpages', 'wexandrefund', 'accproof'
    ].forEach(id => {
      const el = document.getElementById(id);
      if (el) el.value = '';
    });

    const icon = document.getElementById('icon');
    if (icon) icon.innerHTML = '‚ùå';

    const uploadStatus = document.getElementById('Uploadstatus');
    if (uploadStatus) uploadStatus.innerHTML = '';

    document.querySelectorAll('.output').forEach(el => el.textContent = '');
    document.querySelectorAll('.delete-btn').forEach(btn => btn.click());
  }

  function getInfo() {
    const itn = document.getElementById('itn')?.innerText;
    if (itn) {
      statusUpdate('Fetching reservation info...', 'loading');
      google.script.run.withSuccessHandler(updateTtable).getReservationData(itn);
    }
  }

  // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
  // RESOLVE CASE
  // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

  function Resolve() {
    const rca = document.getElementById('rca')?.value;
    const res = document.getElementById('rebuttal-response')?.value;

    if (!rca || !res) {
      alert('RCA or Rebuttal Response is missing.');
      return;
    }

    const refundAmount = document.querySelector('#caseinfo > tbody:nth-child(1) > tr:nth-child(8) > td:nth-child(2)')?.innerText?.trim();
    const uploadStatus = document.querySelectorAll('.output')[2]?.textContent;

    // Check if refund screenshot uploaded but amount is missing or zero
    if (uploadStatus === 'Uploaded' && (!refundAmount || refundAmount === '0' || refundAmount === '')) {
      if (!confirm('‚ö†Ô∏è Missing Refund Amount!\n\nRefund screenshot was uploaded but the Refund Amount is not set.\n\nDo you want to continue without updating the refund amount?')) return;
    }

    const row = document.getElementById('cId')?.innerText;
    const aff = document.getElementById('issuer-notes')?.value;
    const notes = document.getElementById('internal-notes')?.value;

    google.script.run.withSuccessHandler(msg => {
      statusUpdate(msg, 'success');
      clearTableData();

      // Check break mode - if enabled, don't auto-fetch next case
      const breakMode = document.getElementById('breakMode')?.checked;
      if (breakMode) {
        statusUpdate('‚òï Break mode active - ready when you are', 'default');
        return;
      }

      // Auto-get next case if not searching specific ITN
      if (!document.getElementById('confirmation-number')?.value) {
        setTimeout(getCase, 3000);
      }
    }).resolveRCA(row, rca, res, aff, notes);
  }

  // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
  // FILE UPLOADS
  // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

  async function saveFiles1() {
    const uploadBoxes = document.querySelectorAll('.upload-box');
    const itn = document.getElementById('itn')?.innerText;
    const row = document.getElementById('tId')?.innerText;

    if (!row) {
      alert('ERROR: Transaction Info Missing!');
      return;
    }

    for (let box of uploadBoxes) {
      const img = box.querySelector('img');
      const output = box.nextElementSibling;

      if (img?.src.startsWith('blob')) {
        statusUpdate('Uploading images...', 'loading');

        const base64Data = await getBase64FromImage(img.src);

        google.script.run.withSuccessHandler(response => {
          if (output) output.textContent = response.status;
        }).uploadImageToDrive(row, itn, box.id, base64Data);
      }
    }
  }

  async function getBase64FromImage(imageUrl) {
    const response = await fetch(imageUrl);
    const blob = await response.blob();
    return new Promise((resolve, reject) => {
      const reader = new FileReader();
      reader.onloadend = () => resolve(reader.result.split(',')[1]);
      reader.onerror = reject;
      reader.readAsDataURL(blob);
    });
  }

  async function uploadFiles() {
    const statusEl = document.getElementById('Uploadstatus');

    const getFileContent = file => {
      return new Promise((resolve, reject) => {
        if (statusEl) statusEl.innerHTML = 'Uploading... <span class="spinner"></span>';
        const reader = new FileReader();
        reader.onload = () => resolve(reader.result.split(',')[1]);
        reader.onerror = reject;
        reader.readAsDataURL(file);
      });
    };

    const prepareFile = async file => ({
      name: file.name,
      mimeType: file.type,
      content: await getFileContent(file)
    });

    const itn = document.getElementById('itn')?.innerText;
    const confirmpage = document.getElementById('confirmpage')?.files[0];
    const checkoutpage = document.getElementById('checkoutpage')?.files[0];

    if (!confirmpage || !checkoutpage) {
      alert('Confirmation and Checkout pages are required!');
      return;
    }

    const confirmpages = document.getElementById('confirmpages')?.files[0];
    const checkoutpages = document.getElementById('checkoutpages')?.files[0];
    const wexandrefund = document.getElementById('wexandrefund')?.files[0];
    const accproof = document.getElementById('accproof')?.files[0];

    const formData = {
      itn: itn,
      confirmpage: await prepareFile(confirmpage),
      checkoutpage: await prepareFile(checkoutpage),
      confirmpages: confirmpages ? await prepareFile(confirmpages) : null,
      checkoutpages: checkoutpages ? await prepareFile(checkoutpages) : null,
      wexandrefund: wexandrefund ? await prepareFile(wexandrefund) : null,
      accproof: accproof ? await prepareFile(accproof) : null
    };

    google.script.run.withSuccessHandler(res => {
      if (statusEl) {
        statusEl.innerHTML = `<strong>${res.message}</strong><br>Uploaded:<br>` + res.uploaded.join('<br>');
      }

      ['confirmpage', 'confirmpages', 'checkoutpage', 'checkoutpages', 'wexandrefund', 'accproof'].forEach(id => {
        const el = document.getElementById(id);
        if (el) el.value = '';
      });
    }).uploadAllFiles(formData);
  }

  // Setup paste handlers for upload boxes
  document.addEventListener('DOMContentLoaded', () => {
    document.querySelectorAll('.upload-box').forEach(box => {
      const previewImage = box.querySelector('img');
      const span = box.querySelector('span');
      const deleteButton = box.querySelector('.delete-btn');

      box.addEventListener('paste', event => {
        const items = event.clipboardData?.items;
        if (!items) return;

        for (let item of items) {
          if (item.type.startsWith('image/')) {
            const blob = item.getAsFile();
            const url = URL.createObjectURL(blob);

            if (previewImage) {
              previewImage.src = url;
              previewImage.style.display = 'block';
            }
            if (span) span.style.display = 'none';
            if (deleteButton) deleteButton.style.display = 'block';
            box.classList.add('has-image');
            break;
          }
        }
      });

      if (deleteButton) {
        deleteButton.addEventListener('click', () => {
          if (previewImage) {
            previewImage.src = '';
            previewImage.style.display = 'none';
          }
          if (span) span.style.display = 'block';
          deleteButton.style.display = 'none';
          box.classList.remove('has-image');
        });
      }
    });
  });

  // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
  // RECOVERY
  // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

  function RecoveryReq() {
    const row = document.getElementById('tId')?.innerText;
    const selectedOption = document.getElementById('recovery-details')?.value;

    if (!row) {
      alert('ERROR: Transaction Info Missing!');
      return;
    }

    if (!selectedOption) {
      alert('No option selected');
      return;
    }

    if (selectedOption === 'Recovery Needed') {
      const itn = document.getElementById('itn')?.innerText;
      const hotel = document.getElementById('hotel')?.innerText;
      const rnum = document.getElementById('rnum')?.innerText;
      const cin = document.querySelectorAll('.data')[19]?.innerText;
      const cout = document.querySelectorAll('.data')[20]?.innerText;
      const cbcode = document.querySelectorAll('.data')[4]?.innerText;
      const amt = document.querySelectorAll('.data')[8]?.innerText;
      const notes = document.getElementById('recovery-notes')?.value;

      google.script.run.withSuccessHandler(msg => {
        statusUpdate(msg, 'success');
        document.getElementById('recovery-notes').value = '';
        document.getElementById('icon').innerHTML = '‚úÖ';
      }).sendForRecovery(itn, rnum, amt, cin, cout, hotel, cbcode, notes);

    } else {
      const itn = document.getElementById('itn')?.innerText;
      const rnum = document.getElementById('rnum')?.innerText;
      const amt = document.querySelectorAll('.data')[8]?.innerText;
      const notes = document.getElementById('recovery-notes')?.value;

      google.script.run.withSuccessHandler(msg => {
        statusUpdate(msg, 'success');
        document.getElementById('recovery-notes').value = '';
        document.getElementById('icon').innerHTML = '‚úÖ';
      }).sendForVbException(itn, rnum, amt, selectedOption, notes);
    }
  }

  // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
  // PENDING CASES
  // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

  function getPendingCases() {
    statusUpdate('Fetching pending cases...', 'loading');
    google.script.run.withSuccessHandler(updatePending).getPendingCases();
  }

  function updatePending(data) {
    const container = document.querySelector('.working-rca');
    const table = document.getElementById('pendingcase');
    const message = document.getElementById('pendingmessage');
    const hideBtn = document.getElementById('hide');

    if (data?.length > 0) {
      if (container) container.style.display = 'block';
      if (hideBtn) hideBtn.style.display = 'inline';
      if (table) table.style.display = 'table';
      if (message) message.style.display = 'none';

      // Clear existing rows
      if (table) {
        while (table.rows.length > 1) {
          table.deleteRow(1);
        }

        // Add new rows
        data.forEach(rowData => {
          const row = table.insertRow();
          rowData.forEach(cellData => {
            const cell = row.insertCell();
            cell.textContent = cellData;
          });
        });

        // Hide row number column
        table.querySelectorAll('th:first-child, td:first-child').forEach(el => {
          el.style.display = 'none';
        });
      }

      DeadlineReaching();
    } else {
      if (container) container.style.display = 'block';
      if (message) message.style.display = 'block';
      if (table) table.style.display = 'none';
    }
  }

  function DeadlineReaching() {
    const tableRows = document.getElementById('pendingcase')?.getElementsByTagName('tr');
    if (!tableRows) return;

    for (let row = 1; row < tableRows.length; row++) {
      const cellToCheck = tableRows[row].getElementsByTagName('td')[5];
      if (cellToCheck && reviewDate(cellToCheck) < 5) {
        addCautionIconToCell(cellToCheck);
      }
    }
  }

  function addCautionIconToCell(cell) {
    const existing = cell.querySelector('.caution-icon');
    if (existing) return;

    const cautionIcon = document.createElement('span');
    cautionIcon.className = 'caution-icon';
    cautionIcon.innerText = '‚ö†Ô∏è';
    cell.appendChild(cautionIcon);
  }

  function reviewDate(cell) {
    const today = new Date();
    const dueDt = new Date(cell.textContent);
    const diffTime = Math.abs(today - dueDt);
    return Math.ceil(diffTime / (1000 * 60 * 60 * 24));
  }

  function hidePendingTable() {
    document.querySelector('.working-rca').style.display = 'none';
    document.getElementById('hide').style.display = 'none';
  }

  // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
  // QUEUE STATS
  // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

  function getCount() {
    statusUpdate('Fetching queue stats...', 'loading');
    google.script.run.withSuccessHandler(response => {
      const spans = document.querySelectorAll('.queue-status span');
      if (spans.length >= 7) {
        spans[0].textContent = response.myCount;
        spans[1].textContent = response.myFraud;
        spans[2].textContent = response.priority;
        spans[3].textContent = response.affirm;
        spans[4].textContent = response.amex;
        spans[5].textContent = response.braintree;
        spans[6].textContent = response.chase;
      }
      statusUpdate('Stats loaded', 'success');
    }).agentCount();
  }

  // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
  // EDIT CELL (REFUND / ROOM TYPE)
  // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

  function editCell(editIcon) {
    const currTd = editIcon.closest('td');
    const td = editIcon.closest('td').nextElementSibling;
    const currentValue = td.textContent.trim();

    const input = document.createElement('input');
    input.type = 'text';
    input.value = currentValue;
    input.style.width = '100%';

    td.innerHTML = '';
    td.appendChild(input);
    input.focus();

    const saveIcon = document.createElement('span');
    saveIcon.innerHTML = 'üíæ';
    saveIcon.classList.add('action-icons');
    saveIcon.onclick = () => saveCell(input, td, saveIcon, currTd);

    editIcon.replaceWith(saveIcon);
  }

  function saveCell(input, td, saveIcon, currTd) {
    const newValue = input.value.trim();
    td.textContent = newValue;

    const editIcon = document.createElement('span');
    editIcon.innerHTML = '‚úèÔ∏è';
    editIcon.classList.add('action-icons');
    editIcon.onclick = () => editCell(editIcon);

    saveIcon.replaceWith(editIcon);

    if (currTd.innerText.includes('Room Type')) {
      const row = document.getElementById('tId')?.innerText;
      if (row) google.script.run.updateRoomType(row, newValue);
    } else {
      const row = document.getElementById('cId')?.innerText;
      if (row) google.script.run.updateRefundAmount(row, newValue);
    }
  }

  // Textarea character limit
  document.addEventListener('DOMContentLoaded', () => {
    const textarea = document.getElementById('issuer-notes');
    const errorMsg = document.getElementById('errorMsg');
    const MAX_ROWS = 30;
    const MAX_CHARS = 2500;

    if (textarea) {
      textarea.addEventListener('input', function () {
        const lines = this.value.split('\n');
        const charCount = this.value.length;

        if (lines.length > MAX_ROWS) {
          if (errorMsg) errorMsg.textContent = `Error: Maximum of ${MAX_ROWS} rows allowed.`;
          this.value = lines.slice(0, MAX_ROWS).join('\n');
        } else if (charCount > MAX_CHARS) {
          if (errorMsg) errorMsg.textContent = `Error: Maximum of ${MAX_CHARS} characters allowed.`;
          this.value = this.value.slice(0, MAX_CHARS);
        } else {
          if (errorMsg) errorMsg.textContent = '';
        }
      });
    }
  });

  // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
  // BOOKING DATA / CANNED RES
  // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

  function getBookingData() {
    const row = document.getElementById('cId')?.innerText;
    if (!row) return;

    google.script.run.withSuccessHandler(response => {
      addCannedResponse(response);
    }).createCannedRes(row);
  }

  // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
  // KEYBOARD SHORTCUTS
  // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

  function initKeyboardShortcuts() {
    document.addEventListener('keydown', event => {
      // Don't trigger if typing in input/textarea
      if (['INPUT', 'TEXTAREA', 'SELECT'].includes(document.activeElement.tagName)) {
        // Only allow Escape
        if (event.key === 'Escape') {
          document.activeElement.blur();
        }
        return;
      }

      // Ctrl/Cmd shortcuts
      if (event.ctrlKey || event.metaKey) {
        switch (event.key.toLowerCase()) {
          case 'enter':
            event.preventDefault();
            Resolve();
            break;
          case 'g':
            event.preventDefault();
            getCase();
            break;
          case 'p':
            event.preventDefault();
            getPendingCases();
            break;
          case 's':
            event.preventDefault();
            saveFiles1();
            break;
        }
      }

      // Single key shortcuts (when not in input)
      switch (event.key) {
        case '?':
          showShortcutsHelp();
          break;
        case 'Escape':
          closeCannedModal();
          closeAdminPanel();
          break;
      }
    });
  }

  function showShortcutsHelp() {
    alert(`Keyboard Shortcuts:
  
Ctrl+Enter  ‚Üí  Resolve case
Ctrl+G      ‚Üí  Get new case
Ctrl+P      ‚Üí  Show pending cases
Ctrl+S      ‚Üí  Save uploads
Escape      ‚Üí  Close modals
?           ‚Üí  Show this help`);
  }

  // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
  // SEARCH HISTORY
  // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

  function addToSearchHistory(itn) {
    if (!itn || !appConfig?.features?.ENABLE_SEARCH_HISTORY) return;

    // Remove if already exists
    searchHistory = searchHistory.filter(i => i !== itn);

    // Add to front
    searchHistory.unshift(itn);

    // Limit size
    if (searchHistory.length > (appConfig?.ui?.SEARCH_HISTORY_LIMIT || 10)) {
      searchHistory.pop();
    }

    localStorage.setItem('rcam_searchHistory', JSON.stringify(searchHistory));
    renderSearchHistory();
  }

  function renderSearchHistory() {
    const container = document.getElementById('searchHistory');
    if (!container || !appConfig?.features?.ENABLE_SEARCH_HISTORY) return;

    container.innerHTML = '';

    searchHistory.slice(0, 5).forEach(itn => {
      const chip = document.createElement('span');
      chip.className = 'search-chip';
      chip.textContent = itn;
      chip.onclick = () => {
        document.getElementById('confirmation-number').value = itn;
        getCase();
      };
      container.appendChild(chip);
    });
  }

  // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
  // SESSION HEARTBEAT (for case distribution)
  // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

  function startHeartbeat() {
    // Initial heartbeat
    google.script.run.recordHeartbeat();

    // Periodic heartbeat
    setInterval(() => {
      google.script.run.recordHeartbeat();
    }, appConfig?.session?.HEARTBEAT_INTERVAL_MS || 60000);

    // Mark inactive on page unload
    window.addEventListener('beforeunload', () => {
      google.script.run.markInactive();
    });
  }

  // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
  // ADMIN PANEL
  // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

  function toggleAdminPanel() {
    const panel = document.getElementById('adminPanel');
    if (!panel) return;

    adminPanelOpen = !adminPanelOpen;
    panel.classList.toggle('open', adminPanelOpen);

    if (adminPanelOpen) {
      loadAdminData();
    }
  }

  function closeAdminPanel() {
    const panel = document.getElementById('adminPanel');
    if (panel) {
      panel.classList.remove('open');
      adminPanelOpen = false;
    }
  }

  function loadAdminData() {
    // Load analyst stats
    google.script.run.withSuccessHandler(stats => {
      renderAnalystStats(stats);
    }).getAnalystStats();

    // Load case distribution summary
    google.script.run.withSuccessHandler(summary => {
      renderDistributionSummary(summary);
    }).getCaseDistributionSummary();

    // Load active analysts
    google.script.run.withSuccessHandler(analysts => {
      renderActiveAnalysts(analysts);
    }).getActiveAnalysts();
  }

  function renderAnalystStats(stats) {
    const container = document.getElementById('analystStatsContainer');
    if (!container || !stats) return;

    container.innerHTML = stats.slice(0, 10).map(s => `
    <div class="analyst-list-item">
      <div>
        <span class="analyst-name">${s.name}</span>
        <span class="analyst-stats">Avg: ${s.avgTimeMinutes}min</span>
      </div>
      <div>
        <strong>${s.resolvedToday}</strong> today
      </div>
    </div>
  `).join('');
  }

  function renderDistributionSummary(summary) {
    if (!summary) return;

    const el = document.getElementById('distributionSummary');
    if (el) {
      el.innerHTML = `
      <div class="admin-stat-card">
        <h4>URGENCY</h4>
        <div>Critical (0-2d): <strong style="color:var(--accent-red)">${summary.byUrgency?.critical || 0}</strong></div>
        <div>Warning (3-5d): <strong style="color:var(--accent-yellow)">${summary.byUrgency?.warning || 0}</strong></div>
        <div>Normal (6+d): <strong style="color:var(--accent-green)">${summary.byUrgency?.normal || 0}</strong></div>
      </div>
    `;
    }
  }

  function renderActiveAnalysts(analysts) {
    const container = document.getElementById('activeAnalystsContainer');
    if (!container) return;

    if (!analysts || analysts.length === 0) {
      container.innerHTML = '<p style="color:var(--text-muted)">No active analysts</p>';
      return;
    }

    container.innerHTML = analysts.map(a => `
    <div style="display:flex;align-items:center;gap:8px;padding:6px 0;">
      <span class="analyst-active"></span>
      <span>${a.email.split('@')[0]}</span>
    </div>
  `).join('');
  }

  // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
  // ADMIN PANEL - CONFIG TAB (Sheet/Folder IDs)
  // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

  function showAdminTab(tab) {
    const statsTab = document.getElementById('adminTabStats');
    const configTab = document.getElementById('adminTabConfig');
    const btnStats = document.getElementById('tabStats');
    const btnConfig = document.getElementById('tabConfig');

    if (tab === 'stats') {
      statsTab.style.display = 'block';
      configTab.style.display = 'none';
      btnStats.classList.add('primary');
      btnConfig.classList.remove('primary');
      loadAdminData();
    } else {
      statsTab.style.display = 'none';
      configTab.style.display = 'block';
      btnStats.classList.remove('primary');
      btnConfig.classList.add('primary');
      loadSheetConfig();
    }
  }

  function loadSheetConfig() {
    google.script.run.withSuccessHandler(config => {
      if (config.error) {
        alert(config.error);
        return;
      }
      renderSheetConfig(config.sheets, 'sheetConfigContainer', 'sheet');
      renderSheetConfig(config.folders, 'folderConfigContainer', 'folder');
    }).withFailureHandler(err => {
      alert('Error loading config: ' + err);
    }).getSheetConfig();
  }

  function renderSheetConfig(items, containerId, type) {
    const container = document.getElementById(containerId);
    if (!container) return;

    const LABELS = {
      // Sheets
      RCA_DATA: 'RCA Data (Main)',
      CB_CONTROLLER: 'CB Controller',
      RECOVERY: 'Recovery',
      VB_EXCEPTION: 'VB Exception',
      EMAIL_CONFIRMATION: 'Email Confirmation',
      CANNED_RESPONSES: 'Canned Responses',
      // Folders
      IMAGES: 'Images',
      CONFIRM_PAGE: 'Confirmation PDFs',
      CHECKOUT_PAGE: 'Checkout PDFs',
      WEX_REFUND: 'WEX/Refund PDFs',
      ACCERTIFY: 'Accertify PDFs'
    };

    container.innerHTML = Object.entries(items).map(([key, val]) => `
            <div style="margin-bottom:12px;padding:8px;background:var(--bg-card);border-radius:4px;">
                <label style="font-size:10px;color:var(--text-muted);margin-bottom:4px;display:block;">
                    ${LABELS[key] || key}
                    ${val.isCustom ? '<span style="color:var(--accent-yellow);">‚ö° Custom</span>' : ''}
                </label>
                <div style="display:flex;gap:6px;">
                    <input type="text" 
                           id="${type}_${key}" 
                           value="${val.current}" 
                           style="flex:1;font-size:11px;font-family:monospace;">
                    <button onclick="save${type === 'sheet' ? 'Sheet' : 'Folder'}Id('${key}')" 
                            class="small">üíæ</button>
                    ${val.isCustom ? `<button onclick="reset${type === 'sheet' ? 'Sheet' : 'Folder'}Id('${key}')" 
                            class="small danger">‚Ü∫</button>` : ''}
                </div>
            </div>
        `).join('');
  }

  function saveSheetId(key) {
    const input = document.getElementById('sheet_' + key);
    if (!input) return;

    const newId = input.value.trim();
    google.script.run.withSuccessHandler(result => {
      if (result.success) {
        statusUpdate(result.message, 'success');
        loadSheetConfig();
      } else {
        alert('Error: ' + result.error);
      }
    }).updateSheetId(key, newId);
  }

  function saveFolderId(key) {
    const input = document.getElementById('folder_' + key);
    if (!input) return;

    const newId = input.value.trim();
    google.script.run.withSuccessHandler(result => {
      if (result.success) {
        statusUpdate(result.message, 'success');
        loadSheetConfig();
      } else {
        alert('Error: ' + result.error);
      }
    }).updateFolderId(key, newId);
  }

  function resetSheetId(key) {
    if (!confirm('Reset ' + key + ' to default value?')) return;

    google.script.run.withSuccessHandler(result => {
      if (result.success) {
        statusUpdate(result.message, 'success');
        loadSheetConfig();
      }
    }).resetSheetId(key);
  }

  function resetFolderId(key) {
    if (!confirm('Reset ' + key + ' to default value?')) return;

    google.script.run.withSuccessHandler(result => {
      if (result.success) {
        statusUpdate(result.message, 'success');
        loadSheetConfig();
      }
    }).resetFolderId(key);
  }

</script><!--
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
RCA MANAGER v3 - PREMIUM DESIGN SYSTEM STYLESHEET
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
Supports Dark (default) and Light mode via CSS variables.
Fonts: Space Grotesk (UI) + Space Mono (Data)
-->

<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link
  href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@400;500;600;700&family=Space+Mono:wght@400;700&display=swap"
  rel="stylesheet">

<style>
  /* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   CSS CUSTOM PROPERTIES (THEME SYSTEM)
   ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */

  :root {
    /* ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
     DARK THEME (DEFAULT)
     ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ */
    --bg-primary: #000000;
    --bg-secondary: #0a0a0a;
    --bg-elevated: #111111;
    --bg-card: #151515;
    --bg-input: #1a1a1a;

    --border: #1f1f1f;
    --border-hover: #2a2a2a;
    --border-focus: #3a3a3a;

    --text-primary: #ffffff;
    --text-secondary: #888888;
    --text-muted: #555555;
    --text-inverse: #000000;

    --accent-green: #00ff88;
    --accent-green-dim: rgba(0, 255, 136, 0.15);
    --accent-red: #ff0055;
    --accent-red-dim: rgba(255, 0, 85, 0.15);
    --accent-yellow: #ffcc00;
    --accent-yellow-dim: rgba(255, 204, 0, 0.15);
    --accent-blue: #0088ff;
    --accent-blue-dim: rgba(0, 136, 255, 0.15);

    --shadow-sm: 0 1px 2px rgba(0, 0, 0, 0.5);
    --shadow-md: 0 4px 12px rgba(0, 0, 0, 0.4);
    --shadow-lg: 0 8px 24px rgba(0, 0, 0, 0.5);

    --glow-green: 0 0 20px rgba(0, 255, 136, 0.3);
    --glow-red: 0 0 20px rgba(255, 0, 85, 0.3);
  }

  [data-theme="light"] {
    /* ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
     LIGHT THEME
     ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ */
    --bg-primary: #f8f9fa;
    --bg-secondary: #ffffff;
    --bg-elevated: #ffffff;
    --bg-card: #f1f3f5;
    --bg-input: #e9ecef;

    --border: #dee2e6;
    --border-hover: #ced4da;
    --border-focus: #adb5bd;

    --text-primary: #1a1a1a;
    --text-secondary: #495057;
    --text-muted: #868e96;
    --text-inverse: #ffffff;

    --accent-green: #00cc6a;
    --accent-green-dim: rgba(0, 204, 106, 0.12);
    --accent-red: #e03131;
    --accent-red-dim: rgba(224, 49, 49, 0.12);
    --accent-yellow: #f59f00;
    --accent-yellow-dim: rgba(245, 159, 0, 0.12);
    --accent-blue: #1971c2;
    --accent-blue-dim: rgba(25, 113, 194, 0.12);

    --shadow-sm: 0 1px 3px rgba(0, 0, 0, 0.08);
    --shadow-md: 0 4px 12px rgba(0, 0, 0, 0.08);
    --shadow-lg: 0 8px 24px rgba(0, 0, 0, 0.12);

    --glow-green: 0 0 12px rgba(0, 204, 106, 0.25);
    --glow-red: 0 0 12px rgba(224, 49, 49, 0.25);
  }

  /* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   TYPOGRAPHY
   ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */

  * {
    box-sizing: border-box;
    margin: 0;
    padding: 0;
  }

  body {
    font-family: 'Space Grotesk', -apple-system, BlinkMacSystemFont, sans-serif;
    font-size: 13px;
    line-height: 1.5;
    background-color: var(--bg-primary);
    color: var(--text-primary);
    margin: 0;
    padding: 0;
    min-height: 100vh;
    display: flex;
    flex-direction: column;
    transition: background-color 0.3s ease, color 0.3s ease;
  }

  .mono {
    font-family: 'Space Mono', 'Consolas', monospace;
    font-weight: 700;
  }

  /* Meta labels */
  .meta-label {
    font-size: 10px;
    text-transform: uppercase;
    letter-spacing: 1.5px;
    color: var(--text-muted);
    font-weight: 600;
  }

  /* Headings */
  h1,
  h2,
  h3,
  h4 {
    font-family: 'Space Grotesk', sans-serif;
    text-transform: uppercase;
    letter-spacing: 1px;
    font-weight: 700;
  }

  h1 {
    font-size: 18px;
  }

  h2 {
    font-size: 15px;
  }

  h3 {
    font-size: 13px;
  }

  /* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   HEADER / NAV BAR
   ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */

  header {
    background: var(--bg-elevated);
    border-bottom: 1px solid var(--border);
    padding: 12px 20px;
    display: flex;
    align-items: center;
    justify-content: space-between;
    position: sticky;
    top: 0;
    z-index: 100;
  }

  header h1 {
    color: var(--text-primary);
    font-size: 16px;
    letter-spacing: 2px;
    display: flex;
    align-items: center;
    gap: 10px;
  }

  header h1::before {
    content: '';
    width: 8px;
    height: 8px;
    background: var(--accent-green);
    border-radius: 50%;
    box-shadow: var(--glow-green);
  }

  .header-controls {
    display: flex;
    align-items: center;
    gap: 16px;
  }

  #status {
    background: var(--bg-card);
    border: 1px solid var(--border);
    border-radius: 4px;
    padding: 6px 14px;
    font-size: 12px;
    color: var(--text-secondary);
    min-width: 200px;
    text-align: center;
    transition: all 0.3s ease;
  }

  #status.success {
    background: var(--accent-green-dim);
    border-color: var(--accent-green);
    color: var(--accent-green);
  }

  #status.error {
    background: var(--accent-red-dim);
    border-color: var(--accent-red);
    color: var(--accent-red);
  }

  #status.loading {
    background: var(--accent-blue-dim);
    border-color: var(--accent-blue);
    color: var(--accent-blue);
  }

  /* Theme Toggle */
  .theme-toggle {
    background: var(--bg-card);
    border: 1px solid var(--border);
    border-radius: 4px;
    padding: 6px 12px;
    cursor: pointer;
    display: flex;
    align-items: center;
    gap: 6px;
    font-size: 12px;
    color: var(--text-secondary);
    transition: all 0.2s ease;
  }

  .theme-toggle:hover {
    border-color: var(--border-hover);
    color: var(--text-primary);
  }

  /* User info */
  .user-info {
    font-size: 11px;
    color: var(--text-muted);
    text-transform: uppercase;
    letter-spacing: 1px;
  }

  /* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   MAIN CONTAINER / LAYOUT
   ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */

  .container {
    display: flex;
    flex: 1;
    background: var(--bg-primary);
    padding: 12px;
    gap: 12px;
    height: calc(100vh - 60px);
    overflow: visible;
  }

  .left-section,
  .right-section {
    flex: 0 0 280px;
    background: var(--bg-secondary);
    border: 1px solid var(--border);
    border-radius: 4px;
    overflow-y: auto;
    max-height: calc(100vh - 84px);
    display: flex;
    flex-direction: column;
  }

  .middle-section {
    flex: 1;
    background: var(--bg-secondary);
    border: 1px solid var(--border);
    border-radius: 4px;
    display: flex;
    flex-direction: column;
    overflow-y: auto;
    min-height: 200px;
    padding: 16px;
    gap: 12px;
  }

  /* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   SECTION HEADERS (COLLAPSIBLE)
   ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */

  .section-header {
    background: var(--bg-elevated);
    border-bottom: 1px solid var(--border);
    padding: 10px 14px;
    font-size: 11px;
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 1.5px;
    color: var(--text-secondary);
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: space-between;
    transition: all 0.2s ease;
    user-select: none;
  }

  .section-header:hover {
    background: var(--bg-card);
    color: var(--text-primary);
  }

  .section-header::after {
    content: '‚ñº';
    font-size: 8px;
    transition: transform 0.2s ease;
  }

  .section-header.collapsed::after {
    transform: rotate(-90deg);
  }

  .section-header.active {
    background: var(--accent-green-dim);
    color: var(--accent-green);
    border-left: 3px solid var(--accent-green);
  }

  .section-content {
    padding: 12px;
    display: block;
    background: var(--bg-secondary);
  }

  .section-content.hidden {
    display: none;
  }

  /* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   TABLES (CASE INFO / TRANSACTION INFO)
   ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */

  table {
    width: 100%;
    border-collapse: collapse;
    font-size: 12px;
  }

  table th {
    background: var(--bg-elevated);
    color: var(--text-secondary);
    font-size: 10px;
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 1px;
    padding: 8px 10px;
    text-align: left;
    border-bottom: 1px solid var(--border);
  }

  table td {
    padding: 8px 10px;
    border-bottom: 1px solid var(--border);
    vertical-align: middle;
  }

  table tr:last-child td {
    border-bottom: none;
  }

  table tr:hover td {
    background: var(--bg-card);
  }

  .label {
    background: var(--bg-elevated);
    color: var(--text-secondary);
    font-weight: 500;
    width: 40%;
    font-size: 11px;
  }

  .data {
    font-family: 'Space Mono', monospace;
    font-weight: 700;
    color: var(--text-primary);
    cursor: pointer;
    transition: color 0.2s ease;
  }

  .data:hover {
    color: var(--accent-green);
  }

  /* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   FORM ELEMENTS
   ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */

  input[type="text"],
  input[type="file"],
  select,
  textarea,
  datalist {
    background: var(--bg-input);
    border: 1px solid var(--border);
    border-radius: 3px;
    padding: 8px 12px;
    font-family: 'Space Grotesk', sans-serif;
    font-size: 13px;
    color: var(--text-primary);
    width: 100%;
    transition: all 0.2s ease;
  }

  input[type="text"]:focus,
  select:focus,
  textarea:focus {
    outline: none;
    border-color: var(--accent-green);
    box-shadow: 0 0 0 2px var(--accent-green-dim);
  }

  input::placeholder,
  textarea::placeholder {
    color: var(--text-muted);
  }

  textarea {
    resize: vertical !important;
    min-height: 40px;
    max-height: none !important;
    flex-shrink: 0 !important;
    font-size: 12px;
    line-height: 1.6;
    overflow: auto !important;
  }

  textarea#rebuttal-response {
    min-height: 250px;
    max-height: none !important;
    resize: vertical !important;
    flex-shrink: 0 !important;
    overflow: auto !important;
  }

  textarea#issuer-notes,
  textarea#internal-notes {
    min-height: 40px;
    max-height: none !important;
    resize: vertical !important;
    flex-shrink: 0 !important;
    overflow: auto !important;
  }

  label {
    display: block;
    font-size: 11px;
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 1px;
    color: var(--text-secondary);
    margin-bottom: 6px;
  }

  /* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   BUTTONS
   ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */

  button {
    font-family: 'Space Grotesk', sans-serif;
    font-size: 12px;
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 1px;
    padding: 8px 16px;
    border-radius: 3px;
    cursor: pointer;
    transition: all 0.2s ease;
    display: inline-flex;
    align-items: center;
    gap: 6px;
  }

  /* Primary Button (Light background) */
  button.primary,
  button#upload,
  button#buttonPDF {
    background: var(--text-primary);
    color: var(--text-inverse);
    border: none;
  }

  button.primary:hover,
  button#upload:hover,
  button#buttonPDF:hover {
    background: var(--accent-green);
    color: var(--bg-primary);
    box-shadow: var(--glow-green);
  }

  /* Secondary Button (Dark, bordered) */
  button {
    background: var(--bg-card);
    color: var(--text-primary);
    border: 1px solid var(--border);
  }

  button:hover {
    border-color: var(--border-hover);
    background: var(--bg-elevated);
  }

  /* Danger Button */
  button.danger {
    background: var(--accent-red-dim);
    border-color: var(--accent-red);
    color: var(--accent-red);
  }

  button.danger:hover {
    background: var(--accent-red);
    color: var(--text-primary);
    box-shadow: var(--glow-red);
  }

  /* Small Button */
  button.small {
    padding: 4px 10px;
    font-size: 10px;
  }

  /* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   RCA SECTION (MIDDLE)
   ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */

  .rca-section {
    display: flex;
    gap: 8px;
    align-items: center;
    margin-bottom: 12px;
  }

  .rca-section input,
  .rca-section select {
    flex: 1;
  }

  #rca {
    font-family: 'Space Grotesk', sans-serif;
    font-size: 13px;
  }

  /* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   UPLOAD BOXES (PASTE AREAS)
   ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */

  .upload-box {
    width: 100%;
    height: 28px;
    border: 1px dashed var(--border);
    border-radius: 4px;
    display: flex;
    justify-content: center;
    align-items: center;
    background: var(--bg-input);
    transition: all 0.3s ease;
    cursor: pointer;
    position: relative;
    overflow: hidden;
    flex-direction: column;
    margin-bottom: 8px;
  }

  .upload-box:hover,
  .upload-box:focus {
    border-color: var(--accent-green);
    background: var(--accent-green-dim);
  }

  .upload-box span {
    font-size: 11px;
    color: var(--text-muted);
    text-transform: uppercase;
    letter-spacing: 1px;
  }

  .upload-box img {
    max-width: 100%;
    max-height: 100%;
    object-fit: contain;
    display: none;
  }

  .upload-box.has-image span {
    display: none;
  }

  .upload-box.has-image img {
    display: block;
  }

  .delete-btn {
    position: absolute;
    top: 4px;
    right: 4px;
    padding: 2px 6px;
    background: var(--accent-red);
    color: var(--text-primary);
    border: none;
    border-radius: 2px;
    cursor: pointer;
    display: none;
    font-size: 10px;
    text-transform: uppercase;
  }

  .upload-box.has-image .delete-btn {
    display: block;
  }

  .output {
    font-size: 11px;
    color: var(--accent-green);
    margin-bottom: 8px;
  }

  .error {
    color: var(--accent-red);
  }

  /* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   QUEUE STATUS DASHBOARD
   ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */

  .queue-status {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: 8px;
    padding: 12px;
  }

  .queue-status>div {
    background: var(--bg-card);
    border: 1px solid var(--border);
    border-radius: 4px;
    padding: 10px;
    text-align: center;
  }

  .queue-status>div:first-child,
  .queue-status>div:nth-child(2) {
    background: var(--accent-green-dim);
    border-color: var(--accent-green);
  }

  .queue-status>div:nth-child(3) {
    grid-column: span 2;
    background: var(--accent-yellow-dim);
    border-color: var(--accent-yellow);
  }

  .queue-status strong {
    display: block;
    font-size: 10px;
    text-transform: uppercase;
    letter-spacing: 1px;
    color: var(--text-secondary);
    margin-bottom: 4px;
  }

  .queue-status span {
    font-family: 'Space Mono', monospace;
    font-size: 18px;
    font-weight: 700;
    color: var(--text-primary);
  }

  /* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   PENDING CASES TABLE
   ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */

  .working-rca {
    background: var(--bg-card);
    border: 1px solid var(--border);
    border-radius: 4px;
    padding: 12px;
    margin-top: 12px;
    max-height: 300px;
    overflow-y: auto;
  }

  #pendingcase {
    width: 100%;
  }

  #pendingcase th,
  #pendingcase td {
    font-size: 11px;
    padding: 6px 8px;
  }

  .caution-icon {
    margin-left: 6px;
    animation: pulse 1s infinite;
  }

  @keyframes pulse {

    0%,
    100% {
      opacity: 1;
    }

    50% {
      opacity: 0.5;
    }
  }

  #pendingmessage {
    color: var(--accent-green);
    font-weight: 600;
    padding: 12px;
  }

  /* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   BUTTONS SECTION
   ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */

  .buttons-section {
    display: flex;
    gap: 10px;
    margin-top: 12px;
    flex-wrap: wrap;
  }

  /* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   CANNED RESPONSE MODAL
   ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */

  #cannedModal {
    position: fixed;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    background: var(--bg-elevated);
    border: 1px solid var(--border);
    border-radius: 6px;
    padding: 20px;
    z-index: 1000;
    width: 600px;
    min-height: 400px;
    max-width: 90vw;
    max-height: 80vh;
    overflow-y: auto;
    resize: both;
    box-shadow: var(--shadow-lg);
  }

  #cannedModal h3 {
    color: var(--text-primary);
    margin-bottom: 16px;
    font-size: 14px;
  }

  .modal-overlay {
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: rgba(0, 0, 0, 0.7);
    z-index: 999;
  }

  /* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   ADMIN PANEL
   ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */

  .admin-panel {
    position: fixed;
    top: 0;
    right: -400px;
    width: 400px;
    height: 100vh;
    background: var(--bg-secondary);
    border-left: 1px solid var(--border);
    z-index: 200;
    transition: right 0.3s ease;
    display: flex;
    flex-direction: column;
  }

  .admin-panel.open {
    right: 0;
  }

  .admin-panel-header {
    background: var(--bg-elevated);
    border-bottom: 1px solid var(--border);
    padding: 16px;
    display: flex;
    align-items: center;
    justify-content: space-between;
  }

  .admin-panel-header h2 {
    color: var(--text-primary);
    font-size: 14px;
  }

  .admin-panel-content {
    flex: 1;
    overflow-y: auto;
    padding: 16px;
  }

  .admin-stat-card {
    background: var(--bg-card);
    border: 1px solid var(--border);
    border-radius: 4px;
    padding: 12px;
    margin-bottom: 12px;
  }

  .admin-stat-card h4 {
    font-size: 10px;
    color: var(--text-muted);
    margin-bottom: 8px;
  }

  .admin-stat-value {
    font-family: 'Space Mono', monospace;
    font-size: 24px;
    font-weight: 700;
    color: var(--accent-green);
  }

  .analyst-list {
    list-style: none;
  }

  .analyst-list li {
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 10px 12px;
    border-bottom: 1px solid var(--border);
  }

  .analyst-list li:hover {
    background: var(--bg-card);
  }

  .analyst-name {
    font-weight: 500;
  }

  .analyst-stats {
    font-size: 11px;
    color: var(--text-muted);
  }

  .analyst-active {
    width: 8px;
    height: 8px;
    border-radius: 50%;
    background: var(--accent-green);
    box-shadow: var(--glow-green);
  }

  .analyst-inactive {
    width: 8px;
    height: 8px;
    border-radius: 50%;
    background: var(--text-muted);
  }

  /* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   KEYBOARD SHORTCUTS HINT
   ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */

  .shortcuts-hint {
    position: fixed;
    bottom: 16px;
    right: 16px;
    background: var(--bg-elevated);
    border: 1px solid var(--border);
    border-radius: 4px;
    padding: 12px 16px;
    font-size: 11px;
    color: var(--text-muted);
    z-index: 50;
    display: none;
    /* Hidden by default - show via ? key */
  }

  .shortcuts-hint kbd {
    background: var(--bg-card);
    border: 1px solid var(--border);
    border-radius: 2px;
    padding: 2px 6px;
    font-family: 'Space Mono', monospace;
    font-size: 10px;
    color: var(--text-secondary);
  }

  /* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   SEARCH HISTORY CHIPS
   ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */

  .search-history {
    display: flex;
    flex-wrap: wrap;
    gap: 6px;
    margin-bottom: 10px;
  }

  .search-chip {
    background: var(--bg-card);
    border: 1px solid var(--border);
    border-radius: 3px;
    padding: 4px 10px;
    font-size: 11px;
    font-family: 'Space Mono', monospace;
    color: var(--text-secondary);
    cursor: pointer;
    transition: all 0.2s ease;
  }

  .search-chip:hover {
    border-color: var(--accent-green);
    color: var(--accent-green);
  }

  /* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   ACTION ICONS
   ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */

  .action-icons {
    font-size: 14px;
    cursor: pointer;
    margin-left: 8px;
    opacity: 0.6;
    transition: opacity 0.2s ease;
  }

  .action-icons:hover {
    opacity: 1;
  }

  /* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   SPINNER / LOADING
   ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */

  .spinner {
    border: 2px solid var(--border);
    border-top: 2px solid var(--accent-green);
    border-radius: 50%;
    width: 16px;
    height: 16px;
    animation: spin 0.8s linear infinite;
    display: inline-block;
    vertical-align: middle;
  }

  @keyframes spin {
    0% {
      transform: rotate(0deg);
    }

    100% {
      transform: rotate(360deg);
    }
  }

  /* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   SUCCESS / ERROR MESSAGES
   ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */

  .success-msg {
    background: var(--accent-green-dim);
    border: 1px solid var(--accent-green);
    border-radius: 4px;
    padding: 8px 12px;
    color: var(--accent-green);
    font-size: 12px;
  }

  .error-msg {
    background: var(--accent-red-dim);
    border: 1px solid var(--accent-red);
    border-radius: 4px;
    padding: 8px 12px;
    color: var(--accent-red);
    font-size: 12px;
  }

  /* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   SCROLLBAR STYLING
   ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */

  ::-webkit-scrollbar {
    width: 8px;
    height: 8px;
  }

  ::-webkit-scrollbar-track {
    background: var(--bg-primary);
  }

  ::-webkit-scrollbar-thumb {
    background: var(--border-hover);
    border-radius: 4px;
  }

  ::-webkit-scrollbar-thumb:hover {
    background: var(--text-muted);
  }

  /* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   TOOLTIPS
   ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */

  [data-tooltip] {
    position: relative;
  }

  [data-tooltip]::after {
    content: attr(data-tooltip);
    position: absolute;
    bottom: 100%;
    left: 50%;
    transform: translateX(-50%);
    background: var(--bg-elevated);
    border: 1px solid var(--border);
    border-radius: 4px;
    padding: 8px 12px;
    font-size: 11px;
    color: var(--text-secondary);
    white-space: nowrap;
    opacity: 0;
    pointer-events: none;
    transition: opacity 0.2s ease;
    z-index: 100;
  }

  [data-tooltip]:hover::after {
    opacity: 1;
  }

  /* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   RESPONSIVE ADJUSTMENTS
   ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */

  @media (max-width: 1200px) {

    .left-section,
    .right-section {
      flex: 0 0 240px;
    }
  }

  @media (max-width: 900px) {
    .container {
      flex-direction: column;
      height: auto;
    }

    .left-section,
    .middle-section,
    .right-section {
      flex: none;
      width: 100%;
    }
  }

  /* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   HIGHLIGHT EFFECTS
   ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */

  .highlight {
    background-color: var(--accent-red-dim);
    animation: highlight-fade 2s ease-out;
  }

  @keyframes highlight-fade {
    0% {
      background-color: var(--accent-red);
    }

    100% {
      background-color: transparent;
    }
  }

  /* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   PDF UPLOADS SECTION
   ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */

  .pdf-uploads label {
    display: block;
    font-size: 11px;
    font-weight: 500;
    color: var(--text-secondary);
    margin-top: 8px;
    margin-bottom: 4px;
  }

  .pdf-uploads input[type="file"] {
    font-size: 11px;
    padding: 6px;
  }

  /* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   TOGGLE SWITCH (Fancy On/Off)
   ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */

  .toggle-switch {
    position: relative;
    display: inline-block;
    width: 44px;
    height: 22px;
    flex-shrink: 0;
  }

  .toggle-switch input {
    opacity: 0;
    width: 0;
    height: 0;
  }

  .toggle-slider {
    position: absolute;
    cursor: pointer;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background-color: var(--bg-input);
    border: 1px solid var(--border);
    border-radius: 22px;
    transition: all 0.3s ease;
  }

  .toggle-slider:before {
    content: "";
    position: absolute;
    height: 16px;
    width: 16px;
    left: 2px;
    bottom: 2px;
    background: var(--text-muted);
    border-radius: 50%;
    transition: all 0.3s ease;
  }

  input:checked+.toggle-slider {
    background-color: var(--accent-green-dim);
    border-color: var(--accent-green);
  }

  input:checked+.toggle-slider:before {
    transform: translateX(22px);
    background: var(--accent-green);
    box-shadow: var(--glow-green);
  }

  input:focus+.toggle-slider {
    box-shadow: 0 0 0 2px var(--accent-green-dim);
  }

  /* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   CONDENSED LAYOUT MODE
   ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê 
   Enable via CONFIG.FEATURES.ENABLE_CONDENSED_LAYOUT = true
   Applies via data-layout="condensed" on html element */

  [data-layout="condensed"] .container {
    height: auto;
    max-height: calc(100vh - 60px);
  }

  [data-layout="condensed"] .left-section,
  [data-layout="condensed"] .right-section {
    max-height: calc(100vh - 84px);
    overflow-y: auto;
  }

  [data-layout="condensed"] .middle-section {
    overflow: visible;
  }

  [data-layout="condensed"] .section-content {
    max-height: 150px;
    overflow-y: auto;
  }

  [data-layout="condensed"] table {
    font-size: 11px;
  }

  [data-layout="condensed"] table td,
  [data-layout="condensed"] table th {
    padding: 4px 8px;
  }

  [data-layout="condensed"] textarea {
    min-height: 100px;
  }

  [data-layout="condensed"] textarea#rebuttal-response {
    min-height: 120px;
  }

  [data-layout="condensed"] .upload-box {
    height: 45px;
  }

  [data-layout="condensed"] .queue-status {
    padding: 8px;
  }

  [data-layout="condensed"] .working-rca {
    max-height: 150px;
  }
</style><!--
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
RCA MANAGER v3 - RCA RESPONSE AUTO-FILL
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
Maps RCA values to pre-defined rebuttal responses.
Triggered when user selects an RCA and has the checkbox enabled.
-->

<script>
  // Bind the change event for the RCA input
  document.addEventListener('DOMContentLoaded', function () {
    const rcaInput = document.getElementById('rca');
    if (rcaInput) {
      rcaInput.addEventListener('change', fetchResponse);
      // Removed 'input' listener - was causing duplicate paste when both events fired
    }
  });

  function fetchResponse() {
    const rca = document.getElementById('rca').value;
    const res = document.getElementById('rebuttal-response');
    const checkbox = document.getElementById('getRes?');

    if (!res || !checkbox?.checked) return;

    const cursorPosition = res.selectionStart;
    const textBeforeCursor = res.value.substring(0, cursorPosition);
    const textAfterCursor = res.value.substring(cursorPosition);

    // RCA to Response mapping
    const RESPONSES = {
      "Customer - Cancel policy dispute/Non Refundable":
        "Customer was made aware of and agreed to the cancellation policy prior to confirming the booking. At the time the booking was made, the reservation was non-refundable. Cardholder's chargeback is an erroneous attempt to circumvent the cancellation policy and breach the contract the customer entered when agreeing to the Terms and Conditions (T&C) before his card was charged. Cardholder owes Priceline Partner Solutions for the reservation. A reversal is due. Please see included documents supporting that cardholder is not due a credit.\n\n",

      "Risk - Fraudulent Transaction":
        "The following transaction is not fraudulent as stated. The attached documents indicate the cardholder participated in the transaction. Also, we are a Card Not Present (CNP) environment. All of our sales purchase are made by the customer either directly through our secure online platform or via our official call center, where all transactions are handled through verified procedures. Customer was made aware of and agreed to the cancellation policy prior to confirming the booking. The attached documents indicate the cardholder participated in the transaction; note the AVS and CVV attached. The payment for this reservation processed in the United States and appeared on statement as 'HTL*_______'. Based on this, we confirm that the transaction was initiated and authorized by the cardholder and request that the chargeback be reversed. Customer was made aware of and agreed to the cancellation policy prior to confirming the booking. The attached documents indicate the cardholder participated in the transaction. The cardholder has made no good faith effort in resolving any issues with this charge with Priceline Partner Solutions prior to filing the dispute.\n\n",

      "Customer - Cancel policy dispute":
        "Cardholder claiming credit is owed on a reservation. Customer tried contacting Priceline Partner Solutions for cancellation when the reservation was inside penalty or canceled the reservation inside of cancellation policy. See attached receipt/confirmation sent to the customer at the time of booking detailing the cancellation policy. Per cancellation policy and Priceline Partner Solutions Terms and Conditions, which the customer agreed to at the time of booking, no refund is due. If you do not cancel before the cancellation policy period applicable to the reservation, the customer will be subject to a charge equal to applicable nightly rates, tax recovery charges, and service fees. There are no refunds for no-shows or early checkouts. The hotel/ supplier has billed Priceline Partner Solutions, and we have paid the hotel/supplier. The customer owes Priceline Partner Solutions for the reservation.\n\n",

      "No Reservation (No Wex)":
        "Reservation was available at the time of check-in. No cancellation was received via the Priceline Partner Solutions customer service phone line or via the Travel Agent site, as required per the cancellation policy of the reservation. All policies agreed to and sent to guests after the completion of booking process. Guest failed to process cancellation based on agreed-upon policy. See attached confirmation of booking. The supplier billed Priceline for the stay, and Priceline billed the guest. Reversal is required.\n\n",

      "Customer - Taxes and Fees":
        "The customer agreed to and confirmed acceptance of the full transaction price before providing their card information to book the room. The customer is disputing the amount of taxes and service fees. Per Terms and Conditions (T&C), the tax recovery charge is a recovery of the estimated taxes that we pay to the hotel for our customers' reservations. We also collect a service fee for facilitating reservations. These facts are listed in the T&C which the customer agreed to before their card was charged. Customer was made aware of and agreed to the cancellation policy prior to confirming the booking. Please see included documents supporting that cardholder is not due a credit.\n\n",

      "Manual Response": "",

      "Customer - Cancel policy dispute (No Contact / Confirmed)":
        "NO cancellation was received via Priceline customer service via any means - call or email, as required per the attached cancellation policy (T&C Sec 36). The reservation is still active on our records. All policies are agreed to and sent to the guest during checkout. Guest failed to process a cancellation based on agreed-upon policy. Customer was made aware of and agreed to the cancellation policy prior to confirming the booking. See attached confirmation of booking supporting that cardholder is not due a credit.\n\n",

      "Chargeback Accepted":
        "Chargeback has been accepted.",

      "No Reservation (with WEX)":
        "Reservation was available at the hotel for check-in. No cancellation was received via the Priceline Partner Solutions customer service phone line or via the Travel Agent site, as required per the cancellation policy of the reservation. There should be no charges from the hotel directly for this reservation. Please see the attached document showing the hotel has billed Priceline Partner Solutions for the reservation, and we have paid the hotel / supplier. The customer agreed to the terms of the booking before their card was charged. Our terms state that Priceline Partner Solutions is not responsible for the services provided at the hotel; we are merely the facilitator of the hotel booking process. The Cardholder owes Priceline Partner Solutions for this reservation. Please see attached receipt/confirmation sent at the time of booking.\n\n",

      "Cancellation/Tax & Recovery (attempt to cancel)":
        "The customer reviewed and accepted both the cancellation policy and the full transaction amount prior to entering their payment information and completing the booking. They are now disputing the charge, claiming the cancellation was due to dissatisfaction with taxes and service fees. However, as clearly outlined in the Terms and Conditions (T&C) accepted at the time of purchase:\n\nTax Recovery Charge: This charge represents the estimated taxes that we collect and remit directly to the hotel or affiliated supplier on the customer's behalf. It ensures compliance with local tax requirements related to the reservation.\n\nService Fee: This is a nonrefundable fee that covers the administrative and operational costs of facilitating the reservation with our affiliate or supplier. It is clearly disclosed during the booking process.\n\nThese charges, along with the cancellation policy, were fully presented and accepted prior to the cardholder's payment authorization. As such, the transaction was processed in accordance with the agreed-upon terms.\n\n",

      "Duplicate bill w/ GAR ARN":
        "Please see the included purchase details showing that the Cardholder purchased the same item through different transactions. Cardholder booked these reservations and agreed to balance, cancellation policy, terms and condition. The Cardholder is provided with the confirmed booking details before completing the purchase. Please see attached receipt/confirmation sent at the time of booking.\n\n",

      "Hotel - Unsatisfactory":
        "The cardholder is claiming to be dissatisfied with the services provided at the hotel. This reservation is non-refundable once services are rendered. The customer agreed to the terms of the booking before their card was charged. Per the additional terms under Travel Agency Agreement, Section 17 states that because of the nature of Travel Agent's Services, we are not in control of the quality of rooms provided by any particular hotel at any time. Travel Agent has no control over, and makes no representations regarding, the quality, safety or legality of the products and services offered, food provided, accommodations provided, and/or the truth or accuracy of the listings or the ability of the vendors to offer services, nor do we make any guarantee that the lodging establishment is not undergoing any renovation. The terms state that Priceline Partner Solutions is not responsible for the services provided at the hotel; Priceline Partner Solutions is merely the facilitator of the hotel booking process. Per terms and conditions as well as the cancellation policy emailed to the customer at the time of booking, the customer is due no refund. The hotel/ supplier has billed Priceline Partner Solutions, and we have paid the hotel/supplier.\n\n",

      "No Reservation (Cancelled)":
        "The reservation was confirmed and scheduled for [check-in date]. The customer voluntarily cancelled the reservation on [cancellation date], prior to the check-in date. As per our stated cancellation policy, [cancellation policy ‚Äî e.g., 'reservations cancelled within X days of check-in are non-refundable']. Since the customer chose to cancel the reservation, the service which was supposed to be available, couldn't/wouldn't be rendered and hence this chargeback is not valid under the reason code \\\"services not rendered\\\". Attached are the reservation confirmation, cancellation request from the customer, and our cancellation policy as presented at the time of booking. We respectfully request that this chargeback be reversed.\\n\\n",

      "Customer - Cancel Penalty Dispute/Early Checkout":
        "Cardholder is disputing unused nights. The cardholder checked out early, but this does not change the terms they agreed to at the time of booking. The reservation was non-refundable, and our policy clearly states that no refunds are given for unused nights. The full charge remains valid because the room was held for the entire duration of the original reservation, making it unavailable to other guests, and the rate was based on the full length of stay selected at the time of booking. Per terms and conditions as well as the cancellation policy emailed to the customer at the time of booking, Cardholder is not due a refund.\n\n",

      "Hotel - Hotel Billed Direct (Wex not charged/Direct Bill)":
        "Per the affidavit, the customer claims to have been direct billed by the hotel in error. Our establishment did not make this charge. This charge should be disputed with the establishment that made them. The customer agreed to the terms of the booking before their card was charged. Our terms state that Priceline Partner Solutions.com is not responsible for the services provided at the hotel. Priceline Partner Solutions.com is only the facilitator of the hotel booking process. The customer owes Priceline Partner Solutions for this reservation. Please see attached receipt/confirmation sent at the time of booking.\n\n",

      "Cancellation/Tax & Recovery (No attempt to cancel)":
        "The customer completed the booking after reviewing and accepting both the cancellation policy and the full transaction amount prior to entering their payment information. They are now disputing the charge, citing dissatisfaction with taxes and service fees, despite having neither canceled the reservation nor contacted us to request a cancellation. There is no record of any cancellation initiated by the customer.\n\nThe charges in question were fully disclosed at the time of booking and accepted under the Terms and Conditions (T&C):\n\nTax Recovery Charge: This charge represents the estimated taxes that we collect and remit directly to the hotel or affiliated supplier on the customer's behalf. It ensures compliance with local tax obligations related to the reservation.\n\nService Fee: This is a non-refundable fee that covers the administrative and operational costs of securing and managing the reservation with our affiliate or supplier. It was clearly itemized during the checkout process.\n\nThese fees, along with the total transaction amount, were acknowledged and approved by the customer prior to confirming the reservation. As there is no record of a cancellation, and the reservation was held as booked, the charge remains valid and consistent with the agreed-upon terms.\n\n",

      "Customer - Charge not recognized":
        "The following transaction is not fraudulent as stated. Customer was made aware of and agreed to the cancellation policy prior to confirming the booking. The attached documents indicate the cardholder participated in the transaction; note the AVS and CVV attached. The payment for this reservation processed in the United States and appeared on statement as 'cci*Hotel Res'.\n\n",

      "Hotel - Hotel revealed rate":
        "The hotel has revealed Priceline Partner Solutions's net rates to the customer in error. The hotel's receipt provided to the customer in error shows wholesale rates between Priceline Partner Solutions and the hotel. The customer agreed to the retail Priceline Partner Solutions rate during the booking process with us and agreed to and confirmed acceptance of the full transaction price including the Tax Recovery Charges & Service Fees before providing their card information to book the room. Per Terms and Conditions (T&C), the tax recovery charge is a recovery of the estimated taxes that we pay to the hotel for our customers' reservations. We also collect a service fee for facilitating reservations. These facts are listed in the T&C which the customer agreed to before their card was charged. Customer was made aware of and agreed to the cancellation policy prior to confirming the booking. Please see included documents supporting that cardholder is not due a credit.\n\n",

      "Hotel - Hotel Billed Direct":
        "Per the affidavit, the customer claims to have been direct billed by the hotel in error. Our establishment did not make this charge. This charge should be disputed with the establishment that made them. The customer agreed to the terms of the booking before their card was charged. Our terms state that Priceline Partner Solutions is not responsible for the services provided at the hotel. Priceline Partner Solutions is only the facilitator of the hotel booking process. Priceline Partner Solutions has paid for the reservation in advance and it was available at the time of check in. The customer owes Priceline Partner Solutions for this reservation. Please see attached receipt/confirmation sent at the time of booking.\n\n",

      "Duplicate bill w/ NON GAR ARN":
        "Please be advised the ARN# listed on the affidavit does not belong to Priceline Partner Solutions. The customer claims to have been direct billed by the hotel in error. Our establishment did not make this charge. These charges should be disputed with the establishment that made them. The customer agreed to Priceline Partner Solutions's terms of the booking before we charged their card. Our terms state that Priceline Partner Solutions is not responsible for the services provided at the hotel. Priceline Partner Solutions is merely the facilitator of the hotel booking process. Please see attached receipt/confirmation sent at the time of booking. There should be no charges from the hotel directly for this reservation as the hotel has billed Priceline Partner Solutions for the reservation, and we have paid the hotel.\n\n",

      "Resolved":
        "Auto-resolved / Reversal Received",

      "Reason code 53 without affidavit":
        "The customer booked the reservation having first agreed to the balance, cancellation policy, and terms and conditions (T&C). Priceline Partner Solutions has no record of Cardholder making a good faith effort to contact us regarding any cancellation, refund, or service issues. There were no affidavits attached to this dispute informing the reason of the dispute, to allow Priceline Partner Solutions adequate information to address the customer's concerns. Based on reason code 53-NOT AS DESCRIBED OR DEFECTIVE, no cancellation was received via the Priceline Partner Solutions customer service phone line or via the Travel Agent site within the cancellation period, as required per the attached cancellation policy and T&C. All policies are agreed to and sent to guests during checkout via email. Any COVID 19 cancellations inside of penalty must be supported with positive test results. The customer agreed to the terms of the booking before their card was charged. However, because of the nature of Travel Agent's Services, we are not in control of the quality of rooms provided by any particular hotel at any time. Travel Agent does not guarantee the accuracy of any information on the Site, nor do we make any guarantee that the lodging establishment is not undergoing any renovation. The terms state that Priceline Partner Solutions is not responsible for the services provided at the hotel; we are merely the facilitator of the hotel booking process. Per terms and conditions and the cancellation policy emailed to the customer at the time of booking, the customer is due no refund.\n\n",

      "Customer - Currency":
        "All payments are currently processed in one of the following currencies: U.S. dollars, Great Britain Pounds, Australian Dollar, Canadian Dollar, Euro and will reflect the exchange rate in effect on the date of the payment. A customer has the option to choose their preferred currency from the above mentioned currencies. If a customer doesn't change/choose the currency type, the US Dollar will automatically be chosen as the default currency under which the transaction would be processed. Currency rates are based on various publicly available sources and should be used as guidelines only. Rates are not verified as accurate, and actual rates may vary. Currency quotes are not updated in real-time. Check the date on the currency converter feature for the day that currency was last updated. Customer was made aware of and agreed to the cancellation policy prior to confirming the booking. Please see included documents supporting that cardholder is not due a credit.\n\n",

      "Customer - Cancel policy dispute/No Show":
        "The reservation is listed as a no-show. Due to this booking being a no-show, no folio is available. No cancellation was received via the Priceline customer service phone line or via the Travel Agent site, as required per the attached cancellation policy Terms and Conditions (T&C) Part IV (C). All policies are agreed to and sent to the guest at the time of booking. Guest failed to process cancellation based on agreed-upon policy. Please see included documents supporting that cardholder is not due a credit.\n\n",

      "Customer - Unable to check in/Customer Issue (Age, CC)":
        "Please be advised that the guest will be required to provide official State or authorized government issued ID upon check-in for any Travel Agent reservation. In addition, guest is required to provide a credit or debit card upon request from the hotel for incidentals, as referenced above. Failure to produce such ID may result in forfeiture of the booking of the Travel Agent Service without any right to refund. As per Part IV [C]. Additional hotel policies are given on the confirmation page of the reservation which is also sent to customer via email.\n\n",

      "Customer - Booking Error":
        "Customer was made aware of and agreed to the cancellation policy prior to confirming the booking. Please see included documents supporting that cardholder is not due a credit.\n\n",

      "Hotel - Room Type Not Available":
        "Customer was made aware of and agreed to the cancellation policy prior to confirming the booking. Please see included documents supporting that cardholder is not due a credit.\n\n",

      "Other - Chip liability shift (fraud)":
        "The following transaction is not fraudulent as stated. The attached documents indicate the cardholder participated in the transaction; note the AVS and CVV attached. Also, we are a Card Not Present (CNP) environment. All of our sales are made either online through websites or with a sales agent over-the-phone. Customer was made aware of and agreed to the cancellation policy prior to confirming the booking. For this reason, any CB claiming that a chip could not be read, is null and void. Please see included purchase details which show the billing data provided at the time of booking links to the cardholder. The cardholder has made no good faith effort in resolving any issues with this charge with Priceline Partner Solutions prior to filing the dispute.\n\n",

      "Service - Cancel Not Performed":
        "Customer was made aware of and agreed to the cancellation policy prior to confirming the booking. Please see included documents supporting that cardholder is not due a credit.\n\n",

      "Risk - Fraudulent Transaction (w/ Contact)":
        "Customer called Priceline Partner Solutions and cancelled this reservation on MM/DD/YYYY due to _________ which was selected by customer himself/herself at the time of booking. As per the cancellation policy this reservation was non-refundable/partially refundable at the time of cancellation and hence it was cancelled with full/partial cancellation charges/penalty. No refund due.\n\nIn direct communication with us, the cardholder acknowledges:\n1. Visiting our website and initiating a booking process.\n2. Seeing the final price before payment and interacting with the payment screen.\n3. Receiving a confirmation email that includes correct booking details and price.\n4. Noting specific dates, amounts, and cancellation policies‚Äîclear evidence of familiarity with the transaction.\nThese admissions directly contradict the basis of a \"card not present\", as they demonstrate that the cardholder was knowingly and actively involved in the transaction.\n\nThe following transaction is not fraudulent as stated. The attached documents indicate the cardholder participated in the transaction. Also, we are a Card Not Present (CNP) environment. All of our sales purchase are made by the customer either directly through our secure online platform or via our official call center, where all transactions are handled through verified procedures. Customer was made aware of and agreed to the cancellation policy prior to confirming the booking. The attached documents indicate the cardholder participated in the transaction; note the AVS and CVV attached. The payment for this reservation processed in the United States and appeared on statement as 'HTL*_______'. Based on this, we confirm that the transaction was initiated and authorized by the cardholder and request that the chargeback be reversed. Customer was made aware of and agreed to the cancellation policy prior to confirming the booking. The attached documents indicate the cardholder participated in the transaction. The cardholder has made no good faith effort in resolving any issues with this charge with Priceline Partner Solutions prior to filing the dispute.\n\n",

      "Sales - Data Entry Issue (Online Reservation Only)":
        "The reservation was made online through our website by the cardholder and all information was entered by the cardholder. The customer booked the reservation having first agreed to the full transaction amount, cancellation policy, and terms and conditions (T&C) and clicked the box agreeing to the terms and conditions at the time of booking before their card was charged and the card holder was sent confirmation mail in regards to the same. No refund is due.\n\n",

      "Pending":
        "Case is pending."
    };

    const response = RESPONSES[rca];
    if (response !== undefined) {
      res.value = textBeforeCursor + response + textAfterCursor;
      res.focus();
    }
  }
</script>
<? } ?>

<? if (page === "report") { ?>
    <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
         RT PARTIALS (inlined from RTPartials.html)
         ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<script>
    /**
     * √òN Master System - Main App JavaScript
     * Core application functionality
     */

    // Global state
    const AppState = {
        reports: [],
        currentReport: null,
        filters: {},
        user: null,
        isAdmin: false
    };

    // =====================================================
    // Initialization
    // =====================================================

    document.addEventListener('DOMContentLoaded', function () {
        initializeApp();
    });

    async function initializeApp() {
        try {
            // Get user info
            const userInfo = await api.getUserInfo();
            AppState.user = userInfo.email;
            AppState.isAdmin = userInfo.isAdmin;

            // Load filter options
            const options = await api.getFilterOptions();
            populateFilters(options);

            // Load reports
            await refreshReports();

            // Setup search debounce
            const searchInput = document.getElementById('search');
            if (searchInput) {
                searchInput.addEventListener('input', debounce(applyFilters, 300));
            }

            // Check for stored theme
            const savedTheme = localStorage.getItem('theme') || 'dark';
            document.documentElement.setAttribute('data-theme', savedTheme);

        } catch (error) {
            console.error('Init error:', error);
            showToast('Failed to initialize: ' + error.message, 'error');
        }
    }

    // =====================================================
    // Theme
    // =====================================================

    function toggleTheme() {
        const current = document.documentElement.getAttribute('data-theme') || 'dark';
        const newTheme = current === 'dark' ? 'light' : 'dark';
        document.documentElement.setAttribute('data-theme', newTheme);
        localStorage.setItem('theme', newTheme);
    }

    // =====================================================
    // Filters
    // =====================================================

    function populateFilters(options) {
        // Teams
        const teamSelect = document.getElementById('filter-team');
        if (teamSelect && options.teams) {
            options.teams.forEach(team => {
                const opt = document.createElement('option');
                opt.value = team;
                opt.textContent = team;
                teamSelect.appendChild(opt);
            });
        }

        // Frequencies
        const freqSelect = document.getElementById('filter-frequency');
        if (freqSelect && options.frequencies) {
            options.frequencies.forEach(freq => {
                const opt = document.createElement('option');
                opt.value = freq;
                opt.textContent = freq;
                freqSelect.appendChild(opt);
            });
        }
    }

    function getFilters() {
        return {
            search: document.getElementById('search')?.value || '',
            state: document.getElementById('filter-state')?.value || '',
            team: document.getElementById('filter-team')?.value || '',
            frequency: document.getElementById('filter-frequency')?.value || '',
            classification: document.getElementById('filter-classification')?.value || ''
        };
    }

    async function applyFilters() {
        const filters = getFilters();
        await loadReports(filters);
    }

    // =====================================================
    // Reports Loading
    // =====================================================

    async function refreshReports() {
        await loadReports(getFilters());
    }

    async function loadReports(filters = {}) {
        const listEl = document.getElementById('reports-list');
        listEl.innerHTML = '<div class="loading"><div class="spinner"></div><span>Loading reports...</span></div>';

        try {
            const reports = await api.getReports(filters);
            AppState.reports = reports;

            renderReports(reports);
            updateStats(reports);

        } catch (error) {
            console.error('Load error:', error);
            listEl.innerHTML = '<div class="empty-state"><div class="empty-state-icon">‚ö†Ô∏è</div><div class="empty-state-title">Failed to load reports</div><div class="empty-state-text">' + error.message + '</div></div>';
        }
    }

    function updateStats(reports) {
        const total = reports.length;
        const pending = reports.filter(r => r.state === 'Pending').length;
        const accepted = reports.filter(r => r.state === 'Accepted').length;
        const rejected = reports.filter(r => r.state === 'Rejected').length;

        document.getElementById('stat-total').textContent = total;
        document.getElementById('stat-pending').textContent = pending;
        document.getElementById('stat-accepted').textContent = accepted;
        document.getElementById('stat-rejected').textContent = rejected;
    }

    // =====================================================
    // Modal
    // =====================================================

    function openModal(reportId) {
        const report = AppState.reports.find(r => r.id === reportId);
        if (!report) return;

        AppState.currentReport = report;

        const modal = document.getElementById('report-modal');
        const title = document.getElementById('modal-title');
        const body = document.getElementById('modal-body');
        const footer = document.getElementById('modal-footer');

        title.textContent = report.name;

        // Build body content
        body.innerHTML = `
        <div class="form-group">
            <label class="form-label">Description</label>
            <p style="color: var(--text-secondary);">${report.description || 'No description'}</p>
        </div>
        
        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: var(--spacing-md);">
            <div class="form-group">
                <label class="form-label">Classification</label>
                <span class="classification-badge ${report.classification?.toLowerCase()}">${report.classification}</span>
            </div>
            <div class="form-group">
                <label class="form-label">Frequency</label>
                <p style="color: var(--text-secondary);">${report.frequency}</p>
            </div>
            <div class="form-group">
                <label class="form-label">Team</label>
                <p style="color: var(--text-secondary);">${report.team}</p>
            </div>
            <div class="form-group">
                <label class="form-label">Owner</label>
                <p style="color: var(--text-secondary);">${report.owner || 'Not assigned'}</p>
            </div>
        </div>
        
        <div class="form-group">
            <label class="form-label">State</label>
            <span class="state-badge ${report.state?.toLowerCase()}">${report.state}</span>
        </div>
        
        <div class="raci-grid">
            <div class="raci-item">
                <div class="raci-role">R - Responsible</div>
                <div class="raci-value">${report.responsible || '-'}</div>
            </div>
            <div class="raci-item">
                <div class="raci-role">A - Accountable</div>
                <div class="raci-value">${report.accountable || '-'}</div>
            </div>
            <div class="raci-item">
                <div class="raci-role">C - Consulted</div>
                <div class="raci-value">${report.consulted || '-'}</div>
            </div>
            <div class="raci-item">
                <div class="raci-role">I - Informed</div>
                <div class="raci-value">${report.informed || '-'}</div>
            </div>
        </div>
        
        ${report.storageLocation ? `
        <div class="form-group" style="margin-top: var(--spacing-lg);">
            <label class="form-label">Storage Location</label>
            <p style="color: var(--text-muted); font-family: var(--font-data); font-size: 12px;">${report.storageLocation}</p>
        </div>
        ` : ''}
        
        ${report.dataSource ? `
        <div class="form-group">
            <label class="form-label">Data Source</label>
            <p style="color: var(--text-muted); font-family: var(--font-data); font-size: 12px;">${report.dataSource}</p>
        </div>
        ` : ''}
    `;

        // Build footer with action buttons
        let footerHtml = '<button class="btn" onclick="closeModal()">Close</button>';

        if (report.state === 'Pending') {
            footerHtml = `
            <button class="btn" onclick="rejectReport('${report.id}')" style="border-color: var(--state-rejected); color: var(--state-rejected);">Reject</button>
            <button class="btn btn-primary" onclick="approveReport('${report.id}')" style="background-color: var(--state-accepted); border-color: var(--state-accepted);">Approve</button>
        ` + footerHtml;
        } else if (report.state === 'Rejected') {
            footerHtml = `<button class="btn" onclick="resubmitReport('${report.id}')">Resubmit for Review</button>` + footerHtml;
        }

        footer.innerHTML = footerHtml;

        modal.classList.remove('hidden');
    }

    function closeModal() {
        document.getElementById('report-modal').classList.add('hidden');
        AppState.currentReport = null;
    }

    // =====================================================
    // Actions
    // =====================================================

    async function approveReport(reportId) {
        try {
            showToast('Processing approval...', 'info');
            await api.changeReportState(reportId, 'Accepted', '');
            showToast('Report approved!', 'success');
            closeModal();
            await refreshReports();
        } catch (error) {
            showToast('Approval failed: ' + error.message, 'error');
        }
    }

    async function rejectReport(reportId) {
        const reason = prompt('Please provide a rejection reason:');
        if (reason === null) return;

        try {
            showToast('Processing rejection...', 'info');
            await api.changeReportState(reportId, 'Rejected', reason);
            showToast('Report rejected', 'success');
            closeModal();
            await refreshReports();
        } catch (error) {
            showToast('Rejection failed: ' + error.message, 'error');
        }
    }

    async function resubmitReport(reportId) {
        try {
            showToast('Resubmitting...', 'info');
            await api.resubmitReport(reportId);
            showToast('Report resubmitted for review', 'success');
            closeModal();
            await refreshReports();
        } catch (error) {
            showToast('Resubmit failed: ' + error.message, 'error');
        }
    }

    // =====================================================
    // Toast
    // =====================================================

    function showToast(message, type = 'info') {
        const toast = document.getElementById('toast');
        toast.textContent = message;
        toast.className = 'toast ' + type;
        toast.classList.remove('hidden');

        setTimeout(() => {
            toast.classList.add('hidden');
        }, 3000);
    }

    // =====================================================
    // Utilities
    // =====================================================

    function debounce(func, wait) {
        let timeout;
        return function executedFunction(...args) {
            const later = () => {
                clearTimeout(timeout);
                func(...args);
            };
            clearTimeout(timeout);
            timeout = setTimeout(later, wait);
        };
    }

    function escapeHtml(text) {
        if (!text) return '';
        const div = document.createElement('div');
        div.textContent = text;
        return div.innerHTML;
    }
</script>
<script>
    /**
     * √òN Master System - API JavaScript
     * Promise wrappers for google.script.run
     */

    const api = {
        /**
         * Wrap google.script.run in a promise
         * @param {string} functionName - Server function name
         * @param {...*} args - Arguments to pass
         * @returns {Promise} Promise resolving with result
         */
        call(functionName, ...args) {
            return new Promise((resolve, reject) => {
                google.script.run
                    .withSuccessHandler(resolve)
                    .withFailureHandler(reject)
                [functionName](...args);
            });
        },

        /**
         * Get current user info
         * @returns {Promise<Object>} User info
         */
        getUserInfo() {
            return this.call('getUserInfo');
        },

        /**
         * Get filter options
         * @returns {Promise<Object>} Filter options
         */
        getFilterOptions() {
            return this.call('getFilterOptions');
        },

        /**
         * Get reports with filters
         * @param {Object} filters - Filter criteria
         * @returns {Promise<Array>} Reports
         */
        getReports(filters) {
            return this.call('getReports', filters);
        },

        /**
         * Get a single report
         * @param {string} reportId - Report ID
         * @returns {Promise<Object>} Report
         */
        getReportById(reportId) {
            return this.call('getReportById', reportId);
        },

        /**
         * Update a report
         * @param {string} reportId - Report ID
         * @param {Object} data - Updated data
         * @returns {Promise<Object>} Updated report
         */
        updateReport(reportId, data) {
            return this.call('updateReport', reportId, data);
        },

        /**
         * Change report state
         * @param {string} reportId - Report ID
         * @param {string} newState - New state
         * @param {string} comment - Optional comment
         * @returns {Promise<Object>} Updated report
         */
        changeReportState(reportId, newState, comment) {
            return this.call('changeReportState', reportId, newState, comment);
        },

        /**
         * Resubmit a rejected report
         * @param {string} reportId - Report ID
         * @returns {Promise<Object>} Updated report
         */
        resubmitReport(reportId) {
            return this.call('resubmitReport', reportId);
        },

        /**
         * Get audit log
         * @param {Object} filters - Filter criteria
         * @returns {Promise<Array>} Audit entries
         */
        getAuditLog(filters) {
            return this.call('getAuditLog', filters);
        }
    };

    // Add resubmit function to Code.gs (server-side)
    // This wraps the workflow resubmit
</script>
<script>
    /**
     * √òN Master System - Queue JavaScript
     * Reports queue rendering and interaction
     */

    // =====================================================
    // Render Reports List
    // =====================================================

    function renderReports(reports) {
        const listEl = document.getElementById('reports-list');

        if (!reports || reports.length === 0) {
            listEl.innerHTML = `
            <div class="empty-state">
                <div class="empty-state-icon">üìã</div>
                <div class="empty-state-title">No reports found</div>
                <div class="empty-state-text">Try adjusting your filters or import reports from the menu.</div>
            </div>
        `;
            return;
        }

        listEl.innerHTML = reports.map((report, index) => `
        <div class="report-row" onclick="openModal('${report.id}')" style="animation-delay: ${index * 0.03}s">
            <div>
                <div class="report-name">${escapeHtml(report.name)}</div>
                <span class="classification-badge ${report.classification?.toLowerCase() || ''}">${report.classification || 'Unknown'}</span>
            </div>
            <div class="report-team">${escapeHtml(report.team) || '-'}</div>
            <div class="report-frequency">${escapeHtml(report.frequency) || '-'}</div>
            <div class="report-owner">${escapeHtml(report.owner) || '-'}</div>
            <div>
                <span class="state-badge ${report.state?.toLowerCase() || 'pending'}">${report.state || 'Pending'}</span>
            </div>
            <div>
                <button class="btn btn-sm" onclick="event.stopPropagation(); openModal('${report.id}')">View</button>
            </div>
        </div>
    `).join('');
    }

    // =====================================================
    // Queue Filters
    // =====================================================

    function showMyReports() {
        document.getElementById('filter-state').value = '';
        document.getElementById('search').value = AppState.user?.split('@')[0] || '';
        applyFilters();
    }

    function showPendingReview() {
        document.getElementById('filter-state').value = 'Pending';
        applyFilters();
    }

    function clearFilters() {
        document.getElementById('search').value = '';
        document.getElementById('filter-state').value = '';
        document.getElementById('filter-team').value = '';
        document.getElementById('filter-frequency').value = '';
        document.getElementById('filter-classification').value = '';
        applyFilters();
    }
</script>
<style>
    /* =====================================================
   √òN Design System - Ported from ON Module
   Monochrome Theme for GAS HTML Service
   ===================================================== */

    :root,
    :root[data-theme="dark"] {
        /* Backgrounds - Gradations of black */
        --bg-primary: #000000;
        --bg-secondary: #080808;
        --bg-elevated: #0f0f0f;
        --bg-card: #141414;

        /* Borders */
        --border: #1a1a1a;
        --border-hover: #262626;

        /* Text - Gradations of gray/white */
        --text-primary: #f5f5f5;
        --text-secondary: #808080;
        --text-muted: #4d4d4d;

        /* Accent - Off-white (minimal usage only) */
        --accent-primary: #e6e6e6;
        --accent-glow: rgba(230, 230, 230, 0.15);

        /* State Colors */
        --state-pending: #f59e0b;
        --state-accepted: #22c55e;
        --state-rejected: #ef4444;

        /* Typography */
        --font-ui: 'Space Grotesk', -apple-system, BlinkMacSystemFont, sans-serif;
        --font-data: 'Space Mono', 'SF Mono', Consolas, monospace;

        /* Spacing */
        --spacing-xs: 4px;
        --spacing-sm: 8px;
        --spacing-md: 16px;
        --spacing-lg: 24px;
        --spacing-xl: 32px;

        /* Layout */
        --sidebar-width: 260px;
        --header-height: 56px;

        /* Transitions */
        --transition-fast: 150ms cubic-bezier(0.4, 0, 0.2, 1);
        --transition-normal: 300ms cubic-bezier(0.4, 0, 0.2, 1);
        --transition-slow: 500ms cubic-bezier(0.4, 0, 0.2, 1);
    }

    /* Light Theme */
    :root[data-theme="light"] {
        --bg-primary: #e8e6e1;
        --bg-secondary: #dddad4;
        --bg-elevated: #f0eeea;
        --bg-card: #f0eeea;

        --border: #c8c4be;
        --border-hover: #b0aca6;

        --text-primary: #1a1a1a;
        --text-secondary: #4a4a4a;
        --text-muted: #7a7a7a;

        --accent-primary: #2a2a2a;
        --accent-glow: rgba(42, 42, 42, 0.08);
    }

    /* Reset */
    *,
    *::before,
    *::after {
        box-sizing: border-box;
        margin: 0;
        padding: 0;
    }

    /* Hide scrollbars */
    * {
        scrollbar-width: none;
        -ms-overflow-style: none;
    }

    *::-webkit-scrollbar {
        display: none;
    }

    html,
    body {
        height: 100%;
        overflow: hidden;
    }

    body {
        font-family: var(--font-ui);
        font-size: 14px;
        color: var(--text-primary);
        background-color: var(--bg-primary);
        background-image: radial-gradient(circle, var(--border) 1px, transparent 1px);
        background-size: 24px 24px;
        line-height: 1.5;
        -webkit-font-smoothing: antialiased;
    }

    .hidden {
        display: none !important;
    }

    /* =====================================================
   Animations
   ===================================================== */

    @keyframes fadeIn {
        from {
            opacity: 0;
        }

        to {
            opacity: 1;
        }
    }

    @keyframes slideUp {
        from {
            opacity: 0;
            transform: translateY(20px);
        }

        to {
            opacity: 1;
            transform: translateY(0);
        }
    }

    @keyframes slideIn {
        from {
            opacity: 0;
            transform: translateX(-20px);
        }

        to {
            opacity: 1;
            transform: translateX(0);
        }
    }

    @keyframes pulse {

        0%,
        100% {
            opacity: 1;
        }

        50% {
            opacity: 0.7;
        }
    }

    @keyframes shimmer {
        0% {
            background-position: -200% 0;
        }

        100% {
            background-position: 200% 0;
        }
    }

    /* =====================================================
   Layout
   ===================================================== */

    .app-container {
        display: flex;
        height: 100vh;
        width: 100vw;
    }

    /* Sidebar */
    .sidebar {
        width: var(--sidebar-width);
        height: 100vh;
        display: flex;
        flex-direction: column;
        background-color: var(--bg-secondary);
        border-right: 1px solid var(--border);
        flex-shrink: 0;
    }

    .sidebar-header {
        display: flex;
        align-items: center;
        gap: var(--spacing-md);
        padding: var(--spacing-lg);
        border-bottom: 1px solid var(--border);
    }

    .logo {
        font-size: 32px;
        font-weight: 300;
        color: var(--accent-primary);
        letter-spacing: -2px;
    }

    .module-name {
        font-size: 12px;
        font-weight: 500;
        color: var(--text-secondary);
        letter-spacing: 1px;
        text-transform: uppercase;
    }

    .sidebar-nav {
        flex: 1;
        padding: var(--spacing-md);
        display: flex;
        flex-direction: column;
        gap: var(--spacing-xs);
    }

    .nav-item {
        display: flex;
        align-items: center;
        gap: var(--spacing-sm);
        padding: var(--spacing-sm) var(--spacing-md);
        font-size: 13px;
        color: var(--text-secondary);
        text-decoration: none;
        border-radius: 6px;
        cursor: pointer;
        transition: all var(--transition-fast);
    }

    .nav-item:hover {
        color: var(--text-primary);
        background-color: var(--bg-elevated);
    }

    .nav-item.active {
        color: var(--text-primary);
        background-color: var(--bg-card);
        border: 1px solid var(--border);
    }

    .nav-icon {
        font-size: 16px;
    }

    .sidebar-footer {
        padding: var(--spacing-md);
        border-top: 1px solid var(--border);
    }

    .user-info {
        display: flex;
        align-items: center;
        justify-content: space-between;
        gap: var(--spacing-sm);
    }

    .user-email {
        font-size: 11px;
        color: var(--text-muted);
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
        max-width: 140px;
    }

    .user-actions {
        display: flex;
        gap: var(--spacing-xs);
    }

    /* Main Content */
    .main-content {
        flex: 1;
        display: flex;
        flex-direction: column;
        overflow: hidden;
    }

    /* Header */
    .header {
        height: var(--header-height);
        display: flex;
        align-items: center;
        justify-content: space-between;
        padding: 0 var(--spacing-lg);
        background-color: var(--bg-secondary);
        border-bottom: 1px solid var(--border);
        flex-shrink: 0;
    }

    .page-title {
        font-size: 18px;
        font-weight: 500;
        color: var(--text-primary);
    }

    .header-actions {
        display: flex;
        align-items: center;
        gap: var(--spacing-md);
    }

    /* Content Area */
    .content {
        flex: 1;
        padding: var(--spacing-lg);
        overflow-y: auto;
        animation: fadeIn 0.3s ease;
    }

    /* =====================================================
   Components - Buttons
   ===================================================== */

    .btn {
        display: inline-flex;
        align-items: center;
        justify-content: center;
        gap: var(--spacing-xs);
        padding: 8px 16px;
        font-family: var(--font-ui);
        font-size: 13px;
        font-weight: 500;
        border-radius: 6px;
        border: 1px solid var(--border);
        cursor: pointer;
        transition: all var(--transition-fast);
        background: transparent;
        color: var(--text-primary);
    }

    .btn:hover {
        border-color: var(--border-hover);
        background-color: var(--bg-elevated);
    }

    .btn-primary {
        background-color: var(--accent-primary);
        color: var(--bg-primary);
        border-color: var(--accent-primary);
    }

    .btn-primary:hover {
        opacity: 0.9;
    }

    .btn-sm {
        padding: 4px 10px;
        font-size: 12px;
    }

    .btn-icon {
        width: 32px;
        height: 32px;
        padding: 0;
    }

    /* =====================================================
   Components - Cards
   ===================================================== */

    .card {
        background-color: var(--bg-card);
        border: 1px solid var(--border);
        border-radius: 8px;
        padding: var(--spacing-md);
        transition: all var(--transition-fast);
    }

    .card:hover {
        border-color: var(--border-hover);
    }

    .card-header {
        display: flex;
        align-items: center;
        justify-content: space-between;
        margin-bottom: var(--spacing-md);
    }

    .card-title {
        font-size: 14px;
        font-weight: 500;
        color: var(--text-primary);
    }

    /* =====================================================
   Components - Stats
   ===================================================== */

    .stats-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: var(--spacing-md);
        margin-bottom: var(--spacing-lg);
    }

    .stat-card {
        display: flex;
        flex-direction: column;
        gap: var(--spacing-xs);
        padding: var(--spacing-lg);
        background-color: var(--bg-card);
        border: 1px solid var(--border);
        border-radius: 8px;
        animation: slideUp 0.4s ease both;
    }

    .stat-card:nth-child(2) {
        animation-delay: 0.1s;
    }

    .stat-card:nth-child(3) {
        animation-delay: 0.2s;
    }

    .stat-card:nth-child(4) {
        animation-delay: 0.3s;
    }

    .stat-label {
        font-size: 12px;
        color: var(--text-muted);
        text-transform: uppercase;
        letter-spacing: 0.5px;
    }

    .stat-value {
        font-size: 32px;
        font-weight: 600;
        font-family: var(--font-data);
        color: var(--text-primary);
    }

    .stat-value.pending {
        color: var(--state-pending);
    }

    .stat-value.accepted {
        color: var(--state-accepted);
    }

    .stat-value.rejected {
        color: var(--state-rejected);
    }

    /* =====================================================
   Components - Filters
   ===================================================== */

    .filter-bar {
        display: flex;
        align-items: center;
        gap: var(--spacing-md);
        padding: var(--spacing-md);
        background-color: var(--bg-card);
        border: 1px solid var(--border);
        border-radius: 8px;
        margin-bottom: var(--spacing-lg);
        flex-wrap: wrap;
    }

    .filter-group {
        display: flex;
        align-items: center;
        gap: var(--spacing-xs);
    }

    .filter-label {
        font-size: 11px;
        color: var(--text-muted);
        text-transform: uppercase;
        letter-spacing: 0.5px;
    }

    .filter-select,
    .filter-input {
        padding: 6px 12px;
        font-family: var(--font-ui);
        font-size: 13px;
        color: var(--text-primary);
        background-color: var(--bg-elevated);
        border: 1px solid var(--border);
        border-radius: 4px;
        min-width: 120px;
    }

    .filter-select:focus,
    .filter-input:focus {
        outline: none;
        border-color: var(--accent-primary);
    }

    .search-input {
        flex: 1;
        min-width: 200px;
        padding: 8px 12px;
        font-family: var(--font-ui);
        font-size: 13px;
        color: var(--text-primary);
        background-color: var(--bg-elevated);
        border: 1px solid var(--border);
        border-radius: 6px;
    }

    .search-input::placeholder {
        color: var(--text-muted);
    }

    /* =====================================================
   Components - Table / Reports List
   ===================================================== */

    .reports-list {
        display: flex;
        flex-direction: column;
        gap: var(--spacing-sm);
    }

    .report-row {
        display: grid;
        grid-template-columns: 1fr 120px 100px 120px 100px auto;
        align-items: center;
        gap: var(--spacing-md);
        padding: var(--spacing-md);
        background-color: var(--bg-card);
        border: 1px solid var(--border);
        border-radius: 6px;
        cursor: pointer;
        transition: all var(--transition-fast);
        animation: slideIn 0.3s ease both;
    }

    .report-row:hover {
        border-color: var(--border-hover);
        transform: translateX(4px);
    }

    .report-name {
        font-weight: 500;
        color: var(--text-primary);
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
    }

    .report-team {
        font-size: 12px;
        color: var(--text-secondary);
    }

    .report-frequency {
        font-size: 12px;
        color: var(--text-muted);
        font-family: var(--font-data);
    }

    .report-owner {
        font-size: 12px;
        color: var(--text-secondary);
    }

    /* State Badges */
    .state-badge {
        display: inline-flex;
        align-items: center;
        padding: 4px 10px;
        font-size: 11px;
        font-weight: 500;
        text-transform: uppercase;
        letter-spacing: 0.5px;
        border-radius: 4px;
    }

    .state-badge.pending {
        background-color: rgba(245, 158, 11, 0.15);
        color: var(--state-pending);
    }

    .state-badge.accepted {
        background-color: rgba(34, 197, 94, 0.15);
        color: var(--state-accepted);
    }

    .state-badge.rejected {
        background-color: rgba(239, 68, 68, 0.15);
        color: var(--state-rejected);
    }

    /* Classification Badge */
    .classification-badge {
        display: inline-flex;
        align-items: center;
        padding: 2px 8px;
        font-size: 10px;
        font-weight: 600;
        text-transform: uppercase;
        letter-spacing: 0.5px;
        border-radius: 3px;
        background-color: var(--bg-elevated);
        color: var(--text-muted);
        border: 1px solid var(--border);
    }

    .classification-badge.master {
        color: var(--accent-primary);
        border-color: var(--accent-primary);
    }

    /* =====================================================
   Components - RACI Display
   ===================================================== */

    .raci-grid {
        display: grid;
        grid-template-columns: repeat(4, 1fr);
        gap: var(--spacing-md);
        margin-top: var(--spacing-lg);
    }

    .raci-item {
        padding: var(--spacing-md);
        background-color: var(--bg-elevated);
        border: 1px solid var(--border);
        border-radius: 6px;
    }

    .raci-role {
        font-size: 11px;
        color: var(--text-muted);
        text-transform: uppercase;
        letter-spacing: 0.5px;
        margin-bottom: var(--spacing-xs);
    }

    .raci-value {
        font-size: 13px;
        font-weight: 500;
        color: var(--text-primary);
    }

    /* =====================================================
   Components - Form
   ===================================================== */

    .form-group {
        margin-bottom: var(--spacing-md);
    }

    .form-label {
        display: block;
        font-size: 12px;
        font-weight: 500;
        color: var(--text-secondary);
        margin-bottom: var(--spacing-xs);
    }

    .form-input,
    .form-select,
    .form-textarea {
        width: 100%;
        padding: 10px 12px;
        font-family: var(--font-ui);
        font-size: 14px;
        color: var(--text-primary);
        background-color: var(--bg-elevated);
        border: 1px solid var(--border);
        border-radius: 6px;
        transition: all var(--transition-fast);
    }

    .form-input:focus,
    .form-select:focus,
    .form-textarea:focus {
        outline: none;
        border-color: var(--accent-primary);
    }

    .form-textarea {
        min-height: 100px;
        resize: vertical;
    }

    /* =====================================================
   Components - Modal
   ===================================================== */

    .modal-overlay {
        position: fixed;
        inset: 0;
        background-color: rgba(0, 0, 0, 0.7);
        display: flex;
        align-items: center;
        justify-content: center;
        z-index: 1000;
        animation: fadeIn 0.2s ease;
    }

    .modal {
        width: 90%;
        max-width: 600px;
        max-height: 80vh;
        background-color: var(--bg-card);
        border: 1px solid var(--border);
        border-radius: 12px;
        overflow: hidden;
        animation: slideUp 0.3s ease;
    }

    .modal-header {
        display: flex;
        align-items: center;
        justify-content: space-between;
        padding: var(--spacing-md) var(--spacing-lg);
        border-bottom: 1px solid var(--border);
    }

    .modal-title {
        font-size: 16px;
        font-weight: 500;
        color: var(--text-primary);
    }

    .modal-close {
        width: 32px;
        height: 32px;
        display: flex;
        align-items: center;
        justify-content: center;
        background: transparent;
        border: none;
        color: var(--text-muted);
        cursor: pointer;
        border-radius: 4px;
        font-size: 20px;
    }

    .modal-close:hover {
        color: var(--text-primary);
        background-color: var(--bg-elevated);
    }

    .modal-body {
        padding: var(--spacing-lg);
        overflow-y: auto;
        max-height: 60vh;
    }

    .modal-footer {
        display: flex;
        justify-content: flex-end;
        gap: var(--spacing-sm);
        padding: var(--spacing-md) var(--spacing-lg);
        border-top: 1px solid var(--border);
    }

    /* =====================================================
   Components - Toast / Notifications
   ===================================================== */

    .toast {
        position: fixed;
        bottom: var(--spacing-lg);
        right: var(--spacing-lg);
        padding: var(--spacing-md) var(--spacing-lg);
        background-color: var(--bg-card);
        border: 1px solid var(--border);
        border-radius: 8px;
        color: var(--text-primary);
        font-size: 13px;
        z-index: 2000;
        animation: slideUp 0.3s ease;
    }

    .toast.success {
        border-color: var(--state-accepted);
    }

    .toast.error {
        border-color: var(--state-rejected);
    }

    /* =====================================================
   Components - Loading
   ===================================================== */

    .loading {
        display: flex;
        align-items: center;
        justify-content: center;
        gap: var(--spacing-sm);
        padding: var(--spacing-xl);
        color: var(--text-muted);
    }

    .spinner {
        width: 20px;
        height: 20px;
        border: 2px solid var(--border);
        border-top-color: var(--accent-primary);
        border-radius: 50%;
        animation: spin 0.8s linear infinite;
    }

    @keyframes spin {
        to {
            transform: rotate(360deg);
        }
    }

    /* =====================================================
   Components - Empty State
   ===================================================== */

    .empty-state {
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        padding: var(--spacing-xl) * 2;
        color: var(--text-muted);
        text-align: center;
    }

    .empty-state-icon {
        font-size: 48px;
        margin-bottom: var(--spacing-md);
        opacity: 0.5;
    }

    .empty-state-title {
        font-size: 16px;
        font-weight: 500;
        color: var(--text-secondary);
        margin-bottom: var(--spacing-xs);
    }

    .empty-state-text {
        font-size: 13px;
        color: var(--text-muted);
    }

    /* =====================================================
   Audit Log Table
   ===================================================== */

    .audit-table {
        width: 100%;
        border-collapse: collapse;
        font-size: 12px;
    }

    .audit-table th,
    .audit-table td {
        padding: var(--spacing-sm) var(--spacing-md);
        text-align: left;
        border-bottom: 1px solid var(--border);
    }

    .audit-table th {
        font-weight: 500;
        color: var(--text-muted);
        text-transform: uppercase;
        letter-spacing: 0.5px;
        font-size: 11px;
        background-color: var(--bg-secondary);
    }

    .audit-table td {
        color: var(--text-primary);
        font-family: var(--font-data);
    }

    .audit-table tr:hover td {
        background-color: var(--bg-elevated);
    }

    /* =====================================================
   Responsive
   ===================================================== */

    @media (max-width: 768px) {
        .sidebar {
            display: none;
        }

        .report-row {
            grid-template-columns: 1fr 100px;
        }

        .report-row>*:nth-child(n+3) {
            display: none;
        }
    }
</style>
<!DOCTYPE html>
<html>

<head>
    <base target="_top">
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>√òN - Admin Panel</title>
    <link
        href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@300;400;500;600&family=Space+Mono:wght@400;700&display=swap"
        rel="stylesheet">
    <style>
        :root {
            --bg-primary: #000000;
            --bg-secondary: #080808;
            --bg-elevated: #0f0f0f;
            --bg-card: #141414;
            --border: #1a1a1a;
            --border-hover: #333333;
            --text-primary: #f5f5f5;
            --text-secondary: #808080;
            --text-muted: #4d4d4d;
            --accent-primary: #e6e6e6;
            --state-pending: #f59e0b;
            --state-accepted: #22c55e;
            --state-rejected: #ef4444;
            --font-ui: 'Space Grotesk', -apple-system, BlinkMacSystemFont, sans-serif;
            --font-data: 'Space Mono', 'SF Mono', Consolas, monospace;
        }

        [data-theme="light"] {
            --bg-primary: #ffffff;
            --bg-secondary: #f8f8f8;
            --bg-elevated: #f0f0f0;
            --bg-card: #ffffff;
            --border: #e0e0e0;
            --border-hover: #c0c0c0;
            --text-primary: #1a1a1a;
            --text-secondary: #666666;
            --text-muted: #999999;
            --accent-primary: #1a1a1a;
        }

        *,
        *::before,
        *::after {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        html,
        body {
            height: 100%;
            overflow: hidden;
        }

        body {
            font-family: var(--font-ui);
            font-size: 14px;
            color: var(--text-primary);
            background-color: var(--bg-primary);
            background-image: radial-gradient(circle, var(--border) 1px, transparent 1px);
            background-size: 24px 24px;
        }

        .hidden {
            display: none !important;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
            }

            to {
                opacity: 1;
            }
        }

        @keyframes slideUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes spin {
            to {
                transform: rotate(360deg);
            }
        }

        .app {
            display: flex;
            flex-direction: column;
            height: 100vh;
        }

        .header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 12px 24px;
            background: var(--bg-secondary);
            border-bottom: 1px solid var(--border);
        }

        .header-left {
            display: flex;
            align-items: center;
            gap: 24px;
        }

        .logo {
            font-size: 24px;
            font-weight: 300;
            color: var(--accent-primary);
            letter-spacing: -2px;
            text-decoration: none;
        }

        .nav {
            display: flex;
            gap: 8px;
        }

        .nav-link {
            padding: 8px 16px;
            font-size: 13px;
            color: var(--text-secondary);
            text-decoration: none;
            border-radius: 6px;
            transition: all 150ms;
        }

        .nav-link:hover {
            color: var(--text-primary);
            background: var(--bg-elevated);
        }

        .nav-link.active {
            color: var(--text-primary);
            background: var(--bg-card);
            border: 1px solid var(--border);
        }

        .header-right {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .user-badge {
            font-size: 11px;
            color: var(--text-muted);
        }

        .admin-badge {
            font-size: 9px;
            padding: 2px 6px;
            background: var(--state-accepted);
            color: #000;
            border-radius: 3px;
            font-weight: 600;
        }

        .icon-btn {
            width: 32px;
            height: 32px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--text-secondary);
            border-radius: 6px;
            cursor: pointer;
            transition: all 150ms;
            background: transparent;
            border: none;
            font-size: 16px;
        }

        .icon-btn:hover {
            background: var(--bg-elevated);
            color: var(--text-primary);
        }

        .main {
            flex: 1;
            padding: 24px;
            overflow-y: auto;
            animation: fadeIn 0.3s ease;
        }

        .section {
            margin-bottom: 32px;
        }

        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 16px;
        }

        .section-title {
            font-size: 14px;
            font-weight: 500;
            color: var(--text-secondary);
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .actions-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            gap: 12px;
        }

        .action-card {
            padding: 16px;
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 8px;
            cursor: pointer;
            transition: all 150ms;
        }

        .action-card:hover {
            border-color: var(--border-hover);
            transform: translateY(-2px);
        }

        .action-card h3 {
            font-size: 13px;
            font-weight: 500;
            margin-bottom: 4px;
        }

        .action-card p {
            font-size: 11px;
            color: var(--text-muted);
        }

        .card {
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 8px;
            padding: 20px;
        }

        .card-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 16px;
        }

        .card-title {
            font-size: 14px;
            font-weight: 500;
        }

        .add-user-btn {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            padding: 8px 14px;
            font-size: 12px;
            font-weight: 500;
            color: var(--text-primary);
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 6px;
            cursor: pointer;
            transition: all 150ms;
        }

        .add-user-btn:hover {
            border-color: var(--border-hover);
            background: var(--bg-elevated);
        }

        .add-user-form {
            display: none;
            padding: 16px;
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 8px;
            margin-bottom: 16px;
        }

        .add-user-form.show {
            display: block;
        }

        .form-row {
            display: flex;
            gap: 12px;
            align-items: end;
            flex-wrap: wrap;
        }

        .form-group {
            display: flex;
            flex-direction: column;
            gap: 4px;
            flex: 1;
            min-width: 150px;
        }

        .form-label {
            font-size: 10px;
            color: var(--text-muted);
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .form-input {
            padding: 10px 12px;
            font-family: var(--font-ui);
            font-size: 14px;
            color: var(--text-primary);
            background: var(--bg-elevated);
            border: 1px solid var(--border);
            border-radius: 6px;
        }

        .form-input:focus {
            outline: none;
            border-color: var(--accent-primary);
        }

        .btn {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            padding: 10px 18px;
            font-family: var(--font-ui);
            font-size: 13px;
            font-weight: 500;
            border-radius: 6px;
            border: 1px solid var(--border);
            cursor: pointer;
            background: transparent;
            color: var(--text-primary);
            transition: all 150ms;
        }

        .btn:hover {
            border-color: var(--border-hover);
            background: var(--bg-elevated);
        }

        .btn-primary {
            background: var(--accent-primary);
            color: var(--bg-primary);
            border-color: var(--accent-primary);
        }

        .btn-danger {
            border-color: var(--state-rejected);
            color: var(--state-rejected);
        }

        .btn-sm {
            padding: 6px 12px;
            font-size: 12px;
        }

        .users-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 16px;
        }

        .users-table th,
        .users-table td {
            padding: 10px 12px;
            text-align: left;
            border-bottom: 1px solid var(--border);
        }

        .users-table th {
            font-size: 10px;
            font-weight: 500;
            color: var(--text-muted);
            text-transform: uppercase;
            letter-spacing: 0.5px;
            background: var(--bg-secondary);
        }

        .users-table td {
            font-size: 13px;
            color: var(--text-secondary);
        }

        .users-table tr:hover td {
            background: var(--bg-elevated);
        }

        .users-table .email {
            font-family: var(--font-data);
            font-size: 12px;
        }

        .status-badge {
            padding: 2px 8px;
            font-size: 10px;
            font-weight: 600;
            border-radius: 10px;
        }

        .status-badge.active {
            background: rgba(34, 197, 94, 0.15);
            color: var(--state-accepted);
        }

        .status-badge.inactive {
            background: rgba(239, 68, 68, 0.15);
            color: var(--state-rejected);
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 16px;
            margin-bottom: 24px;
        }

        .stat-box {
            padding: 20px;
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 8px;
            text-align: center;
        }

        .stat-number {
            font-size: 32px;
            font-weight: 600;
            font-family: var(--font-data);
            color: var(--text-primary);
        }

        .stat-label {
            font-size: 10px;
            color: var(--text-muted);
            text-transform: uppercase;
            margin-top: 4px;
        }

        .audit-wrap {
            max-height: 400px;
            overflow-y: auto;
        }

        .audit-table {
            width: 100%;
            border-collapse: collapse;
            font-size: 12px;
        }

        .audit-table th,
        .audit-table td {
            padding: 8px 10px;
            text-align: left;
            border-bottom: 1px solid var(--border);
        }

        .audit-table th {
            font-size: 10px;
            font-weight: 500;
            color: var(--text-muted);
            text-transform: uppercase;
            background: var(--bg-secondary);
            position: sticky;
            top: 0;
        }

        .audit-table td {
            color: var(--text-secondary);
            font-family: var(--font-data);
        }

        .action-badge {
            padding: 3px 8px;
            font-size: 9px;
            font-weight: 600;
            text-transform: uppercase;
            border-radius: 3px;
        }

        .action-badge.create,
        .action-badge.approve,
        .action-badge.activate {
            background: rgba(34, 197, 94, 0.15);
            color: var(--state-accepted);
        }

        .action-badge.reject,
        .action-badge.delete,
        .action-badge.deactivate {
            background: rgba(239, 68, 68, 0.15);
            color: var(--state-rejected);
        }

        .action-badge.update,
        .action-badge.state_change,
        .action-badge.comment {
            background: rgba(245, 158, 11, 0.15);
            color: var(--state-pending);
        }

        .action-badge.export {
            background: var(--bg-elevated);
            color: var(--text-secondary);
        }

        .toast {
            position: fixed;
            bottom: 24px;
            right: 24px;
            padding: 12px 20px;
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 8px;
            color: var(--text-primary);
            font-size: 13px;
            z-index: 2000;
            animation: slideUp 0.3s ease;
        }

        .toast.success {
            border-color: var(--state-accepted);
        }

        .toast.error {
            border-color: var(--state-rejected);
        }

        .loading {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 12px;
            padding: 32px;
            color: var(--text-muted);
        }

        .spinner {
            width: 20px;
            height: 20px;
            border: 2px solid var(--border);
            border-top-color: var(--accent-primary);
            border-radius: 50%;
            animation: spin 0.8s linear infinite;
        }

        .empty-state {
            padding: 32px;
            text-align: center;
            color: var(--text-muted);
        }

        @media (max-width: 768px) {
            .form-row {
                flex-direction: column;
            }

            .actions-grid {
                grid-template-columns: 1fr;
            }

            .stats-grid {
                grid-template-columns: repeat(2, 1fr);
            }
        }
    </style>
</head>

<body>
    <div class="app">
        <header class="header">
            <div class="header-left">
                <a href="<?= ScriptApp.getService().getUrl() ?>" class="logo">√ò</a>
                <nav class="nav">
                    <a class="nav-link" href="<?= ScriptApp.getService().getUrl() ?>?page=queue">Reports Queue</a>
                    <a class="nav-link active" href="<?= ScriptApp.getService().getUrl() ?>?page=admin">Admin Panel</a>
                    <a class="nav-link" href="<?= ScriptApp.getService().getUrl() ?>?page=dashboard">Dashboard</a>
                </nav>
            </div>
            <div class="header-right">
                <span class="user-badge">
                    <?= user ?>
                </span>
                <span class="admin-badge">Admin</span>
                <button class="theme-toggle" onclick="toggleTheme()" title="Toggle theme"
                    aria-label="Toggle dark/light mode">
                    <svg class="icon-sun" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <circle cx="12" cy="12" r="5" />
                        <path
                            d="M12 1v2M12 21v2M4.22 4.22l1.42 1.42M18.36 18.36l1.42 1.42M1 12h2M21 12h2M4.22 19.78l1.42-1.42M18.36 5.64l1.42-1.42" />
                    </svg>
                    <svg class="icon-moon" viewBox="0 0 24 24" fill="currentColor">
                        <path
                            d="M21.752 15.002A9.718 9.718 0 0118 15.75c-5.385 0-9.75-4.365-9.75-9.75 0-1.33.266-2.597.748-3.752A9.753 9.753 0 003 11.25C3 16.635 7.365 21 12.75 21a9.753 9.753 0 009.002-5.998z" />
                    </svg>
                </button>
            </div>
        </header>

        <main class="main">
            <!-- Dashboard Stats -->
            <div class="stats-grid" id="stats-grid">
                <div class="stat-box">
                    <div class="stat-number" id="stat-reports">-</div>
                    <div class="stat-label">Total Reports</div>
                </div>
                <div class="stat-box">
                    <div class="stat-number" id="stat-users">-</div>
                    <div class="stat-label">Users</div>
                </div>
                <div class="stat-box">
                    <div class="stat-number" id="stat-pending">-</div>
                    <div class="stat-label">Pending</div>
                </div>
                <div class="stat-box">
                    <div class="stat-number" id="stat-accepted">-</div>
                    <div class="stat-label">Accepted</div>
                </div>
            </div>

            <!-- System Actions -->
            <div class="section">
                <div class="section-title">System Actions</div>
                <div class="actions-grid">
                    <? if (featureFlags.ALLOW_INITIALIZE_SHEETS) { ?>
                    <div class="action-card" onclick="initializeSheets()">
                        <h3>üìã Initialize</h3>
                        <p>Create sheets</p>
                    </div>
                    <? } ?>
                    <? if (featureFlags.ALLOW_IMPORT_REPORTS) { ?>
                    <div class="action-card" onclick="importReports()">
                        <h3>üì• Import Reports</h3>
                        <p>38 reports</p>
                    </div>
                    <? } ?>
                    <? if (featureFlags.ALLOW_IMPORT_USERS) { ?>
                    <div class="action-card" onclick="importUsers()">
                        <h3>üë• Import Users</h3>
                        <p>27 team members</p>
                    </div>
                    <? } ?>
                    <div class="action-card"
                        onclick="window.open('https://docs.google.com/spreadsheets/d/1qCJELcJXwhTeBKC8eULEHiey4ROw_PeZ5zgEwwp2nzU/edit', '_blank')">
                        <h3>üìä Spreadsheet</h3>
                        <p>View raw data</p>
                    </div>
                </div>
            </div>

            <!-- User Management -->
            <div class="section">
                <div class="section-header">
                    <div class="section-title">User Management</div>
                    <button class="add-user-btn" onclick="toggleAddUserForm()">+ Add User</button>
                </div>

                <div class="add-user-form" id="add-user-form">
                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label">Email *</label>
                            <input type="email" class="form-input" id="new-email" placeholder="user@priceline.com">
                        </div>
                        <div class="form-group">
                            <label class="form-label">First Name</label>
                            <input type="text" class="form-input" id="new-firstname" placeholder="John">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Last Name</label>
                            <input type="text" class="form-input" id="new-lastname" placeholder="Doe">
                        </div>
                        <button class="btn btn-primary" onclick="addUser()">Add</button>
                        <button class="btn" onclick="toggleAddUserForm()">Cancel</button>
                    </div>
                </div>

                <div class="card">
                    <div class="card-header">
                        <h3 class="card-title">Registered Users</h3>
                        <button class="btn btn-sm" onclick="loadUsers()">‚Üª</button>
                    </div>
                    <div id="users-list">
                        <div class="loading">
                            <div class="spinner"></div><span>Loading...</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Audit Log -->
            <div class="section">
                <div class="section-title">Audit Log</div>
                <div class="card">
                    <div class="card-header">
                        <h3 class="card-title">Recent Activity</h3>
                        <div style="display:flex;gap:8px;">
                            <select class="form-input" id="audit-filter" style="padding:6px 10px;font-size:12px;"
                                onchange="loadAuditLog()">
                                <option value="">All Actions</option>
                                <option value="CREATE">Create</option>
                                <option value="UPDATE">Update</option>
                                <option value="STATE_CHANGE">State Change</option>
                                <option value="COMMENT">Comment</option>
                                <option value="APPROVE">Approve</option>
                                <option value="REJECT">Reject</option>
                                <option value="DEACTIVATE">Deactivate</option>
                                <option value="EXPORT">Export</option>
                            </select>
                            <button class="btn btn-sm" onclick="loadAuditLog()">‚Üª</button>
                        </div>
                    </div>
                    <div class="audit-wrap" id="audit-log">
                        <div class="loading">
                            <div class="spinner"></div><span>Loading...</span>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <div class="toast hidden" id="toast"></div>

    <script>
        document.addEventListener('DOMContentLoaded', function () {
            loadTheme();
            loadDashboardStats();
            loadUsers();
            loadAuditLog();
        });

        function toggleTheme() {
            var current = document.body.getAttribute('data-theme') || 'dark';
            var next = current === 'dark' ? 'light' : 'dark';
            document.body.setAttribute('data-theme', next);
            localStorage.setItem('theme', next);
        }
        function loadTheme() {
            var saved = localStorage.getItem('theme') || 'dark';
            document.body.setAttribute('data-theme', saved);
        }

        function loadDashboardStats() {
            google.script.run.withSuccessHandler(function (data) {
                document.getElementById('stat-reports').textContent = data.totalReports || 0;
                document.getElementById('stat-users').textContent = data.totalUsers || 0;
                document.getElementById('stat-pending').textContent = data.byState ? data.byState.pending : 0;
                document.getElementById('stat-accepted').textContent = data.byState ? data.byState.accepted : 0;
            }).getDashboardStats();
        }

        function toggleAddUserForm() {
            document.getElementById('add-user-form').classList.toggle('show');
        }

        function loadUsers() {
            var container = document.getElementById('users-list');
            container.innerHTML = '<div class="loading"><div class="spinner"></div><span>Loading...</span></div>';
            google.script.run.withSuccessHandler(function (users) {
                if (!users || users.length === 0) {
                    container.innerHTML = '<div class="empty-state">No users found.</div>';
                    return;
                }
                container.innerHTML = '<table class="users-table"><thead><tr><th>Name</th><th>Email</th><th>Status</th><th>Actions</th></tr></thead><tbody>' +
                    users.map(function (u) {
                        var active = u.active === true || u.active === 'true' || u.active === 'TRUE';
                        return '<tr><td>' + escapeHtml((u.displayName || u.firstName || '') + ' ' + (u.lastName || '')) + '</td>' +
                            '<td class="email">' + escapeHtml(u.email) + '</td>' +
                            '<td><span class="status-badge ' + (active ? 'active' : 'inactive') + '">' + (active ? 'Active' : 'Inactive') + '</span></td>' +
                            '<td><button class="btn btn-sm ' + (active ? 'btn-danger' : '') + '" onclick="toggleUserStatus(\'' + u.email + '\', ' + !active + ')">' + (active ? 'Deactivate' : 'Activate') + '</button></td></tr>';
                    }).join('') + '</tbody></table>';
            }).withFailureHandler(function (e) {
                container.innerHTML = '<div class="empty-state">Failed: ' + e.message + '</div>';
            }).getAllUsers();
        }

        function addUser() {
            var email = document.getElementById('new-email').value.trim();
            var firstName = document.getElementById('new-firstname').value.trim();
            var lastName = document.getElementById('new-lastname').value.trim();
            if (!email) { showToast('Email required', 'error'); return; }
            showToast('Adding user...', 'info');
            google.script.run.withSuccessHandler(function () {
                showToast('User added!', 'success');
                document.getElementById('new-email').value = '';
                document.getElementById('new-firstname').value = '';
                document.getElementById('new-lastname').value = '';
                toggleAddUserForm();
                loadUsers();
                loadDashboardStats();
            }).withFailureHandler(function (e) { showToast('Failed: ' + e.message, 'error'); }).createUser({ email: email, firstName: firstName, lastName: lastName });
        }

        function toggleUserStatus(email, active) {
            showToast('Updating...', 'info');
            google.script.run.withSuccessHandler(function () {
                showToast('Updated!', 'success');
                loadUsers();
            }).withFailureHandler(function (e) { showToast('Failed: ' + e.message, 'error'); }).updateUser(email, { active: active });
        }

        function loadAuditLog() {
            var container = document.getElementById('audit-log');
            container.innerHTML = '<div class="loading"><div class="spinner"></div><span>Loading...</span></div>';
            var action = document.getElementById('audit-filter').value || '';
            google.script.run.withSuccessHandler(function (entries) {
                if (!entries || entries.length === 0) {
                    container.innerHTML = '<div class="empty-state">No audit entries found.</div>';
                    return;
                }
                container.innerHTML = '<table class="audit-table"><thead><tr><th>Time</th><th>User</th><th>Action</th><th>Entity</th><th>Details</th></tr></thead><tbody>' +
                    entries.map(function (e) {
                        return '<tr><td>' + (e.timestamp || '-') + '</td>' +
                            '<td>' + escapeHtml(e.user || '-') + '</td>' +
                            '<td><span class="action-badge ' + (e.action || '').toLowerCase() + '">' + (e.action || '-') + '</span></td>' +
                            '<td>' + escapeHtml(e.entityType || '-') + '</td>' +
                            '<td style="max-width:200px;overflow:hidden;text-overflow:ellipsis;">' + escapeHtml(e.details || '-') + '</td></tr>';
                    }).join('') + '</tbody></table>';
            }).withFailureHandler(function (e) {
                container.innerHTML = '<div class="empty-state">Failed: ' + e.message + '</div>';
            }).getAuditLog({ action: action, limit: 100 });
        }

        function initializeSheets() {
            showToast('Initializing...', 'info');
            google.script.run.withSuccessHandler(function () { showToast('Done!', 'success'); loadAuditLog(); }).withFailureHandler(function (e) { showToast('Failed: ' + e.message, 'error'); }).initializeSheets();
        }

        function importReports() {
            if (!confirm('Import 38 reports?')) return;
            showToast('Importing...', 'info');
            google.script.run.withSuccessHandler(function (count) { showToast('Imported ' + count, 'success'); loadAuditLog(); loadDashboardStats(); }).withFailureHandler(function (e) { showToast('Failed: ' + e.message, 'error'); }).importReportsFromData();
        }

        function importUsers() {
            if (!confirm('Import 27 team members?')) return;
            showToast('Importing...', 'info');
            google.script.run.withSuccessHandler(function (count) { showToast('Imported ' + count, 'success'); loadUsers(); loadAuditLog(); loadDashboardStats(); }).withFailureHandler(function (e) { showToast('Failed: ' + e.message, 'error'); }).importSampleUsers();
        }

        function showToast(msg, type) {
            var t = document.getElementById('toast');
            t.textContent = msg; t.className = 'toast ' + (type || '');
            t.classList.remove('hidden');
            setTimeout(function () { t.classList.add('hidden'); }, 3000);
        }

        function escapeHtml(text) {
            if (!text) return '';
            var div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }
    </script>
</body>

</html>
<? } ?>

<? if (page === "home"
) { ?>
    <!-- HOME PAGE styles -->
<style>
        /* Home-specific overrides */
        body {
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .home-container {
            width: 100%;
            max-width: 1000px;
            padding: 48px 24px;
            animation: fadeIn 0.5s ease;
        }

        .home-header {
            text-align: center;
            margin-bottom: 64px;
            position: relative;
        }

        .theme-toggle-btn {
            position: absolute;
            top: 0;
            right: 0;
        }

        .home-logo {
            font-size: 72px;
            font-weight: 300;
            color: var(--accent-primary);
            letter-spacing: -4px;
            margin-bottom: 16px;
        }

        .home-title {
            font-size: var(--font-xl);
            font-weight: 400;
            color: var(--text-primary);
            margin-bottom: var(--spacing-sm);
        }

        .home-subtitle {
            font-size: var(--font-base);
            color: var(--text-muted);
        }

        .home-user {
            margin-top: var(--spacing-md);
            font-size: var(--font-sm);
            color: var(--text-secondary);
        }

        .modules-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: var(--spacing-lg);
        }

        .module-card {
            background-color: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: var(--border-radius-xl);
            padding: var(--spacing-xl) var(--spacing-lg);
            text-align: center;
            transition: all var(--transition-fast);
            animation: slideUp 0.5s ease both;
            cursor: pointer;
            text-decoration: none;
            display: block;
        }

        .module-card:nth-child(1) {
            animation-delay: 0.1s;
        }

        .module-card:nth-child(2) {
            animation-delay: 0.15s;
        }

        .module-card:nth-child(3) {
            animation-delay: 0.2s;
        }

        .module-card:nth-child(4) {
            animation-delay: 0.25s;
        }

        .module-card:nth-child(5) {
            animation-delay: 0.3s;
        }

        .module-card:nth-child(6) {
            animation-delay: 0.35s;
        }

        .module-card:hover {
            border-color: var(--border-hover);
            transform: translateY(-4px);
        }

        .module-card.disabled {
            opacity: 0.4;
            cursor: not-allowed;
        }

        .module-card.disabled:hover {
            transform: none;
            border-color: var(--border);
        }

        .module-card.active {
            border-color: var(--accent-primary);
            box-shadow: var(--shadow-lg);
        }

        .module-icon {
            font-size: 36px;
            margin-bottom: var(--spacing-md);
        }

        .module-name {
            font-size: var(--font-lg);
            font-weight: 500;
            color: var(--text-primary);
            margin-bottom: var(--spacing-xs);
        }

        .module-id {
            font-size: var(--font-xs);
            font-family: var(--font-mono);
            color: var(--text-muted);
            letter-spacing: 1px;
        }

        .module-status {
            font-size: var(--font-xs);
            padding: var(--spacing-xs) 10px;
            border-radius: 12px;
            margin-top: var(--spacing-md);
            display: inline-block;
        }

        .module-status.active {
            background-color: var(--state-success-dim);
            color: var(--state-success);
        }

        .module-status.coming {
            background-color: var(--bg-elevated);
            color: var(--text-muted);
        }

        .home-footer {
            margin-top: var(--spacing-3xl);
            text-align: center;
            font-size: var(--font-sm);
            color: var(--text-muted);
        }

        .home-footer a {
            color: var(--text-secondary);
            text-decoration: none;
            margin: 0 var(--spacing-md);
        }

        .home-footer a:hover {
            color: var(--text-primary);
        }

        @media (max-width: 768px) {
            .modules-grid {
                grid-template-columns: repeat(2, 1fr);
                gap: var(--spacing-md);
            }

            .module-card {
                padding: var(--spacing-lg) var(--spacing-md);
            }

            .home-logo {
                font-size: 48px;
            }
        }
    </style>
<? } ?>

<? if (page === "cb"
) { ?>
    <!-- CHARGEBACK MODULE SELECTOR styles -->
<style>
        /* CBModule-specific overrides */
        body {
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .cb-container {
            width: 100%;
            max-width: 1000px;
            padding: var(--spacing-3xl) var(--spacing-lg);
        }

        .cb-header {
            text-align: center;
            margin-bottom: var(--spacing-3xl);
            position: relative;
        }

        .cb-header .theme-toggle {
            position: absolute;
            top: 0;
            right: 0;
        }

        .cb-back-link {
            display: inline-block;
            color: var(--text-secondary);
            text-decoration: none;
            font-size: var(--font-base);
            margin-bottom: var(--spacing-lg);
        }

        .cb-back-link:hover {
            color: var(--text-primary);
        }

        .cb-logo {
            font-size: 48px;
            margin-bottom: var(--spacing-md);
        }

        .cb-title {
            font-size: 28px;
            font-weight: 400;
            color: var(--text-primary);
            margin-bottom: var(--spacing-sm);
        }

        .cb-subtitle {
            font-size: var(--font-base);
            color: var(--text-muted);
        }

        /* Dynamic flex grid - centers items when there are fewer */
        .cb-modules-grid {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: var(--spacing-lg);
        }

        .cb-module-card {
            background-color: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: var(--border-radius-xl);
            padding: var(--spacing-xl) var(--spacing-lg);
            text-align: center;
            transition: all var(--transition-fast);
            animation: slideUp 0.5s ease both;
            cursor: pointer;
            text-decoration: none;
            display: block;
            width: 220px;
            flex-shrink: 0;
        }

        .cb-module-card:nth-child(1) {
            animation-delay: 0.1s;
        }

        .cb-module-card:nth-child(2) {
            animation-delay: 0.15s;
        }

        .cb-module-card:nth-child(3) {
            animation-delay: 0.2s;
        }

        .cb-module-card:nth-child(4) {
            animation-delay: 0.25s;
        }

        .cb-module-card:hover {
            border-color: var(--border-hover);
            transform: translateY(-4px);
        }

        .cb-module-card.admin-only {
            border-color: rgba(255, 140, 0, 0.3);
        }

        .cb-module-card.admin-only:hover {
            border-color: rgba(255, 140, 0, 0.6);
        }

        .cb-module-icon {
            font-size: 36px;
            margin-bottom: var(--spacing-md);
        }

        .cb-module-name {
            font-size: var(--font-md);
            font-weight: 500;
            color: var(--text-primary);
            margin-bottom: var(--spacing-xs);
        }

        .cb-module-desc {
            font-size: var(--font-sm);
            color: var(--text-muted);
            margin-top: var(--spacing-sm);
        }

        .admin-badge {
            font-size: var(--font-xs);
            padding: var(--spacing-xs) 10px;
            border-radius: 12px;
            margin-top: var(--spacing-md);
            display: inline-block;
            background-color: rgba(255, 140, 0, 0.15);
            color: #ff8c00;
        }

        @media (max-width: 768px) {
            .cb-modules-grid {
                flex-direction: column;
                align-items: center;
                gap: var(--spacing-md);
            }

            .cb-module-card {
                width: 100%;
                max-width: 300px;
            }
        }
    </style>
<? } ?>

<? if (page === "rep"
) { ?>
    <!-- REPRESENTATION MANAGER styles -->
<style>
    /* RepManagerUI-specific styles */
    .main-container {
      display: flex;
      height: calc(100vh - 65px);
    }

    /* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
           HEADER
           ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
    .rep-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 16px 24px;
      border-bottom: 1px solid var(--border);
      background: var(--bg-secondary);
    }

    .rep-header-left {
      display: flex;
      align-items: center;
      gap: 16px;
    }

    .rep-logo {
      font-size: 32px;
      font-weight: 300;
      color: var(--text-primary);
      text-decoration: none;
    }

    .rep-logo:hover {
      color: var(--state-success);
    }

    .rep-page-title {
      font-size: 18px;
      font-weight: 500;
      color: var(--text-secondary);
    }

    .rep-header-right {
      display: flex;
      align-items: center;
      gap: 16px;
    }

    .rep-back-btn {
      padding: 8px 16px;
      background: var(--bg-card);
      border: 1px solid var(--border);
      border-radius: 6px;
      color: var(--text-secondary);
      text-decoration: none;
      font-size: 14px;
      transition: all 0.2s;
    }

    .rep-back-btn:hover {
      border-color: var(--border-hover);
      color: var(--text-primary);
    }

    /* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
           LAYOUT
           ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
    .main-container {
      display: flex;
      height: calc(100vh - 65px);
    }

    .sidebar {
      width: 220px;
      background: var(--bg-secondary);
      border-right: 1px solid var(--border);
      padding: 24px 16px;
    }

    .content {
      flex: 1;
      padding: 24px;
      overflow-y: auto;
    }

    /* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
           SIDEBAR ACTIONS
           ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
    .action-section h3 {
      font-size: 11px;
      text-transform: uppercase;
      letter-spacing: 1px;
      color: var(--text-muted);
      margin-bottom: 12px;
    }

    .action-btn {
      display: block;
      width: 100%;
      padding: 12px 16px;
      margin-bottom: 8px;
      background: var(--bg-card);
      border: 1px solid var(--border);
      border-radius: 8px;
      color: var(--text-primary);
      font-size: 14px;
      font-family: var(--font-ui);
      cursor: pointer;
      text-align: left;
      transition: all 0.2s;
    }

    .action-btn:hover {
      border-color: var(--border-hover);
      transform: translateX(4px);
    }

    .action-btn.challenge {
      border-left: 3px solid var(--accent);
    }

    .action-btn.accept {
      border-left: 3px solid #3b82f6;
    }

    .action-btn.reversal {
      border-left: 3px solid var(--warning);
    }

    .action-btn.autoclosed {
      border-left: 3px solid var(--text-muted);
    }

    .action-btn.recreate {
      border-left: 3px solid var(--danger);
    }

    /* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
           CARDS ROW
           ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
    .cards-row {
      display: flex;
      gap: 16px;
      margin-bottom: 24px;
    }

    .stat-card {
      flex: 1;
      padding: 16px 20px;
      background: var(--bg-card);
      border: 1px solid var(--border);
      border-radius: 8px;
      text-align: center;
    }

    .stat-card.visa {
      border-top: 3px solid var(--visa);
    }

    .stat-card.mastercard {
      border-top: 3px solid var(--mastercard);
    }

    .stat-card.discover {
      border-top: 3px solid var(--discover);
    }

    .stat-card.amex {
      border-top: 3px solid #0073CF;
    }

    .stat-card.affirm {
      border-top: 3px solid #0FA0EA;
    }

    .stat-card.braintree {
      border-top: 3px solid #7433FF;
    }

    .stat-card.chase {
      border-top: 3px solid #117ACA;
    }

    .stat-card.fiserv {
      border-top: 3px solid #FF6600;
    }

    .stat-label {
      font-size: 12px;
      color: var(--text-muted);
      margin-bottom: 4px;
    }

    .stat-value {
      font-size: 28px;
      font-weight: 600;
      font-family: var(--font-mono);
    }

    /* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
           CONTROLS
           ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
    .controls-row {
      display: flex;
      gap: 12px;
      margin-bottom: 24px;
      align-items: center;
    }

    .select-input {
      padding: 10px 16px;
      background: var(--bg-card);
      border: 1px solid var(--border);
      border-radius: 6px;
      color: var(--text-primary);
      font-size: 14px;
      font-family: var(--font-ui);
      min-width: 160px;
    }

    .select-input:focus {
      outline: none;
      border-color: var(--accent);
    }

    .primary-btn {
      padding: 10px 24px;
      background: var(--accent-primary);
      border: none;
      border-radius: 6px;
      color: var(--bg-primary);
      font-size: 14px;
      font-weight: 500;
      font-family: var(--font-ui);
      cursor: pointer;
      transition: all 0.2s;
    }

    .primary-btn:hover {
      opacity: 0.9;
      transform: translateY(-1px);
      background: var(--state-success);
    }

    /* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
           CASE INFO
           ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
    .case-card {
      background: var(--bg-card);
      border: 1px solid var(--border);
      border-radius: 12px;
      padding: 24px;
      margin-bottom: 24px;
    }

    .case-grid {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 16px;
    }

    .field-group {
      display: flex;
      flex-direction: column;
      gap: 4px;
    }

    .field-label {
      font-size: 11px;
      text-transform: uppercase;
      letter-spacing: 0.5px;
      color: var(--text-muted);
    }

    .field-value {
      font-size: 15px;
      color: var(--text-primary);
      padding: 8px 12px;
      background: var(--bg-elevated);
      border-radius: 6px;
      min-height: 36px;
      font-family: var(--font-mono);
    }

    .field-value.large {
      min-height: 80px;
      font-family: var(--font-ui);
      white-space: pre-wrap;
    }

    /* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
           FILES TABLE
           ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
    .files-section {
      background: var(--bg-card);
      border: 1px solid var(--border);
      border-radius: 12px;
      padding: 24px;
    }

    .files-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 16px;
    }

    .files-header h3 {
      font-size: 16px;
      font-weight: 500;
    }

    .files-actions {
      display: flex;
      gap: 8px;
    }

    .secondary-btn {
      padding: 8px 16px;
      background: var(--bg-elevated);
      border: 1px solid var(--border);
      border-radius: 6px;
      color: var(--text-primary);
      font-size: 13px;
      font-family: var(--font-ui);
      cursor: pointer;
      transition: all 0.2s;
    }

    .secondary-btn:hover {
      border-color: var(--border-hover);
    }

    .files-table {
      width: 100%;
      border-collapse: collapse;
    }

    .files-table th {
      text-align: left;
      padding: 12px;
      font-size: 11px;
      text-transform: uppercase;
      letter-spacing: 0.5px;
      color: var(--text-muted);
      border-bottom: 1px solid var(--border);
    }

    .files-table td {
      padding: 12px;
      border-bottom: 1px solid var(--border);
      font-size: 14px;
    }

    .files-table tr:hover td {
      background: var(--bg-elevated);
    }

    .files-table a {
      color: var(--accent);
      text-decoration: none;
    }

    .files-table a:hover {
      text-decoration: underline;
    }

    input[type="checkbox"] {
      width: 16px;
      height: 16px;
      accent-color: var(--accent);
    }

    #row {
      display: none;
    }
  </style>
<? } ?>

<? if (page === "email-confirm"
) { ?>
    <!-- EMAIL CONFIRMATIONS styles -->
<style>
        body {
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }

        .ec-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 16px 24px;
            border-bottom: 1px solid var(--border);
            background: var(--bg-secondary);
        }

        .ec-header-left {
            display: flex;
            align-items: center;
            gap: 16px;
        }

        .ec-logo {
            font-size: 32px;
            font-weight: 300;
            color: var(--text-primary);
            text-decoration: none;
        }

        .ec-logo:hover {
            color: var(--state-success);
        }

        .ec-page-title {
            font-size: 18px;
            font-weight: 500;
            color: var(--text-secondary);
        }

        .ec-header-right {
            display: flex;
            align-items: center;
            gap: 16px;
        }

        .ec-back-btn {
            padding: 8px 16px;
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 6px;
            color: var(--text-secondary);
            text-decoration: none;
            font-size: 14px;
            transition: all 0.2s;
        }

        .ec-back-btn:hover {
            border-color: var(--border-hover);
            color: var(--text-primary);
        }

        .ec-container {
            flex: 1;
            display: flex;
            gap: 24px;
            padding: 24px;
            max-width: 1400px;
            margin: 0 auto;
            width: 100%;
        }

        .ec-section {
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 24px;
        }

        .ec-pending {
            flex: 1;
            max-width: 500px;
            display: flex;
            flex-direction: column;
        }

        .ec-table-wrapper {
            flex: 1;
            max-height: 400px;
            overflow-y: auto;
            border: 1px solid var(--border);
            border-radius: 6px;
        }

        .ec-upload {
            flex: 1;
        }

        .ec-section h2 {
            font-size: 16px;
            font-weight: 500;
            color: var(--text-primary);
            margin-bottom: 16px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        /* Pending Items Table */
        .ec-table {
            width: 100%;
            border-collapse: collapse;
        }

        .ec-table th {
            text-align: left;
            padding: 10px 12px;
            font-size: 11px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            color: var(--text-muted);
            border-bottom: 1px solid var(--border);
        }

        .ec-table td {
            padding: 10px 12px;
            border-bottom: 1px solid var(--border);
            font-size: 14px;
            color: var(--text-primary);
        }

        .ec-table tr:hover td {
            background: var(--bg-elevated);
        }

        .ec-table .mono {
            font-family: var(--font-mono);
        }

        .ec-status {
            display: inline-block;
            padding: 4px 10px;
            border-radius: 12px;
            font-size: 11px;
            font-weight: 500;
        }

        .ec-status.pending {
            background: rgba(255, 193, 7, 0.15);
            color: #ffc107;
        }

        .ec-status.completed {
            background: rgba(76, 175, 80, 0.15);
            color: #4caf50;
        }

        /* Upload Area */
        .ec-drop-zone {
            border: 2px dashed var(--border);
            border-radius: 8px;
            padding: 40px;
            text-align: center;
            transition: all 0.3s;
            cursor: pointer;
            margin-bottom: 16px;
        }

        .ec-drop-zone:hover,
        .ec-drop-zone.dragover {
            border-color: var(--accent);
            background: var(--accent-dim);
        }

        .ec-drop-zone-icon {
            font-size: 48px;
            margin-bottom: 12px;
        }

        .ec-drop-zone-text {
            font-size: 14px;
            color: var(--text-secondary);
            margin-bottom: 8px;
        }

        .ec-drop-zone-hint {
            font-size: 12px;
            color: var(--text-muted);
        }

        .ec-file-input {
            display: none;
        }

        /* File List */
        .ec-file-list {
            margin-top: 16px;
        }

        .ec-file-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 10px 12px;
            background: var(--bg-elevated);
            border-radius: 6px;
            margin-bottom: 8px;
        }

        .ec-file-name {
            font-size: 13px;
            color: var(--text-primary);
            font-family: var(--font-mono);
        }

        .ec-file-remove {
            background: none;
            border: none;
            color: var(--danger);
            cursor: pointer;
            font-size: 18px;
            padding: 0;
            line-height: 1;
        }

        .ec-upload-btn {
            width: 100%;
            padding: 12px 24px;
            background: var(--accent-primary);
            border: none;
            border-radius: 6px;
            color: var(--bg-primary);
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s;
            margin-top: 16px;
        }

        .ec-upload-btn:hover {
            background: var(--state-success);
        }

        .ec-upload-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .ec-message {
            padding: 12px;
            border-radius: 6px;
            margin-top: 16px;
            font-size: 13px;
        }

        .ec-message.success {
            background: rgba(76, 175, 80, 0.15);
            color: #4caf50;
        }

        .ec-message.error {
            background: rgba(244, 67, 54, 0.15);
            color: #f44336;
        }

        .ec-empty {
            text-align: center;
            padding: 40px;
            color: var(--text-muted);
        }

        .ec-refresh-btn {
            padding: 8px 16px;
            background: var(--bg-elevated);
            border: 1px solid var(--border);
            border-radius: 6px;
            color: var(--text-primary);
            font-size: 13px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .ec-refresh-btn:hover {
            border-color: var(--border-hover);
        }

        @media (max-width: 900px) {
            .ec-container {
                flex-direction: column;
            }

            .ec-pending {
                max-width: none;
            }
        }
    </style>
<? } ?>

<? if (page === "cbq"
) { ?>
    <!-- WORD ANALYSER / TEXT ANALYTICS styles -->
<style>
        /* CBQMain-specific styles */
        .hidden {
            display: none !important;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
            }

            to {
                opacity: 1;
            }
        }

        @keyframes spin {
            to {
                transform: rotate(360deg);
            }
        }

        .app {
            display: flex;
            flex-direction: column;
            height: 100vh;
        }

        .header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 12px 24px;
            background: var(--bg-secondary);
            border-bottom: 1px solid var(--border);
        }

        .header-left {
            display: flex;
            align-items: center;
            gap: 24px;
        }

        .logo {
            font-size: 24px;
            font-weight: 300;
            color: var(--accent-primary);
            letter-spacing: -2px;
            text-decoration: none;
        }

        .nav {
            display: flex;
            gap: 8px;
        }

        .nav-link {
            padding: 8px 16px;
            font-size: 13px;
            color: var(--text-secondary);
            text-decoration: none;
            border-radius: 6px;
            transition: all 150ms;
        }

        .nav-link:hover {
            color: var(--text-primary);
            background: var(--bg-elevated);
        }

        .nav-link.active {
            color: var(--text-primary);
            background: var(--bg-card);
            border: 1px solid var(--border);
        }

        .header-right {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .user-badge {
            font-size: 11px;
            color: var(--text-muted);
        }

        .admin-badge {
            font-size: 9px;
            padding: 2px 6px;
            background: var(--positive);
            color: #000;
            border-radius: 3px;
            font-weight: 600;
        }

        .icon-btn {
            width: 32px;
            height: 32px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--text-secondary);
            border-radius: 6px;
            cursor: pointer;
            transition: all 150ms;
            background: transparent;
            border: none;
            font-size: 16px;
        }

        .icon-btn:hover {
            background: var(--bg-elevated);
            color: var(--text-primary);
        }

        .main {
            flex: 1;
            display: flex;
            overflow: hidden;
        }

        .sidebar {
            width: 280px;
            background: var(--bg-secondary);
            border-right: 1px solid var(--border);
            overflow-y: auto;
            padding: 16px;
        }

        .sidebar-section {
            margin-bottom: 24px;
        }

        .sidebar-title {
            font-size: 10px;
            color: var(--text-muted);
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 12px;
        }

        .content {
            flex: 1;
            padding: 24px;
            overflow-y: auto;
            animation: fadeIn 0.3s ease;
        }

        .tabs {
            display: flex;
            gap: 8px;
            margin-bottom: 24px;
        }

        .tab {
            padding: 10px 20px;
            font-size: 13px;
            color: var(--text-secondary);
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 6px;
            cursor: pointer;
            transition: all 150ms;
        }

        .tab:hover {
            border-color: var(--border-hover);
            color: var(--text-primary);
        }

        .tab.active {
            background: var(--accent-primary);
            color: var(--bg-primary);
            border-color: var(--accent-primary);
        }

        .stats-row {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 16px;
            margin-bottom: 24px;
        }

        .stat-box {
            padding: 20px;
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 8px;
            text-align: center;
        }

        .stat-number {
            font-size: 32px;
            font-weight: 600;
            font-family: var(--font-data);
        }

        .stat-label {
            font-size: 10px;
            color: var(--text-muted);
            text-transform: uppercase;
            margin-top: 4px;
        }

        .upload-zone {
            padding: 40px;
            border: 2px dashed var(--border);
            border-radius: 12px;
            text-align: center;
            cursor: pointer;
            transition: all 150ms;
            margin-bottom: 24px;
        }

        .upload-zone:hover {
            border-color: var(--accent-primary);
            background: var(--bg-elevated);
        }

        .upload-zone.dragover {
            border-color: var(--positive);
            background: rgba(34, 197, 94, 0.1);
        }

        .upload-icon {
            font-size: 48px;
            margin-bottom: 12px;
            opacity: 0.5;
        }

        .upload-title {
            font-size: 16px;
            font-weight: 500;
            margin-bottom: 8px;
        }

        .upload-subtitle {
            font-size: 12px;
            color: var(--text-muted);
        }

        .form-group {
            margin-bottom: 16px;
        }

        .form-label {
            display: block;
            font-size: 10px;
            font-weight: 500;
            color: var(--text-secondary);
            margin-bottom: 6px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .form-input,
        .form-select,
        .form-textarea {
            width: 100%;
            padding: 10px 12px;
            font-family: var(--font-ui);
            font-size: 14px;
            color: var(--text-primary);
            background: var(--bg-elevated);
            border: 1px solid var(--border);
            border-radius: 6px;
        }

        .form-input:focus,
        .form-select:focus,
        .form-textarea:focus {
            outline: none;
            border-color: var(--accent-primary);
        }

        .form-textarea {
            min-height: 150px;
            resize: vertical;
        }

        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 12px;
        }

        .btn {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            padding: 10px 18px;
            font-family: var(--font-ui);
            font-size: 13px;
            font-weight: 500;
            border-radius: 6px;
            border: 1px solid var(--border);
            cursor: pointer;
            background: transparent;
            color: var(--text-primary);
            transition: all 150ms;
        }

        .btn:hover {
            border-color: var(--border-hover);
            background: var(--bg-elevated);
        }

        .btn-primary {
            background: var(--accent-primary);
            color: var(--bg-primary);
            border-color: var(--accent-primary);
        }

        .btn-primary:hover {
            opacity: 0.9;
        }

        .btn-success {
            background: var(--positive);
            color: #000;
            border-color: var(--positive);
        }

        .btn-sm {
            padding: 6px 12px;
            font-size: 12px;
        }

        .word-cloud {
            min-height: 400px;
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 8px;
            padding: 24px;
            display: flex;
            flex-wrap: wrap;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .word-item {
            padding: 4px 12px;
            border-radius: 4px;
            font-family: var(--font-data);
            cursor: pointer;
            transition: transform 0.15s;
        }

        .word-item:hover {
            transform: scale(1.1);
        }

        .word-item.positive {
            background: rgba(34, 197, 94, 0.2);
            color: var(--positive);
        }

        .word-item.negative {
            background: rgba(239, 68, 68, 0.2);
            color: var(--negative);
        }

        .word-item.neutral {
            background: var(--bg-elevated);
            color: var(--text-secondary);
        }

        .queue-list {
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 8px;
        }

        .queue-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 16px;
            border-bottom: 1px solid var(--border);
        }

        .queue-item:last-child {
            border-bottom: none;
        }

        .queue-name {
            font-size: 13px;
            font-weight: 500;
        }

        .queue-meta {
            font-size: 11px;
            color: var(--text-muted);
        }

        .queue-status {
            font-size: 10px;
            padding: 3px 8px;
            border-radius: 4px;
            font-weight: 600;
            text-transform: uppercase;
        }

        .queue-status.queued {
            background: rgba(245, 158, 11, 0.2);
            color: var(--neutral);
        }

        .queue-status.processing {
            background: rgba(99, 102, 241, 0.2);
            color: #6366f1;
        }

        .queue-status.completed {
            background: rgba(34, 197, 94, 0.2);
            color: var(--positive);
        }

        .queue-status.error {
            background: rgba(239, 68, 68, 0.2);
            color: var(--negative);
        }

        .loading {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 12px;
            padding: 48px;
            color: var(--text-muted);
        }

        .spinner {
            width: 20px;
            height: 20px;
            border: 2px solid var(--border);
            border-top-color: var(--accent-primary);
            border-radius: 50%;
            animation: spin 0.8s linear infinite;
        }

        .toast {
            position: fixed;
            bottom: 24px;
            right: 24px;
            padding: 12px 20px;
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 8px;
            color: var(--text-primary);
            font-size: 13px;
            z-index: 2000;
        }

        .toast.success {
            border-color: var(--positive);
        }

        .toast.error {
            border-color: var(--negative);
        }

        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.8);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
        }

        .modal {
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 12px;
            width: 100%;
            max-width: 440px;
            animation: fadeIn 0.2s ease;
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 20px 24px;
            border-bottom: 1px solid var(--border);
        }

        .modal-header h3 {
            font-size: 16px;
            font-weight: 500;
        }

        .modal-close {
            background: none;
            border: none;
            color: var(--text-muted);
            font-size: 24px;
            cursor: pointer;
            line-height: 1;
        }

        .modal-close:hover {
            color: var(--text-primary);
        }

        .modal-body {
            padding: 24px;
        }

        .modal-footer {
            display: flex;
            justify-content: flex-end;
            gap: 12px;
            padding: 16px 24px;
            border-top: 1px solid var(--border);
        }

        @media (max-width: 768px) {
            .sidebar {
                display: none;
            }

            .stats-row {
                grid-template-columns: repeat(2, 1fr);
            }

            .form-row {
                grid-template-columns: 1fr;
            }
        }
    </style>
<? } ?>

<? if (page === "fa"
) { ?>
    <!-- FA COACHING styles -->
<style>
        /* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
           FA COACHING ‚Äî PAGE STYLES
           ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */

        body {
            display: flex;
            align-items: flex-start;
            justify-content: center;
            overflow-y: auto;
            min-height: 100vh;
        }

        .fa-container {
            width: 100%;
            max-width: 900px;
            padding: 48px 24px;
            animation: fadeIn 0.5s ease;
        }

        /* Header */
        .fa-header {
            text-align: center;
            margin-bottom: 48px;
            position: relative;
        }

        .fa-header .theme-toggle {
            position: absolute;
            top: 0;
            right: 0;
        }

        .fa-back-link {
            display: inline-block;
            color: var(--text-secondary);
            text-decoration: none;
            font-size: var(--font-sm);
            margin-bottom: var(--spacing-lg);
            transition: color var(--transition-fast);
        }

        .fa-back-link:hover {
            color: var(--text-primary);
            text-decoration: none;
        }

        .fa-logo {
            font-size: 48px;
            margin-bottom: var(--spacing-md);
        }

        .fa-title {
            font-size: var(--font-xl);
            font-weight: 400;
            color: var(--text-primary);
            margin-bottom: var(--spacing-xs);
        }

        .fa-subtitle {
            font-size: var(--font-sm);
            color: var(--text-muted);
        }

        /* ‚îÄ‚îÄ‚îÄ Date Picker ‚îÄ‚îÄ‚îÄ */
        .date-picker-section {
            margin-bottom: var(--spacing-xl);
        }

        .date-picker-wrapper {
            position: relative;
            max-width: 320px;
            margin: 0 auto;
        }

        .date-input {
            width: 100%;
            padding: 12px 16px;
            font-family: var(--font-ui);
            font-size: var(--font-base);
            color: var(--text-primary);
            background-color: var(--bg-input);
            border: 1px solid var(--border);
            border-radius: var(--border-radius-lg);
            transition: all var(--transition-fast);
            text-align: center;
            letter-spacing: 0.5px;
        }

        .date-input:focus {
            outline: none;
            border-color: var(--accent-primary);
        }

        .date-input::placeholder {
            color: var(--text-muted);
        }

        .date-dropdown {
            position: absolute;
            top: calc(100% + 4px);
            left: 0;
            right: 0;
            max-height: 200px;
            overflow-y: auto;
            background-color: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: var(--border-radius-lg);
            z-index: 100;
            display: none;
        }

        .date-dropdown.open {
            display: block;
            animation: slideUp 0.2s ease;
        }

        .date-option {
            padding: 10px 16px;
            font-size: var(--font-sm);
            color: var(--text-secondary);
            cursor: pointer;
            transition: all var(--transition-fast);
            font-family: var(--font-mono);
        }

        .date-option:hover {
            background-color: var(--bg-elevated);
            color: var(--text-primary);
        }

        .date-option.selected {
            color: var(--text-primary);
            background-color: var(--bg-elevated);
        }

        /* ‚îÄ‚îÄ‚îÄ Case List ‚îÄ‚îÄ‚îÄ */
        .case-list-section {
            animation: slideUp 0.4s ease;
        }

        .case-list-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: var(--spacing-md);
        }

        .case-list-title {
            font-size: var(--font-md);
            font-weight: 500;
            color: var(--text-primary);
        }

        .case-count {
            font-size: var(--font-xs);
            color: var(--text-muted);
            font-family: var(--font-mono);
        }

        .case-table {
            width: 100%;
            border-collapse: collapse;
        }

        .case-table th {
            text-align: left;
            padding: 10px 16px;
            font-size: var(--font-xs);
            font-weight: 500;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            color: var(--text-muted);
            border-bottom: 1px solid var(--border);
        }

        .case-table td {
            padding: 14px 16px;
            font-size: var(--font-sm);
            color: var(--text-secondary);
            border-bottom: 1px solid var(--border);
            transition: all var(--transition-fast);
        }

        .case-table tr.case-row {
            cursor: pointer;
            transition: all var(--transition-fast);
        }

        .case-table tr.case-row:hover {
            background-color: var(--bg-elevated);
        }

        .case-table tr.case-row:hover td {
            color: var(--text-primary);
        }

        .case-table td.itn-cell {
            font-family: var(--font-mono);
            color: var(--text-primary);
            font-weight: 500;
        }

        .case-table td.notes-cell {
            max-width: 400px;
            line-height: 1.4;
        }

        /* ‚îÄ‚îÄ‚îÄ Case Detail ‚îÄ‚îÄ‚îÄ */
        .case-detail-section {
            animation: slideUp 0.4s ease;
        }

        .detail-back-btn {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            color: var(--text-secondary);
            font-size: var(--font-sm);
            cursor: pointer;
            background: none;
            border: none;
            font-family: var(--font-ui);
            padding: 0;
            margin-bottom: var(--spacing-xl);
            transition: color var(--transition-fast);
        }

        .detail-back-btn:hover {
            color: var(--text-primary);
        }

        .detail-card {
            background-color: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: var(--border-radius-xl);
            padding: var(--spacing-xl);
            margin-bottom: var(--spacing-xl);
        }

        .detail-row {
            display: flex;
            gap: var(--spacing-xl);
            margin-bottom: var(--spacing-lg);
        }

        .detail-row:last-child {
            margin-bottom: 0;
        }

        .detail-field {
            flex: 1;
        }

        .detail-label {
            font-size: var(--font-xs);
            font-weight: 500;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            color: var(--text-muted);
            margin-bottom: var(--spacing-xs);
        }

        .detail-value {
            font-size: var(--font-base);
            color: var(--text-primary);
        }

        .detail-value.mono {
            font-family: var(--font-mono);
        }

        .detail-notes-block {
            margin-top: var(--spacing-md);
            padding-top: var(--spacing-lg);
            border-top: 1px solid var(--border);
        }

        .detail-notes-text {
            font-size: var(--font-sm);
            color: var(--text-secondary);
            line-height: 1.6;
        }

        /* SME Notes */
        .sme-section {
            margin-top: var(--spacing-lg);
        }

        .sme-label {
            font-size: var(--font-sm);
            font-weight: 500;
            color: var(--text-secondary);
            margin-bottom: var(--spacing-sm);
        }

        .sme-textarea {
            width: 100%;
            min-height: 120px;
            padding: 14px 16px;
            font-family: var(--font-ui);
            font-size: var(--font-sm);
            color: var(--text-primary);
            background-color: var(--bg-input);
            border: 1px solid var(--border);
            border-radius: var(--border-radius-lg);
            resize: vertical;
            transition: border-color var(--transition-fast);
            line-height: 1.5;
        }

        .sme-textarea:focus {
            outline: none;
            border-color: var(--accent-primary);
        }

        .sme-actions {
            display: flex;
            justify-content: flex-end;
            gap: var(--spacing-sm);
            margin-top: var(--spacing-md);
        }

        .sme-save-btn {
            padding: 10px 24px;
            font-family: var(--font-ui);
            font-size: var(--font-sm);
            font-weight: 500;
            color: var(--bg-primary);
            background-color: var(--accent-primary);
            border: 1px solid var(--accent-primary);
            border-radius: var(--border-radius-md);
            cursor: pointer;
            transition: all var(--transition-fast);
        }

        .sme-save-btn:hover {
            opacity: 0.9;
        }

        .sme-save-btn:disabled {
            opacity: 0.4;
            cursor: not-allowed;
        }

        .sme-save-btn.saving {
            pointer-events: none;
            opacity: 0.6;
        }

        /* Toast */
        .fa-toast {
            position: fixed;
            bottom: var(--spacing-lg);
            right: var(--spacing-lg);
            padding: var(--spacing-md) var(--spacing-lg);
            background-color: var(--bg-card);
            border: 1px solid var(--state-success);
            border-radius: var(--border-radius-lg);
            color: var(--state-success);
            font-size: var(--font-sm);
            z-index: 2000;
            animation: slideUp 0.3s ease;
            display: none;
        }

        .fa-toast.error {
            border-color: var(--state-error);
            color: var(--state-error);
        }

        .fa-toast.show {
            display: block;
        }

        /* Loading */
        .fa-loading {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: var(--spacing-sm);
            padding: var(--spacing-xl);
            color: var(--text-muted);
            font-size: var(--font-sm);
        }

        .fa-spinner {
            width: 16px;
            height: 16px;
            border: 2px solid var(--border);
            border-top-color: var(--accent-primary);
            border-radius: 50%;
            animation: spin 0.8s linear infinite;
        }

        /* Empty State */
        .fa-empty {
            text-align: center;
            padding: var(--spacing-3xl);
            color: var(--text-muted);
        }

        .fa-empty-icon {
            font-size: 36px;
            margin-bottom: var(--spacing-md);
            opacity: 0.5;
        }

        .fa-empty-text {
            font-size: var(--font-sm);
        }

        /* Responsive */
        @media (max-width: 640px) {
            .detail-row {
                flex-direction: column;
                gap: var(--spacing-md);
            }

            .case-table td.notes-cell {
                max-width: 200px;
            }
        }
    </style>
<? } ?>

<? if (page === "queue"
) { ?>
    <!-- REPORTS QUEUE styles -->
<style>
        /* ReportsQueue-specific styles */
        .hidden {
            display: none !important;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
            }

            to {
                opacity: 1;
            }
        }

        @keyframes slideUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes spin {
            to {
                transform: rotate(360deg);
            }
        }

        .app {
            display: flex;
            flex-direction: column;
            height: 100vh;
        }

        .header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 12px 24px;
            background: var(--bg-secondary);
            border-bottom: 1px solid var(--border);
        }

        .header-left {
            display: flex;
            align-items: center;
            gap: 24px;
        }

        .logo {
            font-size: 24px;
            font-weight: 300;
            color: var(--accent-primary);
            letter-spacing: -2px;
            text-decoration: none;
        }

        .nav {
            display: flex;
            gap: 8px;
        }

        .nav-link {
            padding: 8px 16px;
            font-size: 13px;
            color: var(--text-secondary);
            text-decoration: none;
            border-radius: 6px;
            transition: all 150ms;
        }

        .nav-link:hover {
            color: var(--text-primary);
            background: var(--bg-elevated);
        }

        .nav-link.active {
            color: var(--text-primary);
            background: var(--bg-card);
            border: 1px solid var(--border);
        }

        .header-right {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .user-badge {
            font-size: 11px;
            color: var(--text-muted);
        }

        .icon-btn {
            width: 32px;
            height: 32px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--text-secondary);
            border-radius: 6px;
            cursor: pointer;
            transition: all 150ms;
            background: transparent;
            border: none;
            font-size: 16px;
        }

        .icon-btn:hover {
            background: var(--bg-elevated);
            color: var(--text-primary);
        }

        .main {
            flex: 1;
            padding: 24px;
            overflow-y: auto;
            animation: fadeIn 0.3s ease;
        }

        .stats {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 16px;
            margin-bottom: 24px;
        }

        .stat-card {
            padding: 20px;
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 8px;
            cursor: pointer;
            transition: all 150ms;
        }

        .stat-card:hover {
            border-color: var(--border-hover);
            transform: translateY(-2px);
        }

        .stat-card.active {
            border-color: var(--accent-primary);
            box-shadow: 0 0 20px rgba(230, 230, 230, 0.1);
        }

        .stat-label {
            font-size: 10px;
            color: var(--text-muted);
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 4px;
        }

        .stat-value {
            font-size: 28px;
            font-weight: 600;
            font-family: var(--font-data);
        }

        .stat-value.all {
            color: var(--text-primary);
        }

        .stat-value.pending {
            color: var(--state-pending);
        }

        .stat-value.accepted {
            color: var(--state-accepted);
        }

        .stat-value.rejected {
            color: var(--state-rejected);
        }

        .sub-filters {
            display: flex;
            gap: 8px;
            margin-bottom: 16px;
        }

        .sub-filter {
            padding: 6px 12px;
            font-size: 12px;
            color: var(--text-secondary);
            background: transparent;
            border: 1px solid var(--border);
            border-radius: 20px;
            cursor: pointer;
            transition: all 150ms;
        }

        .sub-filter:hover {
            border-color: var(--border-hover);
            color: var(--text-primary);
        }

        .sub-filter.active {
            background: var(--accent-primary);
            color: var(--bg-primary);
            border-color: var(--accent-primary);
        }

        .toolbar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 16px;
            flex-wrap: wrap;
            gap: 12px;
        }

        .filters-toggle {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 8px 12px;
            font-size: 12px;
            color: var(--text-muted);
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 6px;
            cursor: pointer;
        }

        .filters-toggle:hover {
            border-color: var(--border-hover);
            color: var(--text-secondary);
        }

        .bulk-actions {
            display: flex;
            gap: 8px;
        }

        .filters-bar {
            display: none;
            flex-wrap: wrap;
            gap: 12px;
            padding: 16px;
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 8px;
            margin-bottom: 16px;
        }

        .filters-bar.show {
            display: flex;
        }

        .filter-group {
            display: flex;
            flex-direction: column;
            gap: 4px;
        }

        .filter-label {
            font-size: 9px;
            color: var(--text-muted);
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .filter-select,
        .filter-input {
            padding: 6px 10px;
            font-size: 12px;
            font-family: var(--font-ui);
            color: var(--text-primary);
            background: var(--bg-elevated);
            border: 1px solid var(--border);
            border-radius: 4px;
            min-width: 120px;
        }

        .filter-input {
            min-width: 200px;
        }

        .reports-list {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .report-row {
            display: grid;
            grid-template-columns: 2fr 120px 100px 100px 80px;
            align-items: center;
            gap: 16px;
            padding: 16px;
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 8px;
            cursor: pointer;
            transition: all 150ms;
        }

        .report-row:hover {
            border-color: var(--border-hover);
        }

        .report-name {
            font-weight: 500;
            margin-bottom: 4px;
        }

        .report-desc {
            font-size: 12px;
            color: var(--text-muted);
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }

        .report-meta {
            font-size: 12px;
            color: var(--text-secondary);
        }

        .badge {
            display: inline-flex;
            padding: 4px 10px;
            font-size: 10px;
            font-weight: 600;
            text-transform: uppercase;
            border-radius: 4px;
        }

        .badge.pending {
            background: rgba(245, 158, 11, 0.15);
            color: var(--state-pending);
        }

        .badge.accepted {
            background: rgba(34, 197, 94, 0.15);
            color: var(--state-accepted);
        }

        .badge.rejected {
            background: rgba(239, 68, 68, 0.15);
            color: var(--state-rejected);
        }

        .badge.master {
            background: var(--bg-elevated);
            color: var(--accent-primary);
            border: 1px solid var(--border);
        }

        .badge.derived {
            background: var(--bg-elevated);
            color: var(--text-muted);
            border: 1px solid var(--border);
        }

        .loading {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 12px;
            padding: 48px;
            color: var(--text-muted);
        }

        .spinner {
            width: 20px;
            height: 20px;
            border: 2px solid var(--border);
            border-top-color: var(--accent-primary);
            border-radius: 50%;
            animation: spin 0.8s linear infinite;
        }

        .empty-state {
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 64px;
            color: var(--text-muted);
            text-align: center;
        }

        .empty-icon {
            font-size: 48px;
            margin-bottom: 16px;
            opacity: 0.5;
        }

        .modal-overlay {
            position: fixed;
            inset: 0;
            background: rgba(0, 0, 0, 0.85);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
        }

        .modal {
            width: 90%;
            max-width: 750px;
            max-height: 90vh;
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 12px;
            overflow: hidden;
            display: flex;
            flex-direction: column;
        }

        .modal-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 16px 24px;
            border-bottom: 1px solid var(--border);
        }

        .modal-title {
            font-size: 16px;
            font-weight: 500;
        }

        .modal-close {
            width: 32px;
            height: 32px;
            background: transparent;
            border: none;
            color: var(--text-muted);
            cursor: pointer;
            font-size: 20px;
            border-radius: 4px;
        }

        .modal-close:hover {
            background: var(--bg-elevated);
            color: var(--text-primary);
        }

        .modal-body {
            padding: 24px;
            overflow-y: auto;
            flex: 1;
        }

        .modal-footer {
            display: flex;
            justify-content: space-between;
            gap: 8px;
            padding: 16px 24px;
            border-top: 1px solid var(--border);
        }

        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 16px;
        }

        .form-group {
            margin-bottom: 16px;
        }

        .form-label {
            display: block;
            font-size: 10px;
            font-weight: 500;
            color: var(--text-secondary);
            margin-bottom: 6px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .form-input,
        .form-select,
        .form-textarea {
            width: 100%;
            padding: 10px 12px;
            font-family: var(--font-ui);
            font-size: 14px;
            color: var(--text-primary);
            background: var(--bg-elevated);
            border: 1px solid var(--border);
            border-radius: 6px;
        }

        .form-input:focus,
        .form-select:focus,
        .form-textarea:focus {
            outline: none;
            border-color: var(--accent-primary);
        }

        .form-textarea {
            min-height: 80px;
            resize: vertical;
        }

        .form-input[readonly] {
            background: var(--bg-secondary);
            color: var(--text-muted);
            cursor: not-allowed;
        }

        .user-picker-wrap {
            position: relative;
        }

        .user-picker-input {
            width: 100%;
            padding: 10px 12px;
            font-family: var(--font-ui);
            font-size: 14px;
            color: var(--text-primary);
            background: var(--bg-elevated);
            border: 1px solid var(--border);
            border-radius: 6px;
        }

        .user-picker-input:focus {
            outline: none;
            border-color: var(--accent-primary);
        }

        .user-picker-dropdown {
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            max-height: 200px;
            overflow-y: auto;
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 6px;
            z-index: 100;
            display: none;
        }

        .user-picker-dropdown.show {
            display: block;
        }

        .user-picker-item {
            padding: 10px 12px;
            font-size: 13px;
            color: var(--text-secondary);
            cursor: pointer;
            transition: background 100ms;
        }

        .user-picker-item:hover {
            background: var(--bg-elevated);
            color: var(--text-primary);
        }

        .user-picker-item .email {
            font-size: 11px;
            color: var(--text-muted);
            margin-left: 8px;
        }

        .btn {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            padding: 10px 18px;
            font-family: var(--font-ui);
            font-size: 13px;
            font-weight: 500;
            border-radius: 6px;
            border: 1px solid var(--border);
            cursor: pointer;
            background: transparent;
            color: var(--text-primary);
            transition: all 150ms;
        }

        .btn:hover {
            border-color: var(--border-hover);
            background: var(--bg-elevated);
        }

        .btn-primary {
            background: var(--accent-primary);
            color: var(--bg-primary);
            border-color: var(--accent-primary);
        }

        .btn-primary:hover {
            opacity: 0.9;
        }

        .btn-success {
            background: var(--state-accepted);
            color: var(--bg-primary);
            border-color: var(--state-accepted);
        }

        .btn-danger {
            border-color: var(--state-rejected);
            color: var(--state-rejected);
        }

        .btn-sm {
            padding: 6px 12px;
            font-size: 12px;
        }

        .raci-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 12px;
            margin: 16px 0;
        }

        .raci-item {
            padding: 12px;
            background: var(--bg-elevated);
            border: 1px solid var(--border);
            border-radius: 6px;
        }

        .raci-role {
            font-size: 9px;
            color: var(--text-muted);
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 4px;
        }

        .raci-value {
            font-size: 13px;
            font-weight: 500;
            color: var(--text-primary);
        }

        .storage-link {
            display: block;
            padding: 16px;
            background: var(--bg-elevated);
            border: 1px solid var(--border);
            border-radius: 8px;
            margin-bottom: 20px;
            text-decoration: none;
            transition: all 150ms;
        }

        .storage-link:hover {
            border-color: var(--accent-primary);
        }

        .storage-link-label {
            font-size: 9px;
            color: var(--text-muted);
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 6px;
        }

        .storage-link-url {
            font-size: 14px;
            color: var(--accent-primary);
            word-break: break-all;
        }

        .storage-link-icon {
            font-size: 20px;
            float: right;
        }

        .timeline {
            margin: 20px 0;
        }

        .timeline-item {
            display: flex;
            gap: 12px;
            padding: 12px 0;
            border-left: 2px solid var(--border);
            margin-left: 8px;
            padding-left: 20px;
            position: relative;
        }

        .timeline-item::before {
            content: '';
            position: absolute;
            left: -5px;
            top: 16px;
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: var(--border);
        }

        .timeline-item.approve::before {
            background: var(--state-accepted);
        }

        .timeline-item.reject::before {
            background: var(--state-rejected);
        }

        .timeline-item.comment::before {
            background: var(--state-pending);
        }

        .timeline-content {
            flex: 1;
        }

        .timeline-user {
            font-size: 13px;
            font-weight: 500;
            color: var(--text-primary);
        }

        .timeline-action {
            font-size: 12px;
            color: var(--text-secondary);
        }

        .timeline-time {
            font-size: 11px;
            color: var(--text-muted);
        }

        .comments-section {
            margin-top: 20px;
            padding-top: 20px;
            border-top: 1px solid var(--border);
        }

        .comment {
            padding: 12px;
            background: var(--bg-elevated);
            border-radius: 6px;
            margin-bottom: 8px;
        }

        .comment-header {
            display: flex;
            justify-content: space-between;
            margin-bottom: 6px;
        }

        .comment-user {
            font-size: 12px;
            font-weight: 500;
            color: var(--text-primary);
        }

        .comment-time {
            font-size: 11px;
            color: var(--text-muted);
        }

        .comment-text {
            font-size: 13px;
            color: var(--text-secondary);
        }

        .comment-form {
            display: flex;
            gap: 8px;
            margin-top: 12px;
        }

        .comment-input {
            flex: 1;
            padding: 10px;
            font-family: var(--font-ui);
            font-size: 13px;
            color: var(--text-primary);
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 6px;
        }

        .toast {
            position: fixed;
            bottom: 24px;
            right: 24px;
            padding: 12px 20px;
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 8px;
            color: var(--text-primary);
            font-size: 13px;
            z-index: 2000;
            animation: slideUp 0.3s ease;
        }

        .toast.success {
            border-color: var(--state-accepted);
        }

        .toast.error {
            border-color: var(--state-rejected);
        }

        .fab {
            position: fixed;
            bottom: 24px;
            right: 24px;
        }

        @media (max-width: 768px) {
            .stats {
                grid-template-columns: repeat(2, 1fr);
            }

            .report-row {
                grid-template-columns: 1fr;
                gap: 8px;
            }

            .form-row {
                grid-template-columns: 1fr;
            }

            .raci-grid {
                grid-template-columns: repeat(2, 1fr);
            }
        }
    </style>
<? } ?>

<? if (page === "dashboard"
) { ?>
    <!-- DASHBOARD styles -->
<style>
        /* Dashboard-specific styles */
        .hidden {
            display: none !important;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
            }

            to {
                opacity: 1;
            }
        }

        @keyframes spin {
            to {
                transform: rotate(360deg);
            }
        }

        .app {
            display: flex;
            flex-direction: column;
            height: 100vh;
        }

        .header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 12px 24px;
            background: var(--bg-secondary);
            border-bottom: 1px solid var(--border);
        }

        .header-left {
            display: flex;
            align-items: center;
            gap: 24px;
        }

        .logo {
            font-size: 24px;
            font-weight: 300;
            color: var(--accent-primary);
            letter-spacing: -2px;
            text-decoration: none;
        }

        .nav {
            display: flex;
            gap: 8px;
        }

        .nav-link {
            padding: 8px 16px;
            font-size: 13px;
            color: var(--text-secondary);
            text-decoration: none;
            border-radius: 6px;
            transition: all 150ms;
        }

        .nav-link:hover {
            color: var(--text-primary);
            background: var(--bg-elevated);
        }

        .nav-link.active {
            color: var(--text-primary);
            background: var(--bg-card);
            border: 1px solid var(--border);
        }

        .header-right {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .user-badge {
            font-size: 11px;
            color: var(--text-muted);
        }

        .admin-badge {
            font-size: 9px;
            padding: 2px 6px;
            background: var(--state-accepted);
            color: #000;
            border-radius: 3px;
            font-weight: 600;
        }

        .icon-btn {
            width: 32px;
            height: 32px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--text-secondary);
            border-radius: 6px;
            cursor: pointer;
            transition: all 150ms;
            background: transparent;
            border: none;
            font-size: 16px;
        }

        .icon-btn:hover {
            background: var(--bg-elevated);
            color: var(--text-primary);
        }

        .main {
            flex: 1;
            padding: 24px;
            overflow-y: auto;
            animation: fadeIn 0.3s ease;
        }

        .page-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 24px;
            flex-wrap: wrap;
            gap: 16px;
        }

        .page-title {
            font-size: 20px;
            font-weight: 500;
        }

        .filters-bar {
            display: flex;
            gap: 12px;
            flex-wrap: wrap;
        }

        .filter-group {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .filter-label {
            font-size: 11px;
            color: var(--text-muted);
            text-transform: uppercase;
        }

        .filter-select {
            padding: 8px 12px;
            font-size: 12px;
            font-family: var(--font-ui);
            color: var(--text-primary);
            background: var(--bg-elevated);
            border: 1px solid var(--border);
            border-radius: 6px;
            min-width: 140px;
        }

        .filter-select:focus {
            outline: none;
            border-color: var(--accent-primary);
        }

        .btn {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            padding: 8px 14px;
            font-family: var(--font-ui);
            font-size: 12px;
            font-weight: 500;
            border-radius: 6px;
            border: 1px solid var(--border);
            cursor: pointer;
            background: transparent;
            color: var(--text-primary);
            transition: all 150ms;
        }

        .btn:hover {
            border-color: var(--border-hover);
            background: var(--bg-elevated);
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 16px;
            margin-bottom: 32px;
        }

        .stat-box {
            padding: 24px;
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 8px;
            text-align: center;
            cursor: pointer;
            transition: all 150ms;
        }

        .stat-box:hover {
            border-color: var(--border-hover);
        }

        .stat-box.active {
            border-color: var(--accent-primary);
        }

        .stat-number {
            font-size: 40px;
            font-weight: 600;
            font-family: var(--font-data);
        }

        .stat-number.all {
            color: var(--text-primary);
        }

        .stat-number.pending {
            color: var(--state-pending);
        }

        .stat-number.accepted {
            color: var(--state-accepted);
        }

        .stat-number.rejected {
            color: var(--state-rejected);
        }

        .stat-label {
            font-size: 11px;
            color: var(--text-muted);
            text-transform: uppercase;
            margin-top: 8px;
            letter-spacing: 0.5px;
        }

        .charts-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 24px;
        }

        .chart-card {
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 8px;
            padding: 24px;
        }

        .chart-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 16px;
        }

        .chart-title {
            font-size: 14px;
            font-weight: 500;
            color: var(--text-secondary);
        }

        .chart-container {
            height: 280px;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-direction: column;
        }

        .loading {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 12px;
            padding: 32px;
            color: var(--text-muted);
        }

        .spinner {
            width: 20px;
            height: 20px;
            border: 2px solid var(--border);
            border-top-color: var(--accent-primary);
            border-radius: 50%;
            animation: spin 0.8s linear infinite;
        }

        @media (max-width: 768px) {
            .stats-grid {
                grid-template-columns: repeat(2, 1fr);
            }

            .charts-grid {
                grid-template-columns: 1fr;
            }

            .page-header {
                flex-direction: column;
                align-items: flex-start;
            }
        }
    </style>
<? } ?>

<? if (page === "admin"
) { ?>
    <!-- ADMIN PANEL styles -->
<style>
        /* AdminPanel-specific styles */
        .hidden {
            display: none !important;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
            }

            to {
                opacity: 1;
            }
        }

        @keyframes slideUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes spin {
            to {
                transform: rotate(360deg);
            }
        }

        .app {
            display: flex;
            flex-direction: column;
            height: 100vh;
        }

        .header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 12px 24px;
            background: var(--bg-secondary);
            border-bottom: 1px solid var(--border);
        }

        .header-left {
            display: flex;
            align-items: center;
            gap: 24px;
        }

        .logo {
            font-size: 24px;
            font-weight: 300;
            color: var(--accent-primary);
            letter-spacing: -2px;
            text-decoration: none;
        }

        .nav {
            display: flex;
            gap: 8px;
        }

        .nav-link {
            padding: 8px 16px;
            font-size: 13px;
            color: var(--text-secondary);
            text-decoration: none;
            border-radius: 6px;
            transition: all 150ms;
        }

        .nav-link:hover {
            color: var(--text-primary);
            background: var(--bg-elevated);
        }

        .nav-link.active {
            color: var(--text-primary);
            background: var(--bg-card);
            border: 1px solid var(--border);
        }

        .header-right {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .user-badge {
            font-size: 11px;
            color: var(--text-muted);
        }

        .admin-badge {
            font-size: 9px;
            padding: 2px 6px;
            background: var(--state-accepted);
            color: #000;
            border-radius: 3px;
            font-weight: 600;
        }

        .icon-btn {
            width: 32px;
            height: 32px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--text-secondary);
            border-radius: 6px;
            cursor: pointer;
            transition: all 150ms;
            background: transparent;
            border: none;
            font-size: 16px;
        }

        .icon-btn:hover {
            background: var(--bg-elevated);
            color: var(--text-primary);
        }

        .main {
            flex: 1;
            padding: 24px;
            overflow-y: auto;
            animation: fadeIn 0.3s ease;
        }

        .section {
            margin-bottom: 32px;
        }

        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 16px;
        }

        .section-title {
            font-size: 14px;
            font-weight: 500;
            color: var(--text-secondary);
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .actions-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            gap: 12px;
        }

        .action-card {
            padding: 16px;
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 8px;
            cursor: pointer;
            transition: all 150ms;
        }

        .action-card:hover {
            border-color: var(--border-hover);
            transform: translateY(-2px);
        }

        .action-card h3 {
            font-size: 13px;
            font-weight: 500;
            margin-bottom: 4px;
        }

        .action-card p {
            font-size: 11px;
            color: var(--text-muted);
        }

        .card {
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 8px;
            padding: 20px;
        }

        .card-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 16px;
        }

        .card-title {
            font-size: 14px;
            font-weight: 500;
        }

        .add-user-btn {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            padding: 8px 14px;
            font-size: 12px;
            font-weight: 500;
            color: var(--text-primary);
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 6px;
            cursor: pointer;
            transition: all 150ms;
        }

        .add-user-btn:hover {
            border-color: var(--border-hover);
            background: var(--bg-elevated);
        }

        .add-user-form {
            display: none;
            padding: 16px;
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 8px;
            margin-bottom: 16px;
        }

        .add-user-form.show {
            display: block;
        }

        .form-row {
            display: flex;
            gap: 12px;
            align-items: end;
            flex-wrap: wrap;
        }

        .form-group {
            display: flex;
            flex-direction: column;
            gap: 4px;
            flex: 1;
            min-width: 150px;
        }

        .form-label {
            font-size: 10px;
            color: var(--text-muted);
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .form-input {
            padding: 10px 12px;
            font-family: var(--font-ui);
            font-size: 14px;
            color: var(--text-primary);
            background: var(--bg-elevated);
            border: 1px solid var(--border);
            border-radius: 6px;
        }

        .form-input:focus {
            outline: none;
            border-color: var(--accent-primary);
        }

        .btn {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            padding: 10px 18px;
            font-family: var(--font-ui);
            font-size: 13px;
            font-weight: 500;
            border-radius: 6px;
            border: 1px solid var(--border);
            cursor: pointer;
            background: transparent;
            color: var(--text-primary);
            transition: all 150ms;
        }

        .btn:hover {
            border-color: var(--border-hover);
            background: var(--bg-elevated);
        }

        .btn-primary {
            background: var(--accent-primary);
            color: var(--bg-primary);
            border-color: var(--accent-primary);
        }

        .btn-danger {
            border-color: var(--state-rejected);
            color: var(--state-rejected);
        }

        .btn-sm {
            padding: 6px 12px;
            font-size: 12px;
        }

        .users-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 16px;
        }

        .users-table th,
        .users-table td {
            padding: 10px 12px;
            text-align: left;
            border-bottom: 1px solid var(--border);
        }

        .users-table th {
            font-size: 10px;
            font-weight: 500;
            color: var(--text-muted);
            text-transform: uppercase;
            letter-spacing: 0.5px;
            background: var(--bg-secondary);
        }

        .users-table td {
            font-size: 13px;
            color: var(--text-secondary);
        }

        .users-table tr:hover td {
            background: var(--bg-elevated);
        }

        .users-table .email {
            font-family: var(--font-data);
            font-size: 12px;
        }

        .status-badge {
            padding: 2px 8px;
            font-size: 10px;
            font-weight: 600;
            border-radius: 10px;
        }

        .status-badge.active {
            background: rgba(34, 197, 94, 0.15);
            color: var(--state-accepted);
        }

        .status-badge.inactive {
            background: rgba(239, 68, 68, 0.15);
            color: var(--state-rejected);
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 16px;
            margin-bottom: 24px;
        }

        .stat-box {
            padding: 20px;
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 8px;
            text-align: center;
        }

        .stat-number {
            font-size: 32px;
            font-weight: 600;
            font-family: var(--font-data);
            color: var(--text-primary);
        }

        .stat-label {
            font-size: 10px;
            color: var(--text-muted);
            text-transform: uppercase;
            margin-top: 4px;
        }

        .audit-wrap {
            max-height: 400px;
            overflow-y: auto;
        }

        .audit-table {
            width: 100%;
            border-collapse: collapse;
            font-size: 12px;
        }

        .audit-table th,
        .audit-table td {
            padding: 8px 10px;
            text-align: left;
            border-bottom: 1px solid var(--border);
        }

        .audit-table th {
            font-size: 10px;
            font-weight: 500;
            color: var(--text-muted);
            text-transform: uppercase;
            background: var(--bg-secondary);
            position: sticky;
            top: 0;
        }

        .audit-table td {
            color: var(--text-secondary);
            font-family: var(--font-data);
        }

        .action-badge {
            padding: 3px 8px;
            font-size: 9px;
            font-weight: 600;
            text-transform: uppercase;
            border-radius: 3px;
        }

        .action-badge.create,
        .action-badge.approve,
        .action-badge.activate {
            background: rgba(34, 197, 94, 0.15);
            color: var(--state-accepted);
        }

        .action-badge.reject,
        .action-badge.delete,
        .action-badge.deactivate {
            background: rgba(239, 68, 68, 0.15);
            color: var(--state-rejected);
        }

        .action-badge.update,
        .action-badge.state_change,
        .action-badge.comment {
            background: rgba(245, 158, 11, 0.15);
            color: var(--state-pending);
        }

        .action-badge.export {
            background: var(--bg-elevated);
            color: var(--text-secondary);
        }

        .toast {
            position: fixed;
            bottom: 24px;
            right: 24px;
            padding: 12px 20px;
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 8px;
            color: var(--text-primary);
            font-size: 13px;
            z-index: 2000;
            animation: slideUp 0.3s ease;
        }

        .toast.success {
            border-color: var(--state-accepted);
        }

        .toast.error {
            border-color: var(--state-rejected);
        }

        .loading {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 12px;
            padding: 32px;
            color: var(--text-muted);
        }

        .spinner {
            width: 20px;
            height: 20px;
            border: 2px solid var(--border);
            border-top-color: var(--accent-primary);
            border-radius: 50%;
            animation: spin 0.8s linear infinite;
        }

        .empty-state {
            padding: 32px;
            text-align: center;
            color: var(--text-muted);
        }

        @media (max-width: 768px) {
            .form-row {
                flex-direction: column;
            }

            .actions-grid {
                grid-template-columns: 1fr;
            }

            .stats-grid {
                grid-template-columns: repeat(2, 1fr);
            }
        }
    </style>
<? } ?>

<? if (page === "about"
    || page === "privacy" || page === "data-retention"
) { ?>
    <!-- INFO PAGE (About/Privacy/Data Retention) styles -->
<style>
        /* InfoPage-specific overrides */
        html,
        body {
            height: auto;
            overflow: auto;
        }

        .container {
            max-width: 720px;
            margin: 0 auto;
            padding: 80px 24px;
            min-height: 100vh;
        }

        .logo {
            font-size: 48px;
            font-weight: 300;
            color: var(--accent-primary);
            margin-bottom: 48px;
            letter-spacing: -2px;
            text-decoration: none;
            display: inline-block;
        }

        .title {
            font-size: 24px;
            font-weight: 500;
            color: var(--text-primary);
            margin-bottom: 8px;
        }

        .updated {
            font-size: 12px;
            color: var(--text-muted);
            margin-bottom: 32px;
        }

        .section {
            margin-bottom: 32px;
        }

        .section h2 {
            font-size: 14px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 1px;
            color: var(--text-secondary);
            margin-bottom: 12px;
        }

        .section p {
            color: var(--text-primary);
            line-height: 1.7;
            margin-bottom: 12px;
        }

        .section ul {
            list-style: none;
            padding: 0;
        }

        .section li {
            color: var(--text-primary);
            line-height: 1.7;
            margin-bottom: 8px;
            padding-left: 16px;
            position: relative;
        }

        .section li::before {
            content: "‚Ä¢";
            color: var(--text-muted);
            position: absolute;
            left: 0;
        }

        .module-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 16px;
            margin: 24px 0;
        }

        .module-card {
            padding: 20px;
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 8px;
            text-align: center;
        }

        .module-icon {
            font-size: 32px;
            margin-bottom: 8px;
        }

        .module-name {
            font-size: 13px;
            font-weight: 500;
            color: var(--text-primary);
        }

        .module-desc {
            font-size: 11px;
            color: var(--text-muted);
            margin-top: 4px;
        }

        .creator {
            padding: 24px;
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 8px;
            margin-top: 32px;
        }

        .creator-name {
            font-size: 18px;
            font-weight: 500;
            color: var(--text-primary);
            margin-bottom: 4px;
        }

        .creator-role {
            font-size: 13px;
            color: var(--text-secondary);
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
        }

        th,
        td {
            padding: 12px 16px;
            text-align: left;
            border: 1px solid var(--border);
        }

        th {
            background: var(--bg-card);
            color: var(--text-secondary);
            font-size: 11px;
            text-transform: uppercase;
            font-weight: 600;
        }

        td {
            color: var(--text-primary);
            font-size: 13px;
        }

        .back-link {
            display: inline-block;
            margin-top: 48px;
            color: var(--text-muted);
            text-decoration: none;
            font-size: 13px;
        }

        .back-link:hover {
            color: var(--text-primary);
        }
    </style>
<? } ?>

</head>
<body>

<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
     HOME PAGE
     ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<? if (page === "home") { ?>
<!-- Global Theme -->

<div class="home-container">
        <button class="theme-toggle" onclick="Theme.toggle()" title="Toggle theme"
                aria-label="Toggle dark/light mode">
                <svg class="icon-sun" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <circle cx="12" cy="12" r="5" />
                    <path
                        d="M12 1v2M12 21v2M4.22 4.22l1.42 1.42M18.36 18.36l1.42 1.42M1 12h2M21 12h2M4.22 19.78l1.42-1.42M18.36 5.64l1.42-1.42" />
                </svg>
                <svg class="icon-moon" viewBox="0 0 24 24" fill="currentColor">
                    <path
                        d="M21.752 15.002A9.718 9.718 0 0118 15.75c-5.385 0-9.75-4.365-9.75-9.75 0-1.33.266-2.597.748-3.752A9.753 9.753 0 003 11.25C3 16.635 7.365 21 12.75 21a9.753 9.753 0 009.002-5.998z" />
                </svg>
            </button>
            <div class="home-logo">√ò</div>
            <h1 class="home-title">Master System</h1>
            <p class="home-subtitle">Unified Enterprise Operations Platform</p>
            <p class="home-user">Signed in as
                <?= user ?>
            </p>
        </header>

        <div class="modules-grid">
            <a class="module-card active" href="<?= ScriptApp.getService().getUrl() ?>?page=cb">
                <div class="module-icon">üìã</div>
                <div class="module-name">Chargeback</div>
                <div class="module-id">CB</div>
                <span class="module-status active">Active</span>
            </a>

            <div class="module-card disabled">
                <div class="module-icon">‚úÖ</div>
                <div class="module-name">Chargeback QA</div>
                <div class="module-id">CBQA</div>
                <span class="module-status coming">Coming Soon</span>
            </div>

            <a class="module-card active" href="<?= ScriptApp.getService().getUrl() ?>?page=fa">
                <div class="module-icon">üîç</div>
                <div class="module-name">FA Coaching</div>
                <div class="module-id">FA</div>
                <span class="module-status active">Active</span>
            </a>

            <div class="module-card disabled">
                <div class="module-icon">üìä</div>
                <div class="module-name">Fraud Analysis QA</div>
                <div class="module-id">FAQA</div>
                <span class="module-status coming">Coming Soon</span>
            </div>

            <a class="module-card active" href="<?= ScriptApp.getService().getUrl() ?>?page=queue">
                <div class="module-icon">üìà</div>
                <div class="module-name">Reporting</div>
                <div class="module-id">RT</div>
                <span class="module-status active">Active</span>
            </a>

            <div class="module-card disabled">
                <div class="module-icon">üìÅ</div>
                <div class="module-name">Operations</div>
                <div class="module-id">ON</div>
                <span class="module-status coming">Coming Soon</span>
            </div>
        </div>

        <footer class="home-footer">
            <a href="<?= ScriptApp.getService().getUrl() ?>?page=about">About</a>
            <a href="<?= ScriptApp.getService().getUrl() ?>?page=privacy">Privacy Policy</a>
            <a href="<?= ScriptApp.getService().getUrl() ?>?page=data-retention">Data Retention</a>
        </footer>
    </div>

<? } ?>

<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
     CHARGEBACK MODULE SELECTOR
     ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<? if (page === "cb") { ?>
<!-- Global Theme -->

<div class="cb-container">
        <button class="theme-toggle" onclick="Theme.toggle()" title="Toggle theme"
                aria-label="Toggle dark/light mode">
                <svg class="icon-sun" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <circle cx="12" cy="12" r="5" />
                    <path
                        d="M12 1v2M12 21v2M4.22 4.22l1.42 1.42M18.36 18.36l1.42 1.42M1 12h2M21 12h2M4.22 19.78l1.42-1.42M18.36 5.64l1.42-1.42" />
                </svg>
                <svg class="icon-moon" viewBox="0 0 24 24" fill="currentColor">
                    <path
                        d="M21.752 15.002A9.718 9.718 0 0118 15.75c-5.385 0-9.75-4.365-9.75-9.75 0-1.33.266-2.597.748-3.752A9.753 9.753 0 003 11.25C3 16.635 7.365 21 12.75 21a9.753 9.753 0 009.002-5.998z" />
                </svg>
            </button>
            <a class="cb-back-link" href="<?= ScriptApp.getService().getUrl() ?>">‚Üê Back to Home</a>
            <div class="cb-logo">üìã</div>
            <h1 class="cb-title">Chargeback Module</h1>
            <p class="cb-subtitle">RCA Management, Representation & Analytics</p>
        </header>

        <div class="cb-modules-grid">
            <a class="cb-module-card" href="<?= ScriptApp.getService().getUrl() ?>?page=rca">
                <div class="cb-module-icon">üìù</div>
                <div class="cb-module-name">Rebuttal Engine</div>
                <div class="cb-module-desc">Case research & rebuttal workflow</div>
            </a>

            <a class="cb-module-card" href="<?= ScriptApp.getService().getUrl() ?>?page=rep">
                <div class="cb-module-icon">üìÅ</div>
                <div class="cb-module-name">Representation Manager</div>
                <div class="cb-module-desc">Case representation & submission</div>
            </a>

            <a class="cb-module-card" href="<?= ScriptApp.getService().getUrl() ?>?page=email-confirm">
                <div class="cb-module-icon">üìß</div>
                <div class="cb-module-name">Email Confirmations</div>
                <div class="cb-module-desc">Upload email confirmation documents</div>
            </a>

            <? if (isAdmin) { ?>
            <a class="cb-module-card admin-only" href="<?= ScriptApp.getService().getUrl() ?>?page=cbq">
                <div class="cb-module-icon">üìä</div>
                <div class="cb-module-name">Word Analyser</div>
                <div class="cb-module-desc">AI-powered text analytics</div>
                <span class="admin-badge">Admin Only</span>
            </a>
            <? } ?>
        </div>
    </div>

<? } ?>

<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
     REBUTTAL ENGINE (includes RCAPartials)
     ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<? if (page === "rca") { ?>
<!--
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
RCA MANAGER v3 - PREMIUM UI
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
Modernized interface with dark/light theme, admin panel, keyboard shortcuts,
and all original functionality preserved.
-->

<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
       HEADER / NAVIGATION BAR
       ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
    <div style="display:flex;align-items:center;gap:16px;">
            <a href="<?= ScriptApp.getService().getUrl() ?>"
                style="font-size:32px;color:#f5f5f5;text-decoration:none;">√ò</a>
            <h1>REBUTTAL ENGINE</h1>
        </div>

        <div class="header-controls">
            <p id="status"></p>

            <button id="themeToggle" class="theme-toggle" onclick="toggleTheme()">
                üåô Dark
            </button>

            <button id="adminBtn" class="hidden" onclick="toggleAdminPanel()">
                ‚öôÔ∏è Admin
            </button>

            <span class="user-info"></span>
        </div>
    </header>

    <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
       MAIN CONTAINER (3-COLUMN LAYOUT)
       ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
    <div class="container">

        <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
         LEFT SECTION: Case Retrieval & Info
         ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
        <div class="left-section">

            <!-- Get Case Section -->
            <div class="section-header" onclick="toggleSection('section1')">Get Case</div>
            <div class="section-content" id="section1">

                <!-- Portal Selection (hidden - auto-detect from queue) -->
                <input type="hidden" id="portal" value="">

                <!-- Break Mode Toggle -->
                <div
                    style="display:flex;align-items:center;gap:8px;margin-top:10px;padding:8px;background:var(--bg-card);border:1px solid var(--border);border-radius:4px;">
                    <label class="toggle-switch" title="Enable break mode - don't auto-fetch next case after resolve"
                        style="margin:0;">
                        <input type="checkbox" id="breakMode">
                        <span class="toggle-slider"></span>
                    </label>
                    <span style="font-size:12px;color:var(--text-secondary);">‚òï Break Mode</span>
                </div>
                <br>

                <!-- ITN Search -->
                <input type="text" id="confirmation-number" placeholder="Enter ITN to search...">
                <br><br>

                <button class="primary" onclick="getCase()">Get Case</button>
            </div>

            <!-- Case Info Section -->
            <div class="section-header active" onclick="toggleSection('section2')">Case Info</div>
            <div class="section-content" id="section2">
                <table id="caseinfo">
                    <tr>
                        <td class="label">Row</td>
                        <td class="data" id="cId"></td>
                    </tr>
                    <tr>
                        <td class="label">Case ID</td>
                        <td class="data mono" id="caseid" onclick="copyToClipboard('caseid')"></td>
                    </tr>
                    <tr>
                        <td class="label">Merchant Order #</td>
                        <td class="data mono" id="itn" onclick="copyToClipboard('itn')"></td>
                    </tr>
                    <tr>
                        <td class="label">Reservation #</td>
                        <td class="data mono" id="rnum" onclick="copyToClipboard('rnum')"></td>
                    </tr>
                    <tr>
                        <td class="label">Reason Code</td>
                        <td class="data"></td>
                    </tr>
                    <tr>
                        <td class="label">Dispute Amount</td>
                        <td class="data mono"></td>
                    </tr>
                    <tr>
                        <td class="label">Dispute Type</td>
                        <td class="data"></td>
                    </tr>
                    <tr>
                        <td class="label">Refund Amount <span class="action-icons" onclick="editCell(this)">‚úèÔ∏è</span>
                        </td>
                        <td class="data mono"></td>
                    </tr>
                    <tr>
                        <td class="label">Trans Amount</td>
                        <td class="data mono"></td>
                    </tr>
                    <tr>
                        <td class="label">Currency</td>
                        <td class="data"></td>
                    </tr>
                    <tr>
                        <td class="label">Dispute Date</td>
                        <td class="data mono"></td>
                    </tr>
                    <tr>
                        <td class="label">Due Date</td>
                        <td class="data mono"></td>
                    </tr>
                    <tr>
                        <td class="label">Portal</td>
                        <td class="data" id="alink"></td>
                    </tr>
                    <tr>
                        <td class="data" id="policy" colspan="2"
                            style="font-size:11px;font-weight:600;color:var(--text-primary);"></td>
                    </tr>
                </table>
            </div>

            <!-- Transaction Info Section -->
            <div class="section-header" onclick="toggleSection('section3')">Transaction Info</div>
            <div class="section-content hidden" id="section3">
                <button onclick="getInfo()">Get Info</button>
                <table id="transInfo">
                    <tr>
                        <td class="label">Row</td>
                        <td class="data" id="tId"></td>
                    </tr>
                    <tr>
                        <td class="label">Merchant Order #</td>
                        <td class="data mono" id="itn2" onclick="copyToClipboard('itn2')"></td>
                    </tr>
                    <tr>
                        <td class="label">Booking Date</td>
                        <td class="data mono"></td>
                    </tr>
                    <tr style="display:none">
                        <td class="label">Hotel Name</td>
                        <td class="data" id="hotel" onclick="copyToClipboard('hotel')"></td>
                    </tr>
                    <tr style="display:none">
                        <td class="label">Guest Name</td>
                        <td class="data"></td>
                    </tr>
                    <tr>
                        <td class="label">Check In</td>
                        <td class="data mono"></td>
                    </tr>
                    <tr style="display:none">
                        <td class="label">Check Out</td>
                        <td class="data mono"></td>
                    </tr>
                    <tr style="display:none">
                        <td class="label">Customer Email</td>
                        <td class="data"></td>
                    </tr>
                    <tr>
                        <td class="label">Room Type <span class="action-icons" onclick="editCell(this)">‚úèÔ∏è</span></td>
                        <td class="data"></td>
                    </tr>
                </table>
            </div>

            <!-- Canned Responses Section -->
            <div class="section-header" onclick="toggleSection('section4')">Canned Responses</div>
            <div class="section-content hidden" id="section4">
                <button onclick="getBookingData()">üìÑ Booking Data</button><br>
                <button
                    onclick="addCannedResponse('The customer was issued a full refund on [date] in the amount [amount currency] with ARN # [ARN]')">Fully
                    Refunded</button><br>
                <button
                    onclick="addCannedResponse('The reservation was made online through our website by the cardholder and all information was entered by the cardholder including check in/check out dates, hotel name, location, city, state, country, room types, number of persons booked, charges. The cardholder booked the reservation having first agreed to the full transaction amount, cancellation policy, and clicked the box agreeing to the terms and conditions (T&C) at the time of booking before their card was charged and the card holder was sent confirmation mail in regards to the same.')">Online
                    Reservation</button><br>
                <button
                    onclick="addCannedResponse('The guest had agreed to the reservation as well as the terms and conditions of the reservations prior to accepting/confirming his/her payment to us. In addition, upon completion of the booking, an electronic copy of the itinerary was sent via email to the email address that was provided during the booking process. Customer was made aware of and agreed to the cancellation policy prior to confirming the booking. Please see included documents supporting that cardholder is not due a credit.')">Call
                    Center</button><br>
                <button
                    onclick="addCannedResponse('No contact was received via Priceline customer service phone line or via Travel Agent site, as required per the attached cancellation policy (T&C Sec 28) prior to filing a chargeback.')">No
                    Contact</button><br>
                <button
                    onclick="addCannedResponse('Please be advised that Travel Agent retains the right to cancel any travel reservation in the event of a chargeback related to that reservation. Cardholder\'s chargeback is an erroneous attempt to circumvent contract the customer entered when agreeing to the Terms and Conditions (T&C) #6 before his card was charged. Priceline retains the right to dispute any chargeback that it believes is improper and retains the right to investigate and rebut any such chargeback claims and to recover costs of such chargeback claims from the cardholder.')">Fraud
                    No Penalty</button><br>
                <button
                    onclick="addCannedResponse('In order to secure the waiver, we contacted the hotel on XXXXXX CST and spoke to XXXXXX from the XXXXXX for the refund but the same was denied and our card was charged. No refund is due.')">Waiver
                    Denied</button><br>
                <br>
                <button onclick="showCannedModal()">üìã Manage Responses</button>
            </div>
        </div>

        <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
         MIDDLE SECTION: RCA & Response Editor
         ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
        <div class="middle-section">

            <!-- RCA Selection -->
            <div class="rca-section">
                <input list="rcas" id="rca" placeholder="Select or type RCA..." style="flex:1">
                <label class="toggle-switch" title="Auto-fill response">
                    <input type="checkbox" id="getRes?">
                    <span class="toggle-slider"></span>
                </label>
                <datalist id="rcas">
                    <option value="">Select RCA</option>
                    <option value="Customer - Cancel policy dispute/Non Refundable">Customer - Cancel policy dispute/Non
                        Refundable</option>
                    <option value="Risk - Fraudulent Transaction">Risk - Fraudulent Transaction</option>
                    <option value="Customer - Cancel policy dispute">Customer - Cancel policy dispute</option>
                    <option value="No Reservation (No Wex)">No Reservation (No Wex)</option>
                    <option value="Customer - Taxes and Fees">Customer - Taxes and Fees</option>
                    <option value="Manual Response">Manual Response</option>
                    <option value="Customer - Cancel policy dispute (No Contact / Confirmed)">Customer - Cancel policy
                        dispute (No Contact / Confirmed)</option>
                    <option value="Chargeback Accepted">Chargeback Accepted</option>
                    <option value="No Reservation (with WEX)">No Reservation (with WEX)</option>
                    <option value="Cancellation/Tax & Recovery (attempt to cancel)">Cancellation/Tax & Recovery (attempt
                        to cancel)</option>
                    <option value="Duplicate bill w/ GAR ARN">Duplicate bill w/ GAR ARN</option>
                    <option value="Hotel - Unsatisfactory">Hotel - Unsatisfactory</option>
                    <option value="No Reservation (Cancelled)">No Reservation (Cancelled)</option>
                    <option value="Customer - Cancel Penalty Dispute/Early Checkout">Customer - Cancel Penalty
                        Dispute/Early Checkout</option>
                    <option value="Hotel - Hotel Billed Direct (Wex not charged/Direct Bill)">Hotel - Hotel Billed
                        Direct (Wex not charged/Direct Bill)</option>
                    <option value="Cancellation/Tax & Recovery (No attempt to cancel)">Cancellation/Tax & Recovery (No
                        attempt to cancel)</option>
                    <option value="Customer - Charge not recognized">Customer - Charge not recognized</option>
                    <option value="Hotel - Hotel revealed rate">Hotel - Hotel revealed rate</option>
                    <option value="Hotel - Hotel Billed Direct">Hotel - Hotel Billed Direct</option>
                    <option value="Duplicate bill w/ NON GAR ARN">Duplicate bill w/ NON GAR ARN</option>
                    <option value="Resolved">Resolved</option>
                    <option value="Reason code 53 without affidavit">Reason code 53 without affidavit</option>
                    <option value="Customer - Currency">Customer - Currency</option>
                    <option value="Customer - Cancel policy dispute/No Show">Customer - Cancel policy dispute/No Show
                    </option>
                    <option value="Customer - Unable to check in/Customer Issue (Age, CC)">Customer - Unable to check
                        in/Customer Issue (Age, CC)</option>
                    <option value="Customer - Booking Error">Customer - Booking Error</option>
                    <option value="Hotel - Room Type Not Available">Hotel - Room Type Not Available</option>
                    <option value="Other - Chip liability shift (fraud)">Other - Chip liability shift (fraud)</option>
                    <option value="Service - Cancel Not Performed">Service - Cancel Not Performed</option>
                    <option value="Risk - Fraudulent Transaction (w/ Contact)">Risk - Fraudulent Transaction (w/
                        Contact)</option>
                    <option value="Sales - Data Entry Issue (Online Reservation Only)">Sales - Data Entry Issue (Online
                        Reservation Only)</option>
                    <option value="Pending">Pending</option>
                </datalist>
            </div>

            <!-- Issuer Notes -->
            <label for="issuer-notes">Issuer Notes</label>
            <textarea id="issuer-notes" rows="2" placeholder="Enter issuer notes..."></textarea>
            <div class="error" id="errorMsg"></div>

            <!-- Rebuttal Response -->
            <label for="rebuttal-response">Rebuttal Response</label>
            <textarea id="rebuttal-response" rows="14" placeholder="Enter rebuttal response..."></textarea>

            <!-- Internal Notes -->
            <label for="internal-notes">Internal Notes</label>
            <textarea id="internal-notes" rows="2" placeholder="Enter internal notes..."></textarea>
            <div id="internal-notes-display" style="display:none;"></div>

            <!-- Action Buttons -->
            <div class="buttons-section">
                <button class="primary" onclick="Resolve()">‚úì Resolve</button>
                <button onclick="getPendingCases()">üìã Pending Cases</button>
                <button id="hide" style="display:none" onclick="hidePendingTable()">Hide</button>
            </div>

            <!-- Pending Cases Table -->
            <div class="working-rca" style="display:none">
                <label id="pendingmessage" style="display:none">No pending cases!</label>
                <table id="pendingcase" style="display:none">
                    <tr>
                        <th class="row-number">Row</th>
                        <th style="width:100px">Case Id</th>
                        <th>Merchant Order #</th>
                        <th style="width:150px">Reason Code</th>
                        <th>Received</th>
                        <th>Due Date</th>
                        <th style="width:300px">Internal Notes</th>
                    </tr>
                </table>
            </div>
        </div>

        <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
         RIGHT SECTION: Uploads, Recovery, Queue Stats
         ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
        <div class="right-section">

            <!-- Upload Files Section -->
            <div class="uploads-section">
                <div class="section-header" onclick="toggleSection('section5')">Upload Files</div>
                <div class="section-content hidden" id="section5">

                    <label>Hotel Billed Merchant</label>
                    <div class="upload-box" id="wex" tabindex="0">
                        <span>Paste image here</span>
                        <button class="delete-btn">‚úï</button>
                        <img alt="Preview">
                    </div>
                    <div class="output"></div>

                    <label>Accertify Index Score</label>
                    <div class="upload-box" id="ais" tabindex="0">
                        <span>Paste image here</span>
                        <img alt="Preview">
                        <button class="delete-btn">‚úï</button>
                    </div>
                    <div class="output"></div>

                    <label>Refund Screenshot</label>
                    <div class="upload-box" id="rfs" tabindex="0">
                        <span>Paste image here</span>
                        <img alt="Preview">
                        <button class="delete-btn">‚úï</button>
                    </div>
                    <div class="output"></div>

                    <label>Customer Contact</label>
                    <div class="upload-box" id="ccontact" tabindex="0">
                        <span>Paste image here</span>
                        <img alt="Preview">
                        <button class="delete-btn">‚úï</button>
                    </div>
                    <div class="output"></div>

                    <label>Proof of Non Fraud</label>
                    <div class="upload-box" id="nonfraud" tabindex="0">
                        <span>Paste image here</span>
                        <img alt="Preview">
                        <button class="delete-btn">‚úï</button>
                    </div>
                    <div class="output"></div>

                    <label>Proof of Non Fraud #1</label>
                    <div class="upload-box" id="nonfraud1" tabindex="0">
                        <span>Paste image here</span>
                        <img alt="Preview">
                        <button class="delete-btn">‚úï</button>
                    </div>
                    <div class="output"></div>

                    <label>Proof of Non Fraud #2</label>
                    <div class="upload-box" id="nonfraud2" tabindex="0">
                        <span>Paste image here</span>
                        <img alt="Preview">
                        <button class="delete-btn">‚úï</button>
                    </div>
                    <div class="output"></div>
                    <br>
                    <button id="upload" class="primary" onclick="saveFiles1()">Save Images</button>
                </div>
            </div>

            <!-- Recovery Section -->
            <div class="section-header" onclick="toggleSection('section6')">Recovery</div>
            <div class="section-content hidden" id="section6">
                <textarea id="recovery-notes" rows="3" placeholder="Enter recovery notes..."></textarea><br>
                <select id="recovery-details">
                    <option value="">Select one</option>
                    <option value="Recovery Needed">Recovery Needed</option>
                    <option value="Outside Penalty">Outside Penalty</option>
                    <option value="Denied Already">Denied Already</option>
                    <option value="Waived Already">Waived Already</option>
                    <option value="Partially Waived Already">Partially Waived Already</option>
                </select>
                <br><br>
                <button onclick="RecoveryReq()">Submit</button>
                <span id="icon">‚ùå</span>
            </div>

            <!-- PDF Uploads Section -->
            <div class="pdf-uploads">
                <div class="section-header" onclick="toggleSection('section8')">PDF Files Upload</div>
                <div class="section-content hidden" id="section8">
                    <label>Confirmation Page (Required)</label>
                    <input type="file" id="confirmpage" accept="application/pdf" required>

                    <label>Checkout Page (Required)</label>
                    <input type="file" id="checkoutpage" accept="application/pdf" required>

                    <label>Duplicate Confirmation Pages</label>
                    <input type="file" id="confirmpages" accept="application/pdf">

                    <label>Duplicate Checkout Page</label>
                    <input type="file" id="checkoutpages" accept="application/pdf">

                    <label>WEX and Refund</label>
                    <input type="file" id="wexandrefund" accept="application/pdf">

                    <label>Accertify PDF</label>
                    <input type="file" id="accproof" accept="application/pdf">
                    <br><br>
                    <button id="buttonPDF" class="primary" onclick="uploadFiles()">Upload All PDFs</button>
                    <div class="success-msg" style="margin-top:10px;">
                        <p id="Uploadstatus"></p>
                    </div>
                </div>
            </div>

            <!-- Queue Stats Section -->
            <div class="queue-status-section">
                <div class="section-header" onclick="toggleSection('section7')">Queue Stats</div>
                <div class="section-content" id="section7">
                    <button onclick="getCount()">Refresh Stats</button>
                    <div class="queue-status">
                        <div><strong>My Cases</strong><span>-</span></div>
                        <div><strong>My Fraud</strong><span>-</span></div>
                        <div><strong>Priority Queue</strong><span>-</span></div>
                        <div><strong>Affirm</strong><span>-</span></div>
                        <div><strong>Amex</strong><span>-</span></div>
                        <div><strong>Braintree</strong><span>-</span></div>
                        <div><strong>Chase</strong><span>-</span></div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
       CANNED RESPONSE MODAL
       ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
    <div id="modalOverlay" class="modal-overlay" onclick="closeCannedModal()" style="display:none;"></div>
    <div id="cannedModal" style="display:none;">
        <h3>üìã Canned Responses</h3>
        <input list="savedResList" id="responseList" onchange="loadCannedResponse()" placeholder="Search responses...">
        <datalist id="savedResList"></datalist>
        <textarea id="responseBox" placeholder="Type your response..." rows="6"></textarea>
        <input type="text" id="responseName" placeholder="Response name">
        <div style="display:flex;gap:8px;margin-top:12px;flex-wrap:wrap;">
            <button onclick="saveCanned()">üíæ Save</button>
            <button onclick="insertCanned()">üì• Insert</button>
            <button onclick="clearCanned()">üóëÔ∏è Clear</button>
            <button onclick="closeCannedModal()" style="margin-left:auto;">‚úï Close</button>
        </div>
    </div>

    <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
       ADMIN PANEL (SLIDE-OUT)
       ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
    <div id="adminPanel" class="admin-panel">
        <div class="admin-panel-header">
            <h2>‚öôÔ∏è Admin Panel</h2>
            <button onclick="closeAdminPanel()">‚úï</button>
        </div>
        <div class="admin-panel-content">

            <!-- Tab Navigation -->
            <div style="display:flex;gap:8px;margin-bottom:16px;">
                <button onclick="showAdminTab('stats')" id="tabStats" class="primary">üìä Stats</button>
                <button onclick="showAdminTab('config')" id="tabConfig">üîß Config</button>
            </div>

            <!-- STATS TAB -->
            <div id="adminTabStats">
                <!-- Distribution Summary -->
                <div id="distributionSummary"></div>

                <!-- Active Analysts -->
                <div class="admin-stat-card">
                    <h4>ACTIVE ANALYSTS</h4>
                    <div id="activeAnalystsContainer"></div>
                </div>

                <!-- Analyst Leaderboard -->
                <div class="admin-stat-card">
                    <h4>TODAY'S LEADERBOARD</h4>
                    <div id="analystStatsContainer"></div>
                </div>

                <button onclick="loadAdminData()" style="width:100%;margin-top:12px;">üîÑ Refresh Data</button>
            </div>

            <!-- CONFIG TAB (Sheet IDs) -->
            <div id="adminTabConfig" style="display:none;">
                <div class="admin-stat-card">
                    <h4>üìä SHEET IDs</h4>
                    <p style="font-size:11px;color:var(--text-muted);margin-bottom:12px;">
                        Changes take effect immediately. No redeployment needed!
                    </p>
                    <div id="sheetConfigContainer"></div>
                </div>

                <div class="admin-stat-card">
                    <h4>üìÅ DRIVE FOLDER IDs</h4>
                    <div id="folderConfigContainer"></div>
                </div>

                <button onclick="loadSheetConfig()" style="width:100%;margin-top:12px;">üîÑ Reload Config</button>
            </div>
        </div>
    </div>

    <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
       KEYBOARD SHORTCUTS HINT
       ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
    <div class="shortcuts-hint">
        <kbd>Ctrl</kbd>+<kbd>Enter</kbd> Resolve &nbsp;|&nbsp;
        <kbd>Ctrl</kbd>+<kbd>G</kbd> Get Case &nbsp;|&nbsp;
        <kbd>?</kbd> Help
    </div>

    <!-- Include JavaScript -->
    <!-- JavaScript is included in RCAPartials -->

    <!-- Hidden class utility -->
    <style>
        .hidden {
            display: none !important;
        }
    </style>

<? } ?>

<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
     REPRESENTATION MANAGER
     ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<? if (page === "rep") { ?>
<link
    href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@300;400;500;600&family=Space+Mono:wght@400;700&display=swap"
    rel="stylesheet">

  <!-- Global Theme -->

<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
         HEADER
         ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
  <div class="rep-header-left">
      <a href="<?= ScriptApp.getService().getUrl() ?>" class="rep-logo">√ò</a>
      <span class="rep-page-title">Representation Engine</span>
    </div>
    <div class="rep-header-right">
      <button class="theme-toggle" onclick="Theme.toggle()" title="Toggle theme" aria-label="Toggle dark/light mode">
        <svg class="icon-sun" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <circle cx="12" cy="12" r="5" />
          <path
            d="M12 1v2M12 21v2M4.22 4.22l1.42 1.42M18.36 18.36l1.42 1.42M1 12h2M21 12h2M4.22 19.78l1.42-1.42M18.36 5.64l1.42-1.42" />
        </svg>
        <svg class="icon-moon" viewBox="0 0 24 24" fill="currentColor">
          <path
            d="M21.752 15.002A9.718 9.718 0 0118 15.75c-5.385 0-9.75-4.365-9.75-9.75 0-1.33.266-2.597.748-3.752A9.753 9.753 0 003 11.25C3 16.635 7.365 21 12.75 21a9.753 9.753 0 009.002-5.998z" />
        </svg>
      </button>
      <a href="<?= ScriptApp.getService().getUrl() ?>?page=cb" class="rep-back-btn">‚Üê Back to Chargeback</a>
    </div>
  </header>

  <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
         MAIN LAYOUT
         ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
  <div class="main-container">
    <!-- SIDEBAR -->
    <aside class="sidebar">
      <div class="action-section">
        <h3>Case Actions</h3>
        <button class="action-btn challenge" onclick="Challenge()">‚úì Challenge</button>
        <button class="action-btn accept" onclick="Accept()">‚úì Accept</button>
        <button class="action-btn reversal" onclick="Reversal()">‚Ü© Reversal</button>
        <button class="action-btn autoclosed" onclick="AutoClosed()">‚úï Auto-closed</button>
        <button class="action-btn recreate" onclick="RecreateRequest()">‚ü≥ Recreate Request</button>
      </div>
    </aside>

    <!-- CONTENT -->
    <main class="content">
      <!-- Stats Cards -->
      <div class="cards-row">
        <div class="stat-card amex">
          <div class="stat-label">Amex</div>
          <div class="stat-value" id="count-amex">-</div>
        </div>
        <div class="stat-card affirm">
          <div class="stat-label">Affirm</div>
          <div class="stat-value" id="count-affirm">-</div>
        </div>
        <div class="stat-card braintree">
          <div class="stat-label">Braintree</div>
          <div class="stat-value" id="count-braintree">-</div>
        </div>
        <div class="stat-card chase">
          <div class="stat-label">Chase</div>
          <div class="stat-value" id="count-chase">-</div>
        </div>
        <div class="stat-card fiserv">
          <div class="stat-label">Fiserv</div>
          <div class="stat-value" id="count-fiserv">-</div>
        </div>
      </div>

      <!-- Controls -->
      <div class="controls-row">
        <select class="select-input" id="portal">
          <option value="">Select Portal</option>
          <option value="Amex">Amex</option>
          <option value="Affirm">Affirm</option>
          <option value="Braintree">Braintree</option>
          <option value="Chase">Chase</option>
          <option value="Fiserv">Fiserv</option>
        </select>
        <select class="select-input" id="currency">
          <option value="">Select Currency</option>
          <option value="USD">USD / CAD</option>
          <option value="NON-USD">Non-USD / Non-CAD</option>
        </select>
        <button class="primary-btn" onclick="getCase()">Get Next Case</button>
      </div>

      <!-- Case Info -->
      <div class="case-card">
        <label id="row"></label>
        <div class="case-grid">
          <div class="field-group">
            <span class="field-label">Case ID</span>
            <div class="field-value" id="caseId"></div>
          </div>
          <div class="field-group">
            <span class="field-label">Merchant Order / ITN</span>
            <div class="field-value" id="ITN"></div>
          </div>
          <div class="field-group">
            <span class="field-label">Reason Code</span>
            <div class="field-value" id="ReasonCode"></div>
          </div>
          <div class="field-group">
            <span class="field-label">MOP</span>
            <div class="field-value" id="mop"></div>
          </div>
          <div class="field-group">
            <span class="field-label">Reservation #</span>
            <div class="field-value" id="reservation"></div>
          </div>
          <div class="field-group">
            <span class="field-label">Due Date</span>
            <div class="field-value" id="dueDate"></div>
          </div>
          <div class="field-group">
            <span class="field-label">Dispute Amount</span>
            <div class="field-value" id="disputeAmt"></div>
          </div>
          <div class="field-group">
            <span class="field-label">Transaction Amount</span>
            <div class="field-value" id="transAmt"></div>
          </div>
          <div class="field-group">
            <span class="field-label">Refund Amount</span>
            <div class="field-value" id="refundAmt"></div>
          </div>
          <div class="field-group">
            <span class="field-label">Dispute Type</span>
            <div class="field-value" id="disputeType"></div>
          </div>
        </div>
        <div style="margin-top: 16px;">
          <div class="field-group">
            <span class="field-label">RCA Decision</span>
            <div class="field-value" id="rca"></div>
          </div>
        </div>
        <div style="margin-top: 16px;">
          <div class="field-group">
            <span class="field-label">Internal Notes</span>
            <div class="field-value large" id="internalNotes"></div>
          </div>
        </div>
      </div>

      <!-- Files Section -->
      <div class="files-section">
        <div class="files-header">
          <div class="files-actions">
            <button class="secondary-btn" onclick="findFiles()">üîç Find Files</button>
            <button class="secondary-btn" onclick="DownloadFiles()">‚¨á Download Selected</button>
          </div>
          <h3>Related Files</h3>
        </div>
        <table class="files-table" id="filesfound">
          <thead>
            <tr>
              <th style="width: 40px;"><input type="checkbox" id="check-all" onchange="toggle()"></th>
              <th>File Name</th>
              <th style="width: 160px;">Last Modified</th>
            </tr>
          </thead>
          <tbody></tbody>
        </table>
      </div>
    </main>
  </div>

  <script>
    // Initialize counts on load
    document.addEventListener('DOMContentLoaded', function () {
      getCount();
    });

    function getCase() {
      getCount();
      clearFiles();
      var portal = document.getElementById("portal").value;
      var currency = document.getElementById("currency").value;
      if (portal === "" || currency === "") {
        clearData();
        return;
      }
      document.getElementById("caseId").textContent = "Fetching...";
      console.log("Fetching case for portal:", portal, "currency:", currency);
      google.script.run
        .withSuccessHandler(function (data) {
          console.log("Case data received:", data);
          updateData(data);
        })
        .withFailureHandler(function (error) {
          console.error("Error fetching case:", error);
          alert("Error fetching case: " + error.message);
          document.getElementById("caseId").textContent = "Error - check console";
        })
        .rmGetPendingUploads(portal, currency);
    }

    function updateData(data) {
      document.getElementById("row").innerHTML = data[0];
      document.getElementById("caseId").textContent = data[1] || '-';
      document.getElementById("ITN").textContent = data[2] || '-';
      document.getElementById("ReasonCode").textContent = data[3] || '-';
      document.getElementById("mop").textContent = data[4] || '-';
      document.getElementById("reservation").textContent = data[5] || '-';
      document.getElementById("disputeAmt").textContent = data[6] || '-';
      document.getElementById("transAmt").textContent = data[7] || '-';
      document.getElementById("refundAmt").textContent = data[8] || '-';
      document.getElementById("dueDate").textContent = data[9] || '-';
      document.getElementById("disputeType").textContent = data[10] || '-';
      document.getElementById("rca").textContent = data[11] || '-';
      document.getElementById("internalNotes").textContent = data[12] || '-';
    }

    function clearData() {
      ['caseId', 'ITN', 'ReasonCode', 'mop', 'reservation', 'disputeAmt',
        'transAmt', 'refundAmt', 'dueDate', 'disputeType', 'rca', 'internalNotes']
        .forEach(id => document.getElementById(id).textContent = '-');
      document.getElementById("row").innerHTML = "";
    }

    function Challenge() {
      var row = document.getElementById("row").innerHTML;
      if (!row) return alert("No case selected");

      setLoading(true);
      showToast('Processing Challenge...', 'info');

      google.script.run.withSuccessHandler(function () {
        showToast('Case Challenged Successfully', 'success');
        getCase();
        setLoading(false);
      }).withFailureHandler(function (e) {
        showToast('Error: ' + e.message, 'error');
        setLoading(false);
      }).rmChallenge(parseInt(row));
    }

    function Accept() {
      var row = document.getElementById("row").innerHTML;
      if (!row) return alert("No case selected");

      setLoading(true);
      showToast('Processing Accept...', 'info');

      google.script.run.withSuccessHandler(function () {
        showToast('Case Accepted Successfully', 'success');
        getCase();
        setLoading(false);
      }).withFailureHandler(function (e) {
        showToast('Error: ' + e.message, 'error');
        setLoading(false);
      }).rmAccept(parseInt(row));
    }

    function Reversal() {
      var row = document.getElementById("row").innerHTML;
      if (!row) return alert("No case selected");

      setLoading(true);
      showToast('Processing Reversal...', 'info');

      google.script.run.withSuccessHandler(function () {
        showToast('Case Reversed Successfully', 'success');
        getCase();
        setLoading(false);
      }).withFailureHandler(function (e) {
        showToast('Error: ' + e.message, 'error');
        setLoading(false);
      }).rmReversal(parseInt(row));
    }

    function AutoClosed() {
      var row = document.getElementById("row").innerHTML;
      if (!row) return alert("No case selected");

      setLoading(true);
      showToast('Processing Auto-Close...', 'info');

      google.script.run.withSuccessHandler(function () {
        showToast('Case Auto-Closed Successfully', 'success');
        getCase();
        setLoading(false);
      }).withFailureHandler(function (e) {
        showToast('Error: ' + e.message, 'error');
        setLoading(false);
      }).rmAutoclosed(parseInt(row));
    }

    function RecreateRequest() {
      var row = document.getElementById("row").innerHTML;
      if (!row) return alert("No case selected");
      var res = prompt("Reason for Recreate Request");
      if (res) {
        setLoading(true);
        showToast('Submitting Request...', 'info');

        google.script.run.withSuccessHandler(function () {
          showToast('Recreate Request Sent', 'success');
          getCase();
          setLoading(false);
        }).withFailureHandler(function (e) {
          showToast('Error: ' + e.message, 'error');
          setLoading(false);
        }).rmRecreate(parseInt(row), res);
      }
    }

    function setLoading(isLoading) {
      const btns = document.querySelectorAll('.action-btn');
      btns.forEach(btn => {
        btn.disabled = isLoading;
        btn.style.opacity = isLoading ? '0.5' : '1';
        btn.style.cursor = isLoading ? 'not-allowed' : 'pointer';
      });
    }

    function showToast(message, type = 'info') {
      // Create toast container if not exists
      let container = document.getElementById('toast-container');
      if (!container) {
        container = document.createElement('div');
        container.id = 'toast-container';
        container.style.position = 'fixed';
        container.style.top = '20px';
        container.style.right = '20px';
        container.style.zIndex = '9999';
        container.style.display = 'flex';
        container.style.flexDirection = 'column';
        container.style.gap = '10px';
        document.body.appendChild(container);
      }

      const toast = document.createElement('div');
      toast.textContent = message;
      toast.style.padding = '12px 24px';
      toast.style.borderRadius = '6px';
      toast.style.color = '#fff';
      toast.style.fontFamily = 'var(--font-ui)';
      toast.style.fontSize = '14px';
      toast.style.boxShadow = '0 4px 12px rgba(0,0,0,0.15)';
      toast.style.transition = 'all 0.3s ease';
      toast.style.opacity = '0';
      toast.style.transform = 'translateY(-20px)';

      // Set color based on type
      if (type === 'success') toast.style.backgroundColor = 'var(--state-success, #10b981)';
      else if (type === 'error') toast.style.backgroundColor = 'var(--danger, #ef4444)';
      else toast.style.backgroundColor = 'var(--accent, #3b82f6)';

      container.appendChild(toast);

      // Animate in
      requestAnimationFrame(() => {
        toast.style.opacity = '1';
        toast.style.transform = 'translateY(0)';
      });

      // Remove after 3s
      setTimeout(() => {
        toast.style.opacity = '0';
        toast.style.transform = 'translateY(-20px)';
        setTimeout(() => toast.remove(), 300);
      }, 3000);
    }

    function getCount() {
      console.log("Fetching counts...");
      google.script.run
        .withSuccessHandler(function (counts) {
          console.log("Counts received:", counts);
          UpdateCounts(counts);
        })
        .withFailureHandler(function (error) {
          console.error("Error fetching counts:", error);
          alert("Error fetching counts: " + error.message);
        })
        .rmGetCounts();
    }

    function UpdateCounts(counts) {
      document.getElementById("count-amex").textContent = counts[0] || 0;
      document.getElementById("count-affirm").textContent = counts[1] || 0;
      document.getElementById("count-braintree").textContent = counts[2] || 0;
      document.getElementById("count-chase").textContent = counts[3] || 0;
      document.getElementById("count-fiserv").textContent = counts[4] || 0;
    }

    function findFiles() {
      var itn = document.getElementById("ITN").textContent;
      if (!itn || itn === '-') return alert("No ITN to search");

      // Show loading state
      var tbody = document.querySelector('#filesfound tbody');
      tbody.innerHTML = '<tr><td colspan="3" style="text-align:center;padding:20px;">Searching...</td></tr>';

      google.script.run
        .withSuccessHandler(function (files) {
          clearFiles();
          if (!files || files.length === 0) {
            tbody.innerHTML = '<tr><td colspan="3" style="text-align:center;padding:20px;color:var(--text-muted);">No files found for this ITN</td></tr>';
            return;
          }

          files.forEach(function (file) {
            var row = document.createElement('tr');
            row.innerHTML =
              '<td><input type="checkbox" data-fileid="' + file[1] + '"></td>' +
              '<td><a href="https://drive.google.com/file/d/' + file[1] + '/view" target="_blank">' + file[0] + '</a></td>' +
              '<td>' + file[2] + '</td>';
            tbody.appendChild(row);
          });
        })
        .withFailureHandler(function (error) {
          console.error("Error searching files:", error);
          tbody.innerHTML = '<tr><td colspan="3" style="text-align:center;padding:20px;color:var(--danger);">Error: ' + error.message + '</td></tr>';
        })
        .rmSearchFiles(itn);
    }

    function clearFiles() {
      var tbody = document.querySelector('#filesfound tbody');
      tbody.innerHTML = '';
    }

    function toggle() {
      var checkAll = document.getElementById("check-all");
      var checkboxes = document.querySelectorAll('#filesfound tbody input[type="checkbox"]');
      checkboxes.forEach(cb => cb.checked = checkAll.checked);
    }

    function DownloadFiles() {
      var checkboxes = document.querySelectorAll('#filesfound tbody input[type="checkbox"]:checked');
      if (checkboxes.length === 0) {
        alert("No files selected");
        return;
      }

      // Download each selected file
      checkboxes.forEach(function (cb, index) {
        var fileId = cb.getAttribute('data-fileid');
        if (fileId) {
          // Use export URL to trigger download instead of view
          var downloadUrl = 'https://drive.google.com/uc?export=download&id=' + fileId;
          // Stagger the downloads slightly to prevent popup blockers
          setTimeout(function () {
            window.open(downloadUrl, '_blank');
          }, index * 300);
        }
      });
    }
  </script>

<? } ?>

<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
     EMAIL CONFIRMATIONS
     ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<? if (page === "email-confirm") { ?>
<!-- Global Theme -->

<!-- Header -->
    <div class="ec-header-left">
            <a href="<?= ScriptApp.getService().getUrl() ?>" class="ec-logo">√ò</a>
            <span class="ec-page-title">Email Confirmations</span>
        </div>
        <div class="ec-header-right">
            <button class="theme-toggle" onclick="Theme.toggle()" title="Toggle theme">
                <svg class="icon-sun" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <circle cx="12" cy="12" r="5" />
                    <path
                        d="M12 1v2M12 21v2M4.22 4.22l1.42 1.42M18.36 18.36l1.42 1.42M1 12h2M21 12h2M4.22 19.78l1.42-1.42M18.36 5.64l1.42-1.42" />
                </svg>
                <svg class="icon-moon" viewBox="0 0 24 24" fill="currentColor">
                    <path
                        d="M21.752 15.002A9.718 9.718 0 0118 15.75c-5.385 0-9.75-4.365-9.75-9.75 0-1.33.266-2.597.748-3.752A9.753 9.753 0 003 11.25C3 16.635 7.365 21 12.75 21a9.753 9.753 0 009.002-5.998z" />
                </svg>
            </button>
            <a href="<?= ScriptApp.getService().getUrl() ?>?page=cb" class="ec-back-btn">‚Üê Back to Chargeback</a>
        </div>
    </header>

    <!-- Main Content -->
    <div class="ec-container">
        <!-- Pending Items -->
        <section class="ec-section ec-pending">
            <h2>
                üìã My Pending Items
                <button class="ec-refresh-btn" onclick="loadPendingItems()">üîÑ Refresh</button>
            </h2>
            <div id="pendingContainer">
                <div class="ec-empty">Loading...</div>
            </div>
        </section>

        <!-- Upload Section -->
        <section class="ec-section ec-upload">
            <h2>üì§ Upload Email Confirmations</h2>

            <div class="ec-drop-zone" id="dropZone" onclick="document.getElementById('fileInput').click()">
                <div class="ec-drop-zone-icon">üìß</div>
                <div class="ec-drop-zone-text">Drop PDF files here or click to browse</div>
                <div class="ec-drop-zone-hint">Files should be named with the ITN number (e.g., 12345678.pdf)</div>
            </div>

            <input type="file" id="fileInput" class="ec-file-input" multiple accept="application/pdf">

            <div class="ec-file-list" id="fileList"></div>

            <button class="ec-upload-btn" id="uploadBtn" onclick="uploadFiles()" disabled>
                Upload Files
            </button>

            <div id="messageContainer"></div>
        </section>
    </div>

    <script>
        let selectedFiles = [];

        // Initialize on load
        document.addEventListener('DOMContentLoaded', function () {
            loadPendingItems();
            setupDragAndDrop();
            setupFileInput();
        });

        function loadPendingItems() {
            const container = document.getElementById('pendingContainer');
            container.innerHTML = '<div class="ec-empty">Loading...</div>';

            google.script.run
                .withSuccessHandler(function (items) {
                    if (!items || items.length === 0) {
                        container.innerHTML = '<div class="ec-empty">No pending items</div>';
                        return;
                    }

                    let html = '<div class="ec-table-wrapper"><table class="ec-table"><thead><tr>' +
                        '<th>S.No</th><th>ITN</th><th>Added</th><th>Due</th><th>Status</th>' +
                        '</tr></thead><tbody>';

                    items.forEach(function (item, index) {
                        html += '<tr>' +
                            '<td class="mono">' + (index + 1) + '</td>' +
                            '<td class="mono">' + item.itn + '</td>' +
                            '<td>' + item.addedDt + '</td>' +
                            '<td>' + item.dueDt + '</td>' +
                            '<td><span class="ec-status pending">Pending</span></td>' +
                            '</tr>';
                    });

                    html += '</tbody></table></div>';
                    container.innerHTML = html;
                })
                .withFailureHandler(function (error) {
                    container.innerHTML = '<div class="ec-empty">Error: ' + error.message + '</div>';
                })
                .ecGetPendingItems();
        }

        function setupDragAndDrop() {
            const dropZone = document.getElementById('dropZone');

            ['dragenter', 'dragover', 'dragleave', 'drop'].forEach(eventName => {
                dropZone.addEventListener(eventName, preventDefaults, false);
            });

            function preventDefaults(e) {
                e.preventDefault();
                e.stopPropagation();
            }

            ['dragenter', 'dragover'].forEach(eventName => {
                dropZone.addEventListener(eventName, () => dropZone.classList.add('dragover'), false);
            });

            ['dragleave', 'drop'].forEach(eventName => {
                dropZone.addEventListener(eventName, () => dropZone.classList.remove('dragover'), false);
            });

            dropZone.addEventListener('drop', function (e) {
                const files = e.dataTransfer.files;
                handleFiles(files);
            }, false);
        }

        function setupFileInput() {
            document.getElementById('fileInput').addEventListener('change', function (e) {
                handleFiles(e.target.files);
            });
        }

        function handleFiles(files) {
            Array.from(files).forEach(file => {
                if (file.type === 'application/pdf') {
                    // Avoid duplicates
                    if (!selectedFiles.find(f => f.name === file.name)) {
                        selectedFiles.push(file);
                    }
                }
            });
            updateFileList();
        }

        function updateFileList() {
            const container = document.getElementById('fileList');
            const uploadBtn = document.getElementById('uploadBtn');

            if (selectedFiles.length === 0) {
                container.innerHTML = '';
                uploadBtn.disabled = true;
                return;
            }

            uploadBtn.disabled = false;

            let html = '';
            selectedFiles.forEach((file, index) => {
                html += '<div class="ec-file-item">' +
                    '<span class="ec-file-name">' + file.name + '</span>' +
                    '<button class="ec-file-remove" onclick="removeFile(' + index + ')">√ó</button>' +
                    '</div>';
            });

            container.innerHTML = html;
        }

        function removeFile(index) {
            selectedFiles.splice(index, 1);
            updateFileList();
        }

        async function uploadFiles() {
            if (selectedFiles.length === 0) return;

            const uploadBtn = document.getElementById('uploadBtn');
            const msgContainer = document.getElementById('messageContainer');

            uploadBtn.disabled = true;
            uploadBtn.textContent = 'Uploading...';
            msgContainer.innerHTML = '';

            try {
                // Convert files to base64
                const fileData = await Promise.all(selectedFiles.map(async file => {
                    const base64 = await fileToBase64(file);
                    return {
                        name: file.name,
                        mimeType: file.type,
                        content: base64
                    };
                }));

                google.script.run
                    .withSuccessHandler(function (result) {
                        uploadBtn.textContent = 'Upload Files';
                        uploadBtn.disabled = true;
                        selectedFiles = [];
                        updateFileList();

                        let msg = result.message;
                        if (result.updated && result.updated.length > 0) {
                            msg += ' Updated ITNs: ' + result.updated.join(', ');
                        }

                        msgContainer.innerHTML = '<div class="ec-message success">' + msg + '</div>';

                        // Refresh pending items
                        setTimeout(loadPendingItems, 1000);
                    })
                    .withFailureHandler(function (error) {
                        uploadBtn.textContent = 'Upload Files';
                        uploadBtn.disabled = false;
                        msgContainer.innerHTML = '<div class="ec-message error">Error: ' + error.message + '</div>';
                    })
                    .ecUploadFiles({ files: fileData });

            } catch (error) {
                uploadBtn.textContent = 'Upload Files';
                uploadBtn.disabled = false;
                msgContainer.innerHTML = '<div class="ec-message error">Error: ' + error.message + '</div>';
            }
        }

        function fileToBase64(file) {
            return new Promise((resolve, reject) => {
                const reader = new FileReader();
                reader.readAsDataURL(file);
                reader.onload = () => {
                    // Remove data URL prefix
                    const base64 = reader.result.split(',')[1];
                    resolve(base64);
                };
                reader.onerror = error => reject(error);
            });
        }
    </script>

<? } ?>

<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
     WORD ANALYSER / TEXT ANALYTICS
     ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<? if (page === "cbq") { ?>
<link
        href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@300;400;500;600&family=Space+Mono:wght@400;700&display=swap"
        rel="stylesheet">

    <!-- Global Theme -->

<div class="app">
        <div class="header-left">
                <a href="<?= ScriptApp.getService().getUrl() ?>" class="logo">√ò</a>
                <nav class="nav">
                    <a class="nav-link active" href="<?= ScriptApp.getService().getUrl() ?>?page=cbq">Text Analytics</a>
                </nav>
            </div>
            <div class="header-right">
                <span class="user-badge">
                    <?= user ?>
                </span>
                <span class="admin-badge">Admin</span>
                <button class="theme-toggle" onclick="Theme.toggle()" title="Toggle theme"
                    aria-label="Toggle dark/light mode">
                    <svg class="icon-sun" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <circle cx="12" cy="12" r="5" />
                        <path
                            d="M12 1v2M12 21v2M4.22 4.22l1.42 1.42M18.36 18.36l1.42 1.42M1 12h2M21 12h2M4.22 19.78l1.42-1.42M18.36 5.64l1.42-1.42" />
                    </svg>
                    <svg class="icon-moon" viewBox="0 0 24 24" fill="currentColor">
                        <path
                            d="M21.752 15.002A9.718 9.718 0 0118 15.75c-5.385 0-9.75-4.365-9.75-9.75 0-1.33.266-2.597.748-3.752A9.753 9.753 0 003 11.25C3 16.635 7.365 21 12.75 21a9.753 9.753 0 009.002-5.998z" />
                    </svg>
                </button>
            </div>
        </header>

        <div class="main">
            <aside class="sidebar">
                <div class="sidebar-section">
                    <div class="sidebar-title">Queue Status</div>
                    <div id="queue-stats">
                        <div class="loading">
                            <div class="spinner"></div>
                        </div>
                    </div>
                </div>
                <div class="sidebar-section">
                    <div class="sidebar-title">Filters</div>
                    <div class="form-group">
                        <label class="form-label">Reason Code</label>
                        <select class="form-select" id="filter-reason" onchange="applyFilters()">
                            <option value="GLOBAL">All (Global)</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="form-label">View Mode</label>
                        <select class="form-select" id="filter-mode" onchange="applyFilters()">
                            <option value="signal">By Signal Strength</option>
                            <option value="positive">Positive Only</option>
                            <option value="negative">Negative Only</option>
                            <option value="frequency">By Frequency</option>
                        </select>
                    </div>
                </div>
                <div class="sidebar-section">
                    <div class="sidebar-title">Actions</div>
                    <button class="btn btn-sm" style="width:100%;margin-bottom:8px;" onclick="processQueue()">‚ö° Process
                        Queue</button>
                    <button class="btn btn-sm" style="width:100%;margin-bottom:8px;" onclick="recalculateStats()">üìä
                        Recalculate Stats</button>
                    <button class="btn btn-sm" style="width:100%;" onclick="exportStats()">‚Üì Export CSV</button>
                </div>
            </aside>

            <div class="content">
                <div class="tabs">
                    <div class="tab active" onclick="switchTab('upload')">üì§ AI Upload</div>
                    <div class="tab" onclick="switchTab('analytics')">üìä Word Analytics</div>
                    <div class="tab" onclick="switchTab('filtered')">üö´ Filtered Words</div>
                    <div class="tab" onclick="switchTab('queue')">üìã Queue</div>
                </div>

                <!-- Upload Tab -->
                <div id="tab-upload">
                    <div class="stats-row">
                        <div class="stat-box">
                            <div class="stat-number" id="stat-docs">-</div>
                            <div class="stat-label">Documents</div>
                        </div>
                        <div class="stat-box">
                            <div class="stat-number" id="stat-words">-</div>
                            <div class="stat-label">Unique Words</div>
                        </div>
                        <div class="stat-box">
                            <div class="stat-number" style="color:var(--positive)" id="stat-positive">-</div>
                            <div class="stat-label">Positive Signal</div>
                        </div>
                        <div class="stat-box">
                            <div class="stat-number" style="color:var(--negative)" id="stat-negative">-</div>
                            <div class="stat-label">Negative Signal</div>
                        </div>
                    </div>

                    <!-- Primary: Folder Upload -->
                    <div
                        style="background:var(--bg-card);border:1px solid var(--border);border-radius:8px;padding:20px;margin-bottom:20px;">
                        <h3 style="margin:0 0 16px 0;font-size:14px;color:var(--text-primary);">üìÅ Batch Upload from
                            Google Drive</h3>

                        <div class="form-group">
                            <label class="form-label">Google Drive Folder ID *</label>
                            <input type="text" class="form-input" id="folder-id-main"
                                placeholder="Paste folder ID from Drive URL (e.g. 1aBcDeFgHiJkLmNoPqRsTuVwXyZ)"
                                style="font-family:monospace;">
                            <p style="font-size:11px;color:var(--text-muted);margin-top:6px;">
                                üìå Get this from your Google Drive folder URL after <code>/folders/</code>
                            </p>
                        </div>

                        <div class="form-group">
                            <label class="form-label">Outcome Classification *</label>
                            <div style="display:grid;grid-template-columns:repeat(3,1fr);gap:12px;">
                                <button type="button" class="outcome-btn" id="outcome-72h-win"
                                    onclick="selectOutcome('AUTO_WIN_72H')"
                                    style="padding:16px;border:2px solid var(--border);border-radius:8px;background:var(--bg-elevated);cursor:pointer;text-align:center;transition:all 0.2s;">
                                    <div style="font-size:24px;margin-bottom:8px;">‚úÖ</div>
                                    <div style="font-weight:600;color:var(--positive);margin-bottom:4px;">72h Perfect
                                    </div>
                                    <div style="font-size:11px;color:var(--text-muted);">Strong positive outcome</div>
                                </button>
                                <button type="button" class="outcome-btn" id="outcome-30-90"
                                    onclick="selectOutcome('WIN_30_90D')"
                                    style="padding:16px;border:2px solid var(--border);border-radius:8px;background:var(--bg-elevated);cursor:pointer;text-align:center;transition:all 0.2s;">
                                    <div style="font-size:24px;margin-bottom:8px;">üìä</div>
                                    <div style="font-weight:600;color:var(--text-primary);margin-bottom:4px;">30-90 Good
                                    </div>
                                    <div style="font-size:11px;color:var(--text-muted);">Needs review, eventual win
                                    </div>
                                </button>
                                <button type="button" class="outcome-btn" id="outcome-72h-reject"
                                    onclick="selectOutcome('AUTO_REJECT_72H')"
                                    style="padding:16px;border:2px solid var(--border);border-radius:8px;background:var(--bg-elevated);cursor:pointer;text-align:center;transition:all 0.2s;">
                                    <div style="font-size:24px;margin-bottom:8px;">‚ùå</div>
                                    <div style="font-weight:600;color:var(--negative);margin-bottom:4px;">72h Bad</div>
                                    <div style="font-size:11px;color:var(--text-muted);">Weak evidence, likely loss
                                    </div>
                                </button>
                            </div>
                            <input type="hidden" id="selected-outcome" value="">
                        </div>

                        <button class="btn btn-success" onclick="submitFolderUploadMain()"
                            style="width:100%;padding:14px;font-size:14px;">
                            üöÄ Process Folder with AI
                        </button>

                        <div id="folder-progress" class="hidden"
                            style="margin-top:16px;padding:12px;background:var(--bg-elevated);border-radius:6px;">
                            <div style="display:flex;align-items:center;gap:12px;">
                                <div class="spinner"></div>
                                <span id="folder-progress-text">Processing...</span>
                            </div>
                        </div>
                    </div>

                    <!-- Results Table (shows after processing) -->
                    <div id="results-section" class="hidden"
                        style="background:var(--bg-card);border:1px solid var(--border);border-radius:8px;padding:20px;margin-bottom:20px;">
                        <h3 style="margin:0 0 16px 0;font-size:14px;color:var(--text-primary);">üìã Processing Results
                        </h3>
                        <div id="results-table" style="overflow-x:auto;"></div>
                    </div>

                    <!-- Alternative: Text Paste (collapsed by default) -->
                    <details
                        style="background:var(--bg-secondary);border:1px solid var(--border);border-radius:8px;margin-bottom:20px;">
                        <summary style="padding:16px;cursor:pointer;font-size:13px;color:var(--text-secondary);">
                            üìù Alternative: Paste Single Document Text
                        </summary>
                        <div style="padding:0 16px 16px 16px;">
                            <div class="form-group">
                                <label class="form-label">Rebuttal Text</label>
                                <textarea class="form-textarea" id="upload-text"
                                    placeholder="Paste rebuttal document text here..."></textarea>
                            </div>
                            <button class="btn" onclick="submitTextUpload()" style="width:100%;">üì§ Upload Text</button>
                        </div>
                    </details>
                </div>

                <!-- Analytics Tab -->
                <div id="tab-analytics" class="hidden">
                    <div class="tabs" style="margin-bottom:16px;">
                        <div class="tab active" onclick="switchVizTab('wordcloud')">‚òÅÔ∏è Word Cloud</div>
                        <div class="tab" onclick="switchVizTab('heatmap')">üî• Heat Map</div>
                        <div class="tab" onclick="switchVizTab('bubble')">ü´ß Bubble Chart</div>
                    </div>

                    <!-- Word Cloud View -->
                    <div id="viz-wordcloud">
                        <h3 style="margin-bottom:16px;font-size:16px;">Word Cloud - Signal Analysis</h3>
                        <div class="word-cloud" id="word-cloud">
                            <div class="loading">
                                <div class="spinner"></div><span>Loading word data...</span>
                            </div>
                        </div>
                    </div>

                    <!-- Heat Map View -->
                    <div id="viz-heatmap" class="hidden">
                        <h3 style="margin-bottom:16px;font-size:16px;">Heat Map - Word Frequency by Outcome</h3>
                        <div id="heatmap-container"
                            style="min-height:400px;background:var(--bg-card);border-radius:8px;padding:20px;">
                            <div class="loading">
                                <div class="spinner"></div><span>Loading heat map...</span>
                            </div>
                        </div>
                    </div>

                    <!-- Bubble Chart View -->
                    <div id="viz-bubble" class="hidden">
                        <h3 style="margin-bottom:16px;font-size:16px;">Bubble Chart - Word Importance</h3>
                        <div id="bubble-container"
                            style="min-height:400px;background:var(--bg-card);border-radius:8px;padding:20px;">
                            <div class="loading">
                                <div class="spinner"></div><span>Loading bubble chart...</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Filtered Words Tab -->
                <div id="tab-filtered" class="hidden">
                    <h3 style="margin-bottom:16px;font-size:16px;">Filtered Words Management</h3>
                    <p style="font-size:12px;color:var(--text-muted);margin-bottom:16px;">Words below are excluded from
                        word cloud and analytics. These include company names, stopwords, and dates.</p>
                    <div style="display:flex;gap:12px;margin-bottom:16px;">
                        <input type="text" class="form-input" id="new-filter-word" placeholder="Add word to filter..."
                            style="flex:1;">
                        <button class="btn btn-success btn-sm" onclick="addFilteredWord()">+ Add</button>
                        <button class="btn btn-sm" onclick="initializeDefaultFilters()">Reset Defaults</button>
                    </div>
                    <div class="queue-list" id="filtered-words-list">
                        <div class="loading">
                            <div class="spinner"></div>
                        </div>
                    </div>
                </div>

                <!-- Queue Tab -->
                <div id="tab-queue" class="hidden">
                    <h3 style="margin-bottom:16px;font-size:16px;">Processing Queue</h3>
                    <div class="queue-list" id="queue-list">
                        <div class="loading">
                            <div class="spinner"></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="toast hidden" id="toast"></div>

    <!-- Folder Upload Modal -->
    <div class="modal-overlay hidden" id="folder-modal">
        <div class="modal">
            <div class="modal-header">
                <h3>Upload from Drive Folder</h3>
                <button class="modal-close" onclick="closeFolderModal()">&times;</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label class="form-label">Google Drive Folder ID *</label>
                    <input type="text" class="form-input" id="folder-id-input"
                        placeholder="e.g. 1aBcDeFgHiJkLmNoPqRsTuVwXyZ">
                    <p style="font-size:11px;color:var(--text-muted);margin-top:6px;">Find this in the folder URL after
                        /folders/</p>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn" onclick="closeFolderModal()">Cancel</button>
                <button class="btn btn-success" onclick="submitFolderUpload()">üìÅ Upload PDFs</button>
            </div>
        </div>
    </div>

    <script>
        var App = {
            currentTab: 'upload',
            config: null,
            queueStatus: null,
            wordData: null
        };

        document.addEventListener('DOMContentLoaded', function () {
            loadTheme();
            loadConfig();
            loadQueueStatus();
            loadStats();
        });

        function toggleTheme() {
            var current = document.body.getAttribute('data-theme') || 'dark';
            var next = current === 'dark' ? 'light' : 'dark';
            document.body.setAttribute('data-theme', next);
            localStorage.setItem('theme', next);
        }
        function loadTheme() {
            var saved = localStorage.getItem('theme') || 'dark';
            document.body.setAttribute('data-theme', saved);
        }

        function switchTab(tab) {
            App.currentTab = tab;
            document.querySelectorAll('.tab').forEach(function (t, i) {
                t.classList.toggle('active', ['upload', 'analytics', 'filtered', 'queue'][i] === tab);
            });
            document.getElementById('tab-upload').classList.toggle('hidden', tab !== 'upload');
            document.getElementById('tab-analytics').classList.toggle('hidden', tab !== 'analytics');
            document.getElementById('tab-filtered').classList.toggle('hidden', tab !== 'filtered');
            document.getElementById('tab-queue').classList.toggle('hidden', tab !== 'queue');

            if (tab === 'analytics' && !App.wordData) loadWordCloud();
            if (tab === 'queue') loadQueueList();
            if (tab === 'filtered') loadFilteredWords();
        }

        function loadConfig() {
            google.script.run.withSuccessHandler(function (config) {
                App.config = config;
                // AI-powered: no need to populate reason codes dropdown
                // Display AI model info
                console.log('AI Enabled:', config.aiEnabled, 'Model:', config.aiModel);
            }).withFailureHandler(function (e) {
                showDetailedError('loadConfig', e);
            }).cbqGetConfig();
        }

        function loadQueueStatus() {
            google.script.run.withSuccessHandler(function (status) {
                App.queueStatus = status;
                document.getElementById('queue-stats').innerHTML =
                    '<div style="font-size:12px;color:var(--text-secondary);">' +
                    '<div style="margin-bottom:8px;">Queued: <strong>' + status.queued + '</strong></div>' +
                    '<div style="margin-bottom:8px;">Processing: <strong>' + status.processing + '</strong></div>' +
                    '<div style="margin-bottom:8px;">Completed: <strong style="color:var(--positive)">' + status.completed + '</strong></div>' +
                    '<div>Errors: <strong style="color:var(--negative)">' + status.errors + '</strong></div></div>';
            }).withFailureHandler(function (e) {
                showDetailedError('loadQueueStatus', e);
                document.getElementById('queue-stats').innerHTML = '<div style="color:var(--negative);font-size:11px;">Error loading status</div>';
            }).cbqGetQueueStatus();
        }

        function loadStats() {
            google.script.run.withSuccessHandler(function (summary) {
                document.getElementById('stat-docs').textContent = summary.totalWords > 0 ? Math.ceil(summary.totalWords / 50) : 0;
                document.getElementById('stat-words').textContent = summary.totalWords || 0;
                document.getElementById('stat-positive').textContent = summary.positiveWords || 0;
                document.getElementById('stat-negative').textContent = summary.negativeWords || 0;
            }).withFailureHandler(function (e) {
                showDetailedError('loadStats', e);
            }).cbqGetStatsSummary();
        }

        function loadWordCloud() {
            var options = {
                reasonCode: document.getElementById('filter-reason').value || 'GLOBAL',
                mode: document.getElementById('filter-mode').value || 'signal',
                limit: 100
            };
            document.getElementById('word-cloud').innerHTML = '<div class="loading"><div class="spinner"></div><span>Loading...</span></div>';

            google.script.run.withSuccessHandler(function (data) {
                App.wordData = data;
                renderWordCloud(data);
            }).withFailureHandler(function (e) {
                document.getElementById('word-cloud').innerHTML = '<div style="color:var(--text-muted);">No data yet. Upload documents first.</div>';
            }).cbqGetWordCloudData(options);
        }

        function renderWordCloud(data) {
            if (!data || data.length === 0) {
                document.getElementById('word-cloud').innerHTML = '<div style="color:var(--text-muted);">No word data available. Upload and process documents first.</div>';
                return;
            }
            var html = data.map(function (w) {
                var cls = w.value > 0 ? 'positive' : w.value < 0 ? 'negative' : 'neutral';
                var fontSize = Math.max(12, Math.min(36, w.size / 2.5));
                return '<span class="word-item ' + cls + '" style="font-size:' + fontSize + 'px" title="Signal: ' + w.value + '">' + escapeHtml(w.word) + '</span>';
            }).join('');
            document.getElementById('word-cloud').innerHTML = html;
        }

        function loadQueueList() {
            google.script.run.withSuccessHandler(function (docs) {
                if (!docs || docs.length === 0) {
                    document.getElementById('queue-list').innerHTML = '<div class="queue-item"><span style="color:var(--text-muted)">No documents in queue</span></div>';
                    return;
                }
                var html = docs.slice(0, 50).map(function (d) {
                    return '<div class="queue-item">' +
                        '<div><div class="queue-name">' + escapeHtml(d.filename) + '</div>' +
                        '<div class="queue-meta">' + d.outcomeLabel + ' | ' + d.reasonCode + '</div></div>' +
                        '<span class="queue-status ' + d.status.toLowerCase() + '">' + d.status + '</span></div>';
                }).join('');
                document.getElementById('queue-list').innerHTML = html;
            }).cbqGetDocuments({});
        }

        function applyFilters() {
            if (App.currentTab === 'analytics') loadWordCloud();
        }

        function handleDragOver(e) { e.preventDefault(); e.currentTarget.classList.add('dragover'); }
        function handleDragLeave(e) { e.currentTarget.classList.remove('dragover'); }
        function handleDrop(e) { e.preventDefault(); e.currentTarget.classList.remove('dragover'); }

        function submitTextUpload() {
            var text = document.getElementById('upload-text').value.trim();
            var batchType = document.getElementById('selected-outcome').value;

            if (!text) { showToast('Please enter rebuttal text', 'error'); return; }
            if (text.length < 50) { showToast('Text must be at least 50 characters for AI classification', 'error'); return; }
            if (!batchType) { showToast('Please select an outcome classification first', 'error'); return; }

            showToast('Processing with AI...', 'info');
            google.script.run.withSuccessHandler(function (result) {
                var msg = 'Uploaded! AI detected: ' + result.classification.reasonCode + ' (' + result.classification.cardType + ')';
                showToast(msg, 'success');
                document.getElementById('upload-text').value = '';
                loadQueueStatus();
                loadStats();
            }).withFailureHandler(function (e) {
                showToast('Failed: ' + e.message, 'error');
            }).cbqUploadTextWithAI({
                text: text,
                batchType: batchType
            });
        }

        // =====================================================
        // New Revamped Functions
        // =====================================================

        function selectOutcome(outcome) {
            document.getElementById('selected-outcome').value = outcome;
            // Visual feedback - highlight selected button
            document.querySelectorAll('.outcome-btn').forEach(function (btn) {
                btn.style.borderColor = 'var(--border)';
                btn.style.background = 'var(--bg-elevated)';
            });
            var btnId = {
                'AUTO_WIN_72H': 'outcome-72h-win',
                'WIN_30_90D': 'outcome-30-90',
                'AUTO_REJECT_72H': 'outcome-72h-reject'
            }[outcome];
            if (btnId) {
                var btn = document.getElementById(btnId);
                btn.style.borderColor = 'var(--accent-primary)';
                btn.style.background = 'var(--accent-dim)';
            }
        }

        function submitFolderUploadMain() {
            var folderId = document.getElementById('folder-id-main').value.trim();
            var batchType = document.getElementById('selected-outcome').value;

            if (!folderId) { showToast('Please enter a Google Drive folder ID', 'error'); return; }
            if (!batchType) { showToast('Please select an outcome classification', 'error'); return; }

            // Show progress
            document.getElementById('folder-progress').classList.remove('hidden');
            document.getElementById('folder-progress-text').textContent = 'Processing folder with AI...';

            google.script.run.withSuccessHandler(function (result) {
                document.getElementById('folder-progress').classList.add('hidden');
                showToast(result.processed + '/' + result.total + ' PDFs processed successfully!', 'success');

                // Show results
                renderResults(result);
                loadQueueStatus();
                loadStats();
            }).withFailureHandler(function (e) {
                document.getElementById('folder-progress').classList.add('hidden');
                showToast('Failed: ' + e.message, 'error');
            }).cbqUploadFromFolderWithAI({
                folderId: folderId,
                batchType: batchType
            });
        }

        function renderResults(result) {
            var section = document.getElementById('results-section');
            var container = document.getElementById('results-table');

            if (!result.documents || result.documents.length === 0) {
                container.innerHTML = '<p style="color:var(--text-muted);">No documents processed.</p>';
                section.classList.remove('hidden');
                return;
            }

            var html = '<table style="width:100%;border-collapse:collapse;font-size:12px;">' +
                '<thead><tr style="background:var(--bg-elevated);">' +
                '<th style="padding:10px;text-align:left;border-bottom:1px solid var(--border);">Filename</th>' +
                '<th style="padding:10px;text-align:left;border-bottom:1px solid var(--border);">Reason Code</th>' +
                '<th style="padding:10px;text-align:left;border-bottom:1px solid var(--border);">Card Type</th>' +
                '<th style="padding:10px;text-align:left;border-bottom:1px solid var(--border);">Confidence</th>' +
                '<th style="padding:10px;text-align:left;border-bottom:1px solid var(--border);">Status</th>' +
                '</tr></thead><tbody>';

            result.documents.forEach(function (doc) {
                var statusColor = doc.success ? 'var(--positive)' : 'var(--negative)';
                var statusText = doc.success ? '‚úì' : '‚úó ' + (doc.error || 'Failed');
                html += '<tr>' +
                    '<td style="padding:8px;border-bottom:1px solid var(--border);">' + escapeHtml(doc.filename) + '</td>' +
                    '<td style="padding:8px;border-bottom:1px solid var(--border);">' + (doc.reasonCode || '-') + '</td>' +
                    '<td style="padding:8px;border-bottom:1px solid var(--border);">' + (doc.cardType || '-') + '</td>' +
                    '<td style="padding:8px;border-bottom:1px solid var(--border);">' + (doc.confidence ? Math.round(doc.confidence * 100) + '%' : '-') + '</td>' +
                    '<td style="padding:8px;border-bottom:1px solid var(--border);color:' + statusColor + ';">' + statusText + '</td>' +
                    '</tr>';
            });

            html += '</tbody></table>';
            html += '<p style="margin-top:12px;font-size:11px;color:var(--text-muted);">Processed: ' + result.processed + ' | Failed: ' + result.failed + ' | Total: ' + result.total + '</p>';

            container.innerHTML = html;
            section.classList.remove('hidden');
        }

        // Visualization Tab Switching
        App.currentVizTab = 'wordcloud';

        function switchVizTab(tab) {
            App.currentVizTab = tab;
            document.querySelectorAll('#tab-analytics .tabs .tab').forEach(function (t, i) {
                t.classList.toggle('active', ['wordcloud', 'heatmap', 'bubble'][i] === tab);
            });
            document.getElementById('viz-wordcloud').classList.toggle('hidden', tab !== 'wordcloud');
            document.getElementById('viz-heatmap').classList.toggle('hidden', tab !== 'heatmap');
            document.getElementById('viz-bubble').classList.toggle('hidden', tab !== 'bubble');

            if (tab === 'wordcloud' && !App.wordData) loadWordCloud();
            if (tab === 'heatmap') loadHeatMap();
            if (tab === 'bubble') loadBubbleChart();
        }

        function loadHeatMap() {
            var container = document.getElementById('heatmap-container');
            container.innerHTML = '<div class="loading"><div class="spinner"></div><span>Loading heat map...</span></div>';

            google.script.run.withSuccessHandler(function (data) {
                renderHeatMap(data);
            }).withFailureHandler(function (e) {
                container.innerHTML = '<div style="color:var(--text-muted);">No data available for heat map. Process documents first.</div>';
            }).cbqGetWordCloudData({ reasonCode: 'GLOBAL', mode: 'frequency', limit: 50 });
        }

        function renderHeatMap(data) {
            var container = document.getElementById('heatmap-container');
            if (!data || data.length === 0) {
                container.innerHTML = '<div style="color:var(--text-muted);">No data available. Upload and process documents first.</div>';
                return;
            }

            // Simple heat map rendering using CSS grid
            var maxOccur = Math.max.apply(null, data.map(function (w) { return w.size || 1; }));
            var html = '<div style="display:grid;grid-template-columns:repeat(auto-fill,minmax(100px,1fr));gap:4px;">';
            data.slice(0, 50).forEach(function (w) {
                var intensity = Math.min(1, (w.size || 1) / maxOccur);
                var bgColor = w.value > 0 ?
                    'rgba(76,175,80,' + (0.2 + intensity * 0.6) + ')' :
                    w.value < 0 ?
                        'rgba(244,67,54,' + (0.2 + intensity * 0.6) + ')' :
                        'rgba(128,128,128,' + (0.2 + intensity * 0.4) + ')';
                html += '<div style="padding:8px;background:' + bgColor + ';border-radius:4px;text-align:center;font-size:11px;" title="Freq: ' + (w.size || 0) + '">' +
                    escapeHtml(w.word) + '</div>';
            });
            html += '</div>';
            container.innerHTML = html;
        }

        function loadBubbleChart() {
            var container = document.getElementById('bubble-container');
            container.innerHTML = '<div class="loading"><div class="spinner"></div><span>Loading bubble chart...</span></div>';

            google.script.run.withSuccessHandler(function (data) {
                renderBubbleChart(data);
            }).withFailureHandler(function (e) {
                container.innerHTML = '<div style="color:var(--text-muted);">No data available for bubble chart. Process documents first.</div>';
            }).cbqGetBubbleChartData({ reasonCode: 'GLOBAL' });
        }

        function renderBubbleChart(data) {
            var container = document.getElementById('bubble-container');
            if (!data || data.length === 0) {
                container.innerHTML = '<div style="color:var(--text-muted);">No data available. Upload and process documents first.</div>';
                return;
            }

            // Simple bubble chart using absolute positioning
            var html = '<div style="position:relative;height:400px;overflow:hidden;">';
            var maxSize = Math.max.apply(null, data.map(function (w) { return w.size || 1; }));

            data.slice(0, 30).forEach(function (w, i) {
                var size = Math.max(40, Math.min(120, (w.size / maxSize) * 120));
                var left = 10 + (i % 5) * 18;
                var top = 10 + Math.floor(i / 5) * 18;
                var color = w.value > 0 ? 'var(--positive)' : w.value < 0 ? 'var(--negative)' : 'var(--text-muted)';
                html += '<div style="position:absolute;left:' + left + '%;top:' + top + '%;width:' + size + 'px;height:' + size + 'px;' +
                    'border-radius:50%;background:' + color + ';opacity:0.7;display:flex;align-items:center;justify-content:center;' +
                    'font-size:10px;color:#fff;text-align:center;overflow:hidden;padding:4px;" title="Signal: ' + w.value + '">' +
                    escapeHtml(w.word.substring(0, 8)) + '</div>';
            });
            html += '</div>';
            container.innerHTML = html;
        }

        function showFolderUpload() {
            // Legacy function - redirect to main folder input
            document.getElementById('folder-id-main').focus();
            showToast('Use the folder input above', 'info');
        }

        function closeFolderModal() {
            document.getElementById('folder-modal').classList.add('hidden');
        }

        function submitFolderUpload() {
            var folderId = document.getElementById('folder-id-input').value.trim();
            if (!folderId) { showToast('Please enter a folder ID', 'error'); return; }

            var batchType = document.getElementById('upload-outcome').value;

            closeFolderModal();
            showToast('Processing folder with AI...', 'info');
            google.script.run.withSuccessHandler(function (result) {
                showToast(result.processed + '/' + result.total + ' PDFs processed by AI', 'success');
                loadQueueStatus();
            }).withFailureHandler(function (e) {
                showToast('Failed: ' + e.message, 'error');
            }).cbqUploadFromFolderWithAI({
                folderId: folderId,
                batchType: batchType,
                issuer: document.getElementById('upload-issuer').value,
                dateRange: document.getElementById('upload-daterange').value
            });
        }

        function processQueue() {
            showToast('Processing queue...', 'info');
            google.script.run.withSuccessHandler(function (result) {
                showToast('Processed ' + result.succeeded + ' documents', 'success');
                loadQueueStatus();
                loadStats();
            }).withFailureHandler(function (e) {
                showToast('Failed: ' + e.message, 'error');
            }).cbqProcessQueue(10);
        }

        function recalculateStats() {
            var reasonCode = document.getElementById('filter-reason').value || 'GLOBAL';
            showToast('Recalculating...', 'info');
            google.script.run.withSuccessHandler(function (result) {
                showToast('Updated ' + result.wordsUpdated + ' word stats', 'success');
                loadStats();
                if (App.currentTab === 'analytics') loadWordCloud();
            }).withFailureHandler(function (e) {
                showToast('Failed: ' + e.message, 'error');
            }).cbqRecalculateStats(reasonCode);
        }

        function exportStats() {
            var reasonCode = document.getElementById('filter-reason').value || 'GLOBAL';
            showToast('Exporting...', 'info');
            google.script.run.withSuccessHandler(function (data) {
                var csv = data.headers.join(',') + '\n' + data.rows.map(function (r) {
                    return r.map(function (c) { return '"' + String(c || '').replace(/"/g, '""') + '"'; }).join(',');
                }).join('\n');
                var blob = new Blob([csv], { type: 'text/csv' });
                var a = document.createElement('a');
                a.href = URL.createObjectURL(blob);
                a.download = 'cbq_word_stats_' + reasonCode + '.csv';
                a.click();
                showToast('Exported!', 'success');
            }).withFailureHandler(function (e) {
                showToast('Failed: ' + e.message, 'error');
            }).cbqExportStats(reasonCode);
        }

        function showDetailedError(source, error) {
            var msg = error && error.message ? error.message : String(error);
            var stack = error && error.stack ? '\n' + error.stack : '';
            console.error('[CB Error] ' + source + ': ' + msg + stack);

            // Show persistent error banner
            var banner = document.getElementById('error-banner');
            if (!banner) {
                banner = document.createElement('div');
                banner.id = 'error-banner';
                banner.style.cssText = 'position:fixed;top:0;left:0;right:0;padding:12px 20px;background:var(--negative);color:#fff;font-size:12px;z-index:9999;display:flex;justify-content:space-between;align-items:center;';
                document.body.insertBefore(banner, document.body.firstChild);
            }
            banner.innerHTML = '<span><strong>Error in ' + source + ':</strong> ' + escapeHtml(msg) + '</span><button onclick="this.parentElement.remove()" style="background:none;border:none;color:#fff;cursor:pointer;font-size:16px;">&times;</button>';
        }

        function showToast(msg, type) {
            var t = document.getElementById('toast');
            t.textContent = msg;
            t.className = 'toast ' + (type || '');
            t.classList.remove('hidden');
            setTimeout(function () { t.classList.add('hidden'); }, 3000);
        }

        function escapeHtml(text) {
            if (!text) return '';
            var div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }

        // =====================================================
        // Filtered Words Management
        // =====================================================

        function loadFilteredWords() {
            var container = document.getElementById('filtered-words-list');
            container.innerHTML = '<div class="loading"><div class="spinner"></div></div>';

            google.script.run.withSuccessHandler(function (words) {
                if (!words || words.length === 0) {
                    container.innerHTML = '<div class="queue-item"><span style="color:var(--text-muted)">No filtered words yet. Click "Reset Defaults" to add common exclusions.</span></div>';
                    return;
                }

                var html = words.map(function (w) {
                    return '<div class="queue-item">' +
                        '<div><div class="queue-name">' + escapeHtml(w.word) + '</div>' +
                        '<div class="queue-meta">' + w.category + '</div></div>' +
                        '<button class="btn btn-sm" onclick="removeFilteredWord(\'' + escapeHtml(w.word) + '\')" style="color:var(--negative);">√ó</button></div>';
                }).join('');
                container.innerHTML = html;
            }).withFailureHandler(function (e) {
                container.innerHTML = '<div class="queue-item" style="color:var(--negative)">Error loading filtered words</div>';
            }).cbqGetFilteredWords();
        }

        function addFilteredWord() {
            var word = document.getElementById('new-filter-word').value.trim();
            if (!word) { showToast('Enter a word to filter', 'error'); return; }
            if (word.length < 2) { showToast('Word must be at least 2 characters', 'error'); return; }

            google.script.run.withSuccessHandler(function (entry) {
                showToast('Added "' + entry.word + '" to filter list', 'success');
                document.getElementById('new-filter-word').value = '';
                loadFilteredWords();
            }).withFailureHandler(function (e) {
                showToast('Failed: ' + e.message, 'error');
            }).cbqAddFilteredWord(word, 'CUSTOM');
        }

        function removeFilteredWord(word) {
            google.script.run.withSuccessHandler(function (result) {
                if (result) {
                    showToast('Removed "' + word + '" from filter list', 'success');
                    loadFilteredWords();
                } else {
                    showToast('Word not found', 'error');
                }
            }).withFailureHandler(function (e) {
                showToast('Failed: ' + e.message, 'error');
            }).cbqRemoveFilteredWord(word);
        }

        function initializeDefaultFilters() {
            showToast('Initializing default filters...', 'info');
            google.script.run.withSuccessHandler(function (result) {
                showToast(result.message, 'success');
                loadFilteredWords();
            }).withFailureHandler(function (e) {
                showToast('Failed: ' + e.message, 'error');
            }).cbqInitializeFilteredWords();
        }
    </script>

<? } ?>

<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
     FA COACHING
     ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<? if (page === "fa") { ?>
<!-- Global Theme -->

<div class="fa-container">
        <!-- Header -->
        <button class="theme-toggle" onclick="Theme.toggle()" title="Toggle theme"
                aria-label="Toggle dark/light mode">
                <svg class="icon-sun" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <circle cx="12" cy="12" r="5" />
                    <path
                        d="M12 1v2M12 21v2M4.22 4.22l1.42 1.42M18.36 18.36l1.42 1.42M1 12h2M21 12h2M4.22 19.78l1.42-1.42M18.36 5.64l1.42-1.42" />
                </svg>
                <svg class="icon-moon" viewBox="0 0 24 24" fill="currentColor">
                    <path
                        d="M21.752 15.002A9.718 9.718 0 0118 15.75c-5.385 0-9.75-4.365-9.75-9.75 0-1.33.266-2.597.748-3.752A9.753 9.753 0 003 11.25C3 16.635 7.365 21 12.75 21a9.753 9.753 0 009.002-5.998z" />
                </svg>
            </button>
            <a class="fa-back-link" href="<?= ScriptApp.getService().getUrl() ?>">‚Üê Back to Home</a>
            <div class="fa-logo">üîç</div>
            <h1 class="fa-title">FA Coaching</h1>
            <p class="fa-subtitle">Fraud Analysis Case Review & SME Coaching</p>
        </header>

        <!-- Date Picker -->
        <div class="date-picker-section" id="datePickerSection">
            <div class="date-picker-wrapper">
                <input type="text" class="date-input" id="dateInput" placeholder="Select coaching date..."
                    autocomplete="off" spellcheck="false">
                <div class="date-dropdown" id="dateDropdown"></div>
            </div>
        </div>

        <!-- Case List -->
        <div class="case-list-section hidden" id="caseListSection">
            <div class="case-list-header">
                <span class="case-list-title" id="caseListTitle">Cases</span>
                <span class="case-count" id="caseCount"></span>
            </div>
            <div id="caseListContent"></div>
        </div>

        <!-- Case Detail -->
        <div class="case-detail-section hidden" id="caseDetailSection">
            <button class="detail-back-btn" onclick="FACoaching.backToList()">‚Üê Back to list</button>

            <div class="detail-card" id="caseDetailCard"></div>

            <div class="sme-section">
                <div class="sme-label">SME Coaching Notes</div>
                <textarea class="sme-textarea" id="smeNotesInput"
                    placeholder="Enter coaching feedback, observations, or guidance..."></textarea>
                <div class="sme-actions">
                    <button class="sme-save-btn" id="smeSaveBtn" onclick="FACoaching.saveNotes()">Save Notes</button>
                </div>
            </div>
        </div>

        <!-- Toast -->
        <div class="fa-toast" id="faToast"></div>
    </div>

    <script>
        /**
         * ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
         * FA COACHING ‚Äî CLIENT-SIDE LOGIC
         * ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
         */

        const FACoaching = {
            dates: [],
            cases: [],
            selectedCase: null,
            selectedDate: '',

            // ‚îÄ‚îÄ‚îÄ Init ‚îÄ‚îÄ‚îÄ
            init() {
                this.loadDates();
                this.bindEvents();
            },

            // ‚îÄ‚îÄ‚îÄ Load coaching dates ‚îÄ‚îÄ‚îÄ
            loadDates() {
                const input = document.getElementById('dateInput');
                input.disabled = true;
                input.placeholder = 'Loading dates...';

                google.script.run
                    .withSuccessHandler(dates => {
                        this.dates = dates || [];
                        input.disabled = false;
                        input.placeholder = 'Type or select a coaching date...';
                    })
                    .withFailureHandler(err => {
                        console.error('Failed to load dates:', err);
                        input.disabled = false;
                        input.placeholder = 'Type a coaching date (MM/DD/YY)...';
                    })
                    .faGetCoachingDates();
            },

            // ‚îÄ‚îÄ‚îÄ Bind events ‚îÄ‚îÄ‚îÄ
            bindEvents() {
                const input = document.getElementById('dateInput');
                const dropdown = document.getElementById('dateDropdown');

                input.addEventListener('focus', () => this.showDropdown());
                input.addEventListener('input', () => this.filterDropdown());
                input.addEventListener('keydown', e => {
                    if (e.key === 'Enter') {
                        e.preventDefault();
                        const val = input.value.trim();
                        if (val) this.selectDate(val);
                    }
                    if (e.key === 'Escape') {
                        dropdown.classList.remove('open');
                    }
                });

                // Close dropdown on outside click
                document.addEventListener('click', e => {
                    if (!e.target.closest('.date-picker-wrapper')) {
                        dropdown.classList.remove('open');
                    }
                });
            },

            // ‚îÄ‚îÄ‚îÄ Dropdown logic ‚îÄ‚îÄ‚îÄ
            showDropdown() {
                this.renderDropdown(this.dates);
            },

            filterDropdown() {
                const query = document.getElementById('dateInput').value.trim().toLowerCase();
                const filtered = this.dates.filter(d => d.toLowerCase().includes(query));
                this.renderDropdown(filtered);
            },

            renderDropdown(items) {
                const dropdown = document.getElementById('dateDropdown');
                if (!items.length) {
                    dropdown.classList.remove('open');
                    return;
                }

                dropdown.innerHTML = items.map(d =>
                    `<div class="date-option${d === this.selectedDate ? ' selected' : ''}" 
                          onclick="FACoaching.selectDate('${d}')">${d}</div>`
                ).join('');
                dropdown.classList.add('open');
            },

            // ‚îÄ‚îÄ‚îÄ Select date ‚Üí load cases ‚îÄ‚îÄ‚îÄ
            selectDate(dateStr) {
                this.selectedDate = dateStr;
                document.getElementById('dateInput').value = dateStr;
                document.getElementById('dateDropdown').classList.remove('open');

                // Show loading
                const listSection = document.getElementById('caseListSection');
                const detailSection = document.getElementById('caseDetailSection');
                listSection.classList.remove('hidden');
                detailSection.classList.add('hidden');

                document.getElementById('caseListTitle').textContent = `Cases for ${dateStr}`;
                document.getElementById('caseListContent').innerHTML =
                    '<div class="fa-loading"><div class="fa-spinner"></div> Loading cases...</div>';
                document.getElementById('caseCount').textContent = '';

                google.script.run
                    .withSuccessHandler(cases => this.renderCaseList(cases))
                    .withFailureHandler(err => {
                        document.getElementById('caseListContent').innerHTML =
                            '<div class="fa-empty"><div class="fa-empty-icon">‚ö†Ô∏è</div><div class="fa-empty-text">Failed to load cases</div></div>';
                        console.error(err);
                    })
                    .faGetCasesByDate(dateStr);
            },

            // ‚îÄ‚îÄ‚îÄ Render case list ‚îÄ‚îÄ‚îÄ
            renderCaseList(cases) {
                this.cases = cases || [];
                const container = document.getElementById('caseListContent');
                const countEl = document.getElementById('caseCount');

                if (!this.cases.length) {
                    container.innerHTML =
                        '<div class="fa-empty"><div class="fa-empty-icon">üìã</div><div class="fa-empty-text">No cases found for this date</div></div>';
                    countEl.textContent = '0 cases';
                    return;
                }

                countEl.textContent = `${this.cases.length} case${this.cases.length !== 1 ? 's' : ''}`;

                let html = `<table class="case-table">
                    <thead>
                        <tr>
                            <th>Analyst</th>
                            <th>ITN</th>
                            <th>Notes</th>
                        </tr>
                    </thead>
                    <tbody>`;

                this.cases.forEach((c, i) => {
                    const truncNotes = c.notes.length > 80 ? c.notes.substring(0, 80) + '‚Ä¶' : c.notes;
                    html += `<tr class="case-row" onclick="FACoaching.selectCase(${i})">
                        <td>${this.esc(c.name)}</td>
                        <td class="itn-cell">${this.esc(c.itn)}</td>
                        <td class="notes-cell">${this.esc(truncNotes)}</td>
                    </tr>`;
                });

                html += '</tbody></table>';
                container.innerHTML = html;
            },

            // ‚îÄ‚îÄ‚îÄ Select a case ‚îÄ‚îÄ‚îÄ
            selectCase(index) {
                this.selectedCase = this.cases[index];
                if (!this.selectedCase) return;

                // Hide list, show detail
                document.getElementById('caseListSection').classList.add('hidden');
                document.getElementById('caseDetailSection').classList.remove('hidden');

                const card = document.getElementById('caseDetailCard');
                const c = this.selectedCase;

                card.innerHTML = `
                    <div class="detail-row">
                        <div class="detail-field">
                            <div class="detail-label">Analyst</div>
                            <div class="detail-value">${this.esc(c.name)}</div>
                        </div>
                        <div class="detail-field">
                            <div class="detail-label">ITN</div>
                            <div class="detail-value mono">${this.esc(c.itn)}</div>
                        </div>
                    </div>
                    <div class="detail-row">
                        <div class="detail-field">
                            <div class="detail-label">Date</div>
                            <div class="detail-value mono">${this.esc(c.date)}</div>
                        </div>
                        <div class="detail-field">
                            <div class="detail-label">Resolution</div>
                            <div class="detail-value">${this.esc(c.reso)}</div>
                        </div>
                    </div>
                    <div class="detail-notes-block">
                        <div class="detail-label">QA Notes</div>
                        <div class="detail-notes-text">${this.esc(c.notes)}</div>
                    </div>
                `;

                // Pre-fill existing SME notes
                document.getElementById('smeNotesInput').value = c.smeNotes || '';
            },

            // ‚îÄ‚îÄ‚îÄ Back to list ‚îÄ‚îÄ‚îÄ
            backToList() {
                document.getElementById('caseDetailSection').classList.add('hidden');
                document.getElementById('caseListSection').classList.remove('hidden');
                this.selectedCase = null;
            },

            // ‚îÄ‚îÄ‚îÄ Save SME notes ‚îÄ‚îÄ‚îÄ
            saveNotes() {
                if (!this.selectedCase) return;

                const notes = document.getElementById('smeNotesInput').value.trim();
                const btn = document.getElementById('smeSaveBtn');

                btn.textContent = 'Saving...';
                btn.classList.add('saving');
                btn.disabled = true;

                google.script.run
                    .withSuccessHandler(result => {
                        btn.textContent = 'Save Notes';
                        btn.classList.remove('saving');
                        btn.disabled = false;

                        if (result && result.success) {
                            // Update local state
                            this.selectedCase.smeNotes = notes;
                            const idx = this.cases.findIndex(c => c.rowIndex === this.selectedCase.rowIndex);
                            if (idx !== -1) this.cases[idx].smeNotes = notes;
                            this.showToast('Notes saved', false);
                        } else {
                            this.showToast(result?.message || 'Failed to save', true);
                        }
                    })
                    .withFailureHandler(err => {
                        btn.textContent = 'Save Notes';
                        btn.classList.remove('saving');
                        btn.disabled = false;
                        this.showToast('Error saving notes', true);
                        console.error(err);
                    })
                    .faSaveSmeNotes(this.selectedCase.rowIndex, notes);
            },

            // ‚îÄ‚îÄ‚îÄ Toast ‚îÄ‚îÄ‚îÄ
            showToast(msg, isError) {
                const toast = document.getElementById('faToast');
                toast.textContent = msg;
                toast.className = 'fa-toast show' + (isError ? ' error' : '');
                setTimeout(() => toast.classList.remove('show'), 3000);
            },

            // ‚îÄ‚îÄ‚îÄ Escape HTML ‚îÄ‚îÄ‚îÄ
            esc(str) {
                if (!str) return '';
                const el = document.createElement('span');
                el.textContent = str;
                return el.innerHTML;
            }
        };

        // Auto-init
        document.addEventListener('DOMContentLoaded', () => FACoaching.init());
    </script>

<? } ?>

<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
     REPORTS QUEUE
     ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<? if (page === "queue") { ?>
<link
        href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@300;400;500;600&family=Space+Mono:wght@400;700&display=swap"
        rel="stylesheet">

    <!-- Global Theme -->

<div class="app">
        <div class="header-left">
                <a href="<?= ScriptApp.getService().getUrl() ?>" class="logo">√ò</a>
                <nav class="nav">
                    <a class="nav-link active" href="<?= ScriptApp.getService().getUrl() ?>?page=queue">Reports
                        Queue</a>
                </nav>
            </div>
            <div class="header-right">
                <span class="user-badge">
                    <?= user ?>
                </span>
                <button class="theme-toggle" onclick="Theme.toggle()" title="Toggle theme"
                    aria-label="Toggle dark/light mode">
                    <svg class="icon-sun" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <circle cx="12" cy="12" r="5" />
                        <path
                            d="M12 1v2M12 21v2M4.22 4.22l1.42 1.42M18.36 18.36l1.42 1.42M1 12h2M21 12h2M4.22 19.78l1.42-1.42M18.36 5.64l1.42-1.42" />
                    </svg>
                    <svg class="icon-moon" viewBox="0 0 24 24" fill="currentColor">
                        <path
                            d="M21.752 15.002A9.718 9.718 0 0118 15.75c-5.385 0-9.75-4.365-9.75-9.75 0-1.33.266-2.597.748-3.752A9.753 9.753 0 003 11.25C3 16.635 7.365 21 12.75 21a9.753 9.753 0 009.002-5.998z" />
                    </svg>
                </button>
                <? if (isAdmin) { ?>
                <a class="icon-btn" href="<?= ScriptApp.getService().getUrl() ?>?page=admin" title="Admin Panel">‚öôÔ∏è</a>
                <? } ?>
            </div>
        </header>

        <main class="main">
            <div class="stats">
                <div class="stat-card active" data-queue="all" onclick="switchQueue('all')">
                    <div class="stat-label">All Reports</div>
                    <div class="stat-value all" id="stat-all">-</div>
                </div>
                <div class="stat-card" data-queue="pending" onclick="switchQueue('pending')">
                    <div class="stat-label">Pending Review</div>
                    <div class="stat-value pending" id="stat-pending">-</div>
                </div>
                <div class="stat-card" data-queue="accepted" onclick="switchQueue('accepted')">
                    <div class="stat-label">Accepted</div>
                    <div class="stat-value accepted" id="stat-accepted">-</div>
                </div>
                <div class="stat-card" data-queue="rejected" onclick="switchQueue('rejected')">
                    <div class="stat-label">Rejected</div>
                    <div class="stat-value rejected" id="stat-rejected">-</div>
                </div>
            </div>

            <div class="sub-filters">
                <button class="sub-filter active" data-view="all" onclick="switchView('all')">All</button>
                <button class="sub-filter" data-view="mine" onclick="switchView('mine')">My Reports</button>
                <button class="sub-filter" data-view="review" onclick="switchView('review')">Needs My Review</button>
            </div>

            <div class="toolbar">
                <div class="filters-toggle" onclick="toggleFilters()">
                    <span id="filter-icon">‚äï</span> Filters & Sort
                </div>
                <? if (featureFlags.ALLOW_BULK_ACTIONS) { ?>
                <div class="bulk-actions" id="bulk-actions" style="display:none;">
                    <button class="btn btn-sm btn-success" onclick="bulkApprove()">‚úì Approve Selected</button>
                    <button class="btn btn-sm btn-danger" onclick="bulkReject()">‚úó Reject Selected</button>
                    <button class="btn btn-sm" onclick="exportSelected()">‚Üì Export</button>
                </div>
                <? } ?>
            </div>

            <div class="filters-bar" id="filters-bar">
                <div class="filter-group">
                    <label class="filter-label">Search</label>
                    <input type="text" class="filter-input" id="filter-search" placeholder="Search reports...">
                </div>
                <div class="filter-group">
                    <label class="filter-label">Team</label>
                    <select class="filter-select" id="filter-team">
                        <option value="">All Teams</option>
                    </select>
                </div>
                <div class="filter-group">
                    <label class="filter-label">Classification</label>
                    <select class="filter-select" id="filter-class">
                        <option value="">All</option>
                        <option value="Master">Master</option>
                        <option value="Derived">Derived</option>
                    </select>
                </div>
                <div class="filter-group">
                    <label class="filter-label">Sort By</label>
                    <select class="filter-select" id="filter-sort">
                        <option value="newest">Newest First</option>
                        <option value="oldest">Oldest First</option>
                        <option value="name-asc">Name A-Z</option>
                        <option value="name-desc">Name Z-A</option>
                    </select>
                </div>
            </div>

            <div class="reports-list" id="reports-list">
                <div class="loading">
                    <div class="spinner"></div><span>Loading reports...</span>
                </div>
            </div>

            <div class="fab">
                <button class="btn btn-primary" onclick="openCreateModal()">+ New Report</button>
            </div>
        </main>
    </div>

    <!-- View Report Modal -->
    <div class="modal-overlay hidden" id="view-modal">
        <div class="modal">
            <div class="modal-header">
                <h2 class="modal-title" id="view-title">Report Details</h2>
                <button class="modal-close" onclick="closeModal('view-modal')">√ó</button>
            </div>
            <div class="modal-body" id="view-body"></div>
            <div class="modal-footer" id="view-footer"></div>
        </div>
    </div>

    <!-- Create Report Modal -->
    <div class="modal-overlay hidden" id="create-modal">
        <div class="modal">
            <div class="modal-header">
                <h2 class="modal-title">Create New Report</h2>
                <button class="modal-close" onclick="closeModal('create-modal')">√ó</button>
            </div>
            <div class="modal-body">
                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label">Report Name *</label>
                        <input type="text" class="form-input" id="create-name"
                            placeholder="e.g. Daily Performance Report">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Classification</label>
                        <select class="form-select" id="create-classification">
                            <option value="Master">Master</option>
                            <option value="Derived">Derived</option>
                        </select>
                    </div>
                </div>
                <div class="form-group">
                    <label class="form-label">Description</label>
                    <textarea class="form-textarea" id="create-description"
                        placeholder="Brief description..."></textarea>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label">Frequency</label>
                        <select class="form-select" id="create-frequency">
                            <option value="Daily">Daily</option>
                            <option value="Weekly">Weekly</option>
                            <option value="Monthly">Monthly</option>
                            <option value="As Triggered">As Triggered</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Team</label>
                        <select class="form-select" id="create-team">
                            <option value="Reporting Team">Reporting Team</option>
                            <option value="Fraud Prevention Team">Fraud Prevention Team</option>
                            <option value="Chargeback Team">Chargeback Team</option>
                            <option value="SME">SME</option>
                        </select>
                    </div>
                </div>
                <div
                    style="margin: 20px 0 10px; font-size: 11px; color: var(--text-muted); text-transform: uppercase; letter-spacing: 0.5px;">
                    RACI Assignment</div>
                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label">Responsible (You)</label>
                        <input type="text" class="form-input" id="create-responsible" value="<?= user ?>" readonly>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Accountable *</label>
                        <div class="user-picker-wrap">
                            <input type="text" class="user-picker-input" id="create-accountable"
                                placeholder="Type to search..." autocomplete="off" data-email="">
                            <div class="user-picker-dropdown" id="dropdown-accountable"></div>
                        </div>
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label">Consulted</label>
                        <div class="user-picker-wrap">
                            <input type="text" class="user-picker-input" id="create-consulted"
                                placeholder="Type to search..." autocomplete="off" data-email="">
                            <div class="user-picker-dropdown" id="dropdown-consulted"></div>
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Informed</label>
                        <div class="user-picker-wrap">
                            <input type="text" class="user-picker-input" id="create-informed"
                                placeholder="Type to search..." autocomplete="off" data-email="">
                            <div class="user-picker-dropdown" id="dropdown-informed"></div>
                        </div>
                    </div>
                </div>
                <div class="form-group">
                    <label class="form-label">Data Source</label>
                    <input type="text" class="form-input" id="create-dataSource"
                        placeholder="e.g. Accertify | CB Portals">
                </div>
                <div class="form-group">
                    <label class="form-label">Storage Location (Link to file)</label>
                    <input type="text" class="form-input" id="create-storageLocation"
                        placeholder="e.g. https://drive.google.com/...">
                </div>
            </div>
            <div class="modal-footer">
                <div></div>
                <div style="display:flex;gap:8px;">
                    <button class="btn" onclick="closeModal('create-modal')">Cancel</button>
                    <button class="btn btn-success" onclick="submitCreateReport()">Create Report</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Reject Modal (styled) -->
    <div class="modal-overlay hidden" id="reject-modal">
        <div class="modal" style="max-width:500px;">
            <div class="modal-header">
                <h2 class="modal-title">Reject Report</h2>
                <button class="modal-close" onclick="closeModal('reject-modal')">√ó</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label class="form-label">Rejection Reason *</label>
                    <textarea class="form-textarea" id="reject-reason"
                        placeholder="Please provide a reason for rejection..."></textarea>
                </div>
            </div>
            <div class="modal-footer">
                <div></div>
                <div style="display:flex;gap:8px;">
                    <button class="btn" onclick="closeModal('reject-modal')">Cancel</button>
                    <button class="btn btn-danger" onclick="confirmReject()">Reject Report</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Approve Modal (styled) -->
    <div class="modal-overlay hidden" id="approve-modal">
        <div class="modal" style="max-width:500px;">
            <div class="modal-header">
                <h2 class="modal-title">Approve Report</h2>
                <button class="modal-close" onclick="closeModal('approve-modal')">√ó</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label class="form-label">Comment (optional)</label>
                    <textarea class="form-textarea" id="approve-comment" placeholder="Add a comment..."></textarea>
                </div>
            </div>
            <div class="modal-footer">
                <div></div>
                <div style="display:flex;gap:8px;">
                    <button class="btn" onclick="closeModal('approve-modal')">Cancel</button>
                    <button class="btn btn-success" onclick="confirmApprove()">Approve Report</button>
                </div>
            </div>
        </div>
    </div>

    <div class="toast hidden" id="toast"></div>

    <script>
        var App = {
            reports: [],
            users: [],
            currentQueue: 'all',
            currentView: 'all',
            currentReport: null,
            userEmail: '<?= user ?>',
            isAdmin: <?= isAdmin ?>,
            allowBulkActions: <?= featureFlags.ALLOW_BULK_ACTIONS ?>
        };

        document.addEventListener('DOMContentLoaded', function () {
            loadTheme();
            loadUsers();
            loadReports();
            setupFilters();
            setupUserPickers();
        });

        function toggleTheme() {
            var current = document.body.getAttribute('data-theme') || 'dark';
            var next = current === 'dark' ? 'light' : 'dark';
            document.body.setAttribute('data-theme', next);
            localStorage.setItem('theme', next);
        }
        function loadTheme() {
            var saved = localStorage.getItem('theme') || 'dark';
            document.body.setAttribute('data-theme', saved);
        }

        function loadUsers() {
            google.script.run.withSuccessHandler(function (users) {
                App.users = users || [];
            }).getUsersForPicker();
        }

        function loadReports() {
            showLoading();
            google.script.run.withSuccessHandler(function (reports) {
                App.reports = reports || [];
                updateStats();
                renderReports();
            }).withFailureHandler(function (err) {
                showError(err.message);
            }).getReports({});
        }

        function setupFilters() {
            google.script.run.withSuccessHandler(function (options) {
                var teamSelect = document.getElementById('filter-team');
                if (options && options.teams) {
                    options.teams.forEach(function (t) {
                        var opt = document.createElement('option');
                        opt.value = t; opt.textContent = t;
                        teamSelect.appendChild(opt);
                    });
                }
            }).getFilterOptions();
            document.getElementById('filter-search').addEventListener('input', debounce(renderReports, 300));
            document.getElementById('filter-team').addEventListener('change', renderReports);
            document.getElementById('filter-class').addEventListener('change', renderReports);
            document.getElementById('filter-sort').addEventListener('change', renderReports);
        }

        function setupUserPickers() {
            ['accountable', 'consulted', 'informed'].forEach(function (field) {
                var input = document.getElementById('create-' + field);
                var dropdown = document.getElementById('dropdown-' + field);
                input.addEventListener('focus', function () { showUserDropdown(field, ''); });
                input.addEventListener('input', function () { showUserDropdown(field, input.value); });
                input.addEventListener('blur', function () { setTimeout(function () { dropdown.classList.remove('show'); }, 200); });
            });
        }

        function showUserDropdown(field, query) {
            var dropdown = document.getElementById('dropdown-' + field);
            var q = query.toLowerCase();
            var filtered = App.users.filter(function (u) {
                return u.displayLabel.toLowerCase().includes(q) || u.email.toLowerCase().includes(q);
            }).slice(0, 10);
            if (filtered.length === 0) {
                dropdown.innerHTML = '<div class="user-picker-item" style="color:var(--text-muted)">No users found</div>';
            } else {
                dropdown.innerHTML = filtered.map(function (u) {
                    return '<div class="user-picker-item" onclick="selectUser(\'' + field + '\', \'' + u.email + '\', \'' + u.displayLabel + '\')">' + u.displayLabel + '<span class="email">' + u.email + '</span></div>';
                }).join('');
            }
            dropdown.classList.add('show');
        }

        function selectUser(field, email, label) {
            var input = document.getElementById('create-' + field);
            input.value = label;
            input.setAttribute('data-email', email);
            document.getElementById('dropdown-' + field).classList.remove('show');
        }

        function updateStats() {
            document.getElementById('stat-all').textContent = App.reports.length;
            document.getElementById('stat-pending').textContent = App.reports.filter(function (r) { return r.state === 'Pending'; }).length;
            document.getElementById('stat-accepted').textContent = App.reports.filter(function (r) { return r.state === 'Accepted'; }).length;
            document.getElementById('stat-rejected').textContent = App.reports.filter(function (r) { return r.state === 'Rejected'; }).length;
        }

        function switchQueue(queue) {
            App.currentQueue = queue;
            document.querySelectorAll('.stat-card').forEach(function (c) { c.classList.toggle('active', c.dataset.queue === queue); });
            renderReports();
        }

        function switchView(view) {
            App.currentView = view;
            document.querySelectorAll('.sub-filter').forEach(function (f) { f.classList.toggle('active', f.dataset.view === view); });
            renderReports();
        }

        function toggleFilters() {
            var bar = document.getElementById('filters-bar');
            var icon = document.getElementById('filter-icon');
            bar.classList.toggle('show');
            icon.textContent = bar.classList.contains('show') ? '‚äñ' : '‚äï';
        }

        function getFilteredReports() {
            var list = App.reports.slice();
            var email = App.userEmail.toLowerCase();
            if (App.currentQueue === 'pending') list = list.filter(function (r) { return r.state === 'Pending'; });
            else if (App.currentQueue === 'accepted') list = list.filter(function (r) { return r.state === 'Accepted'; });
            else if (App.currentQueue === 'rejected') list = list.filter(function (r) { return r.state === 'Rejected'; });
            if (App.currentView === 'mine') {
                list = list.filter(function (r) { return r.responsible && r.responsible.toLowerCase() === email; });
            } else if (App.currentView === 'review') {
                list = list.filter(function (r) {
                    return (r.accountable && r.accountable.toLowerCase().includes(email)) ||
                        (r.consulted && r.consulted.toLowerCase().includes(email)) ||
                        (r.informed && r.informed.toLowerCase().includes(email));
                });
            }
            var search = document.getElementById('filter-search').value.toLowerCase();
            if (search) list = list.filter(function (r) { return (r.name && r.name.toLowerCase().includes(search)) || (r.description && r.description.toLowerCase().includes(search)); });
            var team = document.getElementById('filter-team').value;
            if (team) list = list.filter(function (r) { return r.team === team; });
            var cls = document.getElementById('filter-class').value;
            if (cls) list = list.filter(function (r) { return r.classification === cls; });
            var sort = document.getElementById('filter-sort').value;
            if (sort === 'newest') list.sort(function (a, b) { return new Date(b.createdAt) - new Date(a.createdAt); });
            else if (sort === 'oldest') list.sort(function (a, b) { return new Date(a.createdAt) - new Date(b.createdAt); });
            else if (sort === 'name-asc') list.sort(function (a, b) { return (a.name || '').localeCompare(b.name || ''); });
            else if (sort === 'name-desc') list.sort(function (a, b) { return (b.name || '').localeCompare(a.name || ''); });
            return list;
        }

        function renderReports() {
            var list = getFilteredReports();
            var container = document.getElementById('reports-list');
            if (list.length === 0) {
                container.innerHTML = '<div class="empty-state"><div class="empty-icon">üìã</div><div>No reports found</div></div>';
                return;
            }
            container.innerHTML = list.map(function (r) {
                return '<div class="report-row" onclick="openViewModal(\'' + r.id + '\')">' +
                    '<div><div class="report-name">' + escapeHtml(r.name) + '</div><div class="report-desc">' + escapeHtml(r.description || '') + '</div></div>' +
                    '<div class="report-meta">' + escapeHtml(r.team || '-') + '</div>' +
                    '<div class="report-meta">' + escapeHtml(r.frequency || '-') + '</div>' +
                    '<div><span class="badge ' + (r.classification || '').toLowerCase() + '">' + (r.classification || 'N/A') + '</span></div>' +
                    '<div><span class="badge ' + (r.state || 'pending').toLowerCase() + '">' + (r.state || 'Pending') + '</span></div></div>';
            }).join('');
        }

        function showLoading() { document.getElementById('reports-list').innerHTML = '<div class="loading"><div class="spinner"></div><span>Loading...</span></div>'; }
        function showError(msg) { document.getElementById('reports-list').innerHTML = '<div class="empty-state"><div class="empty-icon">‚ö†Ô∏è</div><div>' + msg + '</div></div>'; }

        function openViewModal(id) {
            var r = App.reports.find(function (x) { return x.id === id; });
            if (!r) return;
            App.currentReport = r;
            document.getElementById('view-title').textContent = r.name;

            var approvalHistory = [];
            try { approvalHistory = JSON.parse(r.approvalHistory || '[]'); } catch (e) { }
            var comments = [];
            try { comments = JSON.parse(r.comments || '[]'); } catch (e) { }

            // Storage link at top
            var storageHtml = '';
            if (r.storageLocation) {
                var linkUrl = r.storageLocation.startsWith('http') ? r.storageLocation : 'https://' + r.storageLocation;
                storageHtml = '<a href="' + escapeHtml(linkUrl) + '" target="_blank" class="storage-link">' +
                    '<span class="storage-link-icon">üîó</span>' +
                    '<div class="storage-link-label">Storage Location (Click to open)</div>' +
                    '<div class="storage-link-url">' + escapeHtml(r.storageLocation) + '</div></a>';
            }

            var historyHtml = '';
            if (approvalHistory.length > 0) {
                historyHtml = '<div style="margin-top:20px;"><div class="form-label">Approval History</div><div class="timeline">' +
                    approvalHistory.map(function (h) {
                        return '<div class="timeline-item ' + (h.action || '').toLowerCase() + '"><div class="timeline-content"><div class="timeline-user">' + escapeHtml(h.user) + '</div><div class="timeline-action">' + escapeHtml(h.action) + (h.comment ? ': ' + escapeHtml(h.comment) : '') + '</div><div class="timeline-time">' + (h.timestamp || '') + '</div></div></div>';
                    }).join('') + '</div></div>';
            }

            var commentsHtml = '<div class="comments-section"><div class="form-label">Comments (' + comments.length + ')</div>';
            if (comments.length > 0) {
                commentsHtml += comments.map(function (c) {
                    return '<div class="comment"><div class="comment-header"><span class="comment-user">' + escapeHtml(c.user) + '</span><span class="comment-time">' + (c.timestamp || '') + '</span></div><div class="comment-text">' + escapeHtml(c.text) + '</div></div>';
                }).join('');
            } else {
                commentsHtml += '<div style="color:var(--text-muted);font-size:12px;padding:12px 0;">No comments yet</div>';
            }
            commentsHtml += '<div class="comment-form"><input type="text" class="comment-input" id="new-comment" placeholder="Add a comment..."><button class="btn btn-sm" onclick="addComment()">Post</button></div></div>';

            document.getElementById('view-body').innerHTML = storageHtml +
                '<p style="color:var(--text-secondary);margin-bottom:16px;">' + (r.description || 'No description') + '</p>' +
                '<div class="form-row"><div class="form-group"><label class="form-label">Classification</label><span class="badge ' + (r.classification || '').toLowerCase() + '">' + (r.classification || 'N/A') + '</span></div>' +
                '<div class="form-group"><label class="form-label">Frequency</label><p style="color:var(--text-secondary)">' + (r.frequency || '-') + '</p></div></div>' +
                '<div class="form-row"><div class="form-group"><label class="form-label">Team</label><p style="color:var(--text-secondary)">' + (r.team || '-') + '</p></div>' +
                '<div class="form-group"><label class="form-label">State</label><span class="badge ' + (r.state || 'pending').toLowerCase() + '">' + (r.state || 'Pending') + '</span></div></div>' +
                '<div class="raci-grid">' +
                '<div class="raci-item"><div class="raci-role">Responsible</div><div class="raci-value">' + emailToName(r.responsible) + '</div></div>' +
                '<div class="raci-item"><div class="raci-role">Accountable</div><div class="raci-value">' + emailToName(r.accountable) + '</div></div>' +
                '<div class="raci-item"><div class="raci-role">Consulted</div><div class="raci-value">' + emailToName(r.consulted) + '</div></div>' +
                '<div class="raci-item"><div class="raci-role">Informed</div><div class="raci-value">' + emailToName(r.informed) + '</div></div></div>' +
                historyHtml + commentsHtml;

            var footerLeft = '';
            if (App.isAdmin) {
                footerLeft = '<div><button class="btn btn-danger btn-sm" onclick="deactivateReport(\'' + r.id + '\')">üóë Deactivate</button></div>';
            } else {
                footerLeft = '<div></div>';
            }
            var footerRight = '<button class="btn" onclick="closeModal(\'view-modal\')">Close</button>';
            if (r.state === 'Pending') {
                footerRight = '<button class="btn btn-danger" onclick="openRejectModal()">Reject</button><button class="btn btn-success" onclick="openApproveModal()">Approve</button>' + footerRight;
            }
            document.getElementById('view-footer').innerHTML = footerLeft + '<div style="display:flex;gap:8px;">' + footerRight + '</div>';
            document.getElementById('view-modal').classList.remove('hidden');
        }

        function openRejectModal() {
            document.getElementById('reject-reason').value = '';
            document.getElementById('reject-modal').classList.remove('hidden');
        }

        function confirmReject() {
            var reason = document.getElementById('reject-reason').value.trim();
            if (!reason) { showToast('Please provide a rejection reason', 'error'); return; }
            closeModal('reject-modal');
            showToast('Rejecting...', 'info');
            google.script.run.withSuccessHandler(function () {
                showToast('Rejected', 'success');
                closeModal('view-modal');
                loadReports();
            }).withFailureHandler(function (e) { showToast('Failed: ' + e.message, 'error'); }).changeReportState(App.currentReport.id, 'Rejected', reason);
        }

        function openApproveModal() {
            document.getElementById('approve-comment').value = '';
            document.getElementById('approve-modal').classList.remove('hidden');
        }

        function confirmApprove() {
            var comment = document.getElementById('approve-comment').value.trim();
            closeModal('approve-modal');
            showToast('Approving...', 'info');
            google.script.run.withSuccessHandler(function () {
                showToast('Approved!', 'success');
                closeModal('view-modal');
                loadReports();
            }).withFailureHandler(function (e) { showToast('Failed: ' + e.message, 'error'); }).changeReportState(App.currentReport.id, 'Accepted', comment);
        }

        function addComment() {
            var text = document.getElementById('new-comment').value.trim();
            if (!text || !App.currentReport) return;
            showToast('Adding comment...', 'info');
            google.script.run.withSuccessHandler(function () {
                showToast('Comment added', 'success');
                loadReports();
                setTimeout(function () { openViewModal(App.currentReport.id); }, 500);
            }).withFailureHandler(function (e) { showToast('Failed: ' + e.message, 'error'); }).addComment(App.currentReport.id, text);
        }

        function deactivateReport(id) {
            if (!confirm('Deactivate this report?')) return;
            showToast('Deactivating...', 'info');
            google.script.run.withSuccessHandler(function () {
                showToast('Report deactivated', 'success');
                closeModal('view-modal');
                loadReports();
            }).withFailureHandler(function (e) { showToast('Failed: ' + e.message, 'error'); }).deactivateReport(id);
        }

        function closeModal(id) { document.getElementById(id).classList.add('hidden'); }
        function openCreateModal() { document.getElementById('create-modal').classList.remove('hidden'); }

        function submitCreateReport() {
            var name = document.getElementById('create-name').value.trim();
            if (!name) { showToast('Report name is required', 'error'); return; }
            var accountableEmail = document.getElementById('create-accountable').getAttribute('data-email');
            var consultedEmail = document.getElementById('create-consulted').getAttribute('data-email');
            var informedEmail = document.getElementById('create-informed').getAttribute('data-email');
            if (!accountableEmail) { showToast('Please select an Accountable person', 'error'); return; }
            var data = {
                name: name,
                classification: document.getElementById('create-classification').value,
                description: document.getElementById('create-description').value,
                frequency: document.getElementById('create-frequency').value,
                team: document.getElementById('create-team').value,
                accountable: accountableEmail,
                consulted: consultedEmail,
                informed: informedEmail,
                dataSource: document.getElementById('create-dataSource').value,
                storageLocation: document.getElementById('create-storageLocation').value
            };
            showToast('Creating report...', 'info');
            google.script.run.withSuccessHandler(function () {
                showToast('Report created!', 'success');
                closeModal('create-modal');
                clearCreateForm();
                loadReports();
            }).withFailureHandler(function (e) { showToast('Failed: ' + e.message, 'error'); }).createReport(data);
        }

        function clearCreateForm() {
            ['create-name', 'create-description', 'create-accountable', 'create-consulted', 'create-informed', 'create-dataSource', 'create-storageLocation'].forEach(function (id) {
                var el = document.getElementById(id);
                el.value = '';
                if (el.hasAttribute('data-email')) el.setAttribute('data-email', '');
            });
        }

        function exportSelected() {
            showToast('Exporting all...', 'info');
            google.script.run.withSuccessHandler(function (data) {
                var csv = data.headers.join(',') + '\n' + data.rows.map(function (r) { return r.map(function (c) { return '"' + (c || '').replace(/"/g, '""') + '"'; }).join(','); }).join('\n');
                var blob = new Blob([csv], { type: 'text/csv' });
                var a = document.createElement('a');
                a.href = URL.createObjectURL(blob);
                a.download = 'reports_export.csv';
                a.click();
                showToast('Exported!', 'success');
            }).withFailureHandler(function (e) { showToast('Failed: ' + e.message, 'error'); }).exportReportsCSV(null);
        }

        function showToast(msg, type) {
            var t = document.getElementById('toast');
            t.textContent = msg; t.className = 'toast ' + (type || '');
            t.classList.remove('hidden');
            setTimeout(function () { t.classList.add('hidden'); }, 3000);
        }

        function escapeHtml(text) {
            if (!text) return '';
            var div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }

        function debounce(fn, delay) {
            var timeout;
            return function () { clearTimeout(timeout); timeout = setTimeout(fn, delay); };
        }

        /**
         * Convert email to display name
         * firstname.lastname@priceline.com -> Firstname Lastname
         */
        function emailToName(email) {
            if (!email || email === '-') return '-';
            // Handle multiple emails separated by comma or semicolon
            var emails = email.split(/[,;]/).map(function (e) { return e.trim(); });
            return emails.map(function (e) {
                if (!e) return '-';
                var localPart = e.split('@')[0];
                if (!localPart) return e;
                var parts = localPart.split(/[._-]/);
                return parts.map(function (p) {
                    return p.charAt(0).toUpperCase() + p.slice(1).toLowerCase();
                }).join(' ');
            }).join(', ');
        }
    </script>

<? } ?>

<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
     REPORT DETAIL
     ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<? if (page === "report") { ?>
<!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@300;400;500;600&family=Space+Mono:wght@400;700&display=swap"
        rel="stylesheet">

    <!-- Global Theme -->

<div class="app-container">

        <!-- Sidebar -->
        <aside class="sidebar">
            <div class="sidebar-header">
                <span class="logo">√ò</span>
                <div>
                    <div class="module-name">Reporting</div>
                </div>
            </div>

            <nav class="sidebar-nav">
                <a class="nav-item" href="<?= ScriptApp.getService().getUrl() ?>?page=queue">
                    <span class="nav-icon">üìä</span>
                    <span>Reports Queue</span>
                </a>
                <?if (isAdmin) { ?>
                <a class="nav-item" href="<?= ScriptApp.getService().getUrl() ?>?page=admin">
                    <span class="nav-icon">‚öôÔ∏è</span>
                    <span>Admin Panel</span>
                </a>
                <? } ?>
            </nav>

            <div class="sidebar-footer">
                <div class="user-info">
                    <span class="user-email">
                        <?= user ?>
                    </span>
                </div>
            </div>
        </aside>

        <!-- Main Content -->
        <main class="main-content">

            <!-- Header -->
            <div style="display: flex; align-items: center; gap: var(--spacing-md);">
                    <a href="<?= ScriptApp.getService().getUrl() ?>?page=queue" class="btn btn-icon">‚Üê</a>
                    <h1 class="page-title" id="page-title">Report Details</h1>
                </div>
                <div class="header-actions" id="header-actions">
                    <!-- Filled by JS -->
                </div>
            </header>

            <!-- Content -->
            <div class="content" id="content">
                <div class="loading">
                    <div class="spinner"></div>
                    <span>Loading report...</span>
                </div>
            </div>

        </main>
    </div>

    <!-- Toast -->
    <div class="toast hidden" id="toast"></div>

    <script>
        const reportId = '<?= reportId ?>';
        let currentReport = null;

        document.addEventListener('DOMContentLoaded', async function () {
            if (!reportId) {
                document.getElementById('content').innerHTML = '<div class="empty-state"><div class="empty-state-title">No report specified</div></div>';
                return;
            }

            try {
                currentReport = await api.getReportById(reportId);
                renderReport(currentReport);
            } catch (error) {
                document.getElementById('content').innerHTML = '<div class="empty-state"><div class="empty-state-icon">‚ö†Ô∏è</div><div class="empty-state-title">Failed to load report</div><div class="empty-state-text">' + error.message + '</div></div>';
            }
        });

        function renderReport(report) {
            document.getElementById('page-title').textContent = report.name;

            // Header actions
            let actionsHtml = '';
            if (report.state === 'Pending') {
                actionsHtml = `
                    <button class="btn" onclick="rejectReport()" style="border-color: var(--state-rejected); color: var(--state-rejected);">Reject</button>
                    <button class="btn btn-primary" onclick="approveReport()" style="background-color: var(--state-accepted); border-color: var(--state-accepted);">Approve</button>
                `;
            } else if (report.state === 'Rejected') {
                actionsHtml = `<button class="btn" onclick="resubmitReport()">Resubmit for Review</button>`;
            }
            document.getElementById('header-actions').innerHTML = actionsHtml;

            // Content
            document.getElementById('content').innerHTML = `
                <div class="card" style="margin-bottom: var(--spacing-lg);">
                    <div class="card-header">
                        <div>
                            <span class="classification-badge ${report.classification?.toLowerCase()}">${report.classification}</span>
                            <span class="state-badge ${report.state?.toLowerCase()}" style="margin-left: var(--spacing-sm);">${report.state}</span>
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Description</label>
                        <p style="color: var(--text-secondary);">${report.description || 'No description provided'}</p>
                    </div>
                    <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: var(--spacing-md); margin-top: var(--spacing-lg);">
                        <div>
                            <label class="form-label">Frequency</label>
                            <p style="color: var(--text-primary); font-weight: 500;">${report.frequency}</p>
                        </div>
                        <div>
                            <label class="form-label">Team</label>
                            <p style="color: var(--text-primary); font-weight: 500;">${report.team}</p>
                        </div>
                        <div>
                            <label class="form-label">Owner</label>
                            <p style="color: var(--text-primary); font-weight: 500;">${report.owner || '-'}</p>
                        </div>
                    </div>
                </div>
                
                <div class="card" style="margin-bottom: var(--spacing-lg);">
                    <div class="card-header">
                        <h3 class="card-title">RACI Matrix</h3>
                    </div>
                    <div class="raci-grid">
                        <div class="raci-item">
                            <div class="raci-role">R - Responsible</div>
                            <div class="raci-value">${report.responsible || '-'}</div>
                        </div>
                        <div class="raci-item">
                            <div class="raci-role">A - Accountable</div>
                            <div class="raci-value">${report.accountable || '-'}</div>
                        </div>
                        <div class="raci-item">
                            <div class="raci-role">C - Consulted</div>
                            <div class="raci-value">${report.consulted || '-'}</div>
                        </div>
                        <div class="raci-item">
                            <div class="raci-role">I - Informed</div>
                            <div class="raci-value">${report.informed || '-'}</div>
                        </div>
                    </div>
                </div>
                
                ${report.storageLocation || report.dataSource ? `
                <div class="card" style="margin-bottom: var(--spacing-lg);">
                    <div class="card-header">
                        <h3 class="card-title">Data & Storage</h3>
                    </div>
                    ${report.dataSource ? `
                    <div class="form-group">
                        <label class="form-label">Data Source</label>
                        <p style="color: var(--text-secondary); font-family: var(--font-data); font-size: 12px;">${report.dataSource}</p>
                    </div>
                    ` : ''}
                    ${report.storageLocation ? `
                    <div class="form-group">
                        <label class="form-label">Storage Location</label>
                        <p style="color: var(--text-muted); font-family: var(--font-data); font-size: 12px;">${report.storageLocation}</p>
                    </div>
                    ` : ''}
                </div>
                ` : ''}
                
                <div class="card">
                    <div class="card-header">
                        <h3 class="card-title">Metadata</h3>
                    </div>
                    <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: var(--spacing-md);">
                        <div>
                            <label class="form-label">Created By</label>
                            <p style="color: var(--text-secondary);">${report.createdBy || '-'}</p>
                        </div>
                        <div>
                            <label class="form-label">Created At</label>
                            <p style="color: var(--text-muted); font-family: var(--font-data); font-size: 12px;">${report.createdAt || '-'}</p>
                        </div>
                        <div>
                            <label class="form-label">Updated By</label>
                            <p style="color: var(--text-secondary);">${report.updatedBy || '-'}</p>
                        </div>
                        <div>
                            <label class="form-label">Updated At</label>
                            <p style="color: var(--text-muted); font-family: var(--font-data); font-size: 12px;">${report.updatedAt || '-'}</p>
                        </div>
                    </div>
                </div>
            `;
        }

        async function approveReport() {
            try {
                showToast('Processing approval...', 'info');
                await api.changeReportState(reportId, 'Accepted', '');
                showToast('Report approved!', 'success');
                currentReport = await api.getReportById(reportId);
                renderReport(currentReport);
            } catch (error) {
                showToast('Approval failed: ' + error.message, 'error');
            }
        }

        async function rejectReport() {
            const reason = prompt('Please provide a rejection reason:');
            if (reason === null) return;

            try {
                showToast('Processing rejection...', 'info');
                await api.changeReportState(reportId, 'Rejected', reason);
                showToast('Report rejected', 'success');
                currentReport = await api.getReportById(reportId);
                renderReport(currentReport);
            } catch (error) {
                showToast('Rejection failed: ' + error.message, 'error');
            }
        }

        async function resubmitReport() {
            try {
                showToast('Resubmitting...', 'info');
                await api.resubmitReport(reportId);
                showToast('Report resubmitted for review', 'success');
                currentReport = await api.getReportById(reportId);
                renderReport(currentReport);
            } catch (error) {
                showToast('Resubmit failed: ' + error.message, 'error');
            }
        }

        function showToast(message, type = 'info') {
            const toast = document.getElementById('toast');
            toast.textContent = message;
            toast.className = 'toast ' + type;
            toast.classList.remove('hidden');
            setTimeout(() => toast.classList.add('hidden'), 3000);
        }
    </script>

<? } ?>

<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
     DASHBOARD
     ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<? if (page === "dashboard") { ?>
<link
        href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@300;400;500;600&family=Space+Mono:wght@400;700&display=swap"
        rel="stylesheet">
    <script src="https://www.gstatic.com/charts/loader.js"></script>

    <!-- Global Theme -->

<div class="app">
        <div class="header-left">
                <a href="<?= ScriptApp.getService().getUrl() ?>" class="logo">√ò</a>
                <nav class="nav">
                    <a class="nav-link" href="<?= ScriptApp.getService().getUrl() ?>?page=queue">Reports Queue</a>
                    <a class="nav-link" href="<?= ScriptApp.getService().getUrl() ?>?page=admin">Admin Panel</a>
                    <a class="nav-link active"
                        href="<?= ScriptApp.getService().getUrl() ?>?page=dashboard">Dashboard</a>
                </nav>
            </div>
            <div class="header-right">
                <span class="user-badge">
                    <?= user ?>
                </span>
                <span class="admin-badge">Admin</span>
                <button class="theme-toggle" onclick="Theme.toggle()" title="Toggle theme"
                    aria-label="Toggle dark/light mode">
                    <svg class="icon-sun" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <circle cx="12" cy="12" r="5" />
                        <path
                            d="M12 1v2M12 21v2M4.22 4.22l1.42 1.42M18.36 18.36l1.42 1.42M1 12h2M21 12h2M4.22 19.78l1.42-1.42M18.36 5.64l1.42-1.42" />
                    </svg>
                    <svg class="icon-moon" viewBox="0 0 24 24" fill="currentColor">
                        <path
                            d="M21.752 15.002A9.718 9.718 0 0118 15.75c-5.385 0-9.75-4.365-9.75-9.75 0-1.33.266-2.597.748-3.752A9.753 9.753 0 003 11.25C3 16.635 7.365 21 12.75 21a9.753 9.753 0 009.002-5.998z" />
                    </svg>
                </button>
            </div>
        </header>

        <main class="main">
            <div class="page-header">
                <h1 class="page-title">Analytics Dashboard</h1>
                <div class="filters-bar">
                    <div class="filter-group">
                        <span class="filter-label">Team</span>
                        <select class="filter-select" id="filter-team" onchange="applyFilters()">
                            <option value="">All Teams</option>
                        </select>
                    </div>
                    <div class="filter-group">
                        <span class="filter-label">Classification</span>
                        <select class="filter-select" id="filter-class" onchange="applyFilters()">
                            <option value="">All</option>
                            <option value="Master">Master</option>
                            <option value="Derived">Derived</option>
                        </select>
                    </div>
                    <div class="filter-group">
                        <span class="filter-label">Period</span>
                        <select class="filter-select" id="filter-period" onchange="applyFilters()">
                            <option value="">All Time</option>
                            <option value="7">Last 7 Days</option>
                            <option value="30">Last 30 Days</option>
                            <option value="90">Last 90 Days</option>
                        </select>
                    </div>
                    <button class="btn" onclick="resetFilters()">‚Üª Reset</button>
                </div>
            </div>

            <div class="stats-grid">
                <div class="stat-box" onclick="filterByState('')">
                    <div class="stat-number all" id="stat-total">-</div>
                    <div class="stat-label">Total Reports</div>
                </div>
                <div class="stat-box" onclick="filterByState('Pending')">
                    <div class="stat-number pending" id="stat-pending">-</div>
                    <div class="stat-label">Pending</div>
                </div>
                <div class="stat-box" onclick="filterByState('Accepted')">
                    <div class="stat-number accepted" id="stat-accepted">-</div>
                    <div class="stat-label">Accepted</div>
                </div>
                <div class="stat-box" onclick="filterByState('Rejected')">
                    <div class="stat-number rejected" id="stat-rejected">-</div>
                    <div class="stat-label">Rejected</div>
                </div>
            </div>

            <div class="charts-grid">
                <div class="chart-card">
                    <div class="chart-header">
                        <div class="chart-title">Reports by State</div>
                    </div>
                    <div class="chart-container" id="chart-state">
                        <div class="loading">
                            <div class="spinner"></div>
                        </div>
                    </div>
                </div>
                <div class="chart-card">
                    <div class="chart-header">
                        <div class="chart-title">Reports by Team</div>
                    </div>
                    <div class="chart-container" id="chart-team">
                        <div class="loading">
                            <div class="spinner"></div>
                        </div>
                    </div>
                </div>
                <div class="chart-card">
                    <div class="chart-header">
                        <div class="chart-title">Classification Distribution</div>
                    </div>
                    <div class="chart-container" id="chart-class">
                        <div class="loading">
                            <div class="spinner"></div>
                        </div>
                    </div>
                </div>
                <div class="chart-card">
                    <div class="chart-header">
                        <div class="chart-title">Reports by Frequency</div>
                    </div>
                    <div class="chart-container" id="chart-freq">
                        <div class="loading">
                            <div class="spinner"></div>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <script>
        var App = {
            rawData: null,
            filteredData: null,
            colors: ['#6366f1', '#8b5cf6', '#ec4899', '#14b8a6', '#f97316', '#06b6d4', '#22c55e', '#f59e0b']
        };

        google.charts.load('current', { 'packages': ['corechart'] });
        google.charts.setOnLoadCallback(initDashboard);

        function toggleTheme() {
            Theme.toggle();
            if (App.filteredData) drawCharts(App.filteredData);
        }

        function initDashboard() {
            loadDashboardData();
        }

        function loadDashboardData() {
            google.script.run.withSuccessHandler(function (data) {
                App.rawData = data;
                populateTeamFilter(data);
                App.filteredData = data;
                renderStats(data);
                drawCharts(data);
            }).withFailureHandler(function (e) {
                console.error('Failed to load dashboard:', e);
            }).getDashboardStats();
        }

        function populateTeamFilter(data) {
            var select = document.getElementById('filter-team');
            if (data.byTeam) {
                Object.keys(data.byTeam).forEach(function (team) {
                    var opt = document.createElement('option');
                    opt.value = team;
                    opt.textContent = team;
                    select.appendChild(opt);
                });
            }
        }

        function applyFilters() {
            // For now, just refresh - in production this would filter client-side or make new API call
            loadDashboardData();
        }

        function resetFilters() {
            document.getElementById('filter-team').value = '';
            document.getElementById('filter-class').value = '';
            document.getElementById('filter-period').value = '';
            loadDashboardData();
        }

        function filterByState(state) {
            window.location.href = '<?= ScriptApp.getService().getUrl() ?>?page=queue' + (state ? '&state=' + state : '');
        }

        function renderStats(data) {
            document.getElementById('stat-total').textContent = data.totalReports || 0;
            document.getElementById('stat-pending').textContent = data.byState ? data.byState.pending : 0;
            document.getElementById('stat-accepted').textContent = data.byState ? data.byState.accepted : 0;
            document.getElementById('stat-rejected').textContent = data.byState ? data.byState.rejected : 0;
        }

        function drawCharts(data) {
            if (!data) return;
            var isDark = (document.body.getAttribute('data-theme') || 'dark') === 'dark';
            var baseOptions = {
                backgroundColor: 'transparent',
                legend: {
                    position: 'bottom',
                    textStyle: { color: isDark ? '#808080' : '#666666', fontSize: 11 }
                },
                pieSliceTextStyle: { color: '#ffffff', fontSize: 12 },
                chartArea: { width: '90%', height: '75%' },
                titleTextStyle: { color: isDark ? '#f5f5f5' : '#1a1a1a' }
            };

            // State pie chart - with status colors
            if (data.byState) {
                var stateData = google.visualization.arrayToDataTable([
                    ['State', 'Count'],
                    ['Pending', data.byState.pending || 0],
                    ['Accepted', data.byState.accepted || 0],
                    ['Rejected', data.byState.rejected || 0]
                ]);
                var stateChart = new google.visualization.PieChart(document.getElementById('chart-state'));
                stateChart.draw(stateData, Object.assign({}, baseOptions, {
                    colors: ['#f59e0b', '#22c55e', '#ef4444'],
                    pieHole: 0.4
                }));
            }

            // Team pie chart - with vibrant colors
            if (data.byTeam) {
                var teamRows = [['Team', 'Reports']];
                var teamKeys = Object.keys(data.byTeam).sort(function (a, b) { return data.byTeam[b] - data.byTeam[a]; });
                teamKeys.forEach(function (team) {
                    teamRows.push([team, data.byTeam[team]]);
                });
                var teamData = google.visualization.arrayToDataTable(teamRows);
                var teamChart = new google.visualization.PieChart(document.getElementById('chart-team'));
                teamChart.draw(teamData, Object.assign({}, baseOptions, {
                    colors: App.colors,
                    pieHole: 0.4
                }));
            }

            // Classification pie chart - with vibrant colors
            if (data.byClassification) {
                var classData = google.visualization.arrayToDataTable([
                    ['Classification', 'Count'],
                    ['Master', data.byClassification.Master || 0],
                    ['Derived', data.byClassification.Derived || 0]
                ]);
                var classChart = new google.visualization.PieChart(document.getElementById('chart-class'));
                classChart.draw(classData, Object.assign({}, baseOptions, {
                    colors: ['#6366f1', '#ec4899'],
                    pieHole: 0.4
                }));
            }

            // Frequency chart - with vibrant colors
            if (data.byFrequency) {
                var freqRows = [['Frequency', 'Reports']];
                Object.keys(data.byFrequency).forEach(function (freq) {
                    freqRows.push([freq, data.byFrequency[freq]]);
                });
                var freqData = google.visualization.arrayToDataTable(freqRows);
                var freqChart = new google.visualization.PieChart(document.getElementById('chart-freq'));
                freqChart.draw(freqData, Object.assign({}, baseOptions, {
                    colors: ['#14b8a6', '#8b5cf6', '#f97316', '#06b6d4'],
                    pieHole: 0.4
                }));
            } else {
                document.getElementById('chart-freq').innerHTML = '<div style="color:var(--text-muted);font-size:12px;">No frequency data</div>';
            }
        }
    </script>

<? } ?>

<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
     ADMIN PANEL
     ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<? if (page === "admin") { ?>
<link
        href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@300;400;500;600&family=Space+Mono:wght@400;700&display=swap"
        rel="stylesheet">

    <!-- Global Theme -->

<div class="app">
        <div class="header-left">
                <a href="<?= ScriptApp.getService().getUrl() ?>" class="logo">√ò</a>
                <nav class="nav">
                    <a class="nav-link" href="<?= ScriptApp.getService().getUrl() ?>?page=queue">Reports Queue</a>
                    <a class="nav-link active" href="<?= ScriptApp.getService().getUrl() ?>?page=admin">Admin Panel</a>
                    <a class="nav-link" href="<?= ScriptApp.getService().getUrl() ?>?page=dashboard">Dashboard</a>
                </nav>
            </div>
            <div class="header-right">
                <span class="user-badge">
                    <?= user ?>
                </span>
                <span class="admin-badge">Admin</span>
                <button class="theme-toggle" onclick="Theme.toggle()" title="Toggle theme"
                    aria-label="Toggle dark/light mode">
                    <svg class="icon-sun" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <circle cx="12" cy="12" r="5" />
                        <path
                            d="M12 1v2M12 21v2M4.22 4.22l1.42 1.42M18.36 18.36l1.42 1.42M1 12h2M21 12h2M4.22 19.78l1.42-1.42M18.36 5.64l1.42-1.42" />
                    </svg>
                    <svg class="icon-moon" viewBox="0 0 24 24" fill="currentColor">
                        <path
                            d="M21.752 15.002A9.718 9.718 0 0118 15.75c-5.385 0-9.75-4.365-9.75-9.75 0-1.33.266-2.597.748-3.752A9.753 9.753 0 003 11.25C3 16.635 7.365 21 12.75 21a9.753 9.753 0 009.002-5.998z" />
                    </svg>
                </button>
            </div>
        </header>

        <main class="main">
            <!-- Dashboard Stats -->
            <div class="stats-grid" id="stats-grid">
                <div class="stat-box">
                    <div class="stat-number" id="stat-reports">-</div>
                    <div class="stat-label">Total Reports</div>
                </div>
                <div class="stat-box">
                    <div class="stat-number" id="stat-users">-</div>
                    <div class="stat-label">Users</div>
                </div>
                <div class="stat-box">
                    <div class="stat-number" id="stat-pending">-</div>
                    <div class="stat-label">Pending</div>
                </div>
                <div class="stat-box">
                    <div class="stat-number" id="stat-accepted">-</div>
                    <div class="stat-label">Accepted</div>
                </div>
            </div>

            <!-- System Actions -->
            <div class="section">
                <div class="section-title">System Actions</div>
                <div class="actions-grid">
                    <? if (featureFlags.ALLOW_INITIALIZE_SHEETS) { ?>
                    <div class="action-card" onclick="initializeSheets()">
                        <h3>üìã Initialize</h3>
                        <p>Create sheets</p>
                    </div>
                    <? } ?>
                    <? if (featureFlags.ALLOW_IMPORT_REPORTS) { ?>
                    <div class="action-card" onclick="importReports()">
                        <h3>üì• Import Reports</h3>
                        <p>38 reports</p>
                    </div>
                    <? } ?>
                    <div class="action-card" onclick="importUsers()">
                        <h3>üë• Import Users</h3>
                        <p>27 team members</p>
                    </div>
                    <? } ?>
                    <div class="action-card" onclick="initializeAutoCreation()">
                        <h3>‚è∞ Auto-Creation</h3>
                        <p>Init triggers</p>
                    </div>
                    <div class="action-card" onclick="generateDemoData()">
                        <h3>üß™ Demo Data</h3>
                        <p>Generate 1 month</p>
                    </div>
                    <div class="action-card"
                        onclick="window.open('https://docs.google.com/spreadsheets/d/1qCJELcJXwhTeBKC8eULEHiey4ROw_PeZ5zgEwwp2nzU/edit', '_blank')">
                        <h3>üìä Spreadsheet</h3>
                        <p>View raw data</p>
                    </div>
                </div>
            </div>

            <!-- User Management -->
            <div class="section">
                <div class="section-header">
                    <div class="section-title">User Management</div>
                    <button class="add-user-btn" onclick="toggleAddUserForm()">+ Add User</button>
                </div>

                <div class="add-user-form" id="add-user-form">
                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label">Email *</label>
                            <input type="email" class="form-input" id="new-email" placeholder="user@priceline.com">
                        </div>
                        <div class="form-group">
                            <label class="form-label">First Name</label>
                            <input type="text" class="form-input" id="new-firstname" placeholder="John">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Last Name</label>
                            <input type="text" class="form-input" id="new-lastname" placeholder="Doe">
                        </div>
                        <button class="btn btn-primary" onclick="addUser()">Add</button>
                        <button class="btn" onclick="toggleAddUserForm()">Cancel</button>
                    </div>
                </div>

                <div class="card">
                    <div class="card-header">
                        <h3 class="card-title">Registered Users</h3>
                        <button class="btn btn-sm" onclick="loadUsers()">‚Üª</button>
                    </div>
                    <div id="users-list">
                        <div class="loading">
                            <div class="spinner"></div><span>Loading...</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Audit Log -->
            <div class="section">
                <div class="section-title">Audit Log</div>
                <div class="card">
                    <div class="card-header">
                        <h3 class="card-title">Recent Activity</h3>
                        <div style="display:flex;gap:8px;">
                            <select class="form-input" id="audit-filter" style="padding:6px 10px;font-size:12px;"
                                onchange="loadAuditLog()">
                                <option value="">All Actions</option>
                                <option value="CREATE">Create</option>
                                <option value="UPDATE">Update</option>
                                <option value="STATE_CHANGE">State Change</option>
                                <option value="COMMENT">Comment</option>
                                <option value="APPROVE">Approve</option>
                                <option value="REJECT">Reject</option>
                                <option value="DEACTIVATE">Deactivate</option>
                                <option value="EXPORT">Export</option>
                            </select>
                            <button class="btn btn-sm" onclick="loadAuditLog()">‚Üª</button>
                        </div>
                    </div>
                    <div class="audit-wrap" id="audit-log">
                        <div class="loading">
                            <div class="spinner"></div><span>Loading...</span>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <div class="toast hidden" id="toast"></div>

    <script>
        document.addEventListener('DOMContentLoaded', function () {
            loadDashboardStats();
            loadUsers();
            loadAuditLog();
        });

        function toggleTheme() {
            Theme.toggle();
        }

        function loadDashboardStats() {
            google.script.run.withSuccessHandler(function (data) {
                document.getElementById('stat-reports').textContent = data.totalReports || 0;
                document.getElementById('stat-users').textContent = data.totalUsers || 0;
                document.getElementById('stat-pending').textContent = data.byState ? data.byState.pending : 0;
                document.getElementById('stat-accepted').textContent = data.byState ? data.byState.accepted : 0;
            }).getDashboardStats();
        }

        function toggleAddUserForm() {
            document.getElementById('add-user-form').classList.toggle('show');
        }

        function loadUsers() {
            var container = document.getElementById('users-list');
            container.innerHTML = '<div class="loading"><div class="spinner"></div><span>Loading...</span></div>';
            google.script.run.withSuccessHandler(function (users) {
                if (!users || users.length === 0) {
                    container.innerHTML = '<div class="empty-state">No users found.</div>';
                    return;
                }
                container.innerHTML = '<table class="users-table"><thead><tr><th>Name</th><th>Email</th><th>Status</th><th>Actions</th></tr></thead><tbody>' +
                    users.map(function (u) {
                        var active = u.active === true || u.active === 'true' || u.active === 'TRUE';
                        return '<tr><td>' + escapeHtml((u.displayName || u.firstName || '') + ' ' + (u.lastName || '')) + '</td>' +
                            '<td class="email">' + escapeHtml(u.email) + '</td>' +
                            '<td><span class="status-badge ' + (active ? 'active' : 'inactive') + '">' + (active ? 'Active' : 'Inactive') + '</span></td>' +
                            '<td><button class="btn btn-sm ' + (active ? 'btn-danger' : '') + '" onclick="toggleUserStatus(\'' + u.email + '\', ' + !active + ')">' + (active ? 'Deactivate' : 'Activate') + '</button></td></tr>';
                    }).join('') + '</tbody></table>';
            }).withFailureHandler(function (e) {
                container.innerHTML = '<div class="empty-state">Failed: ' + e.message + '</div>';
            }).getAllUsers();
        }

        function addUser() {
            var email = document.getElementById('new-email').value.trim();
            var firstName = document.getElementById('new-firstname').value.trim();
            var lastName = document.getElementById('new-lastname').value.trim();
            if (!email) { showToast('Email required', 'error'); return; }
            showToast('Adding user...', 'info');
            google.script.run.withSuccessHandler(function () {
                showToast('User added!', 'success');
                document.getElementById('new-email').value = '';
                document.getElementById('new-firstname').value = '';
                document.getElementById('new-lastname').value = '';
                toggleAddUserForm();
                loadUsers();
                loadDashboardStats();
            }).withFailureHandler(function (e) { showToast('Failed: ' + e.message, 'error'); }).createUser({ email: email, firstName: firstName, lastName: lastName });
        }

        function toggleUserStatus(email, active) {
            showToast('Updating...', 'info');
            google.script.run.withSuccessHandler(function () {
                showToast('Updated!', 'success');
                loadUsers();
            }).withFailureHandler(function (e) { showToast('Failed: ' + e.message, 'error'); }).updateUser(email, { active: active });
        }

        function loadAuditLog() {
            var container = document.getElementById('audit-log');
            container.innerHTML = '<div class="loading"><div class="spinner"></div><span>Loading...</span></div>';
            var action = document.getElementById('audit-filter').value || '';
            google.script.run.withSuccessHandler(function (entries) {
                if (!entries || entries.length === 0) {
                    container.innerHTML = '<div class="empty-state">No audit entries found.</div>';
                    return;
                }
                container.innerHTML = '<table class="audit-table"><thead><tr><th>Time</th><th>User</th><th>Action</th><th>Entity</th><th>Details</th></tr></thead><tbody>' +
                    entries.map(function (e) {
                        return '<tr><td>' + (e.timestamp || '-') + '</td>' +
                            '<td>' + escapeHtml(e.user || '-') + '</td>' +
                            '<td><span class="action-badge ' + (e.action || '').toLowerCase() + '">' + (e.action || '-') + '</span></td>' +
                            '<td>' + escapeHtml(e.entityType || '-') + '</td>' +
                            '<td style="max-width:200px;overflow:hidden;text-overflow:ellipsis;">' + escapeHtml(e.details || '-') + '</td></tr>';
                    }).join('') + '</tbody></table>';
            }).withFailureHandler(function (e) {
                container.innerHTML = '<div class="empty-state">Failed: ' + e.message + '</div>';
            }).getAuditLog({ action: action, limit: 100 });
        }

        function initializeSheets() {
            showToast('Initializing...', 'info');
            google.script.run.withSuccessHandler(function () { showToast('Done!', 'success'); loadAuditLog(); }).withFailureHandler(function (e) { showToast('Failed: ' + e.message, 'error'); }).initializeSheets();
        }

        function importReports() {
            if (!confirm('Import 38 reports?')) return;
            showToast('Importing...', 'info');
            google.script.run.withSuccessHandler(function (count) { showToast('Imported ' + count, 'success'); loadAuditLog(); loadDashboardStats(); }).withFailureHandler(function (e) { showToast('Failed: ' + e.message, 'error'); }).importReportsFromData();
        }

        function importUsers() {
            if (!confirm('Import 27 team members?')) return;
            showToast('Importing...', 'info');
            google.script.run.withSuccessHandler(function (count) { showToast('Imported ' + count, 'success'); loadUsers(); loadAuditLog(); loadDashboardStats(); }).withFailureHandler(function (e) { showToast('Failed: ' + e.message, 'error'); }).importSampleUsers();
        }

        function initializeAutoCreation() {
            if (!confirm('Initialize daily auto-creation triggers? This will run daily at 1 AM.')) return;
            showToast('Initializing triggers...', 'info');
            google.script.run.withSuccessHandler(function (res) { showToast(res.message, 'success'); loadAuditLog(); }).withFailureHandler(function (e) { showToast('Failed: ' + e.message, 'error'); }).initializeAutoCreation();
        }

        function generateDemoData() {
            if (!confirm('Generate 1 month of demo data? This may take a minute.')) return;
            showToast('Generating data...', 'info');
            google.script.run.withSuccessHandler(function (count) { showToast('Generated ' + count + ' demo reports', 'success'); loadDashboardStats(); loadAuditLog(); }).withFailureHandler(function (e) { showToast('Failed: ' + e.message, 'error'); }).generateDemoData();
        }

        function showToast(msg, type) {
            var t = document.getElementById('toast');
            t.textContent = msg; t.className = 'toast ' + (type || '');
            t.classList.remove('hidden');
            setTimeout(function () { t.classList.add('hidden'); }, 3000);
        }

        function escapeHtml(text) {
            if (!text) return '';
            var div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }
    </script>

<? } ?>

<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
     INFO PAGE (About/Privacy/Data Retention)
     ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<? if (page === "about" || page === "privacy" || page === "data-retention") { ?>
<title>
        <?= pageTitle ?> - √òN
    </title>
    <link
        href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@300;400;500;600&family=Space+Mono:wght@400;700&display=swap"
        rel="stylesheet">

    <!-- Global Theme -->

<div class="container">
        <div
            style="display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: var(--spacing-lg);">
            <a href="<?= ScriptApp.getService().getUrl() ?>" class="logo">√ò</a>
            <button class="theme-toggle" onclick="Theme.toggle()" title="Toggle theme"
                aria-label="Toggle dark/light mode">
                <svg class="icon-sun" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <circle cx="12" cy="12" r="5" />
                    <path
                        d="M12 1v2M12 21v2M4.22 4.22l1.42 1.42M18.36 18.36l1.42 1.42M1 12h2M21 12h2M4.22 19.78l1.42-1.42M18.36 5.64l1.42-1.42" />
                </svg>
                <svg class="icon-moon" viewBox="0 0 24 24" fill="currentColor">
                    <path
                        d="M21.752 15.002A9.718 9.718 0 0118 15.75c-5.385 0-9.75-4.365-9.75-9.75 0-1.33.266-2.597.748-3.752A9.753 9.753 0 003 11.25C3 16.635 7.365 21 12.75 21a9.753 9.753 0 009.002-5.998z" />
                </svg>
            </button>
        </div>

        <? if (pageType === 'about') { ?>
        <!-- ABOUT -->
        <h1 class="title">About ORION</h1>

        <div class="section">
            <h2>What It Is</h2>
            <p>ORION (Operations Reporting Intelligence Operational Nexus) is an enterprise-grade unified operations
                platform built on Google Apps Script with Google Sheets as the backend datastore.</p>
        </div>

        <div class="section">
            <h2>The Modules</h2>
            <div class="module-grid">
                <div class="module-card">
                    <div class="module-icon">üìà</div>
                    <div class="module-name">RT</div>
                    <div class="module-desc">Reporting</div>
                </div>
                <div class="module-card">
                    <div class="module-icon">üìã</div>
                    <div class="module-name">CB</div>
                    <div class="module-desc">Chargeback</div>
                </div>
                <div class="module-card">
                    <div class="module-icon">‚úÖ</div>
                    <div class="module-name">CBQA</div>
                    <div class="module-desc">Chargeback QA</div>
                </div>
                <div class="module-card">
                    <div class="module-icon">üîç</div>
                    <div class="module-name">FAQ</div>
                    <div class="module-desc">Fraud Analysis</div>
                </div>
                <div class="module-card">
                    <div class="module-icon">üìä</div>
                    <div class="module-name">FAQA</div>
                    <div class="module-desc">Fraud QA</div>
                </div>
                <div class="module-card">
                    <div class="module-icon">üìÅ</div>
                    <div class="module-name">ON</div>
                    <div class="module-desc">Operations</div>
                </div>
            </div>
        </div>

        <div class="section">
            <h2>Key Features</h2>
            <ul>
                <li>Role-based access control (Admin, Manager, Analyst, Viewer)</li>
                <li>Complete audit trail for every action</li>
                <li>RACI workflow for approval governance</li>
                <li>AI-powered text analytics (GPT-4o-mini)</li>
                <li>Config-first design‚Äîeverything configurable</li>
            </ul>
        </div>

        <div class="creator">
            <div class="creator-name">Naitik Joshi</div>
            <div class="creator-role">Creator / Architect</div>
        </div>

        <? } else if (pageType === 'privacy') { ?>
        <!-- PRIVACY -->
        <h1 class="title">Privacy Policy</h1>
        <p class="updated">Last updated: January 2026</p>

        <div class="section">
            <h2>Data Collected</h2>
            <ul>
                <li>Google Workspace email (for authentication)</li>
                <li>Report metadata, RACI assignments, workflow states</li>
                <li>Chargeback rebuttal documents (CB module)</li>
                <li>Audit logs of system actions</li>
            </ul>
        </div>

        <div class="section">
            <h2>Where Data Is Stored</h2>
            <p>All data stored in Google Sheets within your organization's Google Workspace. Subject to your org's data
                governance policies.</p>
        </div>

        <div class="section">
            <h2>Data Processing</h2>
            <ul>
                <li>All processing within Google Apps Script</li>
                <li>AI processing via OpenAI API (optional)</li>
                <li>No data sold or shared with third parties</li>
            </ul>
        </div>

        <? } else if (pageType === 'data-retention') { ?>
        <!-- DATA RETENTION -->
        <h1 class="title">Data Retention Policy</h1>
        <p class="updated">Last updated: January 2026</p>

        <div class="section">
            <h2>Retention by Data Type</h2>
            <table>
                <thead>
                    <tr>
                        <th>Data Type</th>
                        <th>Retention</th>
                        <th>Notes</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>Reports</td>
                        <td>Indefinite</td>
                        <td>Until admin deletes</td>
                    </tr>
                    <tr>
                        <td>Audit Logs</td>
                        <td>Indefinite</td>
                        <td>Never auto-deleted</td>
                    </tr>
                    <tr>
                        <td>Users</td>
                        <td>Until Deactivated</td>
                        <td>Admin deactivates</td>
                    </tr>
                    <tr>
                        <td>CB Documents</td>
                        <td>Indefinite</td>
                        <td>Raw text optional</td>
                    </tr>
                </tbody>
            </table>
        </div>

        <div class="section">
            <h2>Deletion Rights</h2>
            <ul>
                <li>Admins can delete or deactivate reports</li>
                <li>Soft-delete is recoverable</li>
                <li>Hard deletion is permanent</li>
                <li>Audit logs of deletions are retained</li>
            </ul>
        </div>

        <? } ?>

        <a href="<?= ScriptApp.getService().getUrl() ?>" class="back-link">‚Üê Back to Home</a>
    </div>

<? } ?>

</body>
</html>